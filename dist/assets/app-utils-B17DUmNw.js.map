{"version":3,"mappings":"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","names":["supabase","baseClient","adminSupabase","adminClient","ExponentialBackoff","static","maxRetries","baseDelay","maxDelay","backoffFactor","jitter","retry","operation","options","config","this","DEFAULT_OPTIONS","startTime","Date","now","lastError","attempt","success","data","attempts","totalTime","error","Error","String","delay","calculateDelay","sleep","Math","pow","min","random","floor","ms","Promise","resolve","setTimeout","retrySessionRefresh","retryApiCall","retryAuth","SessionValidator","validateCurrentSession","session","auth","getSession","isValid","needsRefresh","shouldSignOut","message","expiresAt","expires_at","refreshSessionIfNeeded","validation","async","refreshSession","SessionManager","handleSessionError","validateBeforeApiCall","isAuthenticated","clearSession","SessionCleanup","performCleanup","clearLocalStorage","clearSessionStorage","clearIndexedDB","clearCookies","signOut","clearLocalStorageItems","clearSessionStorageItems","clearIndexedDBItems","clearAuthCookies","window","localStorage","forEach","key","removeItem","itemError","Object","keys","startsWith","includes","keysError","sessionStorage","databases","indexedDB","db","name","deleteRequest","deleteDatabase","reject","onsuccess","onerror","cookieName","document","cookie","location","hostname","emergencyCleanup","reload","logoutCleanup","refreshFailureCleanup","AutoReloginFlow","isReloginInProgress","storedCredentials","reloginQueue","constructor","getInstance","instance","storeCredentials","email","password","clearCredentials","hasStoredCredentials","attemptAutoRelogin","retryDelay","showNotifications","onSuccess","onFailure","push","hasValidSession","toast","title","description","variant","reloginResult","signInWithPassword","processReloginQueue","callbacks","callback","handleRefreshFailure","validateSessionForApiCall","refreshData","refreshError","autoReloginFlow","validateSession","attemptRefresh","redirectToLogin","reloginError","fallbackToManualLogin","href","periodicValidation","lastCheck","CHECK_INTERVAL","result","isLocalhost","Boolean","match","register","navigator","URL","origin","addEventListener","swUrl","fetch","headers","then","response","contentType","get","status","indexOf","serviceWorker","ready","registration","unregister","registerValidSW","catch","checkValidServiceWorker","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","cn","inputs","twMerge","clsx","formatCurrency","amount","currency","locale","Intl","NumberFormat","style","minimumFractionDigits","maximumFractionDigits","format","lazyLoadPages","Dashboard","import","n","bk","__VITE_PRELOAD__","ManagerDashboard","__vitePreload","c","AgentDashboard","d","OperationsDashboard","e","SalesDashboard","f","ContentDashboard","g","SupportDashboard","h","FinanceDashboard","i","StaffDashboard","j","AgentManagement","w","StaffManagement","F","AdminManagement","M","AdminUsers","N","AdminRoleManager","Q","Settings","v","GeneralSettings","AccountSettings","NotificationSettings","AppearanceSettings","k","LanguageManager","l","ApiSettings","m","AccessControl","AgentSettings","o","TranslationTool","p","PricingSettings","q","EmailTemplates","r","CurrencyConverter","s","EmailConfiguration","t","MarketingCommunications","bq","SmsOtpSettings","u","AddHotel","I","AddRoomType","J","EditRoomType","K","AddRoomTypePage","EditHotel","ViewHotel","O","CreateQuery","QueryDetails","Queries","TravelEnquiryHub","T","AssignQueries","EditQuery","AdvancedProposalCreation","EnhancedDayWiseBuilder","bp","FollowUps","bm","BookingManagement","bn","ItineraryBuilder","bo","AddAgent","x","ManagementAgentProfile","y","EditAgent","z","AddStaff","G","Departments","StaffProfile","EditStaff","PayrollPage","LeavesPage","AttendanceManagement","SalaryStructureManager","StaffDocsVerification","BankVerification","Onboarding","Offboarding","AgentProfileModern","TravelerDashboardPage","br","TravelerItineraryPage","bs","TravelerHistoryPage","bt","TravelerNotificationsPage","bu","TravelerProfilePage","bx","TravelerSettingsPage","bv","TravelerSupportPage","bw","SalesEnquiries","bg","SalesBookings","bh","SalesAgents","bi","SalesReports","bj","routeChunkGroups","critical","management","dashboards","settings","inventory","queries","traveler","sales","lazyLoadServices","aiIntegrationService","bU","universalPDFService","c0","emailService","bQ","comprehensiveTransportService","bV","integratedTransportService","bW","transportRouteErrorService","c1","locationResolutionService","bz","telemetryService","by","agentManagementService","bA","countriesService","bJ","citiesService","bL","locationCodesService","bP","appSettingsService","appSettingsService_database","metaSettingsService","b$","countryEmailSettingsService","bT","emailConfigurationService","bS","emailTemplateService","bR","authService","credentialService","bY","loginRecordService","profilesHelper","bC","userTrackingService","departmentService","bX","staffAssignmentService","bE","staffBankService","b_","staffDocumentsService","bZ","staffReferralService","bB","staffSequenceService","bF","enquiriesService","bH","proposalService","bN","enhancedProposalService","bM","supabaseProposalService","bO","assignmentRulesService","bG","autoAssignmentEngine","bI","workflowEventsService","bD","aiRouter","bK","supabaseConnectionTest","bl","activityDataUtils","enqIdGenerator","preloadCriticalChunks","criticalServices","all","map","service","criticalComponents","component","preloadRouteGroup","groupName","group","components","pageName","loader","preloadServicesForRole","userRole","services","super_admin","manager","admin","staff","agent","user","generateUsernameFromName","toLowerCase","replace","split","filter","part","length","join","generateSecurePassword","uppercase","lowercase","numbers","symbols","allChars","sort","validatePasswordStrength","feedback","score","test","checkUsernameUniqueness","username","excludeId","JSON","parse","getItem","some","id","storeAgentCredentials","credentials","updatedCredentials","getStoredAgentCredentials","cred","agentId","setItem","stringify","stored","changeAgentPassword","oldPassword","newPassword","agentCredential","find","updatedCredential","forcePasswordChange","isTemporary","COUNTRY_ALIASES","UAE","Emirates","Thailand","Thai","USA","America","UK","Britain","England","getCountryCodeByName","countryName","normalizedName","trim","aliasCode","exactMatch","initialCountries","code","partialMatch","checkBucketExists","bucket","isAdminClientConfigured","storage","getBucket","msg","exists","errorMessage","from","list","limit","err","currencyCode","toUpperCase","toNumericAgentId","uuid","hex","slice","Number","parseInt","findSupabaseAgentByNumericId","numericId","item","country","India","Japan","Australia","Canada","Germany","France","Italy","Spain","Netherlands","Switzerland","Singapore","Malaysia","Indonesia","Philippines","Vietnam","China","Brazil","Mexico","Argentina","Chile","Egypt","Turkey","Russia","Poland","Hungary","Croatia","Romania","Bulgaria","Norway","Sweden","Denmark","Iceland","Finland","Belgium","Austria","Portugal","Greece","Ireland","Luxembourg","Malta","Cyprus","Estonia","Latvia","Lithuania","Slovakia","Slovenia","Israel","Jordan","Lebanon","Morocco","Tunisia","Kenya","Tanzania","Uganda","Ghana","Nigeria","Botswana","Namibia","Zambia","Zimbabwe","Mauritius","Seychelles","Madagascar","Nepal","Bhutan","Bangladesh","Pakistan","Afghanistan","Iran","Iraq","Kuwait","Bahrain","Qatar","Oman","Yemen","Uzbekistan","Kazakhstan","Kyrgyzstan","Tajikistan","Turkmenistan","Mongolia","Myanmar","Laos","Cambodia","Brunei","Fiji","Vanuatu","Samoa","Tonga","Palau","Micronesia","Kiribati","Tuvalu","Nauru","getCurrencyByCountry","symbol","calculateTripDuration","fromDate","toDate","start","end","diffTime","abs","getTime","diffDays","ceil","days","nights","EnqIdGenerator","validateCountryForEnquiry","countryCode","cached","codes","Array","isArray","getApplicationSettings","savedSettings","enquirySettings","countries","DEFAULT_ENQUIRY_COUNTRIES","defaultCountryCode","buildEnquiryId","sequenceNumber","prefix","yearFormat","yearSeparator","numberLength","numberSeparator","year","getFullYear","toString","numberStr","minLength","paddedNumber","padStart","enquiryId","prepareConfig","ensureCountryConfig","CountriesService","getCountriesByStatus","generateEnqId","targetCountryCode","isActive","savedQueries","currentYear","searchPattern","maxNumber","startingNumber","query","afterPrefix","substring","numberPart","number","isNaN","nextNumber","max","validateEnqId","pattern","RegExp","getCountryFromEnqId","ProposalIdGenerator","getNextProposalSequence","enqId","getProposalsByEnqId","saved","queryId","generateProposalId","parseProposalId","proposalId","sequence","getLatestProposalId","proposals","parsed","loadComprehensiveItineraryData","storageKeys","savedData","transformToComprehensiveData","parseError","rawData","defaultData","accommodationSelections","enhancedData","accommodationOptions","sightseeingActivities","transportRoutes","transferConfigurations","version","savedAt","toISOString","totalCost","calculateTotalCost","extractEnhancedDataFromDays","timestamp","day","index","dayId","accommodations","acc","optionIndex","hotelName","hotel","hotelType","type","roomType","numberOfRooms","rooms","city","numberOfNights","checkInDate","checkIn","date","checkOutDate","checkOut","starRating","amenities","price","totalPrice","pricePerNight","option","address","phone","activities","activity","sightseeingName","sightseeingDescription","sightseeingType","category","transportType","groupSize","effectivePax","packageIncludes","packageOptions","selectedOptions","inclusions","coordinates","endTime","duration","cost","transferConfiguration","vehicleType","vehicleName","vehicleNumbers","transferType","pickupLocation","dropLocation","dropoffLocation","pickupTime","dropTime","capacity","seatingCapacity","transport","routeName","to","routeCode","substr","pickupLocations","vehicleConfiguration","numberOfVehicles","vehicleCount","totalCapacity","schedules","departureTime","arrivalTime","pickupTimes","time","transfers","reduce","total","ensureThreeAccommodationOptions","existingOptions","defaultOptions","dayData","baseOption","generateDefaultAccommodationOptions","filledOptions","saveAccommodationData","updatedDays","dayAccommodations","dayIds","mapAccommodationsToDays","draftData","sum","calculateAccommodationStay","hotelId","hotelCategory","pricePerNightPerRoom","startDay","optionNumber","checkInDay","checkOutDay","stayDays","_","calculateTotalAccommodationCost","accommodation","groupAccommodationsByDay","dayGroups","calculateAccommodationPricing","adults","paxDetails","children","baseRoomCost","childrenExtraCharges","childrenCount","totalCharges","numberOfChildren","extraBeds","calculateChildrenExtraCharges","count","pricePerPerson","discountPercentage","priceStructure","calculateAccommodationOptionsPricing","optionAccommodations","pricingBreakdown","getOptionDisplayConfig","configs","icon","colorClass","borderClass","bgClass","badgeClass","computeProposalSummarySnapshot","totalPax","serviceCosts","sightseeingTotal","transportTotal","sightseeing","perPersonCost","dining","totalRooms","totalNights","calculateServiceCosts","baseCost","accommodationOptionsPricing","optionData","opt","baseTotal","markup","finalTotal","distribution","method","adultPrice","childPrice","accommodationCost","totalBaseAmount","destination","lastCalculated","snapshotToEnhancedMarkupData","snapshot","selectedOption","markupSettings","percentage","slabs","minAmount","maxAmount","Infinity","dispatchProposalSummaryUpdate","event","CustomEvent","detail","dispatchEvent","enhanceActivityData","baseActivity","isDataComplete","lastUpdated","pricingOptions","transferOptions","dataSource","transportLabel","priceBreakdown","basePrice","finalPrice","validateActivityDataCompleteness","validationErrors","getActivityValidationErrors","errors","calculateActivityStats","allActivities","flatMap","complete","a","incomplete","byType","meal","byDataSource","manual","incompleteActivities","loadActivityStats","enhancedDays","stats","dataToSave","activityStats","validationSummary","totalActivities","completeActivities","dataQualityScore","round","getISTTime","utc","getTimezoneOffset","getMillisecondsUntilNextIST","hour","minute","nextScheduled","scheduled","setHours","setDate","getDate","getNextISTSchedule","formatISTTime","toLocaleString","timeZone","second","month","importTransportRoutes","file","validate","continueOnError","importMode","upsertBy","routes","ext","pop","workbook","XLSX.read","arrayBuffer","sheet","Sheets","SheetNames","XLSX.utils","sheet_to_json","text","Papa","header","skipEmptyLines","validRows","invalidRows","raw","route","normalizeImportRow","missing","cleanData","route_code","generateCode","transfer_type","sanitizeTransferType","start_location","startLocation","end_location","endLocation","sanitizeStatus","notes","enable_sightseeing","enableSightseeing","delError","delete","neq","conflictTarget","upsert","onConflict","ignoreDuplicates","select","insert","validCount","invalidCount","parseTransportRoutes","intermediate_stops","parseJSON","intermediateStops","transport_types","transportTypes","sightseeing_options","sightseeingOptions","exportTransportRoutes","filename","selectedFields","filters","baseFilename","sb","routesQuery","statusFilter","countryFilter","eq","routesError","routeList","routeIds","stopsByRoute","typesByRoute","sightByRoute","stopsRes","in","hasTransportTypesRouteId","typesRes","sightRes","rid","route_id","inline","vehicle_types","rows","maps","route_name","distance","mapRouteToExportRow","finalRows","row","fields","out","pickFields","blob","Blob","meta","routeCount","rowsCount","csv","unparse","quotes","wb","book_new","ws","json_to_sheet","book_append_sheet","xlsxBuffer","XLSX.write","bookType","val","obj","refreshSupabaseSession","enableSmoothThemeTransitions","createElement","textContent","head","appendChild","existingStyle","getElementById","remove","preloadLogos","lightLogo","darkLogo","logoUrl","Image","src","LogoCache","cache","Map","set","value","clear","bustCache","url","separator","themeUtils","prefersReducedMotion","matchMedia","matches","getStoredTheme","storeTheme","theme","removeStoredTheme","onThemeChange","mediaQuery","handler","removeEventListener","themeAccessibility","getContrastColor","backgroundColor","getToggleAriaAttributes","currentTheme","role","getScreenReaderText","computeLastMonthRange","getMonth","lastMonth","lastMonthYear","fmt","buildExportFilename","scope","mapQueryToExportRow","travelDates","EnquiryID","AgentName","agentName","AgentCompany","agentCompany","Country","Cities","cities","Nights","tripDuration","Days","TravelFrom","TravelTo","Adults","Children","Infants","infants","PackageType","packageType","Status","BudgetMin","budget","BudgetMax","BudgetCurrency","CreatedAt","createdAt","UpdatedAt","updatedAt","validateEmployeeCode","isEmployeeCodeUnique","staffMembers","employeeId","fetchEmployeeIdsFromTable","client","table","not","employee_id","generateEmployeeCodeFromDB","ids","profiles","nums","next"],"ignoreList":[],"sources":["../../src/lib/supabaseClient.ts","../../src/utils/exponentialBackoff.ts","../../src/utils/sessionValidation.ts","../../src/utils/sessionCleanup.ts","../../src/utils/autoReloginFlow.ts","../../src/utils/sessionManager.ts","../../src/utils/serviceWorkerRegistration.ts","../../src/lib/utils.ts","../../src/utils/dynamicImports.ts","../../src/utils/credentialGenerator.ts","../../src/utils/agentAuth.ts","../../src/utils/countryUtils.ts","../../src/lib/storageChecks.ts","../../src/lib/formatters.ts","../../src/utils/supabaseAgentIds.ts","../../src/utils/currencyUtils.ts","../../src/utils/enqIdGenerator.ts","../../src/utils/proposalIdGenerator.ts","../../src/utils/enhancedItineraryUtils.ts","../../src/utils/accommodationUtils.ts","../../src/utils/accommodationCalculations.ts","../../src/utils/accommodationPricingUtils.ts","../../src/utils/markupSync.ts","../../src/utils/activityDataUtils.ts","../../src/utils/timezoneUtils.ts","../../src/utils/transportRoutesImportExport.ts","../../src/utils/supabaseSessionRefresh.ts","../../src/utils/themeUtils.ts","../../src/utils/exportUtils.ts","../../src/utils/employeeCodeGenerator.ts"],"sourcesContent":["// Centralized Supabase clients to avoid multiple GoTrueClient instances.\n// Re-export existing configured clients so the app uses a single auth instance.\n\nimport { supabase as baseClient, authHelpers } from '@/integrations/supabase/client';\nimport { supabaseAdmin as adminClient, isAdminClientConfigured } from '@/integrations/supabase/adminClient';\n\n// Primary client for app usage\nexport const supabase = baseClient;\n\n// Admin/service-role client (server-only). In browser, fall back to base client to prevent\n// multiple GoTrueClient instances and avoid runtime null dereferencing.\nexport const adminSupabase = adminClient || baseClient;\n\n// Flag to know if admin client is configured\nexport { isAdminClientConfigured };\n\n// Auth helpers from the base client\nexport { authHelpers };","/**\n * Exponential Backoff Utility\n * Provides retry logic with exponential backoff for failed operations\n */\n\nexport interface RetryOptions {\n  maxRetries?: number;\n  baseDelay?: number;\n  maxDelay?: number;\n  backoffFactor?: number;\n  jitter?: boolean;\n}\n\nexport interface RetryResult<T> {\n  success: boolean;\n  data?: T;\n  error?: Error;\n  attempts: number;\n  totalTime: number;\n}\n\nexport class ExponentialBackoff {\n  private static readonly DEFAULT_OPTIONS: Required<RetryOptions> = {\n    maxRetries: 3,\n    baseDelay: 1000, // 1 second\n    maxDelay: 30000, // 30 seconds\n    backoffFactor: 2,\n    jitter: true\n  };\n\n  /**\n   * Retry an async operation with exponential backoff\n   */\n  static async retry<T>(\n    operation: () => Promise<T>,\n    options: RetryOptions = {}\n  ): Promise<RetryResult<T>> {\n    const config = { ...this.DEFAULT_OPTIONS, ...options };\n    const startTime = Date.now();\n    let lastError: Error | undefined;\n\n    for (let attempt = 0; attempt <= config.maxRetries; attempt++) {\n      try {\n        const result = await operation();\n        return {\n          success: true,\n          data: result,\n          attempts: attempt + 1,\n          totalTime: Date.now() - startTime\n        };\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n        \n        // If this was the last attempt, don't wait\n        if (attempt === config.maxRetries) {\n          break;\n        }\n\n        // Calculate delay for next attempt\n        const delay = this.calculateDelay(attempt, config);\n        await this.sleep(delay);\n      }\n    }\n\n    return {\n      success: false,\n      error: lastError,\n      attempts: config.maxRetries + 1,\n      totalTime: Date.now() - startTime\n    };\n  }\n\n  /**\n   * Calculate delay for the given attempt\n   */\n  private static calculateDelay(attempt: number, config: Required<RetryOptions>): number {\n    // Calculate exponential delay\n    let delay = config.baseDelay * Math.pow(config.backoffFactor, attempt);\n    \n    // Apply maximum delay limit\n    delay = Math.min(delay, config.maxDelay);\n    \n    // Add jitter to prevent thundering herd\n    if (config.jitter) {\n      delay = delay * (0.5 + Math.random() * 0.5);\n    }\n    \n    return Math.floor(delay);\n  }\n\n  /**\n   * Sleep for the specified number of milliseconds\n   */\n  private static sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Retry with specific configuration for session refresh\n   */\n  static async retrySessionRefresh<T>(\n    operation: () => Promise<T>\n  ): Promise<RetryResult<T>> {\n    return this.retry(operation, {\n      maxRetries: 2,\n      baseDelay: 500,\n      maxDelay: 5000,\n      backoffFactor: 2,\n      jitter: true\n    });\n  }\n\n  /**\n   * Retry with specific configuration for API calls\n   */\n  static async retryApiCall<T>(\n    operation: () => Promise<T>\n  ): Promise<RetryResult<T>> {\n    return this.retry(operation, {\n      maxRetries: 3,\n      baseDelay: 1000,\n      maxDelay: 10000,\n      backoffFactor: 2,\n      jitter: true\n    });\n  }\n\n  /**\n   * Retry with specific configuration for authentication\n   */\n  static async retryAuth<T>(\n    operation: () => Promise<T>\n  ): Promise<RetryResult<T>> {\n    return this.retry(operation, {\n      maxRetries: 1,\n      baseDelay: 2000,\n      maxDelay: 5000,\n      backoffFactor: 2,\n      jitter: false\n    });\n  }\n}\n\n/**\n * Utility function for simple retry with default options\n */\nexport const retryWithBackoff = <T>(\n  operation: () => Promise<T>,\n  options?: RetryOptions\n): Promise<RetryResult<T>> => {\n  return ExponentialBackoff.retry(operation, options);\n};","import { supabase } from '../lib/supabaseClient';\nimport { SessionManager } from './sessionManager';\nimport { ExponentialBackoff } from './exponentialBackoff';\n\nexport interface SessionValidationResult {\n  isValid: boolean;\n  needsRefresh: boolean;\n  shouldSignOut: boolean;\n  error?: string;\n}\n\nexport class SessionValidator {\n  /**\n   * Validates the current session and determines the appropriate action\n   */\n  static async validateCurrentSession(): Promise<SessionValidationResult> {\n    try {\n      const { data: { session }, error } = await supabase.auth.getSession();\n      \n      if (error) {\n        console.error('Session validation error:', error);\n        return {\n          isValid: false,\n          needsRefresh: false,\n          shouldSignOut: true,\n          error: error.message\n        };\n      }\n\n      if (!session) {\n        return {\n          isValid: false,\n          needsRefresh: false,\n          shouldSignOut: false\n        };\n      }\n\n      // Check if token is expired or about to expire (within 5 minutes)\n      const expiresAt = session.expires_at;\n      const now = Math.floor(Date.now() / 1000);\n      const fiveMinutesFromNow = now + (5 * 60);\n\n      if (expiresAt && expiresAt <= now) {\n        // Token is already expired\n        return {\n          isValid: false,\n          needsRefresh: true,\n          shouldSignOut: false\n        };\n      }\n\n      if (expiresAt && expiresAt <= fiveMinutesFromNow) {\n        // Token expires within 5 minutes, should refresh\n        return {\n          isValid: true,\n          needsRefresh: true,\n          shouldSignOut: false\n        };\n      }\n\n      // Session is valid and not expiring soon\n      return {\n        isValid: true,\n        needsRefresh: false,\n        shouldSignOut: false\n      };\n    } catch (error) {\n      console.error('Session validation failed:', error);\n      return {\n        isValid: false,\n        needsRefresh: false,\n        shouldSignOut: true,\n        error: error instanceof Error ? error.message : 'Unknown error'\n      };\n    }\n  }\n\n  /**\n   * Attempts to refresh the session if needed\n   */\n  static async refreshSessionIfNeeded(): Promise<boolean> {\n    const validation = await this.validateCurrentSession();\n    \n    if (!validation.needsRefresh) {\n      return validation.isValid;\n    }\n\n    // Use exponential backoff for session refresh attempts\n    const refreshResult = await ExponentialBackoff.retrySessionRefresh(async () => {\n      const { data, error } = await supabase.auth.refreshSession();\n      \n      if (error) {\n        throw new Error(`Session refresh failed: ${error.message}`);\n      }\n\n      if (!data.session) {\n        throw new Error('Session refresh returned no session');\n      }\n\n      return data.session;\n    });\n\n    if (refreshResult.success) {\n      console.log(`Session refreshed successfully after ${refreshResult.attempts} attempt(s)`);\n      return true;\n    } else {\n      console.error(`Session refresh failed after ${refreshResult.attempts} attempt(s):`, refreshResult.error);\n      await SessionManager.handleSessionError('Session refresh failed. Please sign in again.', true);\n      return false;\n    }\n  }\n\n  /**\n   * Validates session before making API calls\n   */\n  static async validateBeforeApiCall(): Promise<boolean> {\n    const validation = await this.validateCurrentSession();\n    \n    if (validation.shouldSignOut) {\n      await SessionManager.handleSessionError('Your session is invalid. Please sign in again.', true);\n      return false;\n    }\n\n    if (!validation.isValid && !validation.needsRefresh) {\n      // No session at all\n      return false;\n    }\n\n    if (validation.needsRefresh) {\n      return await this.refreshSessionIfNeeded();\n    }\n\n    return validation.isValid;\n  }\n\n  /**\n   * Checks if the user has a valid session for protected routes\n   */\n  static async isAuthenticated(): Promise<boolean> {\n    const validation = await this.validateCurrentSession();\n    \n    if (validation.shouldSignOut) {\n      await SessionManager.clearSession();\n      return false;\n    }\n\n    if (validation.needsRefresh) {\n      return await this.refreshSessionIfNeeded();\n    }\n\n    return validation.isValid;\n  }\n}\n\nexport default SessionValidator;","import { supabase } from '../lib/supabaseClient';\n\nexport interface CleanupOptions {\n  clearLocalStorage?: boolean;\n  clearSessionStorage?: boolean;\n  clearIndexedDB?: boolean;\n  clearCookies?: boolean;\n}\n\nexport class SessionCleanup {\n  /**\n   * Comprehensive session cleanup utility\n   */\n  static async performCleanup(options: CleanupOptions = {}): Promise<void> {\n    const {\n      clearLocalStorage = true,\n      clearSessionStorage = true,\n      clearIndexedDB = true,\n      clearCookies = false\n    } = options;\n\n    try {\n      // Sign out from Supabase\n      await supabase.auth.signOut();\n      \n      // Clear localStorage items\n      if (clearLocalStorage) {\n        this.clearLocalStorageItems();\n      }\n\n      // Clear sessionStorage\n      if (clearSessionStorage) {\n        this.clearSessionStorageItems();\n      }\n\n      // Clear IndexedDB (Supabase may use this for session storage)\n      if (clearIndexedDB) {\n        await this.clearIndexedDBItems();\n      }\n\n      // Clear cookies if requested (usually not needed for Supabase)\n      if (clearCookies) {\n        this.clearAuthCookies();\n      }\n\n      console.log('Session cleanup completed successfully');\n    } catch (error) {\n      console.error('Error during session cleanup:', error);\n      // Even if there's an error, try to clear local storage\n      if (clearLocalStorage) {\n        this.clearLocalStorageItems();\n      }\n    }\n  }\n\n  /**\n   * Clear specific localStorage items related to authentication\n   */\n  private static clearLocalStorageItems(): void {\n    try {\n      // Check if localStorage is available and accessible\n      if (typeof window === 'undefined' || !window.localStorage) {\n        console.warn('localStorage not available');\n        return;\n      }\n\n      const authKeys = [\n        'user_permissions',\n        'supabase.auth.token',\n        'sb-auth-token',\n        'sb-refresh-token',\n        'user_profile',\n        'auth_state'\n      ];\n\n      // Clear known auth-related keys with permission handling\n      authKeys.forEach(key => {\n        try {\n          localStorage.removeItem(key);\n        } catch (itemError) {\n          console.warn(`Could not remove localStorage item ${key}:`, itemError);\n        }\n      });\n\n      // Clear any keys that start with 'sb-' (Supabase keys)\n      try {\n        const allKeys = Object.keys(localStorage);\n        allKeys.forEach(key => {\n          if (key.startsWith('sb-') || key.includes('supabase')) {\n            try {\n              localStorage.removeItem(key);\n            } catch (itemError) {\n              console.warn(`Could not remove localStorage item ${key}:`, itemError);\n            }\n          }\n        });\n      } catch (keysError) {\n        console.warn('Could not enumerate localStorage keys:', keysError);\n      }\n\n      console.log('localStorage cleared');\n    } catch (error) {\n      console.error('Error clearing localStorage:', error);\n    }\n  }\n\n  /**\n   * Clear sessionStorage items\n   */\n  private static clearSessionStorageItems(): void {\n    try {\n      const authKeys = [\n        'user_permissions',\n        'auth_state',\n        'temp_session'\n      ];\n\n      authKeys.forEach(key => {\n        sessionStorage.removeItem(key);\n      });\n\n      // Clear any keys that start with 'sb-' or contain 'supabase'\n      const allKeys = Object.keys(sessionStorage);\n      allKeys.forEach(key => {\n        if (key.startsWith('sb-') || key.includes('supabase')) {\n          sessionStorage.removeItem(key);\n        }\n      });\n\n      console.log('sessionStorage cleared');\n    } catch (error) {\n      console.error('Error clearing sessionStorage:', error);\n    }\n  }\n\n  /**\n   * Clear IndexedDB items (async operation)\n   */\n  private static async clearIndexedDBItems(): Promise<void> {\n    try {\n      if ('indexedDB' in window) {\n        // Get list of databases\n        const databases = await indexedDB.databases();\n        \n        // Clear Supabase-related databases\n        for (const db of databases) {\n          if (db.name && (db.name.includes('supabase') || db.name.includes('sb-'))) {\n            const deleteRequest = indexedDB.deleteDatabase(db.name);\n            await new Promise((resolve, reject) => {\n              deleteRequest.onsuccess = () => resolve(undefined);\n              deleteRequest.onerror = () => reject(deleteRequest.error);\n            });\n          }\n        }\n        \n        console.log('IndexedDB cleared');\n      }\n    } catch (error) {\n      console.error('Error clearing IndexedDB:', error);\n    }\n  }\n\n  /**\n   * Clear authentication-related cookies\n   */\n  private static clearAuthCookies(): void {\n    try {\n      const authCookies = [\n        'sb-access-token',\n        'sb-refresh-token',\n        'supabase-auth-token'\n      ];\n\n      authCookies.forEach(cookieName => {\n        // Clear cookie by setting it to expire in the past\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n        document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=${window.location.hostname};`;\n      });\n\n      console.log('Auth cookies cleared');\n    } catch (error) {\n      console.error('Error clearing cookies:', error);\n    }\n  }\n\n  /**\n   * Emergency cleanup - clears everything possible\n   */\n  static async emergencyCleanup(): Promise<void> {\n    console.log('Performing emergency session cleanup...');\n    \n    await this.performCleanup({\n      clearLocalStorage: true,\n      clearSessionStorage: true,\n      clearIndexedDB: true,\n      clearCookies: true\n    });\n\n    // Force reload the page to ensure clean state\n    setTimeout(() => {\n      window.location.reload();\n    }, 100);\n  }\n\n  /**\n   * Selective cleanup for logout\n   */\n  static async logoutCleanup(): Promise<void> {\n    await this.performCleanup({\n      clearLocalStorage: true,\n      clearSessionStorage: false, // Keep some session data for UX\n      clearIndexedDB: true,\n      clearCookies: false\n    });\n  }\n\n  /**\n   * Light cleanup for token refresh failures\n   */\n  static async refreshFailureCleanup(): Promise<void> {\n    await this.performCleanup({\n      clearLocalStorage: true,\n      clearSessionStorage: false,\n      clearIndexedDB: false,\n      clearCookies: false\n    });\n  }\n}\n\nexport default SessionCleanup;","import { supabase } from '../lib/supabaseClient';\nimport { toast } from '../hooks/use-toast';\nimport { ExponentialBackoff } from './exponentialBackoff';\n\ninterface ReloginCredentials {\n  email: string;\n  password: string;\n}\n\ninterface ReloginOptions {\n  maxRetries?: number;\n  retryDelay?: number;\n  showNotifications?: boolean;\n  onSuccess?: () => void;\n  onFailure?: (error: Error) => void;\n}\n\nexport class AutoReloginFlow {\n  private static instance: AutoReloginFlow;\n  private isReloginInProgress = false;\n  private storedCredentials: ReloginCredentials | null = null;\n  private reloginQueue: Array<() => void> = [];\n\n  private constructor() {}\n\n  static getInstance(): AutoReloginFlow {\n    if (!AutoReloginFlow.instance) {\n      AutoReloginFlow.instance = new AutoReloginFlow();\n    }\n    return AutoReloginFlow.instance;\n  }\n\n  /**\n   * Store user credentials securely for automatic re-login\n   * Note: In production, consider using more secure storage methods\n   */\n  storeCredentials(email: string, password: string): void {\n    // For security, we should encrypt these credentials\n    // For now, storing in memory only (lost on page refresh)\n    this.storedCredentials = { email, password };\n  }\n\n  /**\n   * Clear stored credentials\n   */\n  clearCredentials(): void {\n    this.storedCredentials = null;\n  }\n\n  /**\n   * Check if credentials are available for auto re-login\n   */\n  hasStoredCredentials(): boolean {\n    return this.storedCredentials !== null;\n  }\n\n  /**\n   * Attempt automatic re-login with stored credentials\n   */\n  async attemptAutoRelogin(options: ReloginOptions = {}): Promise<boolean> {\n    const {\n      maxRetries = 3,\n      retryDelay = 1000,\n      showNotifications = true,\n      onSuccess,\n      onFailure\n    } = options;\n\n    if (this.isReloginInProgress) {\n      // If re-login is already in progress, wait for it to complete\n      return new Promise((resolve) => {\n        this.reloginQueue.push(() => resolve(this.hasValidSession()));\n      });\n    }\n\n    if (!this.storedCredentials) {\n      if (showNotifications) {\n        toast({\n          title: \"Session Expired\",\n          description: \"Please log in again to continue.\",\n          variant: \"destructive\",\n        });\n      }\n      onFailure?.(new Error('No stored credentials available for auto re-login'));\n      return false;\n    }\n\n    this.isReloginInProgress = true;\n\n    try {\n      if (showNotifications) {\n        toast({\n          title: \"Session Expired\",\n          description: \"Attempting to restore your session...\",\n        });\n      }\n\n      // Use exponential backoff for re-login attempts\n      const reloginResult = await ExponentialBackoff.retryAuth(async () => {\n        const { data, error } = await supabase.auth.signInWithPassword({\n          email: this.storedCredentials!.email,\n          password: this.storedCredentials!.password,\n        });\n\n        if (error) {\n          throw new Error(`Re-login failed: ${error.message}`);\n        }\n\n        if (!data.session) {\n          throw new Error('Re-login returned no session');\n        }\n\n        return data.session;\n      });\n\n      if (reloginResult.success) {\n        if (showNotifications) {\n          toast({\n            title: \"Session Restored\",\n            description: `You have been automatically logged back in after ${reloginResult.attempts} attempt(s).`,\n          });\n        }\n\n        // Process queued callbacks\n        this.processReloginQueue();\n        onSuccess?.();\n        return true;\n      } else {\n        // All retries failed\n        if (showNotifications) {\n          toast({\n            title: \"Auto Re-login Failed\",\n            description: \"Please log in manually to continue.\",\n            variant: \"destructive\",\n          });\n        }\n\n        // Clear invalid credentials\n        this.clearCredentials();\n        this.processReloginQueue();\n        onFailure?.(reloginResult.error || new Error('Auto re-login failed after all retries'));\n        return false;\n      }\n\n    } finally {\n      this.isReloginInProgress = false;\n    }\n  }\n\n  /**\n   * Check if there's a valid session\n   */\n  private async hasValidSession(): Promise<boolean> {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      return session !== null && session.expires_at > Date.now() / 1000;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Process queued callbacks after re-login attempt\n   */\n  private processReloginQueue(): void {\n    const callbacks = [...this.reloginQueue];\n    this.reloginQueue = [];\n    callbacks.forEach(callback => callback());\n  }\n\n  /**\n   * Utility method for delays\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Handle session refresh failure and attempt auto re-login\n   */\n  async handleRefreshFailure(options: ReloginOptions = {}): Promise<boolean> {\n    console.warn('Session refresh failed, attempting auto re-login...');\n    \n    // First, try to refresh the session one more time\n    try {\n      const { data, error } = await supabase.auth.refreshSession();\n      if (!error && data.session) {\n        console.log('Session refresh succeeded on retry');\n        return true;\n      }\n    } catch (error) {\n      console.warn('Session refresh retry failed:', error);\n    }\n\n    // If refresh still fails, attempt auto re-login\n    return this.attemptAutoRelogin(options);\n  }\n\n  /**\n   * Validate session before API calls and auto re-login if needed\n   */\n  async validateSessionForApiCall(): Promise<boolean> {\n    try {\n      const { data: { session } } = await supabase.auth.getSession();\n      \n      if (!session) {\n        console.warn('No session found, attempting auto re-login...');\n        return this.attemptAutoRelogin({ showNotifications: false });\n      }\n\n      // Check if session is about to expire (within 5 minutes)\n      const expiresAt = session.expires_at;\n      const now = Date.now() / 1000;\n      const timeUntilExpiry = expiresAt - now;\n\n      if (timeUntilExpiry < 300) { // 5 minutes\n        console.warn('Session expiring soon, attempting refresh...');\n        \n        const { data: refreshData, error: refreshError } = await supabase.auth.refreshSession();\n        \n        if (refreshError || !refreshData.session) {\n          console.warn('Session refresh failed, attempting auto re-login...');\n          return this.attemptAutoRelogin({ showNotifications: false });\n        }\n      }\n\n      return true;\n    } catch (error) {\n      console.error('Session validation failed:', error);\n      return this.attemptAutoRelogin({ showNotifications: false });\n    }\n  }\n}\n\n// Export singleton instance\nexport const autoReloginFlow = AutoReloginFlow.getInstance();","import { supabase } from '../lib/supabaseClient';\nimport { SessionValidator, SessionValidationResult } from './sessionValidation';\nimport { SessionCleanup } from './sessionCleanup';\nimport { toast } from '../hooks/use-toast';\nimport { autoReloginFlow } from './autoReloginFlow';\n\nexport class SessionManager {\n  private static readonly STORAGE_KEY = 'triplexa-session-check';\n  private static readonly CHECK_INTERVAL = 5 * 60 * 1000; // 5 minutes\n  private static lastCheck = 0;\n\n  /**\n   * Validates the current session using SessionValidator\n   */\n  static async validateSession(): Promise<SessionValidationResult> {\n    return await SessionValidator.validateCurrentSession();\n  }\n\n  /**\n   * Attempts to refresh the session using SessionValidator\n   */\n  static async attemptRefresh(): Promise<boolean> {\n    return await SessionValidator.refreshSessionIfNeeded();\n  }\n\n  /**\n   * Clears all session data using SessionCleanup\n   */\n  static async clearSession(): Promise<void> {\n    await SessionCleanup.logoutCleanup();\n  }\n\n  /**\n   * Handle session errors with user feedback and auto re-login attempt\n   */\n  static async handleSessionError(error: any, redirectToLogin = true): Promise<void> {\n    console.error('Session error:', error);\n\n    // First, attempt auto re-login if credentials are available\n    if (autoReloginFlow.hasStoredCredentials()) {\n      const reloginSuccess = await autoReloginFlow.handleRefreshFailure({\n        showNotifications: true,\n        onFailure: (reloginError) => {\n          console.error('Auto re-login failed:', reloginError);\n          this.fallbackToManualLogin(redirectToLogin);\n        }\n      });\n\n      if (reloginSuccess) {\n        console.log('Auto re-login successful, session restored');\n        return;\n      }\n    }\n\n    // If auto re-login is not available or failed, fall back to manual login\n    this.fallbackToManualLogin(redirectToLogin);\n  }\n\n  /**\n   * Fallback to manual login when auto re-login fails or is not available\n   */\n  private static async fallbackToManualLogin(redirectToLogin: boolean): Promise<void> {\n    // Clear potentially corrupted session data\n    await this.clearSession();\n\n    // Show user-friendly error message\n    toast({\n      title: \"Session Expired\",\n      description: \"Please log in again to continue.\",\n      variant: \"destructive\",\n    });\n\n    // Redirect to login if requested\n    if (redirectToLogin && typeof window !== 'undefined') {\n      // Clear any remaining auth state\n      localStorage.removeItem('user_permissions');\n      \n      // Redirect to login page\n      window.location.href = '/login';\n    }\n  }\n\n  /**\n   * Periodic session validation (call this from AuthContext)\n   */\n  static async periodicValidation(): Promise<void> {\n    const now = Date.now();\n    \n    // Only check every 5 minutes to avoid excessive API calls\n    if (now - this.lastCheck < this.CHECK_INTERVAL) {\n      return;\n    }\n    \n    this.lastCheck = now;\n    \n    const result = await this.validateSession();\n    \n    if (result.shouldSignOut) {\n      this.handleSessionError(result.error || 'Session validation failed', true);\n    } else if (!result.isValid && result.error) {\n      console.warn('Session validation warning:', result.error);\n    }\n  }\n\n  /**\n   * Validates session before API calls using SessionValidator\n   */\n  static async validateBeforeApiCall(): Promise<boolean> {\n    return await SessionValidator.validateBeforeApiCall();\n  }\n}\n\n// Export utility functions for easy use\nexport const validateSession = () => SessionManager.validateSession();\nexport const clearSession = () => SessionManager.clearSession();\nexport const handleSessionError = (error: string, shouldSignOut?: boolean) => \n  SessionManager.handleSessionError(error, shouldSignOut);\nexport const validateBeforeApiCall = () => SessionManager.validateBeforeApiCall();","// Service Worker Registration for Push Notifications\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  window.location.hostname === '[::1]' ||\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n  )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if ('serviceWorker' in navigator) {\n    const publicUrl = new URL(import.meta.env.BASE_URL || '', window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${import.meta.env.BASE_URL}sw.js`;\n\n      if (isLocalhost) {\n        checkValidServiceWorker(swUrl, config);\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://cra.link/PWA'\n          );\n        });\n      } else {\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://cra.link/PWA.'\n              );\n\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              console.log('Content is cached for offline use.');\n\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then((response) => {\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then((registration) => {\n        registration.unregister();\n      })\n      .catch((error) => {\n        console.error(error.message);\n      });\n  }\n}\n\n// Push notification subscription helpers\nexport async function subscribeToPushNotifications(): Promise<PushSubscription | null> {\n  if (!('serviceWorker' in navigator) || !('PushManager' in window)) {\n    console.warn('Push messaging is not supported');\n    return null;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    \n    // Check if already subscribed\n    const existingSubscription = await registration.pushManager.getSubscription();\n    if (existingSubscription) {\n      return existingSubscription;\n    }\n\n    // Subscribe to push notifications\n    const subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(\n        import.meta.env.VITE_VAPID_PUBLIC_KEY || 'BEl62iUYgUivxIkv69yViEuiBIa40HI80NM9f8HnKJuOmqmHzdSSW9Oh6S8ks4dMZg'\n      ),\n    });\n\n    console.log('Push subscription successful:', subscription);\n    return subscription;\n  } catch (error) {\n    console.error('Failed to subscribe to push notifications:', error);\n    return null;\n  }\n}\n\nexport async function unsubscribeFromPushNotifications(): Promise<boolean> {\n  if (!('serviceWorker' in navigator)) {\n    return false;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    const subscription = await registration.pushManager.getSubscription();\n    \n    if (subscription) {\n      const successful = await subscription.unsubscribe();\n      console.log('Push unsubscription successful:', successful);\n      return successful;\n    }\n    \n    return true;\n  } catch (error) {\n    console.error('Failed to unsubscribe from push notifications:', error);\n    return false;\n  }\n}\n\n// Helper function to convert VAPID key\nfunction urlBase64ToUint8Array(base64String: string): Uint8Array {\n  const padding = '='.repeat((4 - base64String.length % 4) % 4);\n  const base64 = (base64String + padding)\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\n\n// Send push notification (for testing)\nexport async function sendTestPushNotification(title: string, body: string, data?: any) {\n  if (!('serviceWorker' in navigator)) {\n    return;\n  }\n\n  try {\n    const registration = await navigator.serviceWorker.ready;\n    \n    // Send message to service worker to show notification\n    if (registration.active) {\n      registration.active.postMessage({\n        type: 'SHOW_NOTIFICATION',\n        payload: {\n          title,\n          body,\n          data,\n          icon: '/favicon.ico',\n          badge: '/favicon.ico',\n          tag: `test-${Date.now()}`,\n        }\n      });\n    }\n  } catch (error) {\n    console.error('Failed to send test push notification:', error);\n  }\n}","\nimport { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatCurrency(amount: number, currency = 'USD', locale = 'en-US'): string {\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency: currency,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(amount);\n}\n\nexport function truncateText(text: string, maxLength: number): string {\n  if (text.length <= maxLength) return text;\n  return text.slice(0, maxLength) + '...';\n}\n","// Dynamic Import Optimization Configuration\n// This file helps optimize code splitting and lazy loading\n\n// Lazy load heavy components and pages\nexport const lazyLoadPages = {\n  // Dashboard pages - grouped for better caching\n  Dashboard: () => import('@/pages/Dashboard'),\n  ManagerDashboard: () => import('@/pages/dashboards/ManagerDashboard'),\n  AgentDashboard: () => import('@/pages/dashboards/AgentDashboard'),\n  OperationsDashboard: () => import('@/pages/dashboards/OperationsDashboard'),\n  SalesDashboard: () => import('@/pages/dashboards/SalesDashboard'),\n  ContentDashboard: () => import('@/pages/dashboards/ContentDashboard'),\n  SupportDashboard: () => import('@/pages/dashboards/SupportDashboard'),\n  FinanceDashboard: () => import('@/pages/dashboards/FinanceDashboard'),\n  StaffDashboard: () => import('@/pages/dashboards/StaffDashboard'),\n  \n  // Management pages - grouped for better caching\n  AgentManagement: () => import('@/pages/management/AgentManagement'),\n  StaffManagement: () => import('@/pages/management/StaffManagement'),\n  AdminManagement: () => import('@/pages/management/AdminManagement'),\n  AdminUsers: () => import('@/pages/management/AdminUsers'),\n  AdminRoleManager: () => import('@/pages/management/admin-role-manager/AdminRoleManager'),\n  \n  // Settings pages - grouped for better caching\n  Settings: () => import('@/pages/settings/SettingsPage'),\n  GeneralSettings: () => import('@/pages/settings/GeneralSettings'),\n  AccountSettings: () => import('@/pages/settings/AccountSettings'),\n  NotificationSettings: () => import('@/pages/settings/NotificationSettings'),\n  AppearanceSettings: () => import('@/pages/settings/AppearanceSettings'),\n  LanguageManager: () => import('@/pages/settings/LanguageManager'),\n  ApiSettings: () => import('@/pages/settings/ApiSettings'),\n  AccessControl: () => import('@/pages/settings/AccessControl'),\n  AgentSettings: () => import('@/pages/settings/AgentSettings'),\n  TranslationTool: () => import('@/pages/settings/TranslationTool'),\n  PricingSettings: () => import('@/pages/settings/PricingSettings'),\n  EmailTemplates: () => import('@/pages/settings/EmailTemplates'),\n  CurrencyConverter: () => import('@/pages/settings/CurrencyConverter'),\n  EmailConfiguration: () => import('@/pages/settings/EmailConfiguration'),\n  MarketingCommunications: () => import('@/pages/email/MarketingCommunications'),\n  SmsOtpSettings: () => import('@/pages/settings/SmsOtpSettings'),\n  \n  // Inventory pages - grouped for better caching\n  AddHotel: () => import('@/pages/inventory/hotels/AddHotel'),\n  AddRoomType: () => import('@/pages/inventory/hotels/AddRoomType'),\n  EditRoomType: () => import('@/pages/inventory/hotels/EditRoomType'),\n  AddRoomTypePage: () => import('@/pages/inventory/hotels/AddRoomTypePage'),\n  EditHotel: () => import('@/pages/inventory/hotels/EditHotel'),\n  ViewHotel: () => import('@/pages/inventory/hotels/ViewHotel'),\n  \n  // Query and proposal pages - grouped for better caching\n  CreateQuery: () => import('@/pages/queries/CreateQuery'),\n  QueryDetails: () => import('@/pages/queries/QueryDetails'),\n  Queries: () => import('@/pages/queries/Queries'),\n  TravelEnquiryHub: () => import('@/pages/queries/TravelEnquiryHub'),\n  AssignQueries: () => import('@/pages/queries/AssignQueries'),\n  EditQuery: () => import('@/pages/queries/EditQuery'),\n  AdvancedProposalCreation: () => import('@/pages/proposal/AdvancedProposalCreation'),\n  EnhancedDayWiseBuilder: () => import('@/components/proposal/EnhancedDayWiseBuilder'),\n  \n  // Other pages - grouped for better caching\n  FollowUps: () => import('@/pages/followups/FollowUps'),\n  BookingManagement: () => import('@/pages/bookings/BookingManagement'),\n  ItineraryBuilder: () => import('@/pages/itinerary/ItineraryBuilder'),\n\n\n  AddAgent: () => import('@/pages/management/agents/AddAgent'),\n  ManagementAgentProfile: () => import('@/pages/management/agents/AgentProfile'),\n  EditAgent: () => import('@/pages/management/agents/EditAgent'),\n  AddStaff: () => import('@/pages/management/staff/AddStaff'),\n  Departments: () => import('@/pages/management/staff/Departments'),\n  StaffProfile: () => import('@/pages/management/staff/StaffProfile'),\n  EditStaff: () => import('@/pages/management/staff/EditStaff'),\n  PayrollPage: () => import('@/pages/management/staff/hr/PayrollManagement'),\n  LeavesPage: () => import('@/pages/management/staff/hr/LeaveManagement'),\n  AttendanceManagement: () => import('@/pages/management/staff/hr/AttendanceManagement'),\n  SalaryStructureManager: () => import('@/pages/management/staff/hr/SalaryStructureManager'),\n  StaffDocsVerification: () => import('@/pages/management/hr/StaffDocsVerification'),\n  BankVerification: () => import('@/pages/management/hr/BankVerification'),\n  Onboarding: () => import('@/pages/management/hr/Onboarding'),\n  Offboarding: () => import('@/pages/management/hr/Offboarding'),\n  AgentProfileModern: () => import('@/pages/dashboards/agent/profile'),\n  \n  // Traveler pages - grouped for better caching\n  TravelerDashboardPage: () => import('@/pages/TravelerDashboardPage'),\n  TravelerItineraryPage: () => import('@/pages/TravelerItineraryPage'),\n  TravelerHistoryPage: () => import('@/pages/TravelerHistoryPage'),\n  TravelerNotificationsPage: () => import('@/pages/TravelerNotificationsPage'),\n  TravelerProfilePage: () => import('@/pages/TravelerProfilePage'),\n  TravelerSettingsPage: () => import('@/pages/TravelerSettingsPage'),\n  TravelerSupportPage: () => import('@/pages/TravelerSupportPage'),\n  \n  // Sales pages - grouped for better caching\n  SalesEnquiries: () => import('@/pages/sales/SalesEnquiries'),\n  SalesBookings: () => import('@/pages/sales/SalesBookings'),\n  SalesAgents: () => import('@/pages/sales/SalesAgents'),\n  SalesReports: () => import('@/pages/sales/SalesReports'),\n};\n\n// Route-based chunk groups for better caching and loading\nexport const routeChunkGroups = {\n  // Critical routes that should be preloaded\n  critical: [\n    'Dashboard',\n    'Queries',\n    'Settings',\n  ],\n  \n  // Management routes - loaded when user accesses management features\n  management: [\n    'AgentManagement',\n    'StaffManagement',\n    'AdminManagement',\n    'AdminUsers',\n    'AdminRoleManager',\n    'AddAgent',\n    'ManagementAgentProfile',\n    'EditAgent',\n    'AddStaff',\n    'Departments',\n    'StaffProfile',\n    'EditStaff',\n    'PayrollPage',\n    'LeavesPage',\n    'AttendanceManagement',\n    'SalaryStructureManager',\n    'StaffDocsVerification',\n    'BankVerification',\n    'Onboarding',\n    'Offboarding',\n  ],\n  \n  // Dashboard routes - loaded based on user role\n  dashboards: [\n    'ManagerDashboard',\n    'AgentDashboard',\n    'OperationsDashboard',\n    'SalesDashboard',\n    'ContentDashboard',\n    'SupportDashboard',\n    'FinanceDashboard',\n    'StaffDashboard',\n    'AgentProfileModern',\n  ],\n  \n  // Settings routes - loaded when user accesses settings\n  settings: [\n    'SettingsPage',\n    'GeneralSettings',\n    'AccountSettings',\n    'AppearanceSettings',\n    'NotificationSettings',\n    'EmailConfiguration',\n    'LanguageManager',\n    'TranslationTool',\n    'CurrencyConverter',\n    'PricingSettings',\n    'ApiSettings',\n    'AgentSettings',\n    'EmailTemplates',\n    'SmsOtpSettings',\n    'AccessControl',\n  ],\n  \n  // Inventory routes - loaded when user accesses inventory features\n  inventory: [\n    'AddHotel',\n    'AddRoomType',\n    'EditRoomType',\n    'AddRoomTypePage',\n    'EditHotel',\n    'ViewHotel',\n  ],\n  \n  // Query and proposal routes - loaded when user accesses query features\n  queries: [\n    'CreateQuery',\n    'QueryDetails',\n    'Queries',\n    'TravelEnquiryHub',\n    'AssignQueries',\n    'EditQuery',\n    'AdvancedProposalCreation',\n    'EnhancedDayWiseBuilder',\n  ],\n  \n  // Traveler routes - loaded when user accesses traveler features\n  traveler: [\n    'TravelerDashboardPage',\n    'TravelerItineraryPage',\n    'TravelerHistoryPage',\n    'TravelerNotificationsPage',\n    'TravelerProfilePage',\n    'TravelerSettingsPage',\n    'TravelerSupportPage',\n  ],\n  \n  // Sales routes - loaded when user accesses sales features\n  sales: [\n    'SalesEnquiries',\n    'SalesBookings',\n    'SalesAgents',\n    'SalesReports',\n  ],\n};\n\n// Lazy load heavy service dependencies\nexport const lazyLoadServices = {\n  // Heavy services that should be loaded on demand\n  aiIntegrationService: () => import('@/services/aiIntegrationService'),\n  universalPDFService: () => import('@/services/universalPDFService'),\n  emailService: () => import('@/services/emailService'),\n  comprehensiveTransportService: () => import('@/services/comprehensiveTransportService'),\n  integratedTransportService: () => import('@/services/integratedTransportService'),\n  transportRouteErrorService: () => import('@/services/transportRouteErrorService'),\n  locationResolutionService: () => import('@/services/locationResolutionService'),\n  telemetryService: () => import('@/services/telemetryService'),\n  agentManagementService: () => import('@/services/agentManagementService'),\n  \n  // Country/City services\n  countriesService: () => import('@/services/countriesService'),\n  citiesService: () => import('@/services/citiesService'),\n  locationCodesService: () => import('@/services/locationCodesService'),\n  \n  // Settings services\n  appSettingsService: () => import('@/services/appSettingsService'),\n  appSettingsService_database: () => import('@/services/appSettingsService_database'),\n  metaSettingsService: () => import('@/services/metaSettingsService'),\n  countryEmailSettingsService: () => import('@/services/countryEmailSettingsService'),\n  emailConfigurationService: () => import('@/services/emailConfigurationService'),\n  emailTemplateService: () => import('@/services/emailTemplateService'),\n  \n  // Auth and user services\n  authService: () => import('@/services/authService'),\n  credentialService: () => import('@/services/credentialService'),\n  loginRecordService: () => import('@/services/loginRecordService'),\n  profilesHelper: () => import('@/services/profilesHelper'),\n  userTrackingService: () => import('@/services/userTrackingService'),\n  \n  // Management services\n  departmentService: () => import('@/services/departmentService'),\n  staffAssignmentService: () => import('@/services/staffAssignmentService'),\n  staffBankService: () => import('@/services/staffBankService'),\n  staffDocumentsService: () => import('@/services/staffDocumentsService'),\n  staffReferralService: () => import('@/services/staffReferralService'),\n  staffSequenceService: () => import('@/services/staffSequenceService'),\n  \n  // Query and proposal services\n  enquiriesService: () => import('@/services/enquiriesService'),\n  proposalService: () => import('@/services/proposalService'),\n  enhancedProposalService: () => import('@/services/enhancedProposalService'),\n  supabaseProposalService: () => import('@/services/supabaseProposalService'),\n  assignmentRulesService: () => import('@/services/assignmentRulesService'),\n  autoAssignmentEngine: () => import('@/services/autoAssignmentEngine'),\n  workflowEventsService: () => import('@/services/workflowEventsService'),\n  \n  // Utility services\n  aiRouter: () => import('@/services/aiRouter'),\n  supabaseConnectionTest: () => import('@/debug/supabaseConnectionTest'),\n  activityDataUtils: () => import('@/utils/activityDataUtils'),\n  enqIdGenerator: () => import('@/utils/enqIdGenerator'),\n};\n\n// Preload critical chunks for better performance\nexport const preloadCriticalChunks = async () => {\n  try {\n    // Preload essential services first\n    const criticalServices = [\n      lazyLoadServices.authService,\n      lazyLoadServices.countriesService,\n      lazyLoadServices.citiesService,\n      lazyLoadServices.locationResolutionService,\n    ];\n    \n    // Preload in parallel\n    await Promise.all(criticalServices.map(service => service()));\n    \n    // Preload UI components that are likely to be used\n    const criticalComponents = [\n      lazyLoadPages.Dashboard,\n      lazyLoadPages.Queries,\n      lazyLoadPages.Settings,\n    ];\n    \n    // Preload after critical services\n    setTimeout(() => {\n      Promise.all(criticalComponents.map(component => component()));\n    }, 1000);\n    \n  } catch (error) {\n    console.warn('Failed to preload critical chunks:', error);\n  }\n};\n\n// Preload route groups based on user role and likely usage\nexport const preloadRouteGroup = async (groupName: keyof typeof routeChunkGroups) => {\n  try {\n    const group = routeChunkGroups[groupName];\n    if (!group) return;\n    \n    const components = group.map(pageName => {\n      const loader = lazyLoadPages[pageName as keyof typeof lazyLoadPages];\n      return loader ? loader() : Promise.resolve();\n    });\n    \n    await Promise.all(components);\n    console.log(`Preloaded route group: ${groupName}`);\n  } catch (error) {\n    console.warn(`Failed to preload route group ${groupName}:`, error);\n  }\n};\n\n// Preload services based on user role\nexport const preloadServicesForRole = (userRole: string) => {\n  const roleBasedServices: Record<string, (() => Promise<any>)[]> = {\n    super_admin: [\n      lazyLoadServices.authService,\n      lazyLoadServices.agentManagementService,\n      lazyLoadServices.departmentService,\n      lazyLoadServices.metaSettingsService,\n    ],\n    manager: [\n      lazyLoadServices.authService,\n      lazyLoadServices.agentManagementService,\n      lazyLoadServices.departmentService,\n      lazyLoadServices.enquiriesService,\n    ],\n    admin: [\n      lazyLoadServices.authService,\n      lazyLoadServices.enquiriesService,\n      lazyLoadServices.assignmentRulesService,\n    ],\n    staff: [\n      lazyLoadServices.authService,\n      lazyLoadServices.enquiriesService,\n      lazyLoadServices.assignmentRulesService,\n    ],\n    agent: [\n      lazyLoadServices.authService,\n      lazyLoadServices.enquiriesService,\n      lazyLoadServices.proposalService,\n    ],\n    user: [\n      lazyLoadServices.authService,\n    ],\n  };\n  \n  const services = roleBasedServices[userRole] || [lazyLoadServices.authService];\n  \n  // Preload services in background\n  setTimeout(() => {\n    Promise.all(services.map(service => service().catch(() => {})));\n  }, 2000);\n};\n\n// Service loading utilities\nexport const loadService = async (serviceName: keyof typeof lazyLoadServices) => {\n  try {\n    const service = await lazyLoadServices[serviceName]();\n    return service;\n  } catch (error) {\n    console.error(`Failed to load service: ${serviceName}`, error);\n    throw error;\n  }\n};\n\nexport const loadPage = async (pageName: keyof typeof lazyLoadPages) => {\n  try {\n    const page = await lazyLoadPages[pageName]();\n    return page;\n  } catch (error) {\n    console.error(`Failed to load page: ${pageName}`, error);\n    throw error;\n  }\n};\n\nexport default {\n  lazyLoadPages,\n  lazyLoadServices,\n  routeChunkGroups,\n  preloadCriticalChunks,\n  preloadRouteGroup,\n  preloadServicesForRole,\n  loadService,\n  loadPage,\n};","\nexport const generateUsernameFromEmail = (email: string): string => {\n  const [localPart] = email.split('@');\n  return localPart.toLowerCase().replace(/[^a-z0-9]/g, '.');\n};\n\nexport const generateUsernameFromName = (name: string): string => {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]/g, '')\n    .split(' ')\n    .filter(part => part.length > 0)\n    .join('.');\n};\n\nexport const generateSecurePassword = (length: number = 12): string => {\n  const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  const lowercase = 'abcdefghijklmnopqrstuvwxyz';\n  const numbers = '0123456789';\n  const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';\n  \n  const allChars = uppercase + lowercase + numbers + symbols;\n  let password = '';\n  \n  // Ensure at least one character from each category\n  password += uppercase[Math.floor(Math.random() * uppercase.length)];\n  password += lowercase[Math.floor(Math.random() * lowercase.length)];\n  password += numbers[Math.floor(Math.random() * numbers.length)];\n  password += symbols[Math.floor(Math.random() * symbols.length)];\n  \n  // Fill the rest randomly\n  for (let i = 4; i < length; i++) {\n    password += allChars[Math.floor(Math.random() * allChars.length)];\n  }\n  \n  // Shuffle the password\n  return password.split('').sort(() => Math.random() - 0.5).join('');\n};\n\nexport const validatePasswordStrength = (password: string): {\n  score: number;\n  feedback: string[];\n  isValid: boolean;\n} => {\n  const feedback: string[] = [];\n  let score = 0;\n  \n  if (password.length >= 8) {\n    score += 1;\n  } else {\n    feedback.push('Password must be at least 8 characters long');\n  }\n  \n  if (/[A-Z]/.test(password)) {\n    score += 1;\n  } else {\n    feedback.push('Include at least one uppercase letter');\n  }\n  \n  if (/[a-z]/.test(password)) {\n    score += 1;\n  } else {\n    feedback.push('Include at least one lowercase letter');\n  }\n  \n  if (/\\d/.test(password)) {\n    score += 1;\n  } else {\n    feedback.push('Include at least one number');\n  }\n  \n  if (/[!@#$%^&*()_+\\-=\\[\\]{}|;:,.<>?]/.test(password)) {\n    score += 1;\n  } else {\n    feedback.push('Include at least one special character');\n  }\n  \n  const isValid = score >= 4;\n  \n  return { score, feedback, isValid };\n};\n\nexport const checkUsernameUniqueness = (username: string, excludeId?: string): boolean => {\n  // This would typically check against a database\n  // For now, we'll check against the existing auth data\n  try {\n    const existingUsers = JSON.parse(localStorage.getItem('auth_users') || '[]');\n    return !existingUsers.some((user: any) => \n      user.username === username && user.id !== excludeId\n    );\n  } catch {\n    return true;\n  }\n};\n","import { generateUsernameFromEmail, generateSecurePassword } from './credentialGenerator';\n\nexport interface AgentCredentials {\n  agentId: string;\n  username: string;\n  password: string;\n  email: string;\n  forcePasswordChange: boolean;\n  isTemporary: boolean;\n  createdAt: string;\n  createdBy: {\n    staffId: string;\n    staffName: string;\n  };\n}\n\nexport interface LoginActivity {\n  lastLogin: string | null;\n  loginCount: number;\n  failedAttempts: number;\n  isLocked: boolean;\n  lockExpiry: string | null;\n  loginHistory: {\n    timestamp: string;\n    success: boolean;\n    ip?: string;\n    userAgent?: string;\n  }[];\n}\n\n// Store agent credentials securely\nexport const storeAgentCredentials = (credentials: AgentCredentials): void => {\n  try {\n    const existingCredentials = getStoredAgentCredentials();\n    const updatedCredentials = existingCredentials.filter(cred => cred.agentId !== credentials.agentId);\n    updatedCredentials.push(credentials);\n    \n    localStorage.setItem('agent_credentials', JSON.stringify(updatedCredentials));\n    console.log('Agent credentials stored successfully for agent:', credentials.agentId);\n  } catch (error) {\n    console.error('Error storing agent credentials:', error);\n  }\n};\n\n// Retrieve stored agent credentials\nexport const getStoredAgentCredentials = (): AgentCredentials[] => {\n  try {\n    const stored = localStorage.getItem('agent_credentials');\n    return stored ? JSON.parse(stored) : [];\n  } catch (error) {\n    console.error('Error retrieving agent credentials:', error);\n    return [];\n  }\n};\n\n// Authenticate agent login\nexport const authenticateAgent = (username: string, password: string): { success: boolean; agent?: any; message?: string } => {\n  try {\n    const credentials = getStoredAgentCredentials();\n    const agentCredential = credentials.find(cred => \n      cred.username === username || cred.email === username\n    );\n\n    if (!agentCredential) {\n      return { success: false, message: 'Invalid username or email' };\n    }\n\n    // Enforce password change: block login if flagged\n    if (agentCredential.forcePasswordChange || agentCredential.isTemporary) {\n      return { \n        success: false, \n        message: 'Password change required. Please use the invite link or reset your password.' \n      };\n    }\n\n    // Check if account is locked\n    const loginActivity = getAgentLoginActivity(agentCredential.agentId);\n    if (loginActivity.isLocked && loginActivity.lockExpiry) {\n      const lockExpiry = new Date(loginActivity.lockExpiry);\n      if (new Date() < lockExpiry) {\n        return { success: false, message: 'Account is temporarily locked. Please try again later.' };\n      } else {\n        // Unlock account if lock period has expired\n        unlockAgentAccount(agentCredential.agentId);\n      }\n    }\n\n    // Verify password\n    if (agentCredential.password !== password) {\n      recordLoginAttempt(agentCredential.agentId, false);\n      return { success: false, message: 'Invalid password' };\n    }\n\n    // Get agent details\n    const agents = JSON.parse(localStorage.getItem('agents') || '[]');\n    const agent = agents.find((a: any) => a.id.toString() === agentCredential.agentId);\n\n    if (!agent || agent.status !== 'active') {\n      return { success: false, message: 'Agent account is not active' };\n    }\n\n    // Record successful login\n    recordLoginAttempt(agentCredential.agentId, true);\n\n    return { \n      success: true, \n      agent: {\n        ...agent,\n        requiresPasswordChange: agentCredential.forcePasswordChange,\n        isTemporaryPassword: agentCredential.isTemporary\n      }\n    };\n  } catch (error) {\n    console.error('Error authenticating agent:', error);\n    return { success: false, message: 'Authentication error occurred' };\n  }\n};\n\n// Track agent login activity\nexport const getAgentLoginActivity = (agentId: string): LoginActivity => {\n  try {\n    const stored = localStorage.getItem(`agent_login_activity_${agentId}`);\n    if (stored) {\n      return JSON.parse(stored);\n    }\n    \n    // Return default activity if none exists\n    return {\n      lastLogin: null,\n      loginCount: 0,\n      failedAttempts: 0,\n      isLocked: false,\n      lockExpiry: null,\n      loginHistory: []\n    };\n  } catch (error) {\n    console.error('Error getting agent login activity:', error);\n    return {\n      lastLogin: null,\n      loginCount: 0,\n      failedAttempts: 0,\n      isLocked: false,\n      lockExpiry: null,\n      loginHistory: []\n    };\n  }\n};\n\n// Record login attempt\nexport const recordLoginAttempt = (agentId: string, success: boolean): void => {\n  try {\n    const activity = getAgentLoginActivity(agentId);\n    const timestamp = new Date().toISOString();\n    \n    // Add to login history\n    activity.loginHistory.push({\n      timestamp,\n      success,\n      // In a real app, you would capture actual IP and user agent\n      ip: '127.0.0.1',\n      userAgent: navigator.userAgent\n    });\n    \n    // Keep only last 50 login attempts\n    if (activity.loginHistory.length > 50) {\n      activity.loginHistory = activity.loginHistory.slice(-50);\n    }\n    \n    if (success) {\n      activity.lastLogin = timestamp;\n      activity.loginCount += 1;\n      activity.failedAttempts = 0; // Reset failed attempts on successful login\n      activity.isLocked = false;\n      activity.lockExpiry = null;\n    } else {\n      activity.failedAttempts += 1;\n      \n      // Lock account after 5 failed attempts\n      if (activity.failedAttempts >= 5) {\n        activity.isLocked = true;\n        // Lock for 30 minutes\n        activity.lockExpiry = new Date(Date.now() + 30 * 60 * 1000).toISOString();\n      }\n    }\n    \n    localStorage.setItem(`agent_login_activity_${agentId}`, JSON.stringify(activity));\n    console.log(`Login attempt recorded for agent ${agentId}:`, { success, failedAttempts: activity.failedAttempts });\n  } catch (error) {\n    console.error('Error recording login attempt:', error);\n  }\n};\n\n// Unlock agent account\nexport const unlockAgentAccount = (agentId: string): void => {\n  try {\n    const activity = getAgentLoginActivity(agentId);\n    activity.isLocked = false;\n    activity.lockExpiry = null;\n    activity.failedAttempts = 0;\n    \n    localStorage.setItem(`agent_login_activity_${agentId}`, JSON.stringify(activity));\n    console.log(`Agent account unlocked: ${agentId}`);\n  } catch (error) {\n    console.error('Error unlocking agent account:', error);\n  }\n};\n\n// Generate and send password reset email\nexport const sendPasswordResetEmail = async (email: string): Promise<{ success: boolean; message: string }> => {\n  try {\n    const credentials = getStoredAgentCredentials();\n    const agentCredential = credentials.find(cred => cred.email === email);\n    \n    if (!agentCredential) {\n      return { success: false, message: 'Email address not found' };\n    }\n    \n    // Generate new temporary password\n    const tempPassword = generateSecurePassword(10);\n    \n    // Update credentials with temporary password\n    const updatedCredential = {\n      ...agentCredential,\n      password: tempPassword,\n      isTemporary: true,\n      forcePasswordChange: true\n    };\n    \n    storeAgentCredentials(updatedCredential);\n    \n    // In a real app, this would send an actual email\n    console.log(`Password reset email sent to: ${email}`);\n    console.log(`Temporary password: ${tempPassword}`);\n    \n    // Simulate email sending delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    return { \n      success: true, \n      message: 'Password reset email sent successfully. Please check your inbox for the temporary password.' \n    };\n  } catch (error) {\n    console.error('Error sending password reset email:', error);\n    return { success: false, message: 'Failed to send password reset email' };\n  }\n};\n\n// Send initial credentials email\nexport const sendCredentialsEmail = async (agentCredentials: AgentCredentials): Promise<{ success: boolean; message: string }> => {\n  try {\n    // In a real app, this would send an actual email\n    console.log(`Credentials email sent to: ${agentCredentials.email}`);\n    console.log(`Username: ${agentCredentials.username}`);\n    console.log(`Password: ${agentCredentials.password}`);\n    console.log(`Force password change: ${agentCredentials.forcePasswordChange}`);\n    \n    // Simulate email sending delay\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    return { \n      success: true, \n      message: 'Login credentials sent successfully to agent\\'s email address.' \n    };\n  } catch (error) {\n    console.error('Error sending credentials email:', error);\n    return { success: false, message: 'Failed to send credentials email' };\n  }\n};\n\n// Change agent password\nexport const changeAgentPassword = (agentId: string, oldPassword: string, newPassword: string): { success: boolean; message: string } => {\n  try {\n    const credentials = getStoredAgentCredentials();\n    const agentCredential = credentials.find(cred => cred.agentId === agentId);\n    \n    if (!agentCredential) {\n      return { success: false, message: 'Agent credentials not found' };\n    }\n    \n    if (agentCredential.password !== oldPassword) {\n      return { success: false, message: 'Current password is incorrect' };\n    }\n    \n    // Update password\n    const updatedCredential = {\n      ...agentCredential,\n      password: newPassword,\n      forcePasswordChange: false,\n      isTemporary: false\n    };\n    \n    storeAgentCredentials(updatedCredential);\n    \n    return { success: true, message: 'Password changed successfully' };\n  } catch (error) {\n    console.error('Error changing agent password:', error);\n    return { success: false, message: 'Failed to change password' };\n  }\n};\n","/**\n * Country utilities for mapping country names and aliases to country codes\n */\n\nimport { initialCountries } from '../pages/inventory/countries/data/countryData';\n\n// Country aliases for better mapping\nconst COUNTRY_ALIASES = {\n  'UAE': 'AE',\n  'United Arab Emirates': 'AE',\n  'Emirates': 'AE',\n  'Thailand': 'TH',\n  'Thai': 'TH',\n  'USA': 'US',\n  'United States': 'US',\n  'America': 'US',\n  'UK': 'GB',\n  'United Kingdom': 'GB',\n  'Britain': 'GB',\n  'England': 'GB'\n};\n\n/**\n * Maps country name or alias to country code\n * @param countryName - The country name or alias\n * @returns The country code or null if not found\n */\nexport const getCountryCodeByName = (countryName: string): string | null => {\n  if (!countryName) {\n    console.log('Country mapping: Empty country name provided');\n    return null;\n  }\n  \n  const normalizedName = countryName.trim();\n  console.log(`Country mapping: Attempting to map \"${normalizedName}\"`);\n  \n  // Check direct alias mapping first\n  const aliasCode = COUNTRY_ALIASES[normalizedName];\n  if (aliasCode) {\n    console.log(`Country mapping: \"${normalizedName}\" -> ${aliasCode} (via alias)`);\n    return aliasCode;\n  }\n  \n  // Check exact match in country data\n  const exactMatch = initialCountries.find(c => \n    c.name.toLowerCase() === normalizedName.toLowerCase()\n  );\n  if (exactMatch) {\n    console.log(`Country mapping: \"${normalizedName}\" -> ${exactMatch.code} (exact match)`);\n    return exactMatch.code;\n  }\n  \n  // Check partial match (includes)\n  const partialMatch = initialCountries.find(c => \n    c.name.toLowerCase().includes(normalizedName.toLowerCase()) ||\n    normalizedName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  if (partialMatch) {\n    console.log(`Country mapping: \"${normalizedName}\" -> ${partialMatch.code} (partial match)`);\n    return partialMatch.code;\n  }\n  \n  console.warn(`Country mapping failed: \"${normalizedName}\" not found`);\n  return null;\n};\n\n/**\n * Validates if a country code is active in the system\n * @param countryCode - The country code to validate\n * @returns boolean indicating if the country is active\n */\nexport const isCountryActive = (countryCode: string): boolean => {\n  const country = initialCountries.find(c => c.code === countryCode);\n  return country ? country.status === 'active' : false;\n};\n\n/**\n * Gets available countries for enquiry creation\n * @returns Array of active country codes\n */\nexport const getActiveCountryCodes = (): string[] => {\n  return initialCountries\n    .filter(c => c.status === 'active')\n    .map(c => c.code);\n};","import { supabase, adminSupabase, isAdminClientConfigured } from '@/lib/supabaseClient';\n\nexport interface BucketCheckResult {\n  exists: boolean;\n  errorMessage?: string;\n}\n\n// Lightweight bucket existence check.\n// - Uses admin client getBucket when available (service role).\n// - Falls back to listing bucket root with anon client.\nexport async function checkBucketExists(bucket: string): Promise<BucketCheckResult> {\n  try {\n    // Prefer admin check when configured (works even with private buckets)\n    if (isAdminClientConfigured && adminSupabase) {\n      const { data, error } = await adminSupabase.storage.getBucket(bucket);\n      if (error) {\n        // Normalize common error messages\n        const msg = String(error.message || '').toLowerCase();\n        if (msg.includes('not found') || msg.includes('does not exist')) {\n          return { exists: false, errorMessage: `Bucket \"${bucket}\" was not found` };\n        }\n        return { exists: false, errorMessage: error.message };\n      }\n      return { exists: !!data };\n    }\n\n    // Fallback: try listing root with anon client\n    const { data, error } = await supabase.storage.from(bucket).list('', { limit: 1 });\n    if (error) {\n      const msg = String(error.message || '').toLowerCase();\n      if (msg.includes('not found') || msg.includes('invalid') || msg.includes('bucket')) {\n        return { exists: false, errorMessage: `Bucket \"${bucket}\" is missing or inaccessible` };\n      }\n      return { exists: false, errorMessage: error.message };\n    }\n    return { exists: true };\n  } catch (err: any) {\n    const msg = String(err?.message || '').toLowerCase();\n    if (msg.includes('not found') || msg.includes('bucket')) {\n      return { exists: false, errorMessage: `Bucket \"${bucket}\" was not found` };\n    }\n    return { exists: false, errorMessage: err?.message || 'Unknown bucket check error' };\n  }\n}","\nexport const formatCurrency = (amount: number, currency: string = 'USD'): string => {\n  // List of supported currencies for formatting\n  const supportedCurrencies = ['USD', 'EUR', 'GBP', 'JPY', 'CAD', 'AUD', 'CHF', 'CNY', 'INR', 'AED', 'SGD', 'THB'];\n  const currencyCode = supportedCurrencies.includes(currency.toUpperCase()) ? currency.toUpperCase() : 'USD';\n  \n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: currencyCode,\n    minimumFractionDigits: 2,\n    maximumFractionDigits: 2,\n  }).format(amount);\n};\n\nexport const formatNumber = (num: number): string => {\n  return new Intl.NumberFormat('en-US').format(num);\n};\n\nexport const formatDate = (date: string | Date): string => {\n  const dateObj = typeof date === 'string' ? new Date(date) : date;\n  return dateObj.toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n};\n\nexport const formatTime = (time: string): string => {\n  // Assumes time is in HH:MM format\n  const [hours, minutes] = time.split(':');\n  const hour = parseInt(hours, 10);\n  const ampm = hour >= 12 ? 'PM' : 'AM';\n  const displayHour = hour % 12 || 12;\n  return `${displayHour}:${minutes} ${ampm}`;\n};\n","// Utility for mapping Supabase UUID agent IDs to deterministic numeric IDs\n// This keeps compatibility with existing UI and Query types expecting numbers.\n\n/**\n * Derive a deterministic numeric ID from a UUID string.\n * Uses the first 8 hex characters of the UUID and maps into 100000..899999.\n * This is deterministic and avoids collisions with typical local mock IDs.\n */\nexport function toNumericAgentId(uuid: string): number {\n  if (!uuid) return 0;\n  const hex = uuid.replace(/-/g, '').slice(0, 8);\n  const n = Number.parseInt(hex || '0', 16);\n  // Map into a safe range to avoid overlapping with existing mock IDs (~101..)\n  return 100000 + (n % 800000);\n}\n\n/**\n * Helper to find a Supabase agent option by the numeric ID produced above.\n * Keeps logic centralized so both the selector and wrapper use the same mapping.\n */\nexport function findSupabaseAgentByNumericId<T extends { id: string }>(list: T[], numericId: number): T | null {\n  for (const item of list) {\n    if (toNumericAgentId(item.id) === numericId) return item;\n  }\n  return null;\n}","\n\nexport const formatCurrency = (amount: number, country: string = 'USA'): string => {\n  // Map countries to their currencies\n  const currencyMap: { [key: string]: string } = {\n    'USA': 'USD',\n    'United States': 'USD',\n    'UK': 'GBP',\n    'United Kingdom': 'GBP',\n    'India': 'INR',\n    'Japan': 'JPY',\n    'Australia': 'AUD',\n    'Canada': 'CAD',\n    'Germany': 'EUR',\n    'France': 'EUR',\n    'Italy': 'EUR',\n    'Spain': 'EUR',\n    'Netherlands': 'EUR',\n    'Switzerland': 'CHF',\n    'Singapore': 'SGD',\n    'Thailand': 'THB',\n    'Malaysia': 'MYR',\n    'Indonesia': 'IDR',\n    'Philippines': 'PHP',\n    'Vietnam': 'VND',\n    'China': 'CNY',\n    'South Korea': 'KRW',\n    'Brazil': 'BRL',\n    'Mexico': 'MXN',\n    'Argentina': 'ARS',\n    'Chile': 'CLP',\n    'South Africa': 'ZAR',\n    'Egypt': 'EGP',\n    'UAE': 'AED',\n    'Saudi Arabia': 'SAR',\n    'Turkey': 'TRY',\n    'Russia': 'RUB',\n    'Poland': 'PLN',\n    'Czech Republic': 'CZK',\n    'Hungary': 'HUF',\n    'Croatia': 'HRK',\n    'Romania': 'RON',\n    'Bulgaria': 'BGN',\n    'Norway': 'NOK',\n    'Sweden': 'SEK',\n    'Denmark': 'DKK',\n    'Iceland': 'ISK',\n    'Finland': 'EUR',\n    'Belgium': 'EUR',\n    'Austria': 'EUR',\n    'Portugal': 'EUR',\n    'Greece': 'EUR',\n    'Ireland': 'EUR',\n    'Luxembourg': 'EUR',\n    'Malta': 'EUR',\n    'Cyprus': 'EUR',\n    'Estonia': 'EUR',\n    'Latvia': 'EUR',\n    'Lithuania': 'EUR',\n    'Slovakia': 'EUR',\n    'Slovenia': 'EUR',\n    'New Zealand': 'NZD',\n    'Israel': 'ILS',\n    'Jordan': 'JOD',\n    'Lebanon': 'LBP',\n    'Morocco': 'MAD',\n    'Tunisia': 'TND',\n    'Kenya': 'KES',\n    'Tanzania': 'TZS',\n    'Uganda': 'UGX',\n    'Ghana': 'GHS',\n    'Nigeria': 'NGN',\n    'Botswana': 'BWP',\n    'Namibia': 'NAD',\n    'Zambia': 'ZMW',\n    'Zimbabwe': 'ZWL',\n    'Mauritius': 'MUR',\n    'Seychelles': 'SCR',\n    'Madagascar': 'MGA',\n    'Sri Lanka': 'LKR',\n    'Nepal': 'NPR',\n    'Bhutan': 'BTN',\n    'Bangladesh': 'BDT',\n    'Pakistan': 'PKR',\n    'Afghanistan': 'AFN',\n    'Iran': 'IRR',\n    'Iraq': 'IQD',\n    'Kuwait': 'KWD',\n    'Bahrain': 'BHD',\n    'Qatar': 'QAR',\n    'Oman': 'OMR',\n    'Yemen': 'YER',\n    'Uzbekistan': 'UZS',\n    'Kazakhstan': 'KZT',\n    'Kyrgyzstan': 'KGS',\n    'Tajikistan': 'TJS',\n    'Turkmenistan': 'TMT',\n    'Mongolia': 'MNT',\n    'North Korea': 'KPW',\n    'Myanmar': 'MMK',\n    'Laos': 'LAK',\n    'Cambodia': 'KHR',\n    'Brunei': 'BND',\n    'East Timor': 'USD',\n    'Papua New Guinea': 'PGK',\n    'Fiji': 'FJD',\n    'Vanuatu': 'VUV',\n    'Samoa': 'WST',\n    'Tonga': 'TOP',\n    'Solomon Islands': 'SBD',\n    'Palau': 'USD',\n    'Marshall Islands': 'USD',\n    'Micronesia': 'USD',\n    'Kiribati': 'AUD',\n    'Tuvalu': 'AUD',\n    'Nauru': 'AUD'\n  };\n\n  const currency = currencyMap[country] || 'USD';\n  \n  try {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: currency,\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(amount);\n  } catch (error) {\n    // Fallback to USD if currency is not supported\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(amount);\n  }\n};\n\nexport const formatNumber = (num: number): string => {\n  return new Intl.NumberFormat('en-US').format(num);\n};\n\nexport const getCurrencyByCountry = (country: string): { symbol: string; code: string } => {\n  const currencyMap: Record<string, { symbol: string; code: string }> = {\n    'Thailand': { symbol: '', code: 'THB' },\n    'UAE': { symbol: '.', code: 'AED' },\n    'United Arab Emirates': { symbol: '.', code: 'AED' },\n    'Singapore': { symbol: 'S$', code: 'SGD' },\n    'Malaysia': { symbol: 'RM', code: 'MYR' },\n    'Japan': { symbol: '', code: 'JPY' },\n    'United States': { symbol: '$', code: 'USD' },\n    'USA': { symbol: '$', code: 'USD' },\n    'United Kingdom': { symbol: '', code: 'GBP' },\n    'UK': { symbol: '', code: 'GBP' },\n    'India': { symbol: '', code: 'INR' },\n    'Germany': { symbol: '', code: 'EUR' },\n    'France': { symbol: '', code: 'EUR' },\n    'Italy': { symbol: '', code: 'EUR' },\n    'Spain': { symbol: '', code: 'EUR' },\n    'Netherlands': { symbol: '', code: 'EUR' },\n    'Australia': { symbol: 'A$', code: 'AUD' },\n    'Canada': { symbol: 'C$', code: 'CAD' },\n    'Switzerland': { symbol: 'CHF', code: 'CHF' },\n    'China': { symbol: '', code: 'CNY' },\n    'South Korea': { symbol: '', code: 'KRW' },\n    'Brazil': { symbol: 'R$', code: 'BRL' },\n    'Mexico': { symbol: '$', code: 'MXN' },\n    'New Zealand': { symbol: 'NZ$', code: 'NZD' },\n  };\n\n  return currencyMap[country] || { symbol: '$', code: 'USD' };\n};\n\nexport const calculateTripDuration = (fromDate: string, toDate: string): { days: number; nights: number } => {\n  const start = new Date(fromDate);\n  const end = new Date(toDate);\n  const diffTime = Math.abs(end.getTime() - start.getTime());\n  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n  \n  return {\n    days: diffDays + 1, // Include both start and end date\n    nights: diffDays\n  };\n};\n\n// Currency override types\nexport interface CurrencyOverride {\n  currency_symbol?: string;\n  pricing_currency?: string;\n  pricing_currency_symbol?: string;\n  pricing_currency_override?: boolean;\n}\n\nexport interface CountryWithCurrency {\n  currency: string;\n  currency_symbol: string;\n  pricing_currency?: string;\n  pricing_currency_symbol?: string;\n  pricing_currency_override?: boolean;\n}\n\n/**\n * Get the effective currency symbol for display, considering pricing overrides\n * @param country - Country object with currency information\n * @param useOverride - Whether to use pricing override if available (default: true)\n * @returns The currency symbol to display\n */\nexport const getEffectiveCurrencySymbol = (\n  country: CountryWithCurrency, \n  useOverride: boolean = true\n): string => {\n  // If pricing override is enabled and we should use it\n  if (useOverride && country.pricing_currency_override && country.pricing_currency_symbol) {\n    return country.pricing_currency_symbol;\n  }\n  \n  // Fall back to the country's default currency symbol\n  return country.currency_symbol || '$';\n};\n\n/**\n * Get the effective currency code for display, considering pricing overrides\n * @param country - Country object with currency information\n * @param useOverride - Whether to use pricing override if available (default: true)\n * @returns The currency code to display\n */\nexport const getEffectiveCurrencyCode = (\n  country: CountryWithCurrency, \n  useOverride: boolean = true\n): string => {\n  // If pricing override is enabled and we should use it\n  if (useOverride && country.pricing_currency_override && country.pricing_currency) {\n    return country.pricing_currency;\n  }\n  \n  // Fall back to the country's default currency\n  return country.currency || 'USD';\n};\n\n/**\n * Format currency amount with the effective currency symbol\n * @param amount - The amount to format\n * @param country - Country object with currency information\n * @param useOverride - Whether to use pricing override if available (default: true)\n * @returns Formatted currency string\n */\nexport const formatCurrencyWithOverride = (\n  amount: number, \n  country: CountryWithCurrency, \n  useOverride: boolean = true\n): string => {\n  const symbol = getEffectiveCurrencySymbol(country, useOverride);\n  const code = getEffectiveCurrencyCode(country, useOverride);\n  \n  try {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: code,\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(amount);\n  } catch (error) {\n    // Fallback to manual formatting if currency code is not supported\n    return `${symbol}${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;\n  }\n};\n\n/**\n * Get currency display information for a country\n * @param country - Country object with currency information\n * @param useOverride - Whether to use pricing override if available (default: true)\n * @returns Object with symbol, code, and formatted display string\n */\nexport const getCurrencyDisplayInfo = (\n  country: CountryWithCurrency, \n  useOverride: boolean = true\n): { symbol: string; code: string; display: string; isOverride: boolean } => {\n  const isOverride = useOverride && country.pricing_currency_override && !!country.pricing_currency;\n  const symbol = getEffectiveCurrencySymbol(country, useOverride);\n  const code = getEffectiveCurrencyCode(country, useOverride);\n  \n  return {\n    symbol,\n    code,\n    display: `${code} (${symbol})`,\n    isOverride\n  };\n};\n\n","\nimport { CountryEnquirySettings, EnquiryConfiguration, DEFAULT_ENQUIRY_COUNTRIES } from '../types/enquiry';\nimport { initialCountries } from '../pages/inventory/countries/data/countryData';\nimport { ensureCountryConfig } from '@/services/enquiriesService';\nimport { CountriesService } from '@/services/countriesService';\n\nexport class EnqIdGenerator {\n  private static validateCountryForEnquiry(countryCode: string): boolean {\n    // Prefer cached active countries from Supabase if available\n    try {\n      const cached = localStorage.getItem('enquiry_active_country_codes');\n      if (cached) {\n        const codes = JSON.parse(cached) as string[];\n        if (Array.isArray(codes) && codes.length > 0) {\n          return codes.includes(countryCode);\n        }\n      }\n    } catch {}\n\n    // Fallback to Countries Management module static data\n    const country = initialCountries.find(c => c.code === countryCode);\n    if (!country || country.status !== 'active') {\n      console.warn(`Country ${countryCode} is not active in the Countries Management module`);\n      return false;\n    }\n    return true;\n  }\n\n  private static getApplicationSettings(): EnquiryConfiguration {\n    const savedSettings = localStorage.getItem('applicationSettings');\n    if (savedSettings) {\n      try {\n        const parsed = JSON.parse(savedSettings);\n        return parsed.enquirySettings || {\n          countries: DEFAULT_ENQUIRY_COUNTRIES,\n          defaultCountryCode: 'TH'\n        };\n      } catch (error) {\n        console.error('Error parsing application settings:', error);\n      }\n    }\n    \n    // Fallback to default - use proper default countries including UAE\n    console.log('EnqIdGenerator: Using default enquiry configuration');\n    return {\n      countries: DEFAULT_ENQUIRY_COUNTRIES,\n      defaultCountryCode: 'TH'\n    };\n  }\n\n  private static buildEnquiryId(country: CountryEnquirySettings, sequenceNumber: number): string {\n    const { prefix, yearFormat, yearSeparator, numberLength, numberSeparator } = country;\n    \n    let year = '';\n    if (yearFormat === 'YYYY') {\n      year = new Date().getFullYear().toString();\n    } else if (yearFormat === 'YY') {\n      year = new Date().getFullYear().toString().slice(-2);\n    }\n    \n    // Allow numbers to exceed initial length (e.g., 9999 -> 10000)\n    const numberStr = sequenceNumber.toString();\n    const minLength = numberLength;\n    const paddedNumber = numberStr.length >= minLength ? numberStr : numberStr.padStart(minLength, '0');\n    \n    // Build format based on separators\n    let enquiryId = prefix;\n    \n    if (year) {\n      enquiryId += (yearSeparator === 'none' ? '' : yearSeparator) + year;\n    }\n    \n    if (paddedNumber) {\n      enquiryId += (numberSeparator === 'none' ? '' : numberSeparator) + paddedNumber;\n    }\n    \n    return enquiryId;\n  }\n\n  // Prepare Supabase-backed configuration and cache active countries before ID generation\n  public static async prepareConfig(countryCode?: string): Promise<void> {\n    try {\n      // Ensure enquiry configuration exists in App Settings and includes the target country\n      await ensureCountryConfig(countryCode);\n    } catch (e) {\n      console.warn('EnqIdGenerator.prepareConfig: ensureCountryConfig failed; continuing with local defaults', e);\n    }\n\n    try {\n      // Cache active countries codes to localStorage for validation\n      const response = await CountriesService.getCountriesByStatus('active');\n      if (response.success && response.data) {\n        const codes = (response.data || []).map((c: any) => c.code).filter(Boolean);\n        localStorage.setItem('enquiry_active_country_codes', JSON.stringify(codes));\n      }\n    } catch (e) {\n      console.warn('EnqIdGenerator.prepareConfig: failed to cache active countries; validation will use defaults', e);\n    }\n  }\n\n  public static generateEnqId(countryCode?: string): string {\n    const config = this.getApplicationSettings();\n    \n    // Find the country settings\n    const targetCountryCode = countryCode || config.defaultCountryCode;\n    console.log('EnqIdGenerator: Generating ID for country code:', targetCountryCode);\n    console.log('EnqIdGenerator: Available enquiry configurations:', config.countries.map(c => ({ code: c.countryCode, prefix: c.prefix, active: c.isActive })));\n    \n    // Validate country is active in Countries Management module\n    if (!this.validateCountryForEnquiry(targetCountryCode)) {\n      console.error(`EnqIdGenerator: Country ${targetCountryCode} is not active in the Countries Management module`);\n      throw new Error(`Country ${targetCountryCode} is not active in the Countries Management module`);\n    }\n    \n    const country = config.countries.find(c => c.countryCode === targetCountryCode && c.isActive);\n    console.log('EnqIdGenerator: Found enquiry configuration:', country);\n    \n    if (!country) {\n      console.error(`EnqIdGenerator: Enquiry configuration not found or inactive for country: ${targetCountryCode}`);\n      console.log('Available configurations:', config.countries.map(c => ({ code: c.countryCode, active: c.isActive })));\n      throw new Error(`Enquiry configuration not found or inactive for country: ${targetCountryCode}`);\n    }\n\n    // Get existing enquiries to determine next number\n    const savedQueries = localStorage.getItem('travel_queries');\n    let queries = [];\n    \n    if (savedQueries) {\n      try {\n        queries = JSON.parse(savedQueries);\n      } catch (error) {\n        console.error('Error parsing saved queries:', error);\n        queries = [];\n      }\n    }\n\n    // Build pattern to match existing IDs for this country\n    const currentYear = new Date().getFullYear();\n    let searchPattern = country.prefix;\n    \n    if (country.yearFormat === 'YYYY') {\n      searchPattern += (country.yearSeparator === 'none' ? '' : country.yearSeparator) + currentYear.toString();\n    } else if (country.yearFormat === 'YY') {\n      searchPattern += (country.yearSeparator === 'none' ? '' : country.yearSeparator) + currentYear.toString().slice(-2);\n    }\n    \n    // Find the highest existing number for this country and year\n    let maxNumber = country.startingNumber - 1;\n    \n    queries.forEach((query: any) => {\n      if (query.id && query.id.startsWith(searchPattern)) {\n        const afterPrefix = query.id.substring(searchPattern.length);\n        const numberPart = country.numberSeparator === 'none' ? \n          afterPrefix : \n          afterPrefix.substring(country.numberSeparator.length);\n        \n        const number = parseInt(numberPart, 10);\n        if (!isNaN(number) && number > maxNumber) {\n          maxNumber = number;\n        }\n      }\n    });\n\n    // Generate next number (ensure it's at least the starting number)\n    const nextNumber = Math.max(maxNumber + 1, country.startingNumber);\n    \n    return this.buildEnquiryId(country, nextNumber);\n  }\n\n  public static validateEnqId(id: string, countryCode?: string): boolean {\n    const config = this.getApplicationSettings();\n    \n    // If no country specified, try to validate against all active countries\n    const countriesToCheck = countryCode ? \n      config.countries.filter(c => c.countryCode === countryCode) :\n      config.countries.filter(c => c.isActive);\n\n    // Additional validation: ensure countries are active in Countries Management module\n    const validCountries = countriesToCheck.filter(country => \n      this.validateCountryForEnquiry(country.countryCode)\n    );\n\n    return validCountries.some(country => {\n      let pattern = country.prefix;\n      \n      if (country.yearFormat === 'YYYY') {\n        pattern += country.yearSeparator === 'none' ? '\\\\d{4}' : `\\\\${country.yearSeparator}\\\\d{4}`;\n      } else if (country.yearFormat === 'YY') {\n        pattern += country.yearSeparator === 'none' ? '\\\\d{2}' : `\\\\${country.yearSeparator}\\\\d{2}`;\n      }\n      \n      pattern += country.numberSeparator === 'none' ? `\\\\d{${country.numberLength}}` : `\\\\${country.numberSeparator}\\\\d{${country.numberLength}}`;\n      \n      const regex = new RegExp(`^${pattern}$`);\n      return regex.test(id);\n    });\n  }\n\n  public static getCountryFromEnqId(id: string): CountryEnquirySettings | null {\n    const config = this.getApplicationSettings();\n    \n    for (const country of config.countries) {\n      if (this.validateEnqId(id, country.countryCode)) {\n        return country;\n      }\n    }\n    \n    return null;\n  }\n}\n\n","\nexport class ProposalIdGenerator {\n  private static getNextProposalSequence(enqId: string): number {\n    const existingProposals = this.getProposalsByEnqId(enqId);\n    return existingProposals.length + 1;\n  }\n\n  private static getProposalsByEnqId(enqId: string): any[] {\n    try {\n      const saved = localStorage.getItem('travel_proposals_v2') || '[]';\n      const proposals = JSON.parse(saved);\n      return proposals.filter((p: any) => p.queryId === enqId);\n    } catch (error) {\n      console.error('Error getting proposals by ENQ ID:', error);\n      return [];\n    }\n  }\n\n  public static generateProposalId(enqId: string): string {\n    const sequence = this.getNextProposalSequence(enqId);\n    const paddedSequence = sequence.toString().padStart(3, '0');\n    return `${enqId}-P${paddedSequence}`;\n  }\n\n  public static parseProposalId(proposalId: string): { enqId: string; sequence: number } | null {\n    const match = proposalId.match(/^(.+)-P(\\d{3})$/);\n    if (!match) return null;\n    \n    return {\n      enqId: match[1],\n      sequence: parseInt(match[2], 10)\n    };\n  }\n\n  public static getLatestProposalId(enqId: string): string | null {\n    const proposals = this.getProposalsByEnqId(enqId);\n    if (proposals.length === 0) return null;\n    \n    const latestSequence = Math.max(...proposals.map(p => {\n      const parsed = this.parseProposalId(p.id);\n      return parsed ? parsed.sequence : 0;\n    }));\n    \n    return `${enqId}-P${latestSequence.toString().padStart(3, '0')}`;\n  }\n}\n","import {\n  ItineraryDay,\n  EnhancedAccommodationOption,\n  EnhancedSightseeingActivity,\n  EnhancedTransportRoute,\n  EnhancedTransferConfiguration\n} from '@/types/itinerary';\n\nexport interface EnhancedItineraryData {\n  days: ItineraryDay[];\n  accommodationOptions: Record<string, EnhancedAccommodationOption[]>; // dayId -> options\n  sightseeingActivities: Record<string, EnhancedSightseeingActivity[]>; // dayId -> activities\n  transportRoutes: Record<string, EnhancedTransportRoute[]>; // dayId -> routes\n  transferConfigurations: Record<string, EnhancedTransferConfiguration[]>; // dayId -> transfers\n}\n\nexport interface ComprehensiveProposalData {\n  queryId: string;\n  days: any[];\n  accommodationSelections?: any[];\n  enhancedData?: EnhancedItineraryData;\n  version: number;\n  savedAt: string;\n  totalCost: number;\n}\n\n/**\n * Load comprehensive day-wise itinerary data from all possible storage locations\n */\nexport const loadComprehensiveItineraryData = (queryId: string): ComprehensiveProposalData | null => {\n  try {\n    // Priority order of storage keys to check\n    const storageKeys = [\n      `proposal_draft_${queryId}`,           // Main day-wise draft\n      `proposal_complete_${queryId}`,        // Complete proposal data\n      `itinerary_builder_${queryId}`,       // Advanced itinerary builder\n      `itinerary_${queryId}`,               // Central itinerary\n      `enquiry_workflow_${queryId}`,        // Workflow context data\n      `comprehensive_proposal_${queryId}`,   // Comprehensive proposal manager\n      `enhanced_proposal_modules_${queryId}` // Enhanced modules\n    ];\n\n    for (const key of storageKeys) {\n      const savedData = localStorage.getItem(key);\n      if (savedData) {\n        try {\n          const parsed = JSON.parse(savedData);\n          console.log(`Loaded data from ${key}:`, {\n            daysCount: parsed.days?.length || 0,\n            accommodationsCount: parsed.accommodationSelections?.length || 0,\n            hasEnhancedData: !!parsed.enhancedData\n          });\n\n          // Transform and normalize the data\n          return transformToComprehensiveData(queryId, parsed);\n        } catch (parseError) {\n          console.error(`Error parsing data from ${key}:`, parseError);\n          continue;\n        }\n      }\n    }\n\n    console.log(`No existing data found for query ${queryId}`);\n    return null;\n  } catch (error) {\n    console.error('Error loading comprehensive itinerary data:', error);\n    return null;\n  }\n};\n\n/**\n * Transform various data formats to comprehensive format\n */\nconst transformToComprehensiveData = (queryId: string, rawData: any): ComprehensiveProposalData => {\n  const defaultData: ComprehensiveProposalData = {\n    queryId,\n    days: [],\n    accommodationSelections: [],\n    enhancedData: {\n      days: [],\n      accommodationOptions: {},\n      sightseeingActivities: {},\n      transportRoutes: {},\n      transferConfigurations: {}\n    },\n    version: Date.now(),\n    savedAt: new Date().toISOString(),\n    totalCost: 0\n  };\n\n  try {\n    // Handle different data structures\n    if (rawData.days && Array.isArray(rawData.days)) {\n      defaultData.days = rawData.days;\n      defaultData.totalCost = rawData.totalCost || calculateTotalCost(rawData.days);\n    }\n\n    if (rawData.accommodationSelections && Array.isArray(rawData.accommodationSelections)) {\n      defaultData.accommodationSelections = rawData.accommodationSelections;\n    }\n\n    // Extract enhanced data from days\n    if (rawData.days && Array.isArray(rawData.days)) {\n      defaultData.enhancedData = extractEnhancedDataFromDays(rawData.days);\n    }\n\n    // Preserve existing enhanced data if available\n    if (rawData.enhancedData) {\n      defaultData.enhancedData = { ...defaultData.enhancedData, ...rawData.enhancedData };\n    }\n\n    // Preserve metadata\n    if (rawData.version) defaultData.version = rawData.version;\n    if (rawData.savedAt) defaultData.savedAt = rawData.savedAt;\n    if (rawData.timestamp) defaultData.savedAt = rawData.timestamp;\n\n    return defaultData;\n  } catch (error) {\n    console.error('Error transforming data:', error);\n    return defaultData;\n  }\n};\n\n/**\n * Extract enhanced data structures from legacy day data\n */\nconst extractEnhancedDataFromDays = (days: any[]): EnhancedItineraryData => {\n  const enhancedData: EnhancedItineraryData = {\n    days: [],\n    accommodationOptions: {},\n    sightseeingActivities: {},\n    transportRoutes: {},\n    transferConfigurations: {}\n  };\n\n  days.forEach((day, index) => {\n    const dayId = day.id || `day_${index + 1}`;\n\n    // Extract accommodation options (support for 3 options)\n    if (day.accommodations && Array.isArray(day.accommodations)) {\n      enhancedData.accommodationOptions[dayId] = day.accommodations.map((acc: any, optionIndex: number): EnhancedAccommodationOption => ({\n        id: acc.id || `acc_${dayId}_${optionIndex}`,\n        hotelName: acc.name || acc.hotel || `Hotel ${optionIndex + 1}`,\n        hotelType: acc.type || 'hotel',\n        roomType: acc.roomType || 'Standard Room',\n        numberOfRooms: acc.rooms || 1,\n        city: day.city || acc.city || '',\n        numberOfNights: acc.nights || 1,\n        checkInDate: acc.checkIn || day.date || '',\n        checkOutDate: acc.checkOut || '',\n        starRating: acc.starRating || 3,\n        amenities: acc.amenities || [],\n        price: acc.totalPrice || acc.price || 0,\n        pricePerNight: acc.pricePerNight || acc.price || 0,\n        option: (optionIndex + 1) as 1 | 2 | 3,\n        address: acc.address || '',\n        phone: acc.phone || '',\n        email: acc.email || ''\n      })).slice(0, 3); // Limit to 3 options\n    }\n\n    // Extract enhanced sightseeing activities\n    if (day.activities && Array.isArray(day.activities)) {\n      enhancedData.sightseeingActivities[dayId] = day.activities.map((activity: any): EnhancedSightseeingActivity => ({\n        id: activity.id || `activity_${dayId}_${Date.now()}`,\n        sightseeingName: activity.name || 'Sightseeing Activity',\n        sightseeingDescription: activity.description || '',\n        sightseeingType: activity.category === 'private' || activity.transportType === 'private_car' ? 'PVT' : 'SIC',\n        category: activity.category || activity.type || 'sightseeing',\n        groupSize: activity.effectivePax || activity.groupSize || 2,\n        packageIncludes: activity.packageOptions || activity.selectedOptions || activity.inclusions || [],\n        location: {\n          id: `loc_${dayId}`,\n          name: day.city || 'Location',\n          country: 'Thailand', // Default - should come from query\n          city: day.city || '',\n          coordinates: undefined\n        },\n        startTime: activity.startTime || '',\n        endTime: activity.endTime || '',\n        duration: activity.duration || '2 hours',\n        price: activity.cost || activity.price || 0,\n        transferConfiguration: activity.vehicleType ? {\n          id: `transfer_${activity.id}`,\n          vehicleName: activity.vehicleType || 'Private Car',\n          vehicleType: activity.vehicleType === 'private_car' ? 'private_car' : 'sedan',\n          vehicleNumbers: [`${activity.vehicleType}_001`],\n          transferType: activity.transportType === 'private_car' ? 'PVT' : 'SIC',\n          pickupLocation: activity.pickupLocation || day.city || '',\n          dropLocation: activity.dropoffLocation || day.city || '',\n          pickupTime: activity.startTime || '',\n          dropTime: activity.endTime || '',\n          capacity: activity.seatingCapacity || 4,\n          price: 0 // Usually included in activity price\n        } : undefined\n      }));\n    }\n\n    // Extract transport routes\n    if (day.transport && Array.isArray(day.transport)) {\n      enhancedData.transportRoutes[dayId] = day.transport.map((transport: any): EnhancedTransportRoute => ({\n        id: transport.id || `route_${dayId}_${Date.now()}`,\n        routeName: transport.name || `${transport.from} to ${transport.to}`,\n        routeCode: transport.routeCode || `RT_${dayId}_${Math.random().toString(36).substr(2, 6).toUpperCase()}`,\n        from: {\n          id: `from_${transport.id}`,\n          name: typeof transport.from === 'string' ? transport.from : transport.from?.name || 'Origin',\n          country: 'Thailand',\n          city: typeof transport.from === 'string' ? transport.from : transport.from?.city || day.city || '',\n          coordinates: undefined\n        },\n        to: {\n          id: `to_${transport.id}`,\n          name: typeof transport.to === 'string' ? transport.to : transport.to?.name || 'Destination',\n          country: 'Thailand',\n          city: typeof transport.to === 'string' ? transport.to : transport.to?.city || day.city || '',\n          coordinates: undefined\n        },\n        pickupLocations: [transport.pickupLocation || 'Hotel Pickup'].filter(Boolean),\n        vehicleConfiguration: {\n          vehicleType: transport.vehicleType || 'Private Car',\n          numberOfVehicles: transport.vehicleCount || 1,\n          capacity: transport.seatingCapacity || 4,\n          totalCapacity: transport.totalCapacity || (transport.seatingCapacity || 4) * (transport.vehicleCount || 1)\n        },\n        duration: transport.duration || '1 hour',\n        price: transport.price || 0,\n        schedules: transport.pickupTime && transport.dropTime ? [{\n          departureTime: transport.pickupTime,\n          arrivalTime: transport.dropTime,\n          pickupTimes: [{ location: transport.pickupLocation || 'Hotel', time: transport.pickupTime }]\n        }] : undefined\n      }));\n    }\n\n    // Extract transfer configurations for activities\n    if (day.activities && Array.isArray(day.activities)) {\n      const transfers = day.activities\n        .filter((activity: any) => activity.vehicleType || activity.transportType)\n        .map((activity: any): EnhancedTransferConfiguration => ({\n          id: `transfer_${activity.id}_${dayId}`,\n          vehicleName: activity.vehicleType || 'Private Car',\n          vehicleType: activity.vehicleType === 'private_car' ? 'private_car' : 'sedan',\n          vehicleNumbers: [`${activity.vehicleType || 'car'}_${Math.random().toString(36).substr(2, 4)}`],\n          transferType: activity.transportType === 'private_car' || activity.category === 'private' ? 'PVT' : 'SIC',\n          pickupLocation: activity.pickupLocation || day.city || 'Hotel',\n          dropLocation: activity.dropoffLocation || day.city || 'Activity Location',\n          pickupTime: activity.startTime || '',\n          dropTime: activity.endTime || '',\n          capacity: activity.seatingCapacity || 4,\n          price: 0 // Usually included in activity price\n        }));\n\n      if (transfers.length > 0) {\n        enhancedData.transferConfigurations[dayId] = transfers;\n      }\n    }\n  });\n\n  return enhancedData;\n};\n\n/**\n * Calculate total cost from days data\n */\nconst calculateTotalCost = (days: any[]): number => {\n  return days.reduce((total, day) => total + (day.totalCost || 0), 0);\n};\n\n/**\n * Save comprehensive itinerary data\n */\nexport const saveComprehensiveItineraryData = (data: ComprehensiveProposalData): void => {\n  try {\n    const dataToSave = {\n      ...data,\n      savedAt: new Date().toISOString(),\n      version: Date.now()\n    };\n\n    // Save to multiple keys for compatibility\n    localStorage.setItem(`proposal_draft_${data.queryId}`, JSON.stringify(dataToSave));\n    localStorage.setItem(`proposal_complete_${data.queryId}`, JSON.stringify(dataToSave));\n    \n    console.log('Saved comprehensive itinerary data:', {\n      queryId: data.queryId,\n      daysCount: data.days.length,\n      accommodationsCount: data.accommodationSelections?.length || 0,\n      hasEnhancedData: !!data.enhancedData,\n      totalCost: data.totalCost\n    });\n  } catch (error) {\n    console.error('Error saving comprehensive itinerary data:', error);\n  }\n};\n\n/**\n * Generate default accommodation options for a day\n */\nexport const generateDefaultAccommodationOptions = (dayData: any): EnhancedAccommodationOption[] => {\n  const baseOption: Partial<EnhancedAccommodationOption> = {\n    hotelType: 'hotel',\n    roomType: 'Standard Room',\n    numberOfRooms: 1,\n    city: dayData.city || '',\n    numberOfNights: 1,\n    checkInDate: dayData.date || '',\n    checkOutDate: dayData.date || '',\n    starRating: 3,\n    amenities: ['wifi', 'parking'],\n    pricePerNight: 100\n  };\n\n  return [\n    {\n      ...baseOption,\n      id: `acc_${dayData.id}_1`,\n      hotelName: 'Budget Hotel Option',\n      hotelType: 'hotel',\n      starRating: 3,\n      price: 100,\n      pricePerNight: 100,\n      option: 1\n    },\n    {\n      ...baseOption,\n      id: `acc_${dayData.id}_2`,\n      hotelName: 'Mid-Range Hotel Option',\n      hotelType: 'hotel',\n      starRating: 4,\n      price: 200,\n      pricePerNight: 200,\n      option: 2,\n      amenities: ['wifi', 'parking', 'gym', 'pool']\n    },\n    {\n      ...baseOption,\n      id: `acc_${dayData.id}_3`,\n      hotelName: 'Luxury Hotel Option',\n      hotelType: 'resort',\n      starRating: 5,\n      price: 400,\n      pricePerNight: 400,\n      option: 3,\n      amenities: ['wifi', 'parking', 'gym', 'pool', 'spa', 'restaurant']\n    }\n  ] as EnhancedAccommodationOption[];\n};\n\n/**\n * Ensure each day has 3 accommodation options\n */\nexport const ensureThreeAccommodationOptions = (data: ComprehensiveProposalData): ComprehensiveProposalData => {\n  if (!data.enhancedData) {\n    data.enhancedData = {\n      days: [],\n      accommodationOptions: {},\n      sightseeingActivities: {},\n      transportRoutes: {},\n      transferConfigurations: {}\n    };\n  }\n\n  data.days.forEach((day) => {\n    const dayId = day.id;\n    const existingOptions = data.enhancedData!.accommodationOptions[dayId] || [];\n    \n    if (existingOptions.length < 3) {\n      const defaultOptions = generateDefaultAccommodationOptions(day);\n      // Keep existing options and fill with defaults\n      const filledOptions = [...existingOptions];\n      \n      for (let i = existingOptions.length; i < 3; i++) {\n        filledOptions.push({\n          ...defaultOptions[i],\n          option: (i + 1) as 1 | 2 | 3\n        });\n      }\n      \n      data.enhancedData!.accommodationOptions[dayId] = filledOptions;\n    }\n  });\n\n  return data;\n};\n","\nimport { ItineraryDay } from '@/types/itinerary';\n\nexport interface AccommodationOption {\n  id: string;\n  name: string;\n  type: 'hotel' | 'resort' | 'guesthouse' | 'apartment' | 'villa' | 'hostel';\n  city: string;\n  checkIn: string;\n  checkOut: string;\n  nights: number;\n  roomType: string;\n  starRating: number;\n  pricePerNight: number;\n  totalPrice: number;\n  amenities: string[];\n  description: string;\n  address: string;\n  phone: string;\n  email: string;\n  dayIds: string[]; // Which days this accommodation covers\n  option: 1 | 2 | 3; // Option number for comparison\n  similarOptions?: any[]; // Similar hotel options for alternatives\n}\n\nexport interface AccommodationOptionSet {\n  option1: AccommodationOption[];\n  option2: AccommodationOption[];\n  option3: AccommodationOption[];\n}\n\nexport const extractAccommodationsFromDays = (days: any[]): AccommodationOptionSet => {\n  const optionSet: AccommodationOptionSet = {\n    option1: [],\n    option2: [],\n    option3: []\n  };\n\n  days.forEach(day => {\n    if (day.accommodations && Array.isArray(day.accommodations)) {\n      day.accommodations.forEach((acc: any, index: number) => {\n        const accommodation: AccommodationOption = {\n          id: acc.id || `acc_${day.id}_${index}`,\n          name: acc.name || 'Unnamed Accommodation',\n          type: acc.type || 'hotel',\n          city: acc.city || day.city,\n          checkIn: acc.checkIn || day.date,\n          checkOut: acc.checkOut || day.date,\n          nights: acc.nights || 1,\n          roomType: acc.roomType || 'Standard Room',\n          starRating: acc.starRating || 3,\n          pricePerNight: acc.pricePerNight || 0,\n          totalPrice: acc.totalPrice || acc.pricePerNight || 0,\n          amenities: acc.amenities || [],\n          description: acc.description || '',\n          address: acc.address || '',\n          phone: acc.phone || '',\n          email: acc.email || '',\n          dayIds: [day.id],\n          option: (acc.option || 1) as 1 | 2 | 3\n        };\n\n        if (accommodation.option === 1) {\n          optionSet.option1.push(accommodation);\n        } else if (accommodation.option === 2) {\n          optionSet.option2.push(accommodation);\n        } else if (accommodation.option === 3) {\n          optionSet.option3.push(accommodation);\n        }\n      });\n    }\n  });\n\n  return optionSet;\n};\n\nexport const mapAccommodationsToDays = (\n  accommodations: AccommodationOption[],\n  days: any[]\n): any[] => {\n  return days.map(day => {\n    const dayAccommodations = accommodations.filter(acc => \n      acc.dayIds.includes(day.id) || \n      acc.city === day.city ||\n      (acc.checkIn <= day.date && acc.checkOut >= day.date)\n    );\n\n    return {\n      ...day,\n      accommodations: dayAccommodations.map(acc => ({\n        id: acc.id,\n        name: acc.name,\n        type: acc.type,\n        city: acc.city,\n        checkIn: acc.checkIn,\n        checkOut: acc.checkOut,\n        nights: acc.nights,\n        roomType: acc.roomType,\n        starRating: acc.starRating,\n        pricePerNight: acc.pricePerNight,\n        totalPrice: acc.totalPrice,\n        amenities: acc.amenities,\n        description: acc.description,\n        address: acc.address,\n        phone: acc.phone,\n        email: acc.email,\n        option: acc.option\n      }))\n    };\n  });\n};\n\nexport const saveAccommodationData = (queryId: string, accommodations: AccommodationOption[], days: any[]) => {\n  try {\n    // Update days with accommodation data\n    const updatedDays = mapAccommodationsToDays(accommodations, days);\n    \n    // Save to localStorage with the same key used by proposal builder\n    const draftData = {\n      queryId,\n      days: updatedDays,\n      totalCost: updatedDays.reduce((sum, day) => sum + (day.totalCost || 0), 0),\n      savedAt: new Date().toISOString(),\n      accommodations: accommodations,\n      version: Date.now()\n    };\n    \n    localStorage.setItem(`proposal_draft_${queryId}`, JSON.stringify(draftData));\n    \n    // Also save accommodation-specific data\n    localStorage.setItem(`accommodations_${queryId}`, JSON.stringify(accommodations));\n    \n    console.log('Accommodation data saved for query:', queryId, draftData);\n    return true;\n  } catch (error) {\n    console.error('Error saving accommodation data:', error);\n    return false;\n  }\n};\n\nexport const loadAccommodationData = (queryId: string): AccommodationOption[] => {\n  try {\n    // First try to load from accommodation-specific storage\n    const accommodationData = localStorage.getItem(`accommodations_${queryId}`);\n    if (accommodationData) {\n      return JSON.parse(accommodationData);\n    }\n    \n    // Fallback to extracting from draft data\n    const draftData = localStorage.getItem(`proposal_draft_${queryId}`);\n    if (draftData) {\n      const parsed = JSON.parse(draftData);\n      if (parsed.accommodations) {\n        return parsed.accommodations;\n      }\n      if (parsed.days) {\n        const extracted = extractAccommodationsFromDays(parsed.days);\n        return [...extracted.option1, ...extracted.option2, ...extracted.option3];\n      }\n    }\n    \n    return [];\n  } catch (error) {\n    console.error('Error loading accommodation data:', error);\n    return [];\n  }\n};\n\nexport const calculateAccommodationTimeline = (\n  accommodations: AccommodationOption[],\n  days: any[]\n): Array<{\n  dayId: string;\n  date: string;\n  city: string;\n  accommodations: AccommodationOption[];\n  isCheckIn: boolean;\n  isCheckOut: boolean;\n}> => {\n  return days.map(day => {\n    const dayAccommodations = accommodations.filter(acc =>\n      acc.checkIn <= day.date && acc.checkOut >= day.date\n    );\n\n    const isCheckIn = accommodations.some(acc => acc.checkIn === day.date);\n    const isCheckOut = accommodations.some(acc => acc.checkOut === day.date);\n\n    return {\n      dayId: day.id,\n      date: day.date,\n      city: day.city,\n      accommodations: dayAccommodations,\n      isCheckIn,\n      isCheckOut\n    };\n  });\n};\n","\nexport interface AccommodationStay {\n  id: string;\n  city: string;\n  hotelId: string;\n  hotelName: string;\n  hotelCategory: string;\n  numberOfNights: number;\n  numberOfRooms: number;\n  roomType: string;\n  pricePerNightPerRoom: number;\n  totalPrice: number;\n  checkInDay: number;\n  checkOutDay: number;\n  stayDays: number[];\n  optionNumber: 1 | 2 | 3;\n  // Extended properties for pricing\n  numberOfChildren?: number;\n  extraBeds?: number;\n  pricePerNight?: number; // Legacy compatibility\n  // New properties for room details\n  configuration?: string;\n  mealPlan?: string;\n}\n\nexport interface AccommodationCalculationResult {\n  totalAccommodationCost: number;\n  accommodationsByCity: Record<string, AccommodationStay[]>;\n  accommodationsByDay: Record<number, AccommodationStay[]>;\n  accommodationsByOption: Record<1 | 2 | 3, AccommodationStay[]>;\n}\n\nexport const calculateAccommodationStay = (\n  city: string,\n  hotelId: string,\n  hotelName: string,\n  hotelCategory: string,\n  numberOfNights: number,\n  numberOfRooms: number,\n  roomType: string,\n  pricePerNightPerRoom: number,\n  startDay: number,\n  optionNumber: 1 | 2 | 3 = 1\n): AccommodationStay => {\n  const checkInDay = startDay;\n  const checkOutDay = startDay + numberOfNights;\n  const stayDays = Array.from({ length: numberOfNights }, (_, i) => startDay + i);\n  const totalPrice = numberOfNights * numberOfRooms * pricePerNightPerRoom;\n\n  return {\n    id: `accommodation_${Date.now()}_${Math.random()}`,\n    city,\n    hotelId,\n    hotelName,\n    hotelCategory,\n    numberOfNights,\n    numberOfRooms,\n    roomType,\n    pricePerNightPerRoom,\n    totalPrice,\n    checkInDay,\n    checkOutDay,\n    stayDays,\n    optionNumber\n  };\n};\n\nexport const calculateTotalAccommodationCost = (accommodations: AccommodationStay[]): number => {\n  return accommodations.reduce((total, accommodation) => total + accommodation.totalPrice, 0);\n};\n\nexport const calculateTotalAccommodationCostByOption = (accommodations: AccommodationStay[], optionNumber: 1 | 2 | 3): number => {\n  return accommodations\n    .filter(acc => acc.optionNumber === optionNumber)\n    .reduce((total, accommodation) => total + accommodation.totalPrice, 0);\n};\n\nexport const groupAccommodationsByCity = (accommodations: AccommodationStay[]): Record<string, AccommodationStay[]> => {\n  return accommodations.reduce((groups, accommodation) => {\n    if (!groups[accommodation.city]) {\n      groups[accommodation.city] = [];\n    }\n    groups[accommodation.city].push(accommodation);\n    return groups;\n  }, {} as Record<string, AccommodationStay[]>);\n};\n\nexport const groupAccommodationsByDay = (accommodations: AccommodationStay[]): Record<number, AccommodationStay[]> => {\n  const dayGroups: Record<number, AccommodationStay[]> = {};\n  \n  accommodations.forEach(accommodation => {\n    accommodation.stayDays.forEach(day => {\n      if (!dayGroups[day]) {\n        dayGroups[day] = [];\n      }\n      dayGroups[day].push(accommodation);\n    });\n  });\n  \n  return dayGroups;\n};\n\nexport const groupAccommodationsByOption = (accommodations: AccommodationStay[]): Record<1 | 2 | 3, AccommodationStay[]> => {\n  const optionGroups: Record<1 | 2 | 3, AccommodationStay[]> = {\n    1: [],\n    2: [],\n    3: []\n  };\n  \n  accommodations.forEach(accommodation => {\n    optionGroups[accommodation.optionNumber].push(accommodation);\n  });\n  \n  return optionGroups;\n};\n\nexport const getAccommodationsByDayAndOption = (\n  accommodations: AccommodationStay[], \n  dayNumber: number, \n  optionNumber: 1 | 2 | 3\n): AccommodationStay[] => {\n  return accommodations.filter(acc => \n    acc.optionNumber === optionNumber && acc.stayDays.includes(dayNumber)\n  );\n};\n","import { Query } from '@/types/query';\nimport { AccommodationStay } from '@/utils/accommodationCalculations';\n\nexport interface AccommodationPricingBreakdown {\n  adults: {\n    count: number;\n    totalPrice: number;\n    pricePerPerson: number;\n  };\n  children: {\n    count: number;\n    totalPrice: number;\n    pricePerPerson: number;\n    discountPercentage: number;\n  };\n  totalPrice: number;\n  priceStructure: 'room-based' | 'per-person';\n}\n\nexport interface OptionPricingBreakdown {\n  optionNumber: number;\n  accommodations: AccommodationStay[];\n  totalCost: number;\n  pricingBreakdown: AccommodationPricingBreakdown;\n}\n\n/**\n * Calculate accommodation pricing breakdown for adults and children\n * @param accommodations - Array of accommodation stays\n * @param query - Query object containing pax details\n * @returns AccommodationPricingBreakdown\n */\nexport function calculateAccommodationPricing(\n  accommodations: AccommodationStay[],\n  query: Query\n): AccommodationPricingBreakdown {\n  const adults = query?.paxDetails.adults || 1;\n  const children = query?.paxDetails.children || 0;\n  const totalPax = adults + children;\n  \n  // Calculate total accommodation cost\n  const totalAccommodationCost = accommodations.reduce(\n    (sum, acc) => sum + (acc.totalPrice || 0), \n    0\n  );\n\n  // For accommodations, typically room-based pricing where children may have additional charges\n  // or be included in the room rate\n  \n  // Base room cost covers adults\n  const baseRoomCost = totalAccommodationCost;\n  \n  // Children pricing - simple calculation without discounts\n  const childrenExtraCharges = children > 0 \n    ? calculateChildrenExtraCharges(accommodations, children)\n    : 0;\n\n  const adultPrice = baseRoomCost;\n  const childPrice = childrenExtraCharges;\n  const totalPrice = adultPrice + childPrice;\n\n  return {\n    adults: {\n      count: adults,\n      totalPrice: adultPrice,\n      pricePerPerson: adults > 0 ? adultPrice / adults : 0\n    },\n    children: {\n      count: children,\n      totalPrice: childPrice,\n      pricePerPerson: children > 0 ? childPrice / children : 0,\n      discountPercentage: 0\n    },\n    totalPrice,\n    priceStructure: 'room-based'\n  };\n}\n\n/**\n * Calculate children extra charges for accommodations\n * @param accommodations - Array of accommodations\n * @param childrenCount - Number of children\n * @returns Total extra charges for children\n */\nfunction calculateChildrenExtraCharges(\n  accommodations: AccommodationStay[],\n  childrenCount: number\n): number {\n  // Calculate based on extra bed charges and child policies\n  return accommodations.reduce((totalCharges, accommodation) => {\n    // If accommodation has explicit children count and extra bed costs\n    if (accommodation.numberOfChildren > 0 && accommodation.extraBeds > 0) {\n      // Use accommodation-specific children charges\n      const baseExtraBedCost = (accommodation.totalPrice || 0) * 0.3; // 30% of room rate for extra bed\n      return totalCharges + baseExtraBedCost;\n    }\n    \n    // Otherwise, calculate based on standard children pricing\n    const perNightChildCharge = (accommodation.pricePerNightPerRoom || 0) * 0.25; // 25% of room rate per child\n    const totalChildCharge = perNightChildCharge * (accommodation.numberOfNights || 1) * childrenCount;\n    \n    return totalCharges + totalChildCharge;\n  }, 0);\n}\n\n/**\n * Group accommodations by option and calculate pricing for each\n * @param accommodations - All accommodations\n * @param query - Query object\n * @returns Array of option pricing breakdowns\n */\nexport function calculateAccommodationOptionsPricing(\n  accommodations: AccommodationStay[],\n  query: Query\n): OptionPricingBreakdown[] {\n  const options: OptionPricingBreakdown[] = [];\n  \n  // Group by option number\n  for (let optionNumber = 1; optionNumber <= 3; optionNumber++) {\n    const optionAccommodations = accommodations.filter(\n      acc => acc.optionNumber === optionNumber\n    );\n    \n    if (optionAccommodations.length > 0) {\n      const pricingBreakdown = calculateAccommodationPricing(\n        optionAccommodations,\n        query\n      );\n      \n      const totalCost = optionAccommodations.reduce(\n        (sum, acc) => sum + (acc.totalPrice || 0),\n        0\n      );\n      \n      options.push({\n        optionNumber,\n        accommodations: optionAccommodations,\n        totalCost,\n        pricingBreakdown\n      });\n    }\n  }\n  \n  return options;\n}\n\n/**\n * Get option display details\n * @param optionNumber - Option number (1, 2, 3)\n * @returns Display configuration for the option\n */\nexport function getOptionDisplayConfig(optionNumber: number) {\n  const configs = {\n    1: {\n      title: 'Accommodations',\n      icon: 'Hotel',\n      colorClass: 'primary',\n      borderClass: 'border-l-primary/60',\n      bgClass: 'bg-gradient-to-r from-card to-primary/5',\n      badgeClass: 'bg-primary/10 border-primary/30'\n    },\n    2: {\n      title: 'Optional Accommodations',\n      icon: 'Hotel',\n      colorClass: 'amber-600',\n      borderClass: 'border-l-amber-600/60',\n      bgClass: 'bg-gradient-to-r from-card to-amber-50/50 dark:to-amber-950/20',\n      badgeClass: 'bg-amber-100 dark:bg-amber-900/20 border-amber-300 dark:border-amber-700 text-amber-600 dark:text-amber-400'\n    },\n    3: {\n      title: 'Alternative Accommodations',\n      icon: 'Hotel',\n      colorClass: 'violet-600',\n      borderClass: 'border-l-violet-600/60',\n      bgClass: 'bg-gradient-to-r from-card to-violet-50/50 dark:to-violet-950/20',\n      badgeClass: 'bg-violet-100 dark:bg-violet-900/20 border-violet-300 dark:border-violet-700 text-violet-600 dark:text-violet-400'\n    }\n  };\n  \n  return configs[optionNumber as keyof typeof configs] || configs[1];\n}\n","import { ItineraryDay } from '@/components/proposal/DayByDayItineraryBuilder';\nimport { AccommodationStay } from '@/utils/accommodationCalculations';\nimport { calculateAccommodationOptionsPricing } from '@/utils/accommodationPricingUtils';\nimport { Query } from '@/types/query';\nimport { EnhancedMarkupData, AccommodationPricingOption, ServiceCost } from '@/types/enhancedMarkup';\n\nexport interface ProposalSummarySnapshot {\n  baseCost: number;\n  serviceCosts: ServiceCost;\n  accommodationOptions: AccommodationPricingOption[];\n  currency: string;\n  lastCalculated: string;\n}\n\n/**\n * Compute a complete pricing snapshot from proposal days and accommodations\n * This creates data compatible with EnhancedMarkupData without changing existing models\n */\nexport function computeProposalSummarySnapshot(\n  days: ItineraryDay[],\n  accommodations: AccommodationStay[],\n  query: Query\n): ProposalSummarySnapshot {\n  const adults = query?.paxDetails.adults || 1;\n  const children = query?.paxDetails.children || 0;\n  const totalPax = adults + children;\n\n  // Calculate services costs (activities + transport)\n  const serviceCosts = calculateServiceCosts(days, adults, children, totalPax);\n  const baseCost = serviceCosts.sightseeing.total + serviceCosts.transport.totalCost + serviceCosts.dining.total;\n\n  // Calculate accommodation options pricing\n  const accommodationOptionsPricing = calculateAccommodationOptionsPricing(accommodations, query);\n  \n  // Convert to AccommodationPricingOption format\n  const accommodationOptions: AccommodationPricingOption[] = ['standard', 'optional', 'alternative'].map((type, index) => {\n    const optionNumber = (index + 1) as 1 | 2 | 3;\n    const optionData = accommodationOptionsPricing.find(opt => opt.optionNumber === optionNumber);\n    \n    if (!optionData) {\n      return {\n        type: type as any,\n        accommodations: [],\n        serviceCosts,\n        baseTotal: baseCost,\n        markup: 0,\n        finalTotal: baseCost,\n        distribution: {\n          method: 'separate' as const,\n          adultPrice: baseCost / adults,\n          childPrice: children > 0 ? baseCost / totalPax : 0,\n          totalPrice: baseCost\n        }\n      };\n    }\n\n    const accommodationCost = optionData.totalCost;\n    const totalBaseAmount = baseCost + accommodationCost;\n\n    return {\n      type: type as any,\n      accommodations: optionData.accommodations.map(acc => ({\n        id: `${acc.id}`,\n        hotelName: acc.hotelName || 'Unnamed Hotel',\n        roomType: acc.roomType || 'Standard Room',\n        nights: acc.numberOfNights || 1,\n        pricePerNight: acc.pricePerNightPerRoom || 0,\n        numberOfRooms: acc.numberOfRooms || 1,\n        totalPrice: acc.totalPrice || 0,\n        type: type as any,\n        dayId: acc.id || '',\n        city: acc.city || ''\n      })),\n      serviceCosts: {\n        ...serviceCosts,\n        accommodation: {\n          totalCost: accommodationCost,\n          perPersonCost: accommodationCost / totalPax,\n          totalRooms: optionData.accommodations.reduce((sum, acc) => sum + (acc.numberOfRooms || 1), 0),\n          totalNights: optionData.accommodations.reduce((sum, acc) => sum + (acc.numberOfNights || 1), 0)\n        }\n      },\n      baseTotal: totalBaseAmount,\n      markup: 0,\n      finalTotal: totalBaseAmount,\n      distribution: {\n        method: 'separate' as const,\n        adultPrice: totalBaseAmount / adults,\n        childPrice: children > 0 ? totalBaseAmount / totalPax : 0,\n        totalPrice: totalBaseAmount\n      }\n    };\n  }).filter(option => option.accommodations.length > 0 || option.baseTotal > 0);\n\n  return {\n    baseCost,\n    serviceCosts,\n    accommodationOptions,\n    currency: query?.destination?.country || 'USA',\n    lastCalculated: new Date().toISOString()\n  };\n}\n\n/**\n * Calculate service costs from itinerary days\n */\nfunction calculateServiceCosts(\n  days: ItineraryDay[],\n  adults: number,\n  children: number,\n  totalPax: number\n): ServiceCost {\n  let sightseeingTotal = 0;\n  let transportTotal = 0;\n  let diningTotal = 0;\n\n  days.forEach((day) => {\n    // Sightseeing calculation\n    if (day.activities) {\n      day.activities.forEach((activity) => {\n        // For now, just use the base cost since the current schema doesn't have separate adult/child pricing\n        sightseeingTotal += activity.cost || 0;\n      });\n    }\n\n    // Transport calculation\n    if (day.transport) {\n      day.transport.forEach((transport) => {\n        transportTotal += transport.price || 0;\n      });\n    }\n\n    // Dining calculation - meals is just a boolean flag object, not itemized costs\n    // For now, skip dining costs as they're not itemized in the current schema\n  });\n\n  return {\n    sightseeing: { total: sightseeingTotal },\n    transport: { \n      totalCost: transportTotal, \n      perPersonCost: transportTotal / totalPax \n    },\n    dining: { total: diningTotal },\n    accommodation: {\n      totalCost: 0,\n      perPersonCost: 0,\n      totalRooms: 0,\n      totalNights: 0\n    }\n  };\n}\n\n/**\n * Convert snapshot to EnhancedMarkupData format\n */\nexport function snapshotToEnhancedMarkupData(\n  snapshot: ProposalSummarySnapshot,\n  query: Query\n): EnhancedMarkupData {\n  return {\n    options: snapshot.accommodationOptions,\n    selectedOption: 'standard',\n    markupSettings: {\n      type: 'percentage',\n      percentage: 15,\n      slabs: [\n        { minAmount: 0, maxAmount: 5000, percentage: 10 },\n        { minAmount: 5001, maxAmount: 10000, percentage: 8 },\n        { minAmount: 10001, maxAmount: Infinity, percentage: 7 }\n      ]\n    },\n    adults: query?.paxDetails?.adults || 1,\n    children: query?.paxDetails?.children || 0,\n    totalPax: (query?.paxDetails?.adults || 1) + (query?.paxDetails?.children || 0)\n  };\n}\n\n/**\n * Dispatch custom event for real-time sync\n */\nexport function dispatchProposalSummaryUpdate(queryId: string, snapshot: ProposalSummarySnapshot) {\n  const event = new CustomEvent('proposal-summary-updated', {\n    detail: { queryId, snapshot }\n  });\n  window.dispatchEvent(event);\n}","import { ItineraryDay } from '@/components/proposal/DayByDayItineraryBuilder';\n\nexport interface EnhancedActivityData {\n  id: string;\n  name: string;\n  description?: string;\n  type: 'sightseeing' | 'transport' | 'meal' | 'accommodation' | 'activity';\n  cost: number;\n  duration?: string;\n  \n  // Enhanced data fields\n  category?: string;\n  effectivePax?: number;\n  startTime?: string;\n  endTime?: string;\n  location?: string;\n  \n  // Sightseeing specific data\n  selectedOptions?: string[];\n  packageOptions?: Array<{\n    id: string;\n    name: string;\n    price: number;\n    included: boolean;\n  }>;\n  pricingOptions?: Array<{\n    id: string;\n    name: string;\n    type: string;\n    adultPrice: number;\n    childPrice: number;\n    isEnabled: boolean;\n  }>;\n  transferOptions?: Array<{\n    id: string;\n    type: string;\n    vehicleType: string;\n    price: number;\n    isEnabled: boolean;\n  }>;\n  \n  // Transport specific data\n  transportType?: string;\n  transportLabel?: string;\n  vehicleType?: string;\n  from?: string;\n  to?: string;\n  pickupLocation?: string;\n  dropoffLocation?: string;\n  seatingCapacity?: number;\n  vehicleCount?: number;\n  routeCode?: string;\n  \n  // Pricing breakdown\n  priceBreakdown?: {\n    basePrice: number;\n    taxes?: number;\n    fees?: number;\n    discount?: number;\n    finalPrice: number;\n  };\n  \n  // Data integrity fields\n  isDataComplete: boolean;\n  validationErrors?: string[];\n  lastUpdated?: string;\n  dataSource?: 'manual' | 'sightseeing' | 'transport' | 'accommodation';\n}\n\n/**\n * Enhanced activity data preservation during save operations\n */\nexport const enhanceActivityData = (activity: any): EnhancedActivityData => {\n  const baseActivity: EnhancedActivityData = {\n    id: activity.id?.toString() || `activity_${Date.now()}`,\n    name: activity.name || 'Unnamed Activity',\n    description: activity.description || '',\n    type: activity.type || 'activity',\n    cost: activity.cost || activity.price || 0,\n    duration: activity.duration || '2 hours',\n    isDataComplete: false,\n    lastUpdated: new Date().toISOString()\n  };\n\n  // Preserve sightseeing-specific data\n  if (activity.selectedOptions || activity.packageOptions || activity.pricingOptions) {\n    baseActivity.selectedOptions = activity.selectedOptions || [];\n    baseActivity.packageOptions = activity.packageOptions || [];\n    baseActivity.pricingOptions = activity.pricingOptions || [];\n    baseActivity.transferOptions = activity.transferOptions || [];\n    baseActivity.dataSource = 'sightseeing';\n  }\n\n  // Preserve transport-specific data\n  if (activity.transportType || activity.vehicleType || activity.from || activity.to) {\n    baseActivity.transportType = activity.transportType;\n    baseActivity.transportLabel = activity.transportLabel;\n    baseActivity.vehicleType = activity.vehicleType;\n    baseActivity.from = activity.from;\n    baseActivity.to = activity.to;\n    baseActivity.pickupLocation = activity.pickupLocation;\n    baseActivity.dropoffLocation = activity.dropoffLocation;\n    baseActivity.seatingCapacity = activity.seatingCapacity;\n    baseActivity.vehicleCount = activity.vehicleCount;\n    baseActivity.routeCode = activity.routeCode;\n    baseActivity.dataSource = 'transport';\n  }\n\n  // Preserve enhanced fields\n  baseActivity.category = activity.category;\n  baseActivity.effectivePax = activity.effectivePax;\n  baseActivity.startTime = activity.startTime;\n  baseActivity.endTime = activity.endTime;\n  baseActivity.location = activity.location;\n\n  // Create price breakdown\n  baseActivity.priceBreakdown = {\n    basePrice: baseActivity.cost,\n    finalPrice: baseActivity.cost,\n    ...activity.priceBreakdown\n  };\n\n  // Validate data completeness\n  baseActivity.isDataComplete = validateActivityDataCompleteness(baseActivity);\n  baseActivity.validationErrors = getActivityValidationErrors(baseActivity);\n\n  return baseActivity;\n};\n\n/**\n * Validate if activity data is complete\n */\nexport const validateActivityDataCompleteness = (activity: EnhancedActivityData): boolean => {\n  // Basic required fields\n  if (!activity.name || !activity.type || activity.cost <= 0) {\n    return false;\n  }\n\n  // Type-specific validation\n  switch (activity.type) {\n    case 'sightseeing':\n      return !!(activity.duration && (activity.selectedOptions?.length || activity.packageOptions?.length));\n    \n    case 'transport':\n      return !!(activity.from && activity.to && activity.vehicleType);\n    \n    case 'accommodation':\n      return !!(activity.location);\n    \n    default:\n      return true;\n  }\n};\n\n/**\n * Get validation errors for an activity\n */\nexport const getActivityValidationErrors = (activity: EnhancedActivityData): string[] => {\n  const errors: string[] = [];\n\n  if (!activity.name.trim()) {\n    errors.push('Activity name is required');\n  }\n\n  if (activity.cost <= 0) {\n    errors.push('Activity must have a valid price');\n  }\n\n  // Type-specific validation\n  switch (activity.type) {\n    case 'sightseeing':\n      if (!activity.duration) {\n        errors.push('Duration is required for sightseeing activities');\n      }\n      if (!activity.selectedOptions?.length && !activity.packageOptions?.length) {\n        errors.push('Sightseeing options or packages must be selected');\n      }\n      break;\n    \n    case 'transport':\n      if (!activity.from) errors.push('Origin location is required');\n      if (!activity.to) errors.push('Destination location is required');\n      if (!activity.vehicleType) errors.push('Vehicle type is required');\n      break;\n  }\n\n  return errors;\n};\n\n/**\n * Calculate activity statistics for validation\n */\nexport const calculateActivityStats = (days: any[]) => {\n  const allActivities = days.flatMap(day => day.activities.map(enhanceActivityData));\n  \n  const stats = {\n    total: allActivities.length,\n    complete: allActivities.filter(a => a.isDataComplete).length,\n    incomplete: allActivities.filter(a => !a.isDataComplete).length,\n    byType: {\n      sightseeing: allActivities.filter(a => a.type === 'sightseeing').length,\n      transport: allActivities.filter(a => a.type === 'transport').length,\n      accommodation: allActivities.filter(a => a.type === 'accommodation').length,\n      meal: allActivities.filter(a => a.type === 'meal').length,\n      activity: allActivities.filter(a => a.type === 'activity').length\n    },\n    byDataSource: {\n      sightseeing: allActivities.filter(a => a.dataSource === 'sightseeing').length,\n      transport: allActivities.filter(a => a.dataSource === 'transport').length,\n      manual: allActivities.filter(a => a.dataSource === 'manual').length\n    },\n    totalCost: allActivities.reduce((sum, a) => sum + a.cost, 0),\n    incompleteActivities: allActivities.filter(a => !a.isDataComplete)\n  };\n\n  return stats;\n};\n\n/**\n * Enhanced activity storage with validation\n */\nexport const saveActivityDataWithValidation = (queryId: string, days: any[]): void => {\n  try {\n    // Enhance all activity data\n    const enhancedDays = days.map(day => ({\n      ...day,\n      activities: day.activities.map(enhanceActivityData)\n    }));\n\n    // Calculate statistics\n    const stats = calculateActivityStats(enhancedDays);\n    \n    // Save enhanced data\n    const dataToSave = {\n      queryId,\n      days: enhancedDays,\n      activityStats: stats,\n      savedAt: new Date().toISOString(),\n      version: Date.now()\n    };\n\n    localStorage.setItem(`proposal_draft_${queryId}`, JSON.stringify(dataToSave));\n    localStorage.setItem(`activity_data_${queryId}`, JSON.stringify({\n      stats,\n      incompleteActivities: stats.incompleteActivities,\n      validationSummary: {\n        totalActivities: stats.total,\n        completeActivities: stats.complete,\n        dataQualityScore: Math.round((stats.complete / stats.total) * 100) || 0\n      }\n    }));\n\n    console.log('Enhanced activity data saved:', {\n      totalActivities: stats.total,\n      completeActivities: stats.complete,\n      dataQualityScore: Math.round((stats.complete / stats.total) * 100) || 0\n    });\n\n  } catch (error) {\n    console.error('Error saving enhanced activity data:', error);\n  }\n};\n\n/**\n * Load enhanced activity statistics\n */\nexport const loadActivityStats = (queryId: string) => {\n  try {\n    const saved = localStorage.getItem(`activity_data_${queryId}`);\n    if (saved) {\n      return JSON.parse(saved);\n    }\n  } catch (error) {\n    console.error('Error loading activity stats:', error);\n  }\n  return null;\n};","\nexport const IST_OFFSET = 5.5 * 60 * 60 * 1000; // 5:30 hours in milliseconds\n\nexport function getISTTime(): Date {\n  const now = new Date();\n  const utc = now.getTime() + (now.getTimezoneOffset() * 60000);\n  return new Date(utc + IST_OFFSET);\n}\n\nexport function getNextISTSchedule(hour: number, minute: number = 0): Date {\n  const now = getISTTime();\n  const scheduled = new Date(now);\n  \n  scheduled.setHours(hour, minute, 0, 0);\n  \n  // If the scheduled time has already passed today, schedule for tomorrow\n  if (scheduled <= now) {\n    scheduled.setDate(scheduled.getDate() + 1);\n  }\n  \n  return scheduled;\n}\n\nexport function getMillisecondsUntilNextIST(hour: number, minute: number = 0): number {\n  const nextScheduled = getNextISTSchedule(hour, minute);\n  const now = getISTTime();\n  return nextScheduled.getTime() - now.getTime();\n}\n\nexport function formatISTTime(date: Date): string {\n  return date.toLocaleString('en-IN', {\n    timeZone: 'Asia/Kolkata',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n    day: '2-digit',\n    month: '2-digit',\n    year: 'numeric'\n  });\n}\n","import * as XLSX from \"xlsx\";\nimport Papa from \"papaparse\";\nimport { supabase } from \"@/lib/supabaseClient\";\n// Reduce TypeScript type complexity when interacting with Supabase responses.\ntype SimpleResponse = { data: any[] | null; error: any };\n\nexport type ImportOptions = {\n  validate?: boolean;\n  continueOnError?: boolean;\n  importMode?: \"add\" | \"replace\" | \"update\";\n  upsertBy?: \"id\" | \"route_code\" | \"name\";\n};\n\nexport type ExportOptions = {\n  format: \"xlsx\" | \"csv\" | \"json\";\n  filename?: string;\n  selectedFields?: string[];\n  filters?: {\n    status?: string;\n    country?: string;\n  };\n};\n\nexport async function importTransportRoutes(file: File, options: ImportOptions) {\n  const { validate = true, continueOnError = false, importMode = \"add\", upsertBy = \"route_code\" } = options || {};\n\n  let routes: any[] = [];\n  const ext = file.name.split(\".\").pop()?.toLowerCase();\n\n  if (ext === \"xlsx\" || ext === \"xls\") {\n    const workbook = XLSX.read(await file.arrayBuffer(), { type: \"array\" });\n    const sheet = workbook.Sheets[workbook.SheetNames[0]];\n    routes = XLSX.utils.sheet_to_json(sheet);\n  } else if (ext === \"csv\") {\n    const text = await file.text();\n    const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });\n    routes = parsed.data as any[];\n  } else if (ext === \"json\") {\n    routes = JSON.parse(await file.text());\n  } else {\n    throw new Error(\"Unsupported file format\");\n  }\n\n  const validRows: any[] = [];\n  const invalidRows: { route: any; errors: string[] }[] = [];\n\n  for (const raw of routes) {\n    // Normalize common aliases from different export templates\n    const route = normalizeImportRow(raw);\n\n    const required = [\"name\", \"country\", \"start_location\", \"end_location\"];\n    const missing = required.filter((r) => !route[r]);\n\n    if (validate && missing.length) {\n      invalidRows.push({ route: raw, errors: missing });\n      if (!continueOnError) continue;\n    }\n\n    const cleanData = {\n      route_code: route.route_code || route.code || generateCode(route),\n      name: route.name,\n      country: route.country,\n      transfer_type: sanitizeTransferType(route.transfer_type || route.transferType || \"One-Way\"),\n      start_location: route.start_location || route.startLocation,\n      end_location: route.end_location || route.endLocation,\n      // Fields that exist in the view but not in the actual table are removed:\n      // - currency (removed previously)\n      // - intermediate_stops (stored in separate table)\n      // - transport_types (stored in separate table)\n      // - sightseeing_options (stored in separate table)\n      status: sanitizeStatus(route.status || \"active\"),\n      notes: route.description || route.notes || \"\",\n      enable_sightseeing: route.enable_sightseeing === true || route.enableSightseeing === true || route.enableSightseeing === \"true\",\n    };\n\n    validRows.push(cleanData);\n  }\n\n  if (importMode === \"replace\") {\n    const { error: delError } = await supabase\n      .from(\"transport_routes\")\n      .delete()\n      .neq(\"id\", \"00000000-0000-0000-0000-000000000000\");\n    if (delError) throw delError;\n  }\n\n  if (validRows.length) {\n    if (importMode === \"update\") {\n      // Upsert by route_code or provided key\n      const conflictTarget = upsertBy;\n      // Supabase JS upsert uses insert with onConflict option via PostgREST query param\n      const { error } = await supabase\n        .from(\"transport_routes\")\n        .upsert(validRows, { onConflict: conflictTarget, ignoreDuplicates: false })\n        .select(\"id\");\n      if (error) throw error;\n    } else {\n      const { error } = await supabase.from(\"transport_routes\").insert(validRows);\n      if (error) throw error;\n    }\n  }\n\n  return { validCount: validRows.length, invalidCount: invalidRows.length, invalidRows };\n}\n\n// Preview-only parsing helper used by Import UI before confirming DB writes\nexport async function parseTransportRoutes(file: File, options: ImportOptions) {\n  const { validate = true, continueOnError = false } = options || {};\n\n  let routes: any[] = [];\n  const ext = file.name.split(\".\").pop()?.toLowerCase();\n\n  if (ext === \"xlsx\" || ext === \"xls\") {\n    const workbook = XLSX.read(await file.arrayBuffer(), { type: \"array\" });\n    const sheet = workbook.Sheets[workbook.SheetNames[0]];\n    routes = XLSX.utils.sheet_to_json(sheet);\n  } else if (ext === \"csv\") {\n    const text = await file.text();\n    const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });\n    routes = parsed.data as any[];\n  } else if (ext === \"json\") {\n    routes = JSON.parse(await file.text());\n  } else {\n    throw new Error(\"Unsupported file format\");\n  }\n\n  const validRows: any[] = [];\n  const invalidRows: { route: any; errors: string[] }[] = [];\n\n  for (const raw of routes) {\n    const route = normalizeImportRow(raw);\n    const required = [\"name\", \"country\", \"start_location\", \"end_location\"];\n    const missing = required.filter((r) => !route[r]);\n\n    if (validate && missing.length) {\n      invalidRows.push({ route: raw, errors: missing });\n      if (!continueOnError) continue;\n    }\n\n    const cleanData = {\n      route_code: route.route_code || route.code || generateCode(route),\n      name: route.name,\n      country: route.country,\n      currency: route.currency || \"\",\n      transfer_type: sanitizeTransferType(route.transfer_type || route.transferType || \"One-Way\"),\n      start_location: route.start_location || route.startLocation,\n      end_location: route.end_location || route.endLocation,\n      intermediate_stops: parseJSON(route.intermediate_stops ?? route.intermediateStops),\n      transport_types: parseJSON(route.transport_types ?? route.transportTypes),\n      enable_sightseeing: route.enable_sightseeing === true || route.enableSightseeing === true || route.enableSightseeing === \"true\",\n      sightseeing_options: parseJSON(route.sightseeing_options ?? route.sightseeingOptions),\n      status: sanitizeStatus(route.status || \"active\"),\n      notes: route.description || route.notes || \"\",\n    };\n\n    validRows.push(cleanData);\n  }\n\n  return { validRows, invalidRows };\n}\n\nexport async function exportTransportRoutes(options: ExportOptions) {\n  const { format, filename, selectedFields, filters } = options || ({} as ExportOptions);\n  const baseFilename = filename || `transport_routes_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, \"-\")}.${format}`;\n\n  // Use an \"any\"-typed client to avoid deep generic instantiation on chained PostgREST queries\n  const sb: any = supabase;\n\n  // Build query with filters using typed base tables\n  let routesQuery = sb.from(\"transport_routes\").select(\"*\");\n  const statusFilter = filters?.status && filters.status !== 'any' ? filters.status : undefined;\n  const countryFilter = filters?.country && filters.country.trim().length ? filters.country.trim() : undefined;\n  if (statusFilter) {\n    routesQuery = routesQuery.eq(\"status\", statusFilter);\n  }\n  if (countryFilter) {\n    routesQuery = routesQuery.eq(\"country\", countryFilter);\n  }\n\n  const { data: routes, error: routesError } = await routesQuery;\n  if (routesError) throw routesError;\n\n  const routeList = Array.isArray(routes) ? routes : [];\n  // eslint-disable-next-line no-console\n  console.debug('[ExportRoutes] Filters:', { status: statusFilter, country: countryFilter }, 'routeCount:', routeList.length);\n  const routeIds = routeList.map((r: any) => r.id).filter(Boolean);\n\n  // Fetch related JSON-array sources and aggregate by route_id\n  let stopsByRoute: Record<string, any[]> = {};\n  let typesByRoute: Record<string, any[]> = {};\n  let sightByRoute: Record<string, any[]> = {};\n\n  if (routeIds.length) {\n    // Avoid deep generic tuple inference from Promise.all and Supabase types\n    const stopsRes = (await sb\n      .from(\"intermediate_stops\")\n      .select(\"*\")\n      .in(\"route_id\", routeIds)) as unknown as SimpleResponse;\n\n    // Detect whether transport_types has a route_id column in current schema\n    const transportTypesColumnCheck = await sb\n      .from(\"transport_types\")\n      .select(\"route_id\")\n      .limit(0);\n    const hasTransportTypesRouteId = !transportTypesColumnCheck.error;\n\n    let typesRes: SimpleResponse = { data: null, error: null } as any;\n    if (hasTransportTypesRouteId) {\n      typesRes = (await sb\n        .from(\"transport_types\")\n        .select(\"*\")\n        .in(\"route_id\", routeIds)) as unknown as SimpleResponse;\n    }\n\n    const sightRes = (await sb\n      .from(\"sightseeing_options\")\n      .select(\"*\")\n      .in(\"route_id\", routeIds)) as unknown as SimpleResponse;\n\n    if (stopsRes.error) throw stopsRes.error;\n    if (hasTransportTypesRouteId && typesRes.error) throw typesRes.error;\n    if (sightRes.error) throw sightRes.error;\n\n    for (const s of stopsRes.data || []) {\n      const rid = (s as any).route_id;\n      if (!stopsByRoute[rid]) stopsByRoute[rid] = [];\n      stopsByRoute[rid].push(s);\n    }\n    if (hasTransportTypesRouteId) {\n      for (const t of typesRes.data || []) {\n        const rid = (t as any).route_id;\n        if (!typesByRoute[rid]) typesByRoute[rid] = [];\n        typesByRoute[rid].push(t);\n      }\n    } else {\n      // Fallback: many schemas store transport types inline as JSON in transport_routes\n      for (const r of routeList) {\n        const rid = (r as any).id;\n        const inline = (r as any).transport_types ?? (r as any).vehicle_types ?? [];\n        typesByRoute[rid] = Array.isArray(inline) ? inline : [];\n      }\n    }\n    for (const o of sightRes.data || []) {\n      const rid = (o as any).route_id;\n      if (!sightByRoute[rid]) sightByRoute[rid] = [];\n      sightByRoute[rid].push(o);\n    }\n    // eslint-disable-next-line no-console\n    console.debug('[ExportRoutes] Aggregations:', {\n      stops: stopsRes.data?.length || 0,\n      types: hasTransportTypesRouteId ? (typesRes.data?.length || 0) : 'inline-json',\n      sight: sightRes.data?.length || 0,\n    });\n  }\n\n  const rows = routeList.map((r: any) => mapRouteToExportRow(r, { stopsByRoute, typesByRoute, sightByRoute }));\n\n  // Reduce to selected fields if provided\n  const finalRows = Array.isArray(selectedFields) && selectedFields.length\n    ? rows.map((row) => pickFields(row, selectedFields))\n    : rows;\n\n  // eslint-disable-next-line no-console\n  console.debug('[ExportRoutes] Final rows:', finalRows.length, 'Selected fields:', selectedFields);\n\n  if (format === \"json\") {\n    const blob = new Blob([JSON.stringify(finalRows, null, 2)], { type: \"application/json\" });\n    return { blob, filename: baseFilename, meta: { filters, routeCount: routeList.length, rowsCount: finalRows.length } };\n  }\n\n  if (format === \"csv\") {\n    const csv = Papa.unparse(finalRows, { quotes: false });\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n    return { blob, filename: baseFilename, meta: { filters, routeCount: routeList.length, rowsCount: finalRows.length } };\n  }\n\n  // xlsx\n  const wb = XLSX.utils.book_new();\n  // Cast to any[] to prevent generic instantiation depth issues in json_to_sheet\n  const ws = XLSX.utils.json_to_sheet(((finalRows.length ? finalRows : [{}]) as unknown) as any[]);\n  XLSX.utils.book_append_sheet(wb, ws, \"Routes\");\n  const xlsxBuffer = XLSX.write(wb, { bookType: \"xlsx\", type: \"array\" });\n  const blob = new Blob([xlsxBuffer], { type: \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\" });\n  return { blob, filename: baseFilename, meta: { filters, routeCount: routeList.length, rowsCount: finalRows.length } };\n}\n\nfunction parseJSON(val: any) {\n  try {\n    if (val == null) return [];\n    if (typeof val === \"string\") return JSON.parse(val);\n    return Array.isArray(val) ? val : [];\n  } catch {\n    return [];\n  }\n}\n\nfunction generateCode(route: any) {\n  const start = (route.start_location || route.startLocation || \"\").slice(0, 3).toUpperCase();\n  const end = (route.end_location || route.endLocation || \"\").slice(0, 3).toUpperCase();\n  const rand = Math.floor(Math.random() * 999).toString().padStart(3, \"0\");\n  return `${start}-${end}-${rand}`;\n}\n\nfunction sanitizeTransferType(val: string) {\n  const map: Record<string, string> = {\n    \"one-way\": \"One-Way\",\n    \"round-trip\": \"Round-Trip\",\n    \"multi-stop\": \"Multi-Stop\",\n    \"en route\": \"en route\",\n  };\n  const key = String(val || \"One-Way\").toLowerCase();\n  return map[key] || val;\n}\n\nfunction sanitizeStatus(val: string) {\n  const key = String(val || \"active\").toLowerCase();\n  return key === \"inactive\" ? \"inactive\" : \"active\";\n}\n\nfunction normalizeImportRow(raw: any) {\n  const obj = { ...raw };\n  // Map common UI field names to db-like keys\n  if (obj.code && !obj.route_code) obj.route_code = obj.code;\n  if (obj.transferType && !obj.transfer_type) obj.transfer_type = obj.transferType;\n  if (obj.startLocation && !obj.start_location) obj.start_location = obj.startLocation;\n  if (obj.endLocation && !obj.end_location) obj.end_location = obj.endLocation;\n  if (obj.intermediateStops && !obj.intermediate_stops) obj.intermediate_stops = obj.intermediateStops;\n  if (obj.transportTypes && !obj.transport_types) obj.transport_types = obj.transportTypes;\n  if (obj.sightseeingOptions && !obj.sightseeing_options) obj.sightseeing_options = obj.sightseeingOptions;\n  if (obj.enableSightseeing && obj.enableSightseeing !== undefined && obj.enable_sightseeing === undefined) obj.enable_sightseeing = obj.enableSightseeing;\n  return obj;\n}\n\nfunction mapRouteToExportRow(\n  r: any,\n  maps?: {\n    stopsByRoute?: Record<string, any[]>;\n    typesByRoute?: Record<string, any[]>;\n    sightByRoute?: Record<string, any[]>;\n  }\n) {\n  return {\n    id: r.id,\n    code: r.route_code,\n    name: r.name ?? r.route_name,\n    country: r.country,\n    currency: r.currency ?? \"\",\n    transferType: r.transfer_type,\n    startLocation: r.start_location,\n    endLocation: r.end_location,\n    intermediateStops: JSON.stringify(\n      (maps?.stopsByRoute && maps.stopsByRoute[r.id]) ?? (r.intermediate_stops ?? [])\n    ),\n    transportTypes: JSON.stringify(\n      (maps?.typesByRoute && maps.typesByRoute[r.id]) ?? (r.transport_types ?? r.vehicle_types ?? [])\n    ),\n    enableSightseeing: Boolean(r.enable_sightseeing),\n    sightseeingOptions: JSON.stringify(\n      (maps?.sightByRoute && maps.sightByRoute[r.id]) ?? (r.sightseeing_options ?? [])\n    ),\n    status: r.status,\n    price: r.price ?? null,\n    distance: r.distance ?? null,\n    duration: r.duration ?? \"\",\n    description: r.description ?? r.notes ?? \"\",\n  };\n}\n\nfunction pickFields(row: Record<string, any>, fields: string[]) {\n  const out: Record<string, any> = {};\n  for (const f of fields) {\n    out[f] = row[f];\n  }\n  return out;\n}","// Utility to refresh Supabase session and handle common errors\nimport { supabase, adminSupabase } from '@/lib/supabaseClient';\n\n/**\n * Refreshes the current Supabase session\n * @returns The refreshed session or null if no session exists\n */\nexport const refreshSupabaseSession = async () => {\n  try {\n    const { data, error } = await supabase.auth.refreshSession();\n    if (error) {\n      console.error('Failed to refresh session:', error.message);\n      return null;\n    }\n    return data.session;\n  } catch (err) {\n    console.error('Session refresh error:', err);\n    return null;\n  }\n};\n\n/**\n * Safely fetches data from transport_routes table\n * Falls back to adminSupabase if regular client fails\n */\nexport const fetchTransportRoutes = async () => {\n  try {\n    // First try with regular client\n    const { data, error } = await supabase\n      .from('transport_routes')\n      .select('*');\n    \n    if (error) {\n      console.warn('Regular client failed, trying admin client:', error.message);\n      \n      // Fall back to admin client if available\n      if (adminSupabase) {\n        const { data: adminData, error: adminError } = await adminSupabase\n          .from('transport_routes')\n          .select('*');\n          \n        if (adminError) {\n          console.error('Admin client also failed:', adminError.message);\n          throw adminError;\n        }\n        \n        return adminData;\n      } else {\n        throw error;\n      }\n    }\n    \n    return data;\n  } catch (err) {\n    console.error('Failed to fetch transport routes:', err);\n    throw err;\n  }\n};","/**\n * Theme Utility Functions\n * Provides comprehensive theme management utilities for the application\n */\n\nexport interface ThemeConfig {\n  light: {\n    primary: string;\n    secondary: string;\n    background: string;\n    surface: string;\n    text: string;\n    textSecondary: string;\n    border: string;\n    shadow: string;\n  };\n  dark: {\n    primary: string;\n    secondary: string;\n    background: string;\n    surface: string;\n    text: string;\n    textSecondary: string;\n    border: string;\n    shadow: string;\n  };\n}\n\nexport const defaultThemeConfig: ThemeConfig = {\n  light: {\n    primary: '#3b82f6',\n    secondary: '#8b5cf6',\n    background: '#ffffff',\n    surface: '#f8fafc',\n    text: '#0f172a',\n    textSecondary: '#64748b',\n    border: '#e2e8f0',\n    shadow: '0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)'\n  },\n  dark: {\n    primary: '#60a5fa',\n    secondary: '#a78bfa',\n    background: '#0f172a',\n    surface: '#1e293b',\n    text: '#f8fafc',\n    textSecondary: '#94a3b8',\n    border: '#334155',\n    shadow: '0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3)'\n  }\n};\n\n/**\n * Get current theme from document\n */\nexport const getCurrentTheme = (): 'light' | 'dark' => {\n  if (typeof document === 'undefined') return 'light';\n  return document.documentElement.classList.contains('dark') ? 'dark' : 'light';\n};\n\n/**\n * Get system theme preference\n */\nexport const getSystemTheme = (): 'light' | 'dark' => {\n  if (typeof window === 'undefined') return 'light';\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n};\n\n/**\n * Apply theme to document\n */\nexport const applyTheme = (theme: 'light' | 'dark' | 'system'): void => {\n  if (typeof document === 'undefined') return;\n  \n  const root = document.documentElement;\n  root.classList.remove('light', 'dark');\n  \n  if (theme === 'system') {\n    const systemTheme = getSystemTheme();\n    root.classList.add(systemTheme);\n  } else {\n    root.classList.add(theme);\n  }\n};\n\n/**\n * Get CSS custom properties for theme\n */\nexport const getThemeCSSVariables = (config: ThemeConfig = defaultThemeConfig): Record<string, string> => {\n  const variables: Record<string, string> = {};\n  \n  // Light theme variables\n  Object.entries(config.light).forEach(([key, value]) => {\n    variables[`--theme-light-${key}`] = value;\n  });\n  \n  // Dark theme variables\n  Object.entries(config.dark).forEach(([key, value]) => {\n    variables[`--theme-dark-${key}`] = value;\n  });\n  \n  return variables;\n};\n\n/**\n * Apply CSS custom properties to document\n */\nexport const applyThemeCSSVariables = (config: ThemeConfig = defaultThemeConfig): void => {\n  if (typeof document === 'undefined') return;\n  \n  const root = document.documentElement;\n  const variables = getThemeCSSVariables(config);\n  \n  Object.entries(variables).forEach(([key, value]) => {\n    root.style.setProperty(key, value);\n  });\n};\n\n/**\n * Create smooth theme transition\n */\nexport const enableSmoothThemeTransitions = (duration: number = 300): void => {\n  if (typeof document === 'undefined') return;\n  \n  const style = document.createElement('style');\n  style.textContent = `\n    * {\n      transition: background-color ${duration}ms ease-in-out,\n                  color ${duration}ms ease-in-out,\n                  border-color ${duration}ms ease-in-out,\n                  box-shadow ${duration}ms ease-in-out !important;\n    }\n  `;\n  style.id = 'theme-transition-style';\n  document.head.appendChild(style);\n  \n  // Remove after transition completes\n  setTimeout(() => {\n    const existingStyle = document.getElementById('theme-transition-style');\n    if (existingStyle) {\n      existingStyle.remove();\n    }\n  }, duration + 100);\n};\n\n/**\n * Logo theme utilities\n */\nexport interface LogoThemeConfig {\n  lightLogo?: string;\n  darkLogo?: string;\n  fallbackText?: string;\n  size?: 'small' | 'medium' | 'large';\n}\n\n/**\n * Determine which logo to show based on theme\n */\nexport const getLogoForTheme = (config: LogoThemeConfig, theme: 'light' | 'dark'): string | null => {\n  return theme === 'dark' && config.darkLogo ? config.darkLogo : config.lightLogo || null;\n};\n\n/**\n * Create logo with fallback\n */\nexport const createLogoWithFallback = (config: LogoThemeConfig, theme: 'light' | 'dark'): string => {\n  const logo = getLogoForTheme(config, theme);\n  if (logo) return logo;\n  \n  // Create SVG fallback\n  const text = config.fallbackText || 'Logo';\n  const bgColor = theme === 'dark' ? '#374151' : '#3b82f6';\n  const textColor = '#ffffff';\n  \n  return `data:image/svg+xml;base64,${btoa(`\n    <svg width=\"120\" height=\"40\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"120\" height=\"40\" fill=\"${bgColor}\" rx=\"8\"/>\n      <text x=\"60\" y=\"25\" font-family=\"Arial, sans-serif\" font-size=\"16\" \n            font-weight=\"bold\" text-anchor=\"middle\" fill=\"${textColor}\">\n        ${text}\n      </text>\n    </svg>\n  `)}`;\n};\n\n/**\n * Preload logos for better performance\n */\nexport const preloadLogos = (lightLogo?: string, darkLogo?: string): void => {\n  if (typeof document === 'undefined') return;\n  \n  const logos = [lightLogo, darkLogo].filter(Boolean) as string[];\n  \n  logos.forEach(logoUrl => {\n    const img = new Image();\n    img.src = logoUrl;\n  });\n};\n\n/**\n * Cache logo URLs with version control\n */\nexport class LogoCache {\n  private cache: Map<string, string> = new Map();\n  private version: string;\n  \n  constructor(version: string = 'v1') {\n    this.version = version;\n  }\n  \n  get(key: string): string | undefined {\n    return this.cache.get(`${this.version}:${key}`);\n  }\n  \n  set(key: string, value: string): void {\n    this.cache.set(`${this.version}:${key}`, value);\n  }\n  \n  clear(): void {\n    this.cache.clear();\n  }\n  \n  bustCache(url: string): string {\n    const separator = url.includes('?') ? '&' : '?';\n    return `${url}${separator}_t=${Date.now()}`;\n  }\n}\n\n/**\n * Theme detection utilities\n */\nexport const themeUtils = {\n  /**\n   * Check if user prefers reduced motion\n   */\n  prefersReducedMotion: (): boolean => {\n    if (typeof window === 'undefined') return false;\n    return window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  },\n  \n  /**\n   * Get theme from localStorage\n   */\n  getStoredTheme: (key: string = 'theme'): string | null => {\n    if (typeof localStorage === 'undefined') return null;\n    return localStorage.getItem(key);\n  },\n  \n  /**\n   * Store theme in localStorage\n   */\n  storeTheme: (theme: string, key: string = 'theme'): void => {\n    if (typeof localStorage === 'undefined') return;\n    localStorage.setItem(key, theme);\n  },\n  \n  /**\n   * Remove theme from localStorage\n   */\n  removeStoredTheme: (key: string = 'theme'): void => {\n    if (typeof localStorage === 'undefined') return;\n    localStorage.removeItem(key);\n  },\n  \n  /**\n   * Add theme change listener\n   */\n  onThemeChange: (callback: (theme: 'light' | 'dark') => void): (() => void) => {\n    if (typeof window === 'undefined') return () => {};\n    \n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handler = (e: MediaQueryListEvent) => {\n      callback(e.matches ? 'dark' : 'light');\n    };\n    \n    mediaQuery.addEventListener('change', handler);\n    \n    return () => {\n      mediaQuery.removeEventListener('change', handler);\n    };\n  }\n};\n\n/**\n * Accessibility utilities for themes\n */\nexport const themeAccessibility = {\n  /**\n   * Get appropriate contrast color\n   */\n  getContrastColor: (backgroundColor: string): 'black' | 'white' => {\n    // Convert hex to RGB\n    const hex = backgroundColor.replace('#', '');\n    const r = parseInt(hex.substr(0, 2), 16);\n    const g = parseInt(hex.substr(2, 2), 16);\n    const b = parseInt(hex.substr(4, 2), 16);\n    \n    // Calculate luminance\n    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;\n    \n    return luminance > 0.5 ? 'black' : 'white';\n  },\n  \n  /**\n   * Get ARIA attributes for theme toggle\n   */\n  getToggleAriaAttributes: (currentTheme: 'light' | 'dark'): Record<string, string> => {\n    return {\n      'aria-label': `Switch to ${currentTheme === 'dark' ? 'light' : 'dark'} mode`,\n      'aria-pressed': currentTheme === 'dark' ? 'false' : 'true',\n      'role': 'switch',\n      'title': `Switch to ${currentTheme === 'dark' ? 'light' : 'dark'} mode`\n    };\n  },\n  \n  /**\n   * Get screen reader text for theme\n   */\n  getScreenReaderText: (theme: 'light' | 'dark'): string => {\n    return theme === 'dark' ? 'Currently in dark mode' : 'Currently in light mode';\n  }\n};\n\nexport default {\n  defaultThemeConfig,\n  getCurrentTheme,\n  getSystemTheme,\n  applyTheme,\n  getThemeCSSVariables,\n  applyThemeCSSVariables,\n  enableSmoothThemeTransitions,\n  getLogoForTheme,\n  createLogoWithFallback,\n  preloadLogos,\n  LogoCache,\n  themeUtils,\n  themeAccessibility\n};","import { Query } from '@/types/query';\n\nexport type DateRange = { from: string; to: string };\n\n// Compute the previous calendar month range in YYYY-MM-DD\nexport function computeLastMonthRange(now = new Date()): DateRange {\n  const year = now.getFullYear();\n  const month = now.getMonth(); // 0-based\n  const lastMonth = month === 0 ? 11 : month - 1;\n  const lastMonthYear = month === 0 ? year - 1 : year;\n  const start = new Date(lastMonthYear, lastMonth, 1);\n  const end = new Date(lastMonthYear, lastMonth + 1, 0); // last day of last month\n\n  const fmt = (d: Date) => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n  return { from: fmt(start), to: fmt(end) };\n}\n\nexport function buildExportFilename(scope: 'current' | 'last-month', format: 'csv' | 'xlsx', now = new Date()): string {\n  const y = now.getFullYear();\n  const m = String(now.getMonth() + 1).padStart(2, '0');\n  const d = String(now.getDate()).padStart(2, '0');\n  const base = scope === 'last-month' ? 'queries-last-month' : 'queries-current';\n  return `${base}-${y}-${m}-${d}.${format}`;\n}\n\n// Flatten a Query into an export-friendly row\nexport function mapQueryToExportRow(q: Query) {\n  const fromDate = q.travelDates?.from ? new Date(q.travelDates.from) : null;\n  const toDate = q.travelDates?.to ? new Date(q.travelDates.to) : null;\n  const fmt = (d: Date | null) => d ? `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}` : '';\n\n  return {\n    EnquiryID: q.id,\n    AgentName: q.agentName || '',\n    AgentCompany: q.agentCompany || '',\n    Country: q.destination?.country || '',\n    Cities: Array.isArray(q.destination?.cities) ? q.destination!.cities.join(', ') : '',\n    Nights: q.tripDuration?.nights ?? 0,\n    Days: q.tripDuration?.days ?? 0,\n    TravelFrom: fmt(fromDate),\n    TravelTo: fmt(toDate),\n    Adults: q.paxDetails?.adults ?? 0,\n    Children: q.paxDetails?.children ?? 0,\n    Infants: q.paxDetails?.infants ?? 0,\n    PackageType: q.packageType || '',\n    Status: q.status || '',\n    BudgetMin: q.budget?.min ?? '',\n    BudgetMax: q.budget?.max ?? '',\n    BudgetCurrency: q.budget?.currency || '',\n    CreatedAt: q.createdAt || '',\n    UpdatedAt: q.updatedAt || '',\n  } as Record<string, any>;\n}","\nimport { staffMembers } from '@/data/staffData';\nimport { supabase, adminSupabase, isAdminClientConfigured } from '@/lib/supabaseClient';\n\nexport const generateEmployeeCode = (): string => {\n  // Get all existing employee IDs and extract the numeric parts\n  const existingCodes = staffMembers\n    .map(staff => staff.employeeId)\n    .filter(id => id && /^\\d{4}$/.test(id)) // Only 4-digit numeric codes\n    .map(id => parseInt(id))\n    .filter(num => !isNaN(num));\n\n  // Start from 1001 and find the next available code\n  let nextCode = 1001;\n  while (existingCodes.includes(nextCode)) {\n    nextCode++;\n    // Prevent infinite loop, max 4-digit number is 9999\n    if (nextCode > 9999) {\n      throw new Error('No available employee codes remaining');\n    }\n  }\n\n  return nextCode.toString().padStart(4, '0');\n};\n\nexport const validateEmployeeCode = (code: string): boolean => {\n  // Allow 1 to 10 digits, including leading zeros when typed (e.g., \"0001\")\n  return /^\\d{1,10}$/.test(code);\n};\n\nexport const isEmployeeCodeUnique = (code: string, excludeId?: string): boolean => {\n  return !staffMembers.some(staff => \n    staff.employeeId === code && staff.id !== excludeId\n  );\n};\n\nconst fetchEmployeeIdsFromTable = async (client: any, table: 'profiles' | 'staff'): Promise<string[]> => {\n  const { data, error } = await client\n    .from(table)\n    .select('employee_id')\n    .not('employee_id', 'is', null);\n  if (error || !Array.isArray(data)) return [];\n  return (data as any[])\n    .map((row) => String((row as any).employee_id))\n    .filter((v) => /^\\d{1,10}$/.test(v));\n};\n\nexport const generateEmployeeCodeFromDB = async (): Promise<string> => {\n  let ids: string[] = [];\n  try {\n    const profiles = await fetchEmployeeIdsFromTable(supabase, 'profiles');\n    const staff = await fetchEmployeeIdsFromTable(supabase, 'staff');\n    ids = [...profiles, ...staff];\n  } catch {\n    ids = [];\n  }\n\n  if (!ids.length && isAdminClientConfigured && adminSupabase) {\n    try {\n      const profiles = await fetchEmployeeIdsFromTable(adminSupabase, 'profiles');\n      const staff = await fetchEmployeeIdsFromTable(adminSupabase, 'staff');\n      ids = [...profiles, ...staff];\n    } catch {\n      ids = [];\n    }\n  }\n\n  // Convert to numeric values ignoring leading zeros, permit 1..10 digits\n  const nums = ids\n    .map((v) => parseInt(v, 10))\n    .filter((n) => !isNaN(n) && n >= 1 && n <= 9_999_999_999);\n\n  // Start from 1 if none, otherwise next sequential\n  const max = nums.length ? Math.max(...nums) : 0;\n  const next = max + 1;\n  if (next > 9_999_999_999) {\n    throw new Error('No available employee codes remaining up to 10 digits');\n  }\n  // Return as unpadded string so it naturally grows from 1 digit to 10\n  return String(next);\n};\n\nexport const isEmployeeCodeUniqueDb = async (code: string): Promise<boolean> => {\n  if (!/^\\d{1,10}$/.test(code)) return false;\n  const check = async (client: any, table: 'profiles' | 'staff') => {\n    const { data, error } = await client\n      .from(table)\n      .select('employee_id')\n      .eq('employee_id', code)\n      .limit(1);\n    if (error) return false;\n    return Array.isArray(data) ? data.length === 0 : true;\n  };\n\n  try {\n    const a = await check(supabase, 'profiles');\n    const b = await check(supabase, 'staff');\n    if (a && b) return true;\n  } catch {}\n\n  if (isAdminClientConfigured && adminSupabase) {\n    try {\n      const a2 = await check(adminSupabase, 'profiles');\n      const b2 = await check(adminSupabase, 'staff');\n      return a2 && b2;\n    } catch {}\n  }\n  return false;\n};\n"],"file":"app-utils-B17DUmNw.js"}