{"version":3,"file":"app-auth-system-CQfBSoYn.js","sources":["../../src/contexts/ApplicationSettingsContext.tsx","../../src/contexts/AuthContext.tsx","../../src/contexts/AppContext.tsx","../../src/contexts/StaffNotificationContext.tsx","../../src/components/auth/ProtectedRoute.tsx","../../src/contexts/SEOContext.tsx","../../src/contexts/AgentHeaderContext.tsx","../../src/contexts/ItineraryContext.tsx","../../src/contexts/AIRouterContext.tsx"],"sourcesContent":["\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport { EnquiryConfiguration, CountryEnquirySettings, DEFAULT_ENQUIRY_COUNTRIES } from '../types/enquiry';\nimport { AppSettingsService, SETTING_CATEGORIES, AppSettingsHelpers } from '@/services/appSettingsService_database';\n\ninterface CompanyDetails {\n  name: string;\n  tagline: string;\n  description: string;\n  address: string;\n  phone: string;\n  email: string;\n  website: string;\n}\n\ninterface SEOSettings {\n  title: string;\n  description: string;\n  keywords: string;\n  ogTitle: string;\n  ogDescription: string;\n}\n\ninterface PDFSettings {\n  headerEnabled: boolean;\n  showLogo: boolean;\n  showCompanyName: boolean;\n  showContactDetails: boolean;\n  headerBackgroundColor: string;\n  headerTextColor: string;\n  fontFamily: 'Arial' | 'Times' | 'Helvetica' | 'Georgia';\n  fontSize: 'small' | 'medium' | 'large';\n}\n\ninterface ApplicationSettings {\n  logo: string | null;\n  darkLogo: string | null;\n  favicon: string | null;\n  logoSize: 'small' | 'medium' | 'large';\n  companyDetails: CompanyDetails;\n  seoSettings: SEOSettings;\n  pdfSettings: PDFSettings;\n  enquirySettings: EnquiryConfiguration;\n}\n\ninterface ApplicationSettingsContextType {\n  settings: ApplicationSettings;\n  updateSettings: (newSettings: Partial<ApplicationSettings>) => void;\n  updateCompanyDetails: (details: Partial<CompanyDetails>) => void;\n  updateSEOSettings: (seo: Partial<SEOSettings>) => void;\n  updatePDFSettings: (pdf: Partial<PDFSettings>) => void;\n  updateEnquirySettings: (enquirySettings: Partial<EnquiryConfiguration>) => void;\n  addCountry: (country: CountryEnquirySettings) => void;\n  updateCountry: (countryCode: string, updates: Partial<CountryEnquirySettings>) => void;\n  removeCountry: (countryCode: string) => void;\n  setDefaultCountry: (countryCode: string) => void;\n  hydrated: boolean;\n}\n\nconst defaultSettings: ApplicationSettings = {\n  logo: null,\n  darkLogo: null,\n  favicon: null,\n  logoSize: 'medium',\n  companyDetails: {\n    name: 'TripOex',\n    tagline: 'Travel Management System',\n    description: 'Complete travel and tourism management solution',\n    address: '',\n    phone: '',\n    email: '',\n    website: ''\n  },\n  seoSettings: {\n    title: 'TripOex - Travel Management System',\n    description: 'Complete travel and tourism management solution for agencies and operators',\n    keywords: 'travel, tourism, management, booking, itinerary',\n    ogTitle: 'TripOex - Travel Management System',\n    ogDescription: 'Complete travel and tourism management solution for agencies and operators'\n  },\n  pdfSettings: {\n    headerEnabled: true,\n    showLogo: true,\n    showCompanyName: true,\n    showContactDetails: true,\n    headerBackgroundColor: '#ffffff',\n    headerTextColor: '#000000',\n    fontFamily: 'Arial',\n    fontSize: 'medium'\n  },\n  enquirySettings: {\n    countries: DEFAULT_ENQUIRY_COUNTRIES,\n    defaultCountryCode: 'TH'\n  }\n};\n\nconst ApplicationSettingsContext = createContext<ApplicationSettingsContextType | undefined>(undefined);\n\nexport const ApplicationSettingsProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [settings, setSettings] = useState<ApplicationSettings>(defaultSettings);\n  const [hydrated, setHydrated] = useState<boolean>(false);\n  const location = useLocation();\n  const isPublicRoute = /^\\/(privacy|terms)(\\/|$)/.test(location.pathname);\n\n  useEffect(() => {\n    // Hydrate settings from unified App Settings service (DB with localStorage fallback)\n    (async () => {\n      // Suppress Supabase-based hydration on public routes to avoid console noise\n      if (isPublicRoute) {\n        return;\n      }\n      try {\n        const [companyNameRes, taglineRes, logoRes, darkLogoRes, faviconRes, siteTitleRes, enquiryConfigRes] = await Promise.all([\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.BRANDING, 'company_name'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.BRANDING, 'brand_tagline'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.BRANDING, 'company_logo'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.BRANDING, 'company_logo_dark'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.BRANDING, 'company_favicon'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.GENERAL, 'site_title'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.GENERAL, 'enquiry_configuration')\n        ]);\n\n        setSettings(prev => ({\n          ...prev,\n          logo: (logoRes as string) || prev.logo,\n          darkLogo: (darkLogoRes as string) || prev.darkLogo,\n          favicon: (faviconRes as string) || prev.favicon,\n          companyDetails: {\n            ...prev.companyDetails,\n            name: (companyNameRes as string) || prev.companyDetails.name,\n            tagline: (taglineRes as string) || prev.companyDetails.tagline\n          },\n          seoSettings: {\n            ...prev.seoSettings,\n            title: (siteTitleRes as string) || prev.seoSettings.title\n          },\n          enquirySettings: (enquiryConfigRes as EnquiryConfiguration) || prev.enquirySettings\n        }));\n        setHydrated(true);\n      } catch (error) {\n        console.warn('ApplicationSettings: Failed to hydrate from AppSettingsService, using defaults', error);\n        // Even on failure, mark as hydrated to avoid blocking UI indefinitely\n        setHydrated(true);\n      }\n    })();\n  }, [isPublicRoute]);\n\n  const updateSettings = (newSettings: Partial<ApplicationSettings>) => {\n    setSettings(prev => {\n      const updated = { ...prev, ...newSettings };\n\n      // Persist known branding keys via unified service\n      (async () => {\n        try {\n          if (newSettings.logo !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.BRANDING, 'company_logo', { setting_value: newSettings.logo as any, is_active: true });\n          }\n          if (newSettings.darkLogo !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.BRANDING, 'company_logo_dark', { setting_value: newSettings.darkLogo as any, is_active: true });\n          }\n          if (newSettings.favicon !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.BRANDING, 'company_favicon', { setting_value: newSettings.favicon as any, is_active: true });\n          }\n          if (newSettings.seoSettings?.title !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.GENERAL, 'site_title', { setting_value: newSettings.seoSettings.title as any, is_active: true });\n          }\n        } catch (e) {\n          console.warn('Failed to persist application settings via AppSettingsService', e);\n        }\n      })();\n\n      return updated;\n    });\n  };\n\n  const updateCompanyDetails = (details: Partial<CompanyDetails>) => {\n    setSettings(prev => {\n      const updated = {\n        ...prev,\n        companyDetails: { ...prev.companyDetails, ...details }\n      };\n\n      // Persist known company details to unified service\n      (async () => {\n        try {\n          if (details.name !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.BRANDING, 'company_name', { setting_value: details.name as any, is_active: true });\n          }\n          if (details.tagline !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.BRANDING, 'brand_tagline', { setting_value: details.tagline as any, is_active: true });\n          }\n        } catch (e) {\n          console.warn('Failed to persist company details via AppSettingsService', e);\n        }\n      })();\n\n      return updated;\n    });\n  };\n\n  const updateSEOSettings = (seo: Partial<SEOSettings>) => {\n    setSettings(prev => {\n      const updated = {\n        ...prev,\n        seoSettings: { ...prev.seoSettings, ...seo }\n      };\n\n      (async () => {\n        try {\n          if (seo.title !== undefined) {\n            await AppSettingsService.updateSetting(SETTING_CATEGORIES.GENERAL, 'site_title', { setting_value: seo.title as any, is_active: true });\n          }\n        } catch (e) {\n          console.warn('Failed to persist SEO settings via AppSettingsService', e);\n        }\n      })();\n\n      return updated;\n    });\n  };\n\n  const updatePDFSettings = (pdf: Partial<PDFSettings>) => {\n    setSettings(prev => {\n      const updated = {\n        ...prev,\n        pdfSettings: { ...prev.pdfSettings, ...pdf }\n      };\n      return updated;\n    });\n  };\n\n  const updateEnquirySettings = (enquirySettings: Partial<EnquiryConfiguration>) => {\n    setSettings(prev => {\n      // Block writes during initial hydration to avoid overwriting server state\n      if (!hydrated) {\n        return prev;\n      }\n      const updated = {\n        ...prev,\n        enquirySettings: { ...prev.enquirySettings, ...enquirySettings }\n      };\n\n      // Persist to Supabase-backed app_settings (JSON) and keep localStorage in sync for legacy utils\n      (async () => {\n        try {\n          await AppSettingsHelpers.upsertSetting({\n            category: SETTING_CATEGORIES.GENERAL,\n            setting_key: 'enquiry_configuration',\n            setting_json: updated.enquirySettings as any,\n            data_type: 'json',\n            is_active: true\n          });\n        } catch (e) {\n          console.warn('Failed to persist enquiry configuration via AppSettingsService', e);\n        }\n      })();\n\n      try {\n        localStorage.setItem('applicationSettings', JSON.stringify(updated));\n      } catch {}\n      return updated;\n    });\n  };\n\n  const addCountry = (country: CountryEnquirySettings) => {\n    setSettings(prev => {\n      if (!hydrated) {\n        return prev;\n      }\n      const updated = {\n        ...prev,\n        enquirySettings: {\n          ...prev.enquirySettings,\n          countries: [...prev.enquirySettings.countries, country]\n        }\n      };\n      (async () => {\n        try {\n          await AppSettingsHelpers.upsertSetting({\n            category: SETTING_CATEGORIES.GENERAL,\n            setting_key: 'enquiry_configuration',\n            setting_json: updated.enquirySettings as any,\n            data_type: 'json',\n            is_active: true\n          });\n        } catch (e) {\n          console.warn('Failed to persist enquiry configuration via AppSettingsService', e);\n        }\n      })();\n      try {\n        localStorage.setItem('applicationSettings', JSON.stringify(updated));\n      } catch {}\n      return updated;\n    });\n  };\n\n  const updateCountry = (countryCode: string, updates: Partial<CountryEnquirySettings>) => {\n    setSettings(prev => {\n      if (!hydrated) {\n        return prev;\n      }\n      const updated = {\n        ...prev,\n        enquirySettings: {\n          ...prev.enquirySettings,\n          countries: prev.enquirySettings.countries.map(country =>\n            country.countryCode === countryCode\n              ? { ...country, ...updates }\n              : country\n          )\n        }\n      };\n      (async () => {\n        try {\n          await AppSettingsHelpers.upsertSetting({\n            category: SETTING_CATEGORIES.GENERAL,\n            setting_key: 'enquiry_configuration',\n            setting_json: updated.enquirySettings as any,\n            data_type: 'json',\n            is_active: true\n          });\n        } catch (e) {\n          console.warn('Failed to persist enquiry configuration via AppSettingsService', e);\n        }\n      })();\n      try {\n        localStorage.setItem('applicationSettings', JSON.stringify(updated));\n      } catch {}\n      return updated;\n    });\n  };\n\n  const removeCountry = (countryCode: string) => {\n    setSettings(prev => {\n      if (!hydrated) {\n        return prev;\n      }\n      const updated = {\n        ...prev,\n        enquirySettings: {\n          ...prev.enquirySettings,\n          countries: prev.enquirySettings.countries.filter(country => \n            country.countryCode !== countryCode\n          )\n        }\n      };\n      (async () => {\n        try {\n          await AppSettingsHelpers.upsertSetting({\n            category: SETTING_CATEGORIES.GENERAL,\n            setting_key: 'enquiry_configuration',\n            setting_json: updated.enquirySettings as any,\n            data_type: 'json',\n            is_active: true\n          });\n        } catch (e) {\n          console.warn('Failed to persist enquiry configuration via AppSettingsService', e);\n        }\n      })();\n      try {\n        localStorage.setItem('applicationSettings', JSON.stringify(updated));\n      } catch {}\n      return updated;\n    });\n  };\n\n  const setDefaultCountry = (countryCode: string) => {\n    setSettings(prev => {\n      if (!hydrated) {\n        return prev;\n      }\n      const updated = {\n        ...prev,\n        enquirySettings: {\n          ...prev.enquirySettings,\n          defaultCountryCode: countryCode,\n          countries: prev.enquirySettings.countries.map(country => ({\n            ...country,\n            isDefault: country.countryCode === countryCode\n          }))\n        }\n      };\n      (async () => {\n        try {\n          await AppSettingsHelpers.upsertSetting({\n            category: SETTING_CATEGORIES.GENERAL,\n            setting_key: 'enquiry_configuration',\n            setting_json: updated.enquirySettings as any,\n            data_type: 'json',\n            is_active: true\n          });\n        } catch (e) {\n          console.warn('Failed to persist enquiry configuration via AppSettingsService', e);\n        }\n      })();\n      try {\n        localStorage.setItem('applicationSettings', JSON.stringify(updated));\n      } catch {}\n      return updated;\n    });\n  };\n\n  return (\n    <ApplicationSettingsContext.Provider \n      value={{ \n        settings, \n        updateSettings, \n        updateCompanyDetails, \n        updateSEOSettings, \n        updatePDFSettings,\n        updateEnquirySettings,\n        addCountry,\n        updateCountry,\n        removeCountry,\n        setDefaultCountry,\n        hydrated\n      }}\n    >\n      {children}\n    </ApplicationSettingsContext.Provider>\n  );\n};\n\nexport function useApplicationSettings() {\n  const context = useContext(ApplicationSettingsContext);\n  if (context === undefined) {\n    throw new Error('useApplicationSettings must be used within an ApplicationSettingsProvider');\n  }\n  return context;\n}\n","import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { AuthService } from '../services/authService';\nimport { User } from '../types/User';\nimport { supabase } from '@/lib/supabaseClient';\nimport { recordStaffLogin, recordStaffLogout, isStaffCurrentlyActive } from '@/services/loginRecordService';\nimport { userTrackingService } from '../services/userTrackingService';\nimport { SessionManager, handleSessionError } from '../utils/sessionManager';\nimport { autoReloginFlow } from '../utils/autoReloginFlow';\n\ninterface AuthContextType {\n  user: User | null;\n  session: any;\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<{ user: User | null; error: string | null }>;\n  signUp: (email: string, password: string, userData: any) => Promise<{ user: User | null; error: string | null }>;\n  signInWithGoogle: (role?: string) => Promise<{ user: User | null; error: string | null }>;\n  signOut: () => Promise<void>;\n  resetPassword: (email: string) => Promise<{ error: string | null }>;\n  updateProfile: (updates: any) => Promise<{ user: User | null; error: string | null }>;\n  updatePassword: (newPassword: string) => Promise<{ error: string | null }>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [session, setSession] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    let mounted = true;\n    let validationInterval: NodeJS.Timeout;\n    \n    const initializeAuth = async () => {\n      // Check for existing session on mount with validation\n      try {\n        const validationResult = await SessionManager.validateSession();\n        \n        if (!mounted) return;\n        \n        if (validationResult.shouldSignOut) {\n          // Session is invalid, clear everything\n          setUser(null);\n          setSession(null);\n          await SessionManager.clearSession();\n        } else if (validationResult.isValid) {\n          // Session is valid, get user profile\n          const { user: sessionUser, session: currentSession, error } = await AuthService.getCurrentSession();\n          \n          if (sessionUser && currentSession && !error) {\n            setUser(sessionUser);\n            setSession(currentSession);\n          } else {\n            setUser(null);\n            setSession(null);\n          }\n        } else {\n          // No session or needs refresh\n          setUser(null);\n          setSession(null);\n        }\n      } catch (error) {\n        console.error('Auth initialization error:', error);\n        if (mounted) {\n          setUser(null);\n          setSession(null);\n        }\n      } finally {\n        if (mounted) {\n          setLoading(false);\n        }\n      }\n      \n      // Listen for auth state changes\n      const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\n        if (!mounted) return;\n        \n        console.log('Auth state change:', event, session?.user?.email);\n        \n        if (event === 'SIGNED_IN' && session) {\n          // User signed in, get their profile\n          console.log('ðŸŽ‰ SIGNED_IN event detected, getting current session for user:', session.user?.email);\n          const { user: sessionUser, error } = await AuthService.getCurrentSession();\n          if (!error && sessionUser) {\n            console.log('âœ… Session user retrieved:', sessionUser.id, 'with role:', sessionUser.role);\n            setUser(sessionUser);\n            setSession(session);\n            // Record staff login\n            if (sessionUser.role === 'staff' && sessionUser.id) {\n              try {\n                recordStaffLogin(sessionUser.id, sessionUser.name || session.user?.email || sessionUser.id);\n              } catch (e) {\n                console.warn('Staff login recording failed on SIGNED_IN:', e);\n              }\n            }\n          } else {\n            console.log('âŒ Error getting session user:', error);\n          }\n        } else if (event === 'INITIAL_SESSION') {\n          // Handle initial session state on subscription setup\n          if (session && session.user) {\n            const { user: sessionUser, error } = await AuthService.getCurrentSession();\n            if (!error && sessionUser) {\n              setUser(sessionUser);\n              setSession(session);\n            } else {\n              setUser(null);\n              setSession(null);\n            }\n          } else {\n            // No session on init; keep state cleared without triggering cleanup\n            setUser(null);\n            setSession(null);\n          }\n        } else if (event === 'SIGNED_OUT') {\n          // User signed out\n          // Record staff logout if applicable\n          try {\n            if (user?.role === 'staff' && user?.id && isStaffCurrentlyActive(user.id)) {\n              recordStaffLogout(user.id);\n            }\n          } catch (e) {\n            console.warn('Staff logout recording failed on SIGNED_OUT:', e);\n          }\n          setUser(null);\n          setSession(null);\n          // Avoid redundant cleanup on initial load when there was no prior session\n          if (user) {\n            await SessionManager.clearSession();\n          }\n        } else if (event === 'TOKEN_REFRESHED' && session) {\n          // Token refreshed, update session\n          console.log('Token refreshed successfully');\n          setSession(session);\n        }\n      });\n\n      // Set up periodic session validation\n      validationInterval = setInterval(() => {\n        if (mounted) {\n          SessionManager.periodicValidation();\n        }\n      }, 5 * 60 * 1000); // Check every 5 minutes\n\n      return () => {\n        subscription.unsubscribe();\n        if (validationInterval) {\n          clearInterval(validationInterval);\n        }\n      };\n    };\n\n    initializeAuth();\n    \n    return () => {\n      mounted = false;\n      if (validationInterval) {\n        clearInterval(validationInterval);\n      }\n    };\n  }, []);\n\n  // Sync user with userTrackingService whenever user state changes\n  useEffect(() => {\n    userTrackingService.setCurrentUser(user);\n    console.log('ðŸ”„ UserTrackingService updated with user:', user?.name || 'null');\n  }, [user]);\n\n  const signIn = async (email: string, password: string) => {\n    try {\n      setLoading(true);\n      const response = await AuthService.signIn(email, password);\n      \n      if (response.error) {\n        return { user: null, error: response.error };\n      }\n      \n      if (response.user) {\n        setUser(response.user);\n        setSession(response.session);\n        \n        // Store credentials for auto re-login (only in memory for security)\n        autoReloginFlow.storeCredentials(email, password);\n        \n        return { user: response.user, error: null };\n      }\n      \n      return { user: null, error: 'Authentication failed' };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Sign in failed';\n      return { user: null, error: errorMessage };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signUp = async (email: string, password: string, userData: any) => {\n    try {\n      setLoading(true);\n      const response = await AuthService.signUp(email, password, userData);\n      \n      if (response.error) {\n        return { user: null, error: response.error };\n      }\n      \n      if (response.user) {\n        setUser(response.user);\n        setSession(response.session);\n        return { user: response.user, error: null };\n      }\n      \n      return { user: null, error: 'Registration failed' };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Sign up failed';\n      return { user: null, error: errorMessage };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signInWithGoogle = async (role: string = 'agent') => {\n    try {\n      setLoading(true);\n      const response = await AuthService.signInWithGoogle(role);\n      \n      if (response.error) {\n        return { user: null, error: response.error };\n      }\n      \n      // Google OAuth will redirect, so we don't set user/session here\n      // The auth state change listener will handle the session after redirect\n      return { user: null, error: null };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Google sign in failed';\n      return { user: null, error: errorMessage };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signOut = async () => {\n    try {\n      setLoading(true);\n      // Record staff logout before actual sign out\n      try {\n        if (user?.role === 'staff' && user?.id && isStaffCurrentlyActive(user.id)) {\n          recordStaffLogout(user.id);\n        }\n      } catch (e) {\n        console.warn('Staff logout recording failed during signOut:', e);\n      }\n      await AuthService.signOut();\n      setUser(null);\n      setSession(null);\n      \n      // Use SessionManager for comprehensive cleanup\n      await SessionManager.clearSession();\n      \n      // Clear stored credentials for auto re-login\n      autoReloginFlow.clearCredentials();\n    } catch (error) {\n      console.error('Sign out error:', error);\n      // Even if there's an error, clear local state\n      await SessionManager.clearSession();\n      autoReloginFlow.clearCredentials();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const resetPassword = async (email: string) => {\n    try {\n      const response = await AuthService.resetPassword(email);\n      return { error: response.error };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Password reset failed';\n      return { error: errorMessage };\n    }\n  };\n\n  const updatePassword = async (newPassword: string) => {\n    try {\n      const response = await AuthService.updatePassword(newPassword);\n      return { error: response.error };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Password update failed';\n      return { error: errorMessage };\n    }\n  };\n\n  const updateProfile = async (updates: any) => {\n    try {\n      if (!user) {\n        return { user: null, error: 'No user logged in' };\n      }\n      \n      const response = await AuthService.updateProfile(user.id, updates);\n      \n      if (response.error) {\n        return { user: null, error: response.error };\n      }\n      \n      if (response.user) {\n        setUser(response.user);\n        return { user: response.user, error: null };\n      }\n      \n      return { user: null, error: 'Profile update failed' };\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Profile update failed';\n      return { user: null, error: errorMessage };\n    }\n  };\n\n  const value: AuthContextType = {\n    user,\n    session,\n    loading,\n    signIn,\n    signUp,\n    signInWithGoogle,\n    signOut,\n    resetPassword,\n    updateProfile,\n    updatePassword\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};","import React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { User } from '@/types/User';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { AppSettingsService, SETTING_CATEGORIES, AppSettingsHelpers } from '@/services/appSettingsService_database';\nimport { CurrencyService, CurrencyInfo } from '@/services/currencyService';\n\n// Language types and constants\nexport type Language = 'en' | 'es' | 'fr' | 'de' | 'it' | 'pt' | 'ru' | 'zh' | 'ja' | 'ko' | 'ar' | 'hi';\n\nconst languageNames: Record<Language, string> = {\n  en: 'English',\n  es: 'EspaÃ±ol',\n  fr: 'FranÃ§ais', \n  de: 'Deutsch',\n  it: 'Italiano',\n  pt: 'PortuguÃªs',\n  ru: 'Ð ÑƒÑÑÐºÐ¸Ð¹',\n  zh: 'ä¸­æ–‡',\n  ja: 'æ—¥æœ¬èªž',\n  ko: 'í•œêµ­ì–´',\n  ar: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©',\n  hi: 'à¤¹à¤¿à¤¨à¥à¤¦à¥€'\n};\n\ninterface AppContextType {\n  // UI State\n  notifications: Notification[];\n  addNotification: (notification: Notification) => void;\n  removeNotification: (id: string) => void;\n  clearNotifications: () => void;\n  sidebarOpen: boolean;\n  setSidebarOpen: (open: boolean) => void;\n  isFullscreen: boolean;\n  toggleFullscreen: () => void;\n  \n  // Language & Localization\n  language: Language;\n  setLanguage: (language: Language) => void;\n  translate: (key: string) => string;\n  isMultiLanguageEnabled: boolean;\n  setMultiLanguageEnabled: (enabled: boolean) => void;\n  hasLanguageAccess: boolean;\n  availableLanguages: Language[];\n  setAvailableLanguages: (languages: Language[]) => void;\n  languageNames: Record<Language, string>;\n\n  // Regional Settings\n  timezone: string;\n  setTimezone: (tz: string) => void;\n  availableTimezones: string[];\n  currency: string;\n  setCurrency: (currency: string) => void;\n  availableCurrencies: CurrencyInfo[];\n  \n  // Auth-related helpers (using AuthContext)\n  currentUser: User | null;\n  isLoggedIn: boolean;\n  isAuthenticated: boolean;\n  hasPermission: (permission: string) => boolean;\n}\n\ninterface Notification {\n  id: string;\n  type: 'success' | 'error' | 'warning' | 'info';\n  message: string;\n  duration?: number;\n}\n\n// Basic translations for common terms\nconst translations: Record<Language, Record<string, string>> = {\n  en: {\n    'search': 'Search',\n    'language': 'Language',\n    'light': 'Light',\n    'dark': 'Dark', \n    'system': 'System',\n    'success': 'Success',\n    'bookings': 'Bookings',\n    'hotels': 'Hotels',\n    'agents': 'Agents',\n    'queries': 'Queries'\n  },\n  es: {\n    'search': 'Buscar',\n    'language': 'Idioma',\n    'light': 'Claro',\n    'dark': 'Oscuro',\n    'system': 'Sistema',\n    'success': 'Ã‰xito',\n    'bookings': 'Reservas',\n    'hotels': 'Hoteles',\n    'agents': 'Agentes',\n    'queries': 'Consultas'\n  },\n  fr: {\n    'search': 'Rechercher',\n    'language': 'Langue',\n    'light': 'Clair',\n    'dark': 'Sombre',\n    'system': 'SystÃ¨me',\n    'success': 'SuccÃ¨s',\n    'bookings': 'RÃ©servations',\n    'hotels': 'HÃ´tels',\n    'agents': 'Agents',\n    'queries': 'RequÃªtes'\n  },\n  de: {\n    'search': 'Suchen',\n    'language': 'Sprache',\n    'light': 'Hell',\n    'dark': 'Dunkel',\n    'system': 'System',\n    'success': 'Erfolg',\n    'bookings': 'Buchungen',\n    'hotels': 'Hotels',\n    'agents': 'Agenten',\n    'queries': 'Anfragen'\n  },\n  it: {\n    'search': 'Cerca',\n    'language': 'Lingua',\n    'light': 'Chiaro',\n    'dark': 'Scuro',\n    'system': 'Sistema',\n    'success': 'Successo',\n    'bookings': 'Prenotazioni',\n    'hotels': 'Hotel',\n    'agents': 'Agenti',\n    'queries': 'Query'\n  },\n  pt: {\n    'search': 'Pesquisar',\n    'language': 'Idioma',\n    'light': 'Claro',\n    'dark': 'Escuro',\n    'system': 'Sistema',\n    'success': 'Sucesso',\n    'bookings': 'Reservas',\n    'hotels': 'HotÃ©is',\n    'agents': 'Agentes',\n    'queries': 'Consultas'\n  },\n  ru: {\n    'search': 'ÐŸÐ¾Ð¸ÑÐº',\n    'language': 'Ð¯Ð·Ñ‹Ðº',\n    'light': 'Ð¡Ð²ÐµÑ‚Ð»Ñ‹Ð¹',\n    'dark': 'Ð¢Ñ‘Ð¼Ð½Ñ‹Ð¹',\n    'system': 'Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð°',\n    'success': 'Ð£ÑÐ¿ÐµÑ…',\n    'bookings': 'Ð‘Ñ€Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ',\n    'hotels': 'ÐžÑ‚ÐµÐ»Ð¸',\n    'agents': 'ÐÐ³ÐµÐ½Ñ‚Ñ‹',\n    'queries': 'Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹'\n  },\n  zh: {\n    'search': 'æœç´¢',\n    'language': 'è¯­è¨€',\n    'light': 'æµ…è‰²',\n    'dark': 'æ·±è‰²',\n    'system': 'ç³»ç»Ÿ',\n    'success': 'æˆåŠŸ',\n    'bookings': 'é¢„è®¢',\n    'hotels': 'é…’åº—',\n    'agents': 'ä»£ç†',\n    'queries': 'æŸ¥è¯¢'\n  },\n  ja: {\n    'search': 'æ¤œç´¢',\n    'language': 'è¨€èªž',\n    'light': 'ãƒ©ã‚¤ãƒˆ',\n    'dark': 'ãƒ€ãƒ¼ã‚¯',\n    'system': 'ã‚·ã‚¹ãƒ†ãƒ ',\n    'success': 'æˆåŠŸ',\n    'bookings': 'äºˆç´„',\n    'hotels': 'ãƒ›ãƒ†ãƒ«',\n    'agents': 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ',\n    'queries': 'ã‚¯ã‚¨ãƒª'\n  },\n  ko: {\n    'search': 'ê²€ìƒ‰',\n    'language': 'ì–¸ì–´',\n    'light': 'ë°ê²Œ',\n    'dark': 'ì–´ë‘¡ê²Œ',\n    'system': 'ì‹œìŠ¤í…œ',\n    'success': 'ì„±ê³µ',\n    'bookings': 'ì˜ˆì•½',\n    'hotels': 'í˜¸í…”',\n    'agents': 'ì—ì´ì „íŠ¸',\n    'queries': 'ì¿¼ë¦¬'\n  },\n  ar: {\n    'search': 'Ø¨Ø­Ø«',\n    'language': 'Ø§Ù„Ù„ØºØ©',\n    'light': 'ÙØ§ØªØ­',\n    'dark': 'Ø¯Ø§ÙƒÙ†',\n    'system': 'Ø§Ù„Ù†Ø¸Ø§Ù…',\n    'success': 'Ù†Ø¬Ø­',\n    'bookings': 'Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª',\n    'hotels': 'Ø§Ù„ÙÙ†Ø§Ø¯Ù‚',\n    'agents': 'Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡',\n    'queries': 'Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª'\n  },\n  hi: {\n    'search': 'à¤–à¥‹à¤œà¥‡à¤‚',\n    'language': 'à¤­à¤¾à¤·à¤¾',\n    'light': 'à¤¹à¤²à¥à¤•à¤¾',\n    'dark': 'à¤—à¤¹à¤°à¤¾',\n    'system': 'à¤¸à¤¿à¤¸à¥à¤Ÿà¤®',\n    'success': 'à¤¸à¤«à¤²à¤¤à¤¾',\n    'bookings': 'à¤¬à¥à¤•à¤¿à¤‚à¤—',\n    'hotels': 'à¤¹à¥‹à¤Ÿà¤²',\n    'agents': 'à¤à¤œà¥‡à¤‚à¤Ÿ',\n    'queries': 'à¤ªà¥à¤°à¤¶à¥à¤¨'\n  }\n};\n\nconst defaultContext: AppContextType = {\n  // UI State\n  notifications: [],\n  addNotification: () => {},\n  removeNotification: () => {},\n  clearNotifications: () => {},\n  sidebarOpen: true,\n  setSidebarOpen: () => {},\n  isFullscreen: false,\n  toggleFullscreen: () => {},\n  \n  // Language & Localization\n  language: 'en',\n  setLanguage: () => {},\n  translate: (key: string) => key,\n  isMultiLanguageEnabled: true,\n  setMultiLanguageEnabled: () => {},\n  hasLanguageAccess: true,\n  availableLanguages: ['en', 'es', 'fr', 'de'],\n  setAvailableLanguages: () => {},\n  languageNames,\n\n  // Regional Settings\n  timezone: 'UTC',\n  setTimezone: () => {},\n  availableTimezones: [],\n  currency: 'USD',\n  setCurrency: () => {},\n  availableCurrencies: [],\n  \n  // Auth-related helpers (using AuthContext)\n  currentUser: null,\n  isLoggedIn: false,\n  isAuthenticated: false,\n  hasPermission: () => false\n};\n\nconst AppContext = createContext<AppContextType>(defaultContext);\n\nexport const AppProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  // Get auth state from AuthContext\n  const { user: currentUser } = useAuth();\n  \n  // UI State\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [sidebarOpen, setSidebarOpen] = useState<boolean>(true);\n  const [isFullscreen, setIsFullscreen] = useState<boolean>(false);\n  \n  // Language State\n  const [language, setLanguage] = useState<Language>(() => {\n    const stored = localStorage.getItem('language');\n    return (stored as Language) || 'en';\n  });\n  const [isMultiLanguageEnabled, setIsMultiLanguageEnabledState] = useState<boolean>(() => {\n    const stored = localStorage.getItem('isMultiLanguageEnabled');\n    return stored ? JSON.parse(stored) : true;\n  });\n  const [availableLanguages, setAvailableLanguagesState] = useState<Language[]>(() => {\n    const stored = localStorage.getItem('availableLanguages');\n    return stored ? JSON.parse(stored) : ['en', 'es', 'fr', 'de', 'it', 'pt'];\n  });\n\n  // Regional Settings state\n  const [timezone, setTimezoneState] = useState<string>(() => {\n    const stored = localStorage.getItem('timezone');\n    return stored || 'UTC';\n  });\n  const [currency, setCurrencyState] = useState<string>(() => {\n    const stored = localStorage.getItem('currency');\n    return stored || 'USD';\n  });\n  const [availableTimezones, setAvailableTimezones] = useState<string[]>(() => {\n    try {\n      // Prefer full list provided by the runtime\n      // @ts-ignore supportedValuesOf may not exist in some TS lib targets\n      const tzs = (Intl as any).supportedValuesOf?.('timeZone') || [];\n      let list: string[] = Array.isArray(tzs) && tzs.length ? tzs : ['UTC', 'Asia/Kolkata'];\n      if (!list.includes('Asia/Kolkata')) {\n        list = [...list, 'Asia/Kolkata'];\n      }\n      return list;\n    } catch {\n      return ['UTC', 'Asia/Kolkata'];\n    }\n  });\n  const [availableCurrencies, setAvailableCurrencies] = useState<CurrencyInfo[]>(() => {\n    return CurrencyService.getAvailableCurrencies();\n  });\n\n  useEffect(() => {\n    localStorage.setItem('language', language);\n  }, [language]);\n\n  // Load remote persisted regional settings on mount\n  useEffect(() => {\n    (async () => {\n      try {\n        const tzRes = await AppSettingsService.getSetting(SETTING_CATEGORIES.GENERAL, 'default_timezone');\n        if (tzRes.success && tzRes.data?.setting_value) {\n          setTimezoneState(tzRes.data.setting_value);\n          localStorage.setItem('timezone', tzRes.data.setting_value);\n        }\n\n        const curRes = await AppSettingsService.getSetting(SETTING_CATEGORIES.GENERAL, 'default_currency');\n        if (curRes.success && curRes.data?.setting_value) {\n          setCurrencyState(curRes.data.setting_value);\n          localStorage.setItem('currency', curRes.data.setting_value);\n        }\n\n        const langRes = await AppSettingsService.getSetting(SETTING_CATEGORIES.GENERAL, 'default_language');\n        if (langRes.success && langRes.data?.setting_value) {\n          const val = langRes.data.setting_value as Language;\n          setLanguage(val);\n          localStorage.setItem('language', val);\n        }\n      } catch (e) {\n        // Ignore errors and rely on localStorage defaults\n        console.warn('Failed loading remote app settings, using local defaults');\n      }\n    })();\n  }, []);\n\n  const hasPermission = (permission: string): boolean => {\n    if (!currentUser) return false;\n    if (currentUser.role === 'super_admin') return true;\n    if (currentUser.role === 'hr_manager') {\n      // HR managers have specific permissions for HR-related functionality\n      return ['staff.*', 'hr.*', 'attendance.*', 'payroll.*', 'staff.view', 'staff.create', 'staff.edit'].includes(permission) ||\n             currentUser.permissions?.includes(permission) || false;\n    }\n    if (currentUser.role === 'manager') {\n      // Managers have most permissions\n      return !['system.config', 'system.backup'].includes(permission);\n    }\n    return currentUser.permissions?.includes(permission) || false;\n  };\n\n  const toggleFullscreen = () => {\n    setIsFullscreen(prev => !prev);\n  };\n\n  const translate = (key: string): string => {\n    const langTranslations = translations[language] || translations.en;\n    return langTranslations[key] || key;\n  };\n\n  const isLoggedIn = !!currentUser;\n  const isAuthenticated = !!currentUser;\n  const hasLanguageAccess = currentUser?.languageAccess !== false;\n\n  const addNotification = (notification: Notification) => {\n    const id = String(Math.random());\n    const newNotification = { ...notification, id };\n    setNotifications(prevNotifications => [...prevNotifications, newNotification]);\n\n    if (notification.duration) {\n      setTimeout(() => {\n        removeNotification(id);\n      }, notification.duration);\n    }\n  };\n\n  const removeNotification = (id: string) => {\n    setNotifications(prevNotifications =>\n      prevNotifications.filter(notification => notification.id !== id)\n    );\n  };\n\n  const clearNotifications = () => {\n    setNotifications([]);\n  };\n\n  const setMultiLanguageEnabled = (enabled: boolean) => {\n    setIsMultiLanguageEnabledState(enabled);\n    localStorage.setItem('isMultiLanguageEnabled', JSON.stringify(enabled));\n  };\n\n  const setAvailableLanguages = (languages: Language[]) => {\n    setAvailableLanguagesState(languages);\n    localStorage.setItem('availableLanguages', JSON.stringify(languages));\n  };\n\n  const persistSetting = async (key: string, value: string) => {\n    try {\n      // Use unified upsert helper to avoid redundant update->create loops\n      const res = await AppSettingsHelpers.upsertSetting({\n        category: SETTING_CATEGORIES.GENERAL,\n        setting_key: key,\n        setting_value: value,\n        is_active: true\n      });\n      if (!res.success) {\n        console.warn('Persist setting failed:', res.error);\n      }\n    } catch (err) {\n      console.warn('Failed to persist setting', key, err);\n    }\n  };\n\n  const setTimezone = (tz: string) => {\n    setTimezoneState(tz);\n    localStorage.setItem('timezone', tz);\n    persistSetting('default_timezone', tz);\n  };\n\n  const setCurrency = (cur: string) => {\n    setCurrencyState(cur);\n    localStorage.setItem('currency', cur);\n    persistSetting('default_currency', cur);\n  };\n\n  // Persist language selection to remote settings as well\n  useEffect(() => {\n    (async () => {\n      try {\n        await persistSetting('default_language', language);\n      } catch {}\n    })();\n  }, [language]);\n\n  return (\n    <AppContext.Provider\n      value={{\n        // UI State\n        notifications,\n        addNotification,\n        removeNotification,\n        clearNotifications,\n        sidebarOpen,\n        setSidebarOpen,\n        isFullscreen,\n        toggleFullscreen,\n      \n        // Language & Localization\n        language,\n        setLanguage,\n        translate,\n        isMultiLanguageEnabled,\n        setMultiLanguageEnabled,\n        hasLanguageAccess,\n        availableLanguages,\n        setAvailableLanguages,\n        languageNames,\n\n        // Regional Settings\n        timezone,\n        setTimezone,\n        availableTimezones,\n        currency,\n        setCurrency,\n        availableCurrencies,\n        \n        // Auth-related helpers (using AuthContext)\n        currentUser,\n        isLoggedIn,\n        isAuthenticated,\n        hasPermission\n      }}\n    >\n      {children}\n    </AppContext.Provider>\n  );\n};\n\nexport const useApp = () => {\n  return useContext(AppContext);\n};\n","\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { StaffNotification, NotificationPreferences } from '@/types/query';\nimport { useApp } from '@/contexts/AppContext';\nimport { staffNotificationService } from '@/services/staffNotificationService';\n\ninterface StaffNotificationContextType {\n  notifications: StaffNotification[];\n  unreadCount: number;\n  isLoading: boolean;\n  preferences: NotificationPreferences | null;\n  markAsRead: (notificationId: string) => void;\n  markAllAsRead: () => void;\n  dismissNotification: (notificationId: string) => void;\n  addNotification: (notification: Omit<StaffNotification, 'id' | 'timestamp'>) => void;\n  updatePreferences: (preferences: Partial<NotificationPreferences>) => void;\n  requestBrowserPermission: () => Promise<boolean>;\n  hasBrowserPermission: boolean;\n  notificationStats: {\n    total: number;\n    unread: number;\n    urgent: number;\n    highPriority: number;\n    actionRequired: number;\n  };\n}\n\nconst StaffNotificationContext = createContext<StaffNotificationContextType | undefined>(undefined);\n\nexport const useStaffNotifications = () => {\n  const context = useContext(StaffNotificationContext);\n  if (context === undefined) {\n    throw new Error('useStaffNotifications must be used within a StaffNotificationProvider');\n  }\n  return context;\n};\n\ninterface StaffNotificationProviderProps {\n  children: React.ReactNode;\n}\n\nexport const StaffNotificationProvider: React.FC<StaffNotificationProviderProps> = ({ children }) => {\n  const { currentUser } = useApp();\n  const [notifications, setNotifications] = useState<StaffNotification[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [preferences, setPreferences] = useState<NotificationPreferences | null>(null);\n  const [hasBrowserPermission, setHasBrowserPermission] = useState(false);\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n\n  // Check browser notification permission on mount\n  useEffect(() => {\n    if ('Notification' in window) {\n      setHasBrowserPermission(Notification.permission === 'granted');\n    }\n  }, []);\n\n  // Load notifications and preferences for current staff user\n  useEffect(() => {\n    if (currentUser && (currentUser.role === 'staff' || currentUser.role === 'manager')) {\n      loadNotifications();\n      loadPreferences();\n    }\n  }, [currentUser]);\n\n  // Cleanup expired notifications periodically\n  useEffect(() => {\n    const interval = setInterval(() => {\n      staffNotificationService.cleanupExpiredNotifications();\n      if (currentUser) {\n        loadNotifications();\n      }\n    }, 60000); // Check every minute\n\n    return () => clearInterval(interval);\n  }, [currentUser]);\n\n  const loadNotifications = async () => {\n    if (!currentUser) return;\n    \n    setIsLoading(true);\n    try {\n      const staffNotifications = await staffNotificationService.getNotificationsForStaff(currentUser.id);\n      setNotifications(staffNotifications);\n    } catch (error) {\n      console.error('Failed to load notifications:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const loadPreferences = async () => {\n    if (!currentUser) return;\n    \n    try {\n      const userPreferences = await staffNotificationService.getPreferences(currentUser.id);\n      setPreferences(userPreferences);\n    } catch (error) {\n      console.error('Failed to load notification preferences:', error);\n    }\n  };\n\n  const markAsRead = useCallback((notificationId: string) => {\n    setNotifications(prev => \n      prev.map(notification => \n        notification.id === notificationId \n          ? { ...notification, read: true }\n          : notification\n      )\n    );\n    staffNotificationService.markAsRead(notificationId);\n  }, []);\n\n  const markAllAsRead = useCallback(() => {\n    const unreadIds = notifications.filter(n => !n.read).map(n => n.id);\n    setNotifications(prev => \n      prev.map(notification => ({ ...notification, read: true }))\n    );\n    staffNotificationService.markMultipleAsRead(unreadIds);\n  }, [notifications]);\n\n  const dismissNotification = useCallback((notificationId: string) => {\n    setNotifications(prev => prev.filter(n => n.id !== notificationId));\n    staffNotificationService.dismissNotification(notificationId);\n  }, []);\n\n  const addNotification = useCallback(async (notification: Omit<StaffNotification, 'id' | 'timestamp'>) => {\n    const newNotification = staffNotificationService.createNotification(notification);\n    setNotifications(prev => [newNotification, ...prev]);\n    \n    // Process notification with preferences (browser/email)\n    if (currentUser?.email) {\n      await staffNotificationService.processNotification(newNotification, currentUser.email);\n    }\n  }, [hasBrowserPermission, preferences, currentUser]);\n\n  const updatePreferences = useCallback(async (newPreferences: Partial<NotificationPreferences>) => {\n    if (!currentUser || !preferences) return;\n\n    const updatedPreferences = { ...preferences, ...newPreferences };\n    setPreferences(updatedPreferences);\n    await staffNotificationService.updatePreferences(updatedPreferences);\n  }, [currentUser, preferences]);\n\n  const requestBrowserPermission = useCallback(async (): Promise<boolean> => {\n    if (!('Notification' in window)) {\n      return false;\n    }\n\n    if (Notification.permission === 'granted') {\n      setHasBrowserPermission(true);\n      return true;\n    }\n\n    if (Notification.permission !== 'denied') {\n      const permission = await Notification.requestPermission();\n      const granted = permission === 'granted';\n      setHasBrowserPermission(granted);\n      return granted;\n    }\n\n    return false;\n  }, []);\n\n  // Calculate notification statistics\n  const notificationStats = currentUser \n    ? staffNotificationService.getNotificationStats(currentUser.id)\n    : {\n        total: 0,\n        unread: 0,\n        urgent: 0,\n        highPriority: 0,\n        actionRequired: 0\n      };\n\n  const value: StaffNotificationContextType = {\n    notifications,\n    unreadCount,\n    isLoading,\n    preferences,\n    markAsRead,\n    markAllAsRead,\n    dismissNotification,\n    addNotification,\n    updatePreferences,\n    requestBrowserPermission,\n    hasBrowserPermission,\n    notificationStats\n  };\n\n  return (\n    <StaffNotificationContext.Provider value={value}>\n      {children}\n    </StaffNotificationContext.Provider>\n  );\n};\n","\nimport React from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { useAuth } from '@/contexts/AuthContext';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n  requiredRole?: string | string[];\n  requiredPermission?: string;\n  requiredDepartment?: string;\n}\n\nconst ProtectedRoute: React.FC<ProtectedRouteProps> = ({ \n  children, \n  requiredRole, \n  requiredPermission,\n  requiredDepartment\n}) => {\n  const { user: currentUser, loading } = useAuth();\n\n  // Debug logging for ProtectedRoute\n  console.log('=== PROTECTED ROUTE DEBUG ===', {\n    currentUser: currentUser,\n    userRole: currentUser?.role,\n    requiredRole: requiredRole,\n    loading: loading,\n    timestamp: new Date().toISOString()\n  });\n\n  // Dev-only auth bypass to preview protected routes locally\n  const isDev = import.meta.env.DEV;\n  let devBypassEnabled = false;\n  try {\n    const urlParams = typeof window !== 'undefined' ? new URLSearchParams(window.location.search) : undefined;\n    const urlBypass = urlParams?.get('dev') === '1';\n    const localBypass = typeof window !== 'undefined' && localStorage.getItem('dev_auth_bypass') === '1';\n    const envBypass = (import.meta.env as any).VITE_DEV_AUTH_BYPASS === '1';\n    devBypassEnabled = isDev && (urlBypass || localBypass || envBypass);\n  } catch (e) {\n    devBypassEnabled = false;\n  }\n\n  if (devBypassEnabled) {\n    return <>{children}</>;\n  }\n\n  // Helper function to check permissions\n  const hasPermission = (permission: string): boolean => {\n    if (!currentUser) return false;\n    \n    // Super admin has all permissions\n    if (currentUser.role === 'super_admin') return true;\n    \n    // Check if user has the specific permission\n    return currentUser.permissions?.includes(permission) || \n           currentUser.permissions?.includes('*') || \n           false;\n  };\n\n  if (loading) {\n    return <div className=\"flex items-center justify-center min-h-screen\">Loading...</div>;\n  }\n\n  // If user is not authenticated, redirect to login\n  if (!currentUser) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  // Check role requirement with precise hierarchy\n  if (requiredRole) {\n    const allowedRoles = Array.isArray(requiredRole) ? requiredRole : [requiredRole];\n\n    const isAdminRoute = allowedRoles.includes('admin');\n    const isManagerRoute = allowedRoles.includes('manager');\n    const isSuperAdminRoute = allowedRoles.includes('super_admin');\n\n    const role = currentUser.role;\n\n    const hasAccess = (\n      // Super admin can access any route listing super_admin or admin or manager\n      (role === 'super_admin' && (isSuperAdminRoute || isAdminRoute || isManagerRoute)) ||\n      // Admin can access routes that list admin\n      (role === 'admin' && isAdminRoute) ||\n      // Manager can access routes that list manager\n      (role === 'manager' && isManagerRoute) ||\n      // Direct match fallback\n      allowedRoles.includes(role)\n    );\n\n    if (!hasAccess) {\n      // Redirect staff users to their department dashboard instead of Unauthorized\n      if (role === 'staff') {\n        const dept = currentUser.department;\n        const staffRedirect = (() => {\n          switch (dept) {\n            case 'Sales':\n              return '/dashboards/sales';\n            case 'Operations':\n              return '/dashboards/operations';\n            case 'Marketing':\n              return '/dashboards/content';\n            case 'Customer Support':\n            case 'Support':\n              return '/dashboards/support';\n            case 'Finance':\n              return '/dashboards/finance';\n            case 'Field Sales':\n              return '/management/agents';\n            default:\n              return '/dashboard';\n          }\n        })();\n        return <Navigate to={staffRedirect} replace />;\n      }\n      return <Navigate to=\"/unauthorized\" replace />;\n    }\n  }\n\n  // Check permission requirement\n  if (requiredPermission && !hasPermission(requiredPermission)) {\n    return <Navigate to=\"/unauthorized\" replace />;\n  }\n\n  // Check department requirement with dashboard access configuration\n  if (requiredDepartment && currentUser.role === 'staff') {\n    // Get saved dashboard access configuration\n    const savedDashboardAccess = localStorage.getItem('dashboard_access_config');\n    let dashboardAccessConfig = [];\n    \n    if (savedDashboardAccess) {\n      try {\n        dashboardAccessConfig = JSON.parse(savedDashboardAccess);\n      } catch (error) {\n        console.error('Error parsing dashboard access config:', error);\n      }\n    }\n    \n    // Find matching dashboard configuration\n    const dashboardConfig = dashboardAccessConfig.find((config: any) => \n      config.allowedDepartments?.includes(requiredDepartment)\n    );\n    \n    if (dashboardConfig && dashboardConfig.restrictByDepartment) {\n      // Check if user's department matches required department\n      if (currentUser.department !== requiredDepartment) {\n        return <Navigate to=\"/unauthorized\" replace />;\n      }\n    } else {\n      // Fallback to original logic\n      if (currentUser.department !== requiredDepartment) {\n        return <Navigate to=\"/unauthorized\" replace />;\n      }\n    }\n  }\n\n  return <>{children}</>;\n};\n\nexport default ProtectedRoute;\n","import React, { createContext, useContext, useState, ReactNode, useEffect } from 'react';\nimport { AppSettingsService, SETTING_CATEGORIES } from '@/services/appSettingsService';\nimport { authHelpers } from '@/lib/supabaseClient';\n\ninterface SEOData {\n  title?: string;\n  description?: string;\n  keywords?: string;\n  image?: string;\n  url?: string;\n  type?: 'website' | 'article' | 'product' | 'profile';\n  author?: string;\n  publishedTime?: string;\n  modifiedTime?: string;\n  section?: string;\n  tags?: string[];\n  locale?: string;\n  siteName?: string;\n  twitterHandle?: string;\n  noIndex?: boolean;\n  canonicalUrl?: string;\n  structuredData?: object;\n}\n\ninterface SEOContextType {\n  seoData: SEOData;\n  updateSEO: (data: Partial<SEOData>) => void;\n  resetSEO: () => void;\n}\n\nconst defaultSEOData: SEOData = {\n  title: 'Travel Management System',\n  description: 'Comprehensive B2B tour management system for DMCs, travel agents, and tour operators.',\n  keywords: 'tour management, travel software, DMC software, B2B travel, booking system, itinerary builder, travel CRM, destination management',\n  image: 'https://lovable.dev/opengraph-image-p98pqg.png',\n  type: 'website',\n  author: 'Tripoex',\n  locale: 'en_US',\n  siteName: 'Travel Management System',\n  twitterHandle: '',\n  noIndex: false,\n};\n\nconst SEOContext = createContext<SEOContextType | undefined>(undefined);\n\nexport const useSEO = (): SEOContextType => {\n  const context = useContext(SEOContext);\n  if (!context) {\n    throw new Error('useSEO must be used within a SEOProvider');\n  }\n  return context;\n};\n\ninterface SEOProviderProps {\n  children: ReactNode;\n}\n\nexport const SEOProvider: React.FC<SEOProviderProps> = ({ children }) => {\n  const [seoData, setSeoData] = useState<SEOData>(defaultSEOData);\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      try {\n        // Skip settings calls when no active session to avoid noisy logs\n        const { session, error: sessionError } = await authHelpers.getSession();\n        if (sessionError || !session) {\n          return; // defaults will be used\n        }\n\n        const [siteTitle, companyName, appDescription] = await Promise.all([\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.SEO, 'site_title'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.GENERAL, 'company_name'),\n          AppSettingsService.getSettingValue(SETTING_CATEGORIES.GENERAL, 'app_description'),\n        ]);\n        if (!mounted) return;\n        setSeoData(prev => ({\n          ...prev,\n          title: typeof siteTitle === 'string' && siteTitle.trim() ? siteTitle : prev.title,\n          siteName: typeof companyName === 'string' && companyName.trim() ? companyName : (typeof siteTitle === 'string' && siteTitle.trim() ? siteTitle : prev.siteName),\n          description: typeof appDescription === 'string' && appDescription.trim() ? appDescription : prev.description,\n        }));\n      } catch (e) {\n        // Non-fatal; defaults will be used\n        console.debug('SEOContext: settings fetch skipped or failed', e);\n      }\n    })();\n    return () => { mounted = false; };\n  }, []);\n\n  const updateSEO = (data: Partial<SEOData>) => {\n    setSeoData(prev => ({ ...prev, ...data }));\n  };\n\n  const resetSEO = () => {\n    setSeoData(defaultSEOData);\n  };\n\n  return (\n    <SEOContext.Provider value={{ seoData, updateSEO, resetSEO }}>\n      {children}\n    </SEOContext.Provider>\n  );\n};\n\nexport { SEOContext };","import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { supabase } from '@/lib/supabaseClient';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport type AgentHeader = {\n  agency_name?: string;\n  profile_image?: string;\n};\n\ninterface AgentHeaderContextType {\n  agentHeader: AgentHeader | null;\n  loading: boolean;\n  error: string | null;\n  refresh: () => Promise<void>;\n  clearError: () => void;\n}\n\nconst AgentHeaderContext = createContext<AgentHeaderContextType | undefined>(undefined);\n\nconst CACHE_TTL_MS = 1000 * 60 * 5; // 5 minutes\n\nexport const AgentHeaderProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const { user } = useAuth();\n  const [agentHeader, setAgentHeader] = useState<AgentHeader | null>(null);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadAgentHeader = useCallback(async (force = false) => {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Determine user id\n      const { data: auth } = await supabase.auth.getUser();\n      const userId = auth?.user?.id || user?.id;\n      if (!userId) {\n        setAgentHeader(null);\n        return;\n      }\n\n      // Cache key per user\n      const cacheKey = `agentHeader:${userId}`;\n      const cachedStr = localStorage.getItem(cacheKey);\n      const now = Date.now();\n\n      if (!force && cachedStr) {\n        try {\n          const cached = JSON.parse(cachedStr) as { value: AgentHeader; timestamp: number };\n          if (cached?.timestamp && (now - cached.timestamp) < CACHE_TTL_MS) {\n            setAgentHeader(cached.value || null);\n            return;\n          }\n        } catch (_) {\n          // ignore cache parse error\n        }\n      }\n\n      // Fetch from Supabase\n      const { data, error: dbError } = await supabase\n        .from('agents')\n        .select('agency_name, profile_image')\n        .eq('user_id', userId)\n        .maybeSingle();\n\n      if (dbError) {\n        throw dbError;\n      }\n\n      const value: AgentHeader | null = data ? (data as AgentHeader) : null;\n      setAgentHeader(value);\n\n      // Persist cache\n      try {\n        localStorage.setItem(cacheKey, JSON.stringify({ value, timestamp: now }));\n      } catch (_) {\n        // ignore localStorage errors\n      }\n    } catch (err) {\n      const message = err instanceof Error ? err.message : 'Failed to load agent header';\n      setError(message);\n      setAgentHeader(null);\n    } finally {\n      setLoading(false);\n    }\n  }, [user?.id]);\n\n  const refresh = useCallback(async () => {\n    await loadAgentHeader(true);\n  }, [loadAgentHeader]);\n\n  const clearError = () => setError(null);\n\n  // Auto-load when user changes\n  useEffect(() => {\n    loadAgentHeader(false);\n  }, [loadAgentHeader]);\n\n  // Realtime subscription: auto-update header when agents row changes for current user\n  useEffect(() => {\n    let isMounted = true;\n    let channel: any = null;\n\n    const setupRealtime = async () => {\n      try {\n        // Resolve current user id\n        const { data: auth } = await supabase.auth.getUser();\n        const userId = auth?.user?.id || user?.id;\n        if (!userId) return;\n\n        // Subscribe to changes on public.agents filtered by user_id\n        channel = supabase\n          .channel(`agent-header:${userId}`)\n          .on(\n            'postgres_changes',\n            { event: '*', schema: 'public', table: 'agents', filter: `user_id=eq.${userId}` },\n            (payload: any) => {\n              try {\n                const row = (payload?.new || payload?.old || {}) as any;\n                const value: AgentHeader = {\n                  agency_name: row?.agency_name,\n                  profile_image: row?.profile_image,\n                };\n                if (isMounted) {\n                  setAgentHeader(value);\n                }\n                // Update cache\n                const cacheKey = `agentHeader:${userId}`;\n                try {\n                  localStorage.setItem(cacheKey, JSON.stringify({ value, timestamp: Date.now() }));\n                } catch (_) {}\n              } catch (e) {\n                // ignore payload errors\n              }\n            }\n          )\n          .subscribe(async (status) => {\n            if (status === 'SUBSCRIBED') {\n              // Optional: force refresh to hydrate immediately\n              await loadAgentHeader(true);\n            }\n          });\n      } catch (err) {\n        // ignore subscription errors; context still works with manual refresh\n      }\n    };\n\n    setupRealtime();\n\n    return () => {\n      isMounted = false;\n      try {\n        if (channel) {\n          supabase.removeChannel(channel);\n        }\n      } catch (_) {}\n    };\n  }, [user?.id, loadAgentHeader]);\n\n  return (\n    <AgentHeaderContext.Provider value={{ agentHeader, loading, error, refresh, clearError }}>\n      {children}\n    </AgentHeaderContext.Provider>\n  );\n};\n\nexport const useAgentHeader = () => {\n  const ctx = useContext(AgentHeaderContext);\n  if (!ctx) throw new Error('useAgentHeader must be used within AgentHeaderProvider');\n  return ctx;\n};","\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { CentralItinerary, ItineraryDay } from '@/types/itinerary';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface ItineraryContextType {\n  itinerary: CentralItinerary | null;\n  isLoading: boolean;\n  error: string | null;\n  updateItinerary: (updates: Partial<CentralItinerary>) => void;\n  updateDay: (dayIndex: number, updates: Partial<ItineraryDay>) => void;\n  addDay: () => void;\n  removeDay: (dayIndex: number) => void;\n  saveItinerary: () => Promise<void>;\n  loadItinerary: (queryId: string) => Promise<void>;\n  clearItinerary: () => void;\n}\n\nconst ItineraryContext = createContext<ItineraryContextType | undefined>(undefined);\n\nexport const useItineraryContext = () => {\n  const context = useContext(ItineraryContext);\n  if (!context) {\n    throw new Error('useItineraryContext must be used within an ItineraryProvider');\n  }\n  return context;\n};\n\ninterface ItineraryProviderProps {\n  children: React.ReactNode;\n  queryId?: string;\n}\n\nexport const ItineraryProvider: React.FC<ItineraryProviderProps> = ({\n  children,\n  queryId\n}) => {\n  const [itinerary, setItinerary] = useState<CentralItinerary | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  // Auto-save functionality\n  useEffect(() => {\n    if (itinerary && queryId) {\n      const timeoutId = setTimeout(() => {\n        localStorage.setItem(`itinerary_${queryId}`, JSON.stringify(itinerary));\n      }, 1000); // Auto-save after 1 second of inactivity\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [itinerary, queryId]);\n\n  const loadItinerary = useCallback(async (targetQueryId: string) => {\n    try {\n      setIsLoading(true);\n      setError(null);\n      \n      const saved = localStorage.getItem(`itinerary_${targetQueryId}`);\n      if (saved) {\n        const parsedItinerary = JSON.parse(saved);\n        setItinerary(parsedItinerary);\n      }\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to load itinerary';\n      setError(errorMessage);\n      console.error('Error loading itinerary:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  const updateItinerary = useCallback((updates: Partial<CentralItinerary>) => {\n    if (!itinerary) return;\n    \n    setItinerary(prev => prev ? {\n      ...prev,\n      ...updates,\n      updatedAt: new Date().toISOString(),\n    } : null);\n  }, [itinerary]);\n\n  const updateDay = useCallback((dayIndex: number, updates: Partial<ItineraryDay>) => {\n    if (!itinerary || dayIndex < 0 || dayIndex >= itinerary.days.length) return;\n    \n    setItinerary(prev => {\n      if (!prev) return null;\n      \n      const updatedDays = [...prev.days];\n      updatedDays[dayIndex] = {\n        ...updatedDays[dayIndex],\n        ...updates,\n      };\n      \n      // Recalculate pricing\n      const totalCost = updatedDays.reduce((sum, day) => sum + day.totalCost, 0);\n      \n      return {\n        ...prev,\n        days: updatedDays,\n        pricing: {\n          ...prev.pricing,\n          baseCost: totalCost,\n          finalPrice: totalCost + (prev.pricing.markup || 0),\n        },\n        updatedAt: new Date().toISOString(),\n      };\n    });\n  }, [itinerary]);\n\n  const addDay = useCallback(() => {\n    if (!itinerary) return;\n    \n    const newDayNumber = itinerary.days.length + 1;\n    const lastDay = itinerary.days[itinerary.days.length - 1];\n    const newDate = new Date(lastDay?.date || itinerary.startDate);\n    newDate.setDate(newDate.getDate() + 1);\n    \n    const newDay: ItineraryDay = {\n      id: `day-${newDayNumber}`,\n      day: newDayNumber,\n      date: newDate.toISOString().split('T')[0],\n      location: lastDay?.location || itinerary.destinations[0],\n      activities: [],\n      meals: [],\n      totalCost: 0,\n    };\n    \n    updateItinerary({\n      days: [...itinerary.days, newDay],\n      duration: {\n        ...itinerary.duration,\n        days: itinerary.duration.days + 1,\n      },\n    });\n  }, [itinerary, updateItinerary]);\n\n  const removeDay = useCallback((dayIndex: number) => {\n    if (!itinerary || dayIndex < 0 || dayIndex >= itinerary.days.length) return;\n    \n    const updatedDays = itinerary.days.filter((_, index) => index !== dayIndex);\n    // Renumber remaining days\n    const renumberedDays = updatedDays.map((day, index) => ({\n      ...day,\n      day: index + 1,\n    }));\n    \n    updateItinerary({\n      days: renumberedDays,\n      duration: {\n        ...itinerary.duration,\n        days: itinerary.duration.days - 1,\n        nights: Math.max(0, itinerary.duration.nights - 1),\n      },\n    });\n  }, [itinerary, updateItinerary]);\n\n  const saveItinerary = useCallback(async () => {\n    if (!itinerary || !queryId) return;\n    \n    try {\n      setIsLoading(true);\n      localStorage.setItem(`itinerary_${queryId}`, JSON.stringify(itinerary));\n      \n      toast({\n        title: \"Itinerary Saved\",\n        description: \"Your itinerary has been saved successfully.\",\n      });\n    } catch (err) {\n      toast({\n        title: \"Save Failed\",\n        description: \"Failed to save itinerary. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  }, [itinerary, queryId, toast]);\n\n  const clearItinerary = useCallback(() => {\n    setItinerary(null);\n    setError(null);\n  }, []);\n\n  // Load itinerary on mount if queryId provided\n  useEffect(() => {\n    if (queryId) {\n      loadItinerary(queryId);\n    }\n  }, [queryId, loadItinerary]);\n\n  const value = {\n    itinerary,\n    isLoading,\n    error,\n    updateItinerary,\n    updateDay,\n    addDay,\n    removeDay,\n    saveItinerary,\n    loadItinerary,\n    clearItinerary,\n  };\n\n  return (\n    <ItineraryContext.Provider value={value}>\n      {children}\n    </ItineraryContext.Provider>\n  );\n};\n","import React, { createContext, useContext, useMemo } from 'react';\nimport { runSmartPrompt } from '@/services/aiRouter';\n\ntype AskAIOptions = { timeoutMs?: number; maxRetriesPerProvider?: number; sessionProviderLimit?: number };\ntype AskAIResult = { provider: string; model: string; text?: string; response_time_ms: number };\n\ntype AIRouterContextValue = {\n  askAI: (prompt: string, options?: AskAIOptions) => Promise<AskAIResult>;\n};\n\nconst AIRouterContext = createContext<AIRouterContextValue | null>(null);\n\nexport function AIRouterProvider({ children }: { children: React.ReactNode }) {\n  const value = useMemo<AIRouterContextValue>(() => ({\n    askAI: async (prompt: string, options?: AskAIOptions) => {\n      return runSmartPrompt(prompt, options);\n    },\n  }), []);\n\n  return <AIRouterContext.Provider value={value}>{children}</AIRouterContext.Provider>;\n}\n\nexport function useAI(): AIRouterContextValue {\n  const ctx = useContext(AIRouterContext);\n  if (!ctx) throw new Error('useAI must be used within AIRouterProvider');\n  return ctx;\n}"],"names":["defaultSettings","logo","darkLogo","favicon","logoSize","companyDetails","name","tagline","description","address","phone","email","website","seoSettings","title","keywords","ogTitle","ogDescription","pdfSettings","headerEnabled","showLogo","showCompanyName","showContactDetails","headerBackgroundColor","headerTextColor","fontFamily","fontSize","enquirySettings","countries","DEFAULT_ENQUIRY_COUNTRIES","defaultCountryCode","ApplicationSettingsContext","createContext","ApplicationSettingsProvider","children","settings","setSettings","useState","hydrated","setHydrated","location","useLocation","isPublicRoute","test","pathname","useEffect","companyNameRes","taglineRes","logoRes","darkLogoRes","faviconRes","siteTitleRes","enquiryConfigRes","Promise","all","AppSettingsService","getSettingValue","SETTING_CATEGORIES","BRANDING","GENERAL","prev","error","jsx","Provider","value","updateSettings","newSettings","updated","updateSetting","setting_value","is_active","e","updateCompanyDetails","details","updateSEOSettings","seo","updatePDFSettings","pdf","updateEnquirySettings","AppSettingsHelpers","upsertSetting","category","setting_key","setting_json","data_type","localStorage","setItem","JSON","stringify","addCountry","country","updateCountry","countryCode","updates","map","removeCountry","filter","setDefaultCountry","isDefault","useApplicationSettings","context","useContext","Error","AuthContext","useAuth","AuthProvider","user","setUser","session","setSession","loading","setLoading","validationInterval","mounted","async","validationResult","SessionManager","validateSession","shouldSignOut","clearSession","isValid","sessionUser","currentSession","AuthService","getCurrentSession","data","subscription","supabase","auth","onAuthStateChange","event","role","id","recordStaffLogin","isStaffCurrentlyActive","recordStaffLogout","setInterval","periodicValidation","initializeAuth","clearInterval","userTrackingService","setCurrentUser","signIn","password","response","autoReloginFlow","storeCredentials","message","signUp","userData","signInWithGoogle","signOut","clearCredentials","resetPassword","updateProfile","updatePassword","newPassword","languageNames","en","es","fr","de","it","pt","ru","zh","ja","ko","ar","hi","translations","search","language","light","dark","system","success","bookings","hotels","agents","queries","defaultContext","notifications","addNotification","removeNotification","clearNotifications","sidebarOpen","setSidebarOpen","isFullscreen","toggleFullscreen","setLanguage","translate","key","isMultiLanguageEnabled","setMultiLanguageEnabled","hasLanguageAccess","availableLanguages","setAvailableLanguages","timezone","setTimezone","availableTimezones","currency","setCurrency","availableCurrencies","currentUser","isLoggedIn","isAuthenticated","hasPermission","AppContext","AppProvider","setNotifications","setIsFullscreen","getItem","setIsMultiLanguageEnabledState","stored","parse","setAvailableLanguagesState","setTimezoneState","setCurrencyState","setAvailableTimezones","tzs","Intl","supportedValuesOf","list","Array","isArray","length","includes","setAvailableCurrencies","CurrencyService","getAvailableCurrencies","tzRes","getSetting","curRes","langRes","val","languageAccess","prevNotifications","notification","persistSetting","err","String","Math","random","newNotification","duration","setTimeout","enabled","languages","tz","cur","permission","permissions","useApp","StaffNotificationContext","useStaffNotifications","StaffNotificationProvider","isLoading","setIsLoading","preferences","setPreferences","hasBrowserPermission","setHasBrowserPermission","unreadCount","n","read","window","Notification","loadNotifications","loadPreferences","interval","staffNotificationService","cleanupExpiredNotifications","staffNotifications","getNotificationsForStaff","userPreferences","getPreferences","markAsRead","useCallback","notificationId","markAllAsRead","unreadIds","markMultipleAsRead","dismissNotification","createNotification","processNotification","updatePreferences","newPreferences","updatedPreferences","requestBrowserPermission","granted","requestPermission","notificationStats","getNotificationStats","total","unread","urgent","highPriority","actionRequired","ProtectedRoute","requiredRole","requiredPermission","requiredDepartment","devBypassEnabled","urlParams","URLSearchParams","get","className","Navigate","to","replace","allowedRoles","isAdminRoute","isManagerRoute","isSuperAdminRoute","dept","department","staffRedirect","savedDashboardAccess","dashboardAccessConfig","dashboardConfig","find","config","allowedDepartments","restrictByDepartment","defaultSEOData","image","type","author","locale","siteName","twitterHandle","noIndex","SEOContext","useSEO","SEOProvider","seoData","setSeoData","sessionError","authHelpers","getSession","siteTitle","companyName","appDescription","SEO","trim","updateSEO","resetSEO","AgentHeaderContext","AgentHeaderProvider","agentHeader","setAgentHeader","setError","loadAgentHeader","force","getUser","userId","cacheKey","cachedStr","now","Date","cached","timestamp","_","dbError","from","select","eq","maybeSingle","refresh","isMounted","channel","on","schema","table","payload","row","new","old","agency_name","profile_image","subscribe","status","setupRealtime","removeChannel","clearError","useAgentHeader","ctx","ItineraryContext","useItineraryContext","ItineraryProvider","queryId","itinerary","setItinerary","toast","useToast","timeoutId","clearTimeout","loadItinerary","targetQueryId","saved","parsedItinerary","errorMessage","updateItinerary","updatedAt","toISOString","updateDay","dayIndex","days","updatedDays","totalCost","reduce","sum","day","pricing","baseCost","finalPrice","markup","addDay","newDayNumber","lastDay","newDate","date","startDate","setDate","getDate","newDay","split","destinations","activities","meals","removeDay","renumberedDays","index","nights","max","saveItinerary","variant","clearItinerary","AIRouterContext","AIRouterProvider","useMemo","askAI","prompt","options","runSmartPrompt","useAI"],"mappings":"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"}