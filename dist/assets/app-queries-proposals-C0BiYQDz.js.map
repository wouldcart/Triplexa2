{"version":3,"file":"app-queries-proposals-C0BiYQDz.js","sources":["../../src/pages/queries/components/QueryList.tsx","../../src/pages/queries/components/AssignmentRules.tsx","../../src/pages/queries/components/AssignmentRulesEditor.tsx","../../src/pages/queries/components/StaffSequence.tsx","../../src/pages/queries/AssignQueries.tsx","../../src/pages/queries/hooks/useInventoryData.ts","../../src/pages/queries/components/AgentSelector.tsx","../../src/pages/queries/components/CityCheckboxSelector.tsx","../../src/pages/queries/components/CountryCitySelector.tsx","../../src/pages/queries/EditQuery.tsx","../../src/pages/proposal/AdvancedProposalCreation.tsx","../../src/pages/queries/QueryManagement.tsx","../../src/pages/queries/CreateQuery.tsx","../../src/pages/queries/QueryDetails.tsx","../../src/pages/queries/components/QuickCreateQuery.tsx","../../src/pages/queries/Queries.tsx","../../src/pages/queries/components/EnhancedQueryList.tsx","../../src/pages/queries/TravelEnquiryHub.tsx"],"sourcesContent":["import React from 'react';\nimport { \n  Table, TableBody, TableCell, TableHead, TableHeader, TableRow \n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Query } from '@/types/query';\nimport { useQueryAssignment } from '@/hooks/useQueryAssignment';\nimport { useActiveStaffData } from '@/hooks/useActiveStaffData';\nimport { getAssignmentReason } from '@/services/countryAssignmentService';\n\ninterface QueryListProps {\n  queries: Query[];\n  mode: 'unassigned' | 'assigned' | 'all';\n  onAssignQuery: (query: Query) => void;\n}\n\nconst QueryList: React.FC<QueryListProps> = ({\n  queries,\n  mode,\n  onAssignQuery\n}) => {\n  const { getApplicableRule, findBestStaffMatch } = useQueryAssignment();\n  const { activeStaff } = useActiveStaffData();\n\n  // Render query priority badge with appropriate styling\n  const renderPriorityBadge = (priority?: string) => {\n    const p = (priority || 'normal').toLowerCase();\n    const label = p.charAt(0).toUpperCase() + p.slice(1);\n    if (p === 'urgent' || p === 'high') {\n      return <Badge variant=\"destructive\">{label}</Badge>;\n    } else if (p === 'normal' || p === 'medium') {\n      return <Badge variant=\"default\">{label}</Badge>;\n    }\n    return <Badge variant=\"outline\">{label}</Badge>;\n  };\n\n  // Get staff member assigned to query using active staff data\n  const getAssignedStaff = (query: Query) => {\n    const key = query.assignedTo;\n    if (!key) return null;\n    // Resolve against uuid, numeric id string, or name\n    const match = activeStaff.find(s => {\n      const uuid = (s as any).uuid;\n      return uuid === key || String(s.id) === key || s.name === key;\n    });\n    return match || null;\n  };\n\n  // Get best matching rule for unassigned query with country consideration\n  const getBestMatchRule = (query: Query) => {\n    const bestStaff = findBestStaffMatch(query);\n    if (bestStaff) {\n      const reason = getAssignmentReason(bestStaff, query);\n      \n      switch (reason) {\n        case 'Country Expertise':\n          return <Badge className=\"bg-green-600\">Country Match</Badge>;\n        case 'Destination Expertise':\n          return <Badge className=\"bg-blue-600\">Expertise Match</Badge>;\n        case 'Workload Balance':\n          return <Badge className=\"bg-orange-600\">Workload Balance</Badge>;\n        default:\n          return <Badge variant=\"outline\">Manual</Badge>;\n      }\n    }\n\n    const ruleType = getApplicableRule(query);\n    switch (ruleType) {\n      case 'agent-staff-relationship':\n        return <Badge className=\"bg-purple-600\">Agent Relationship</Badge>;\n      case 'expertise-match':\n        return <Badge className=\"bg-blue-600\">Expertise Match</Badge>;\n      case 'workload-balance':\n        return <Badge className=\"bg-orange-600\">Workload Balance</Badge>;\n      default:\n        return <Badge variant=\"outline\">Manual</Badge>;\n    }\n  };\n\n  if (mode === 'unassigned') {\n    return (\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Query ID</TableHead>\n            <TableHead>Destination</TableHead>\n            <TableHead>PAX</TableHead>\n            <TableHead>Travel Date</TableHead>\n            <TableHead>Priority</TableHead>\n            <TableHead>Best Match</TableHead>\n            <TableHead>Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {queries.filter(q => q.status === 'new').length > 0 ? (\n            queries.filter(q => q.status === 'new').map((query) => (\n              <TableRow key={query.id}>\n                <TableCell>{query.id}</TableCell>\n                <TableCell>\n                  <div>\n                    <div className=\"font-medium\">{query.destination.country}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      {query.destination.cities.join(', ')}\n                    </div>\n                  </div>\n                </TableCell>\n                <TableCell>\n                  {query.paxDetails.adults + query.paxDetails.children + query.paxDetails.infants} \n                  <div className=\"text-xs text-muted-foreground\">\n                    ({query.paxDetails.adults} A, {query.paxDetails.children} C, {query.paxDetails.infants} I)\n                  </div>\n                </TableCell>\n                <TableCell>{query.travelDates.from}</TableCell>\n                <TableCell>\n                  {renderPriorityBadge(query.priority)}\n                </TableCell>\n                <TableCell>\n                  {getBestMatchRule(query)}\n                </TableCell>\n                <TableCell>\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => onAssignQuery(query)}>\n                    Assign\n                  </Button>\n                </TableCell>\n              </TableRow>\n            ))\n          ) : (\n            <TableRow>\n              <TableCell colSpan={7} className=\"text-center py-4 text-muted-foreground\">\n                No unassigned queries\n              </TableCell>\n            </TableRow>\n          )}\n        </TableBody>\n      </Table>\n    );\n  }\n\n  if (mode === 'assigned') {\n    return (\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>Query ID</TableHead>\n            <TableHead>Destination</TableHead>\n            <TableHead>PAX</TableHead>\n            <TableHead>Assigned To</TableHead>\n            <TableHead>Status</TableHead>\n            <TableHead>Assignment</TableHead>\n            <TableHead>Actions</TableHead>\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          {queries.filter(q => q.status === 'assigned' || q.status === 'in-progress').length > 0 ? (\n            queries.filter(q => q.status === 'assigned' || q.status === 'in-progress').map((query) => {\n              const assignedStaff = getAssignedStaff(query);\n              return (\n                <TableRow key={query.id}>\n                  <TableCell>{query.id}</TableCell>\n                  <TableCell>\n                    <div>\n                      <div className=\"font-medium\">{query.destination.country}</div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {query.destination.cities.join(', ')}\n                      </div>\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {query.paxDetails.adults + query.paxDetails.children + query.paxDetails.infants} \n                    <div className=\"text-xs text-muted-foreground\">\n                      ({query.paxDetails.adults} A, {query.paxDetails.children} C, {query.paxDetails.infants} I)\n                    </div>\n                  </TableCell>\n                  <TableCell>\n                    {assignedStaff && (\n                      <div className=\"flex items-center\">\n                        <Avatar className=\"h-7 w-7 mr-2\">\n                          <AvatarFallback>{assignedStaff.name.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <span>{assignedStaff.name}</span>\n                      </div>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <Badge className={query.status === 'in-progress' ? 'bg-blue-500' : ''}>\n                      {query.status === 'assigned' ? 'Assigned' : 'In Progress'}\n                    </Badge>\n                  </TableCell>\n                  <TableCell>\n                    {assignedStaff && (\n                      <Badge className=\"bg-green-600\">\n                        {getAssignmentReason(assignedStaff, query)}\n                      </Badge>\n                    )}\n                  </TableCell>\n                  <TableCell>\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => onAssignQuery(query)}>\n                      Reassign\n                    </Button>\n                  </TableCell>\n                </TableRow>\n              );\n            })\n          ) : (\n            <TableRow>\n              <TableCell colSpan={7} className=\"text-center py-4 text-muted-foreground\">\n                No assigned queries\n              </TableCell>\n            </TableRow>\n          )}\n        </TableBody>\n      </Table>\n    );\n  }\n\n  // All queries mode with country-aware display\n  return (\n    <Table>\n      <TableHeader>\n        <TableRow>\n          <TableHead>Query ID</TableHead>\n          <TableHead>Destination</TableHead>\n          <TableHead>PAX</TableHead>\n          <TableHead>Status</TableHead>\n          <TableHead>Assigned To</TableHead>\n          <TableHead>Assignment</TableHead>\n          <TableHead>Actions</TableHead>\n        </TableRow>\n      </TableHeader>\n      <TableBody>\n        {queries.map((query) => {\n          const assignedStaff = getAssignedStaff(query);\n          return (\n            <TableRow key={query.id}>\n              <TableCell>{query.id}</TableCell>\n              <TableCell>\n                <div>\n                  <div className=\"font-medium\">{query.destination.country}</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    {query.destination.cities.join(', ')}\n                  </div>\n                </div>\n              </TableCell>\n              <TableCell>\n                {query.paxDetails.adults + query.paxDetails.children + query.paxDetails.infants} \n                <div className=\"text-xs text-muted-foreground\">\n                  ({query.paxDetails.adults} A, {query.paxDetails.children} C, {query.paxDetails.infants} I)\n                </div>\n              </TableCell>\n              <TableCell>\n                <Badge \n                  variant={query.status === 'new' ? 'outline' : 'default'} \n                  className={query.status === 'in-progress' ? 'bg-blue-500' : ''}\n                >\n                  {query.status === 'new' ? 'Unassigned' : \n                   query.status === 'assigned' ? 'Assigned' : 'In Progress'}\n                </Badge>\n              </TableCell>\n              <TableCell>\n                {query.status !== 'new' && assignedStaff ? (\n                  <div className=\"flex items-center\">\n                    <Avatar className=\"h-7 w-7 mr-2\">\n                      <AvatarFallback>{assignedStaff.name.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                    <span>{assignedStaff.name}</span>\n                  </div>\n                ) : (\n                  <span className=\"text-muted-foreground\">-</span>\n                )}\n              </TableCell>\n              <TableCell>\n                {query.status === 'new' ? (\n                  getBestMatchRule(query)\n                ) : assignedStaff ? (\n                  <Badge className=\"bg-green-600\">\n                    {getAssignmentReason(assignedStaff, query)}\n                  </Badge>\n                ) : (\n                  <Badge variant=\"outline\">Manual</Badge>\n                )}\n              </TableCell>\n              <TableCell>\n                {query.status === 'new' ? (\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => onAssignQuery(query)}>\n                    Assign\n                  </Button>\n                ) : (\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => onAssignQuery(query)}>\n                    Reassign\n                  </Button>\n                )}\n              </TableCell>\n            </TableRow>\n          );\n        })}\n      </TableBody>\n    </Table>\n  );\n};\n\nexport default QueryList;\n","\nimport React, { useEffect, useState } from 'react';\nimport { Badge } from '@/components/ui/badge';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { listAssignmentRules, updateAssignmentRuleEnabled, type DBAssignmentRule } from '@/services/assignmentRulesService';\n\ninterface AssignmentRulesProps {\n  onEditRules: () => void;\n}\n\nconst AssignmentRules: React.FC<AssignmentRulesProps> = ({ onEditRules }) => {\n  const [rules, setRules] = useState<DBAssignmentRule[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [selectedRuleId, setSelectedRuleId] = useState<string | null>(null);\n\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      const { data } = await listAssignmentRules();\n      if (!mounted) return;\n      setRules(data);\n      setLoading(false);\n    })();\n    return () => { mounted = false; };\n  }, []);\n\n  const handleToggleRule = async (ruleId: string, enabled: boolean) => {\n    // optimistic update\n    setRules(prev => prev.map(r => (r.id === ruleId ? { ...r, enabled } : r)));\n    const { error } = await updateAssignmentRuleEnabled(ruleId, enabled);\n    if (error) {\n      // revert on error\n      setRules(prev => prev.map(r => (r.id === ruleId ? { ...r, enabled: !enabled } : r)));\n    }\n  };\n\n  const describeRuleType = (type: string) => {\n    switch (type) {\n      case 'agent-staff-relationship':\n        return 'Assigns queries based on agent-staff relationships';\n      case 'expertise-match':\n        return 'Assigns queries based on staff expertise with destination';\n      case 'workload-balance':\n        return 'Assigns queries to staff with the lowest workload';\n      case 'round-robin':\n        return 'Assigns queries sequentially based on staff priority';\n      default:\n        return type;\n    }\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Assignment Rules</CardTitle>\n          <Button variant=\"outline\" size=\"sm\" onClick={onEditRules}>Edit Rules</Button>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {loading ? (\n          <div className=\"text-sm text-muted-foreground\">Loading rules…</div>\n        ) : (\n          <div className=\"space-y-2\">\n            {rules.map((rule) => {\n              const isEnabled = Boolean(rule.enabled ?? true);\n              const isSelected = selectedRuleId === rule.id;\n              return (\n                <div\n                  key={rule.id}\n                  className={`flex items-center justify-between p-2 border rounded transition-colors cursor-pointer ${\n                    isSelected ? 'bg-accent/20 border-primary' : ''\n                  }`}\n                  onClick={() => setSelectedRuleId(rule.id)}\n                  role=\"button\"\n                  aria-selected={isSelected}\n                  data-selected={isSelected}\n                >\n                  <div className=\"flex items-center\">\n                    <span className=\"font-medium mr-2\">{rule.priority}</span>\n                    <div>\n                      <div>{rule.name}</div>\n                      <div className=\"text-xs text-muted-foreground\">\n                        {describeRuleType(rule.rule_type)}\n                      </div>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Switch\n                      checked={isEnabled}\n                      onCheckedChange={(checked) => handleToggleRule(rule.id, checked)}\n                      id={`rule-${rule.id}`}\n                    />\n                    <Label htmlFor={`rule-${rule.id}`}>\n                      <Badge variant={isEnabled ? 'default' : 'outline'} className={isEnabled ? 'bg-green-500' : ''}>\n                        {isEnabled ? 'Active' : 'Inactive'}\n                      </Badge>\n                    </Label>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default AssignmentRules;\n","import React, { useEffect, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { Separator } from '@/components/ui/separator';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  DBAssignmentRule,\n  listAssignmentRules,\n  createAssignmentRule,\n  updateAssignmentRule,\n  deleteAssignmentRule,\n} from '@/services/assignmentRulesService';\n\ntype Props = { onClose: () => void };\n\nconst RULE_OPTIONS: { value: string; label: string }[] = [\n  { value: 'expertise-match', label: 'Country/Destination Expertise' },\n  { value: 'workload-balance', label: 'Workload Balance' },\n  { value: 'agent-staff-relationship', label: 'Agent–Staff Relationship' },\n  { value: 'round-robin', label: 'Round Robin' },\n];\n\nconst AssignmentRulesEditor: React.FC<Props> = ({ onClose }) => {\n  const { toast } = useToast();\n  const [rules, setRules] = useState<DBAssignmentRule[]>([]);\n  const [loading, setLoading] = useState<boolean>(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const [newRule, setNewRule] = useState<Omit<DBAssignmentRule, 'id' | 'created_at' | 'updated_at'>>({\n    name: '',\n    rule_type: 'expertise-match',\n    priority: 1,\n    enabled: true,\n    conditions: null,\n  });\n\n  const loadRules = async () => {\n    setLoading(true);\n    const { data, error } = await listAssignmentRules();\n    if (error) {\n      setError('Failed to load assignment rules');\n      setRules([]);\n    } else {\n      setError(null);\n      setRules(data);\n    }\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    loadRules();\n  }, []);\n\n  const handleCreate = async () => {\n    if (!newRule.name.trim()) {\n      toast({ title: 'Name required', variant: 'destructive', description: 'Please enter a rule name.' });\n      return;\n    }\n    const { data, error } = await createAssignmentRule(newRule);\n    if (error) {\n      toast({ title: 'Create failed', variant: 'destructive', description: String(error?.message || error) });\n      return;\n    }\n    toast({ title: 'Rule created', description: `${data?.name} added.` });\n    setNewRule({ name: '', rule_type: 'expertise-match', priority: (rules?.length || 0) + 1, enabled: true, conditions: null });\n    await loadRules();\n  };\n\n  const handleUpdate = async (id: string, patch: Partial<DBAssignmentRule>) => {\n    const { error } = await updateAssignmentRule(id, patch);\n    if (error) {\n      toast({ title: 'Update failed', variant: 'destructive', description: String(error?.message || error) });\n      return;\n    }\n    toast({ title: 'Rule updated' });\n    await loadRules();\n  };\n\n  const handleDelete = async (id: string) => {\n    const { error } = await deleteAssignmentRule(id);\n    if (error) {\n      toast({ title: 'Delete failed', variant: 'destructive', description: String(error?.message || error) });\n      return;\n    }\n    toast({ title: 'Rule deleted' });\n    await loadRules();\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle>Manage Assignment Rules</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {loading ? (\n            <div className=\"text-sm text-muted-foreground\">Loading…</div>\n          ) : error ? (\n            <div className=\"text-sm text-red-600\">{error}</div>\n          ) : (\n            <div className=\"space-y-3\">\n              {rules.map((rule) => (\n                <div key={rule.id} className=\"grid grid-cols-1 md:grid-cols-12 items-center gap-3 p-3 border rounded\">\n                  <div className=\"md:col-span-3\">\n                    <Label className=\"text-xs\">Name</Label>\n                    <Input\n                      value={rule.name}\n                      onChange={(e) => setRules((prev) => prev.map((r) => (r.id === rule.id ? { ...r, name: e.target.value } : r)))}\n                    />\n                  </div>\n                  <div className=\"md:col-span-3\">\n                    <Label className=\"text-xs\">Type</Label>\n                    <Select\n                      value={rule.rule_type}\n                      onValueChange={(val) => setRules((prev) => prev.map((r) => (r.id === rule.id ? { ...r, rule_type: val } : r)))}\n                    >\n                      <SelectTrigger className=\"w-full\">\n                        <SelectValue placeholder=\"Select type\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {RULE_OPTIONS.map((opt) => (\n                          <SelectItem key={opt.value} value={opt.value}>\n                            {opt.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"md:col-span-2\">\n                    <Label className=\"text-xs\">Priority</Label>\n                    <Input\n                      type=\"number\"\n                      value={rule.priority}\n                      onChange={(e) => setRules((prev) => prev.map((r) => (r.id === rule.id ? { ...r, priority: Number(e.target.value) } : r)))}\n                    />\n                  </div>\n                  <div className=\"md:col-span-2\">\n                    <Label className=\"text-xs\">Enabled</Label>\n                    <div className=\"flex items-center gap-2\">\n                      <Switch\n                        checked={!!rule.enabled}\n                        onCheckedChange={(checked) => setRules((prev) => prev.map((r) => (r.id === rule.id ? { ...r, enabled: checked } : r)))}\n                      />\n                      <span className=\"text-xs\">{rule.enabled ? 'Active' : 'Inactive'}</span>\n                    </div>\n                  </div>\n                  <div className=\"md:col-span-2 flex items-end justify-end gap-2\">\n                    <Button variant=\"outline\" onClick={() => handleUpdate(rule.id, rule)}>Save</Button>\n                    <Button variant=\"destructive\" onClick={() => handleDelete(rule.id)}>Delete</Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Create New Rule</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-12 items-center gap-3\">\n            <div className=\"md:col-span-3\">\n              <Label className=\"text-xs\">Name</Label>\n              <Input value={newRule.name} onChange={(e) => setNewRule((p) => ({ ...p, name: e.target.value }))} />\n            </div>\n            <div className=\"md:col-span-3\">\n              <Label className=\"text-xs\">Type</Label>\n              <Select value={newRule.rule_type} onValueChange={(val) => setNewRule((p) => ({ ...p, rule_type: val }))}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Select type\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {RULE_OPTIONS.map((opt) => (\n                    <SelectItem key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"md:col-span-2\">\n              <Label className=\"text-xs\">Priority</Label>\n              <Input type=\"number\" value={newRule.priority} onChange={(e) => setNewRule((p) => ({ ...p, priority: Number(e.target.value) }))} />\n            </div>\n            <div className=\"md:col-span-2\">\n              <Label className=\"text-xs\">Enabled</Label>\n              <div className=\"flex items-center gap-2\">\n                <Switch checked={!!newRule.enabled} onCheckedChange={(checked) => setNewRule((p) => ({ ...p, enabled: checked }))} />\n                <span className=\"text-xs\">{newRule.enabled ? 'Active' : 'Inactive'}</span>\n              </div>\n            </div>\n            <div className=\"md:col-span-2 flex items-end justify-end gap-2\">\n              <Button onClick={handleCreate}>Add Rule</Button>\n              <Button variant=\"outline\" onClick={onClose}>Close</Button>\n            </div>\n          </div>\n          <Separator className=\"mt-4\" />\n          <p className=\"text-xs text-muted-foreground mt-2\">Rules are applied in ascending priority order. Ensure the most specific rule has the lowest number.</p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n};\n\nexport default AssignmentRulesEditor;","import React, { useEffect, useMemo, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { StaffMember } from '@/types/assignment';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { Badge } from '@/components/ui/badge';\nimport { Switch } from '@/components/ui/switch';\nimport { ArrowDown, ArrowUp, GripVertical, Plus, Trash } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useActiveStaffData, EnhancedStaffWithWorkload } from '@/hooks/useActiveStaffData';\nimport { useRealTimeCountriesData } from '@/hooks/useRealTimeCountriesData';\nimport StaffSequenceService, { StaffSequenceRow } from '@/services/staffSequenceService';\n\ninterface StaffSequenceProps {\n  staff: EnhancedStaffWithWorkload[];\n}\n\nconst StaffSequence: React.FC<StaffSequenceProps> = ({ staff }) => {\n  const { toast } = useToast();\n  const { activeStaff } = useActiveStaffData();\n  const { getCountryById } = useRealTimeCountriesData();\n  const toCountryName = (value: string) => getCountryById(value)?.name || value;\n  \n  const [sequenceStaff, setSequenceStaff] = useState<EnhancedStaffWithWorkload[]>([]);\n  const [isEditing, setIsEditing] = useState(false);\n  const [addStaffDialogOpen, setAddStaffDialogOpen] = useState(false);\n  const [selectedStaffId, setSelectedStaffId] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n\n  // Hydrate sequence from Supabase\n  useEffect(() => {\n    let ignore = false;\n    const load = async () => {\n      setLoading(true);\n      try {\n        const { data } = await StaffSequenceService.fetchSequence();\n        const mapped: EnhancedStaffWithWorkload[] = (data || [])\n          .map((row: StaffSequenceRow) => {\n            const found = activeStaff.find(s => (s as any).uuid && String((s as any).uuid) === String(row.staff_id));\n            if (found) {\n              return { ...found, sequenceOrder: row.sequence_order, autoAssignEnabled: row.auto_assign_enabled ?? true } as EnhancedStaffWithWorkload;\n            }\n            // Fallback placeholder if profile not in activeStaff\n            return {\n              ...(found || ({} as any)),\n              id: found?.id ?? -1,\n              name: found?.name ?? 'Unknown',\n              role: found?.role ?? 'staff',\n              email: found?.email ?? '',\n              department: found?.department ?? 'General',\n              status: found?.status ?? 'active',\n              assigned: found?.assigned ?? 0,\n              workloadCapacity: found?.workloadCapacity ?? 10,\n              expertise: found?.expertise ?? [],\n              active: found?.active ?? true,\n              avatar: found?.avatar ?? '',\n              availability: found?.availability ?? [],\n              autoAssignEnabled: row.auto_assign_enabled ?? true,\n              sequenceOrder: row.sequence_order,\n            } as EnhancedStaffWithWorkload;\n          })\n          .sort((a, b) => (a.sequenceOrder || 999) - (b.sequenceOrder || 999));\n        if (!ignore) setSequenceStaff(mapped);\n      } finally {\n        if (!ignore) setLoading(false);\n      }\n    };\n    load();\n    return () => { ignore = true; };\n  }, [activeStaff]);\n\n  // Get staff members who are active but not in the sequence\n  const availableStaff = useMemo(() => {\n    return activeStaff.filter(s => \n      s.active && \n      !sequenceStaff.some(sequenceMember => {\n        const seqUuid = (sequenceMember as any).uuid ? String((sequenceMember as any).uuid) : String(sequenceMember.id);\n        const sUuid = (s as any).uuid ? String((s as any).uuid) : String(s.id);\n        return seqUuid === sUuid;\n      })\n    );\n  }, [activeStaff, sequenceStaff]);\n\n  const moveStaff = (index: number, direction: 'up' | 'down') => {\n    if (\n      (direction === 'up' && index === 0) || \n      (direction === 'down' && index === sequenceStaff.length - 1)\n    ) {\n      return;\n    }\n\n    const newList = [...sequenceStaff];\n    const targetIndex = direction === 'up' ? index - 1 : index + 1;\n    \n    const temp = newList[index];\n    newList[index] = newList[targetIndex];\n    newList[targetIndex] = temp;\n    \n    // Update sequence orders\n    newList.forEach((staff, idx) => {\n      staff.sequenceOrder = idx + 1;\n    });\n    \n    setSequenceStaff(newList);\n  };\n\n  const handleAddStaff = () => {\n    if (!selectedStaffId) {\n      toast({\n        title: \"No staff selected\",\n        description: \"Please select a staff member to add.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const staffToAdd = activeStaff.find(s => {\n      const sUuid = (s as any).uuid ? String((s as any).uuid) : String(s.id);\n      return sUuid === selectedStaffId;\n    });\n    \n    if (staffToAdd) {\n      // Persist to Supabase using UUID if available\n      const uuid = (staffToAdd as any).uuid ? String((staffToAdd as any).uuid) : String(staffToAdd.id);\n      StaffSequenceService.addStaff(uuid, sequenceStaff.length + 1)\n        .then(() => {\n          setAddStaffDialogOpen(false);\n          setSelectedStaffId('');\n          toast({\n            title: \"Staff added\",\n            description: `${staffToAdd.name} has been added to the assignment sequence`,\n          });\n          // Reload sequence from DB\n          return StaffSequenceService.fetchSequence();\n        })\n        .then(({ data }) => {\n          const mapped: EnhancedStaffWithWorkload[] = (data || [])\n            .map((row: StaffSequenceRow) => {\n              const found = activeStaff.find(s => (s as any).uuid && String((s as any).uuid) === String(row.staff_id));\n              if (found) {\n                return { ...found, sequenceOrder: row.sequence_order, autoAssignEnabled: row.auto_assign_enabled ?? true } as EnhancedStaffWithWorkload;\n              }\n              return {\n                id: -1,\n                name: 'Unknown',\n                role: 'staff',\n                email: '',\n                department: 'General',\n                status: 'active',\n                assigned: 0,\n                workloadCapacity: 10,\n                expertise: [],\n                active: true,\n                avatar: '',\n                availability: [],\n                autoAssignEnabled: row.auto_assign_enabled ?? true,\n                sequenceOrder: row.sequence_order,\n              } as EnhancedStaffWithWorkload;\n            })\n            .sort((a, b) => (a.sequenceOrder || 999) - (b.sequenceOrder || 999));\n          setSequenceStaff(mapped);\n        })\n        .catch(() => {\n          toast({\n            title: \"Failed to add staff\",\n            description: \"Unable to persist sequence in Supabase\",\n            variant: \"destructive\",\n          });\n        });\n    }\n  };\n\n  const handleRemoveStaff = (staffId: number) => {\n    const staffToRemove = sequenceStaff.find(s => s.id === staffId);\n    const uuid = staffToRemove && (staffToRemove as any).uuid ? String((staffToRemove as any).uuid) : undefined;\n    const name = staffToRemove?.name || 'Staff member';\n    if (!uuid) {\n      toast({ title: 'Cannot remove', description: 'Missing staff UUID', variant: 'destructive' });\n      return;\n    }\n    StaffSequenceService.removeStaff(uuid)\n      .then(() => {\n        toast({ title: 'Staff removed', description: `${name} has been removed from the assignment sequence` });\n        // Reload from DB\n        return StaffSequenceService.fetchSequence();\n      })\n      .then(({ data }) => {\n        const mapped: EnhancedStaffWithWorkload[] = (data || [])\n          .map((row: StaffSequenceRow) => {\n            const found = activeStaff.find(s => (s as any).uuid && String((s as any).uuid) === String(row.staff_id));\n            if (found) {\n              return { ...found, sequenceOrder: row.sequence_order, autoAssignEnabled: row.auto_assign_enabled ?? true } as EnhancedStaffWithWorkload;\n            }\n            return {\n              id: -1,\n              name: 'Unknown',\n              role: 'staff',\n              email: '',\n              department: 'General',\n              status: 'active',\n              assigned: 0,\n              workloadCapacity: 10,\n              expertise: [],\n              active: true,\n              avatar: '',\n              availability: [],\n              autoAssignEnabled: row.auto_assign_enabled ?? true,\n              sequenceOrder: row.sequence_order,\n            } as EnhancedStaffWithWorkload;\n          })\n          .sort((a, b) => (a.sequenceOrder || 999) - (b.sequenceOrder || 999));\n        setSequenceStaff(mapped);\n      })\n      .catch(() => {\n        toast({ title: 'Failed to remove staff', description: 'Unable to update Supabase', variant: 'destructive' });\n      });\n  };\n\n  const handleToggleStaffAutoAssign = (s: EnhancedStaffWithWorkload, index: number, enabled: boolean) => {\n    const uuid = (s as any).uuid ? String((s as any).uuid) : undefined;\n    if (!uuid) {\n      toast({ title: 'Cannot update auto-assign', description: 'Missing staff UUID', variant: 'destructive' });\n      return;\n    }\n    // Optimistic UI update\n    setSequenceStaff(prev => prev.map((item, i) => i === index ? { ...item, autoAssignEnabled: enabled } : item));\n    StaffSequenceService.updateAutoAssign(uuid, enabled)\n      .then(({ error }) => {\n        if (error) throw error;\n        toast({ title: 'Auto-assign updated', description: `${s.name}: ${enabled ? 'Enabled' : 'Disabled'}` });\n      })\n      .catch(() => {\n        // Revert on failure\n        setSequenceStaff(prev => prev.map((item, i) => i === index ? { ...item, autoAssignEnabled: !enabled } : item));\n        toast({ title: 'Failed to update', description: 'Could not persist auto-assign in Supabase', variant: 'destructive' });\n      });\n  };\n\n  const saveSequence = () => {\n    const payload: StaffSequenceRow[] = sequenceStaff.map((s, idx) => ({\n      staff_id: ((s as any).uuid ? String((s as any).uuid) : String(s.id)),\n      sequence_order: s.sequenceOrder || idx + 1,\n      auto_assign_enabled: s.autoAssignEnabled ?? true,\n    }));\n    StaffSequenceService.upsertSequence(payload)\n      .then(() => {\n        setIsEditing(false);\n        toast({\n          title: 'Staff sequence updated',\n          description: 'The auto-assignment staff sequence has been updated successfully',\n        });\n      })\n      .catch(() => {\n        toast({ title: 'Failed to save sequence', description: 'Unable to persist to Supabase', variant: 'destructive' });\n      });\n  };\n\n  const cancelEdit = () => {\n    // Reload from DB instead of local reset\n    StaffSequenceService.fetchSequence().then(({ data }) => {\n      const mapped: EnhancedStaffWithWorkload[] = (data || [])\n        .map((row: StaffSequenceRow) => {\n          const found = activeStaff.find(s => (s as any).uuid && String((s as any).uuid) === String(row.staff_id));\n          if (found) {\n            return { ...found, sequenceOrder: row.sequence_order, autoAssignEnabled: row.auto_assign_enabled ?? true } as EnhancedStaffWithWorkload;\n          }\n          return {\n            id: -1,\n            name: 'Unknown',\n            role: 'staff',\n            email: '',\n            department: 'General',\n            status: 'active',\n            assigned: 0,\n            workloadCapacity: 10,\n            expertise: [],\n            active: true,\n            avatar: '',\n            availability: [],\n            autoAssignEnabled: row.auto_assign_enabled ?? true,\n            sequenceOrder: row.sequence_order,\n          } as EnhancedStaffWithWorkload;\n        })\n        .sort((a, b) => (a.sequenceOrder || 999) - (b.sequenceOrder || 999));\n      setSequenceStaff(mapped);\n      setIsEditing(false);\n    });\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle>Staff Sequence</CardTitle>\n          {isEditing ? (\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={cancelEdit}>\n                Cancel\n              </Button>\n              <Button size=\"sm\" onClick={saveSequence}>\n                Save Sequence\n              </Button>\n            </div>\n          ) : (\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setAddStaffDialogOpen(true)}>\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Staff\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsEditing(true)}>\n                Edit Sequence\n              </Button>\n            </div>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-2\">\n          {loading ? (\n            <div className=\"text-center py-6 text-muted-foreground\">Loading sequence…</div>\n          ) : sequenceStaff.length > 0 ? (\n            sequenceStaff.map((staff, index) => {\n              const rowKey = (staff as any).uuid\n                ? String((staff as any).uuid)\n                : (staff as any).sequenceUuid\n                ? String((staff as any).sequenceUuid)\n                : `row-${index}`;\n              const selectId = (staff as any).uuid\n                ? String((staff as any).uuid)\n                : (staff as any).sequenceUuid\n                ? String((staff as any).sequenceUuid)\n                : String(staff.id);\n              return (\n              <div\n                key={rowKey}\n                className={`flex items-center justify-between p-3 border rounded-lg cursor-pointer ${\n                  isEditing ? 'bg-slate-50 dark:bg-slate-900 border-slate-300 dark:border-slate-700' : 'border-border'\n                } ${selectedStaffId === selectId ? 'ring-2 ring-primary' : ''}`}\n                onClick={() => setSelectedStaffId(selectId)}\n              >\n                <div className=\"flex items-center\">\n                  {isEditing && (\n                    <GripVertical className=\"h-4 w-4 mr-2 text-muted-foreground cursor-move\" />\n                  )}\n                  <span className=\"font-medium mr-3 text-sm bg-primary text-primary-foreground rounded-full w-6 h-6 flex items-center justify-center\">\n                    {index + 1}\n                  </span>\n                  <Avatar className=\"h-8 w-8 mr-3\">\n                    <AvatarFallback>{staff.name.charAt(0)}</AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <div className=\"font-medium\">{staff.name}</div>\n                    <div className=\"flex gap-2 mt-1\">\n                      <span className=\"text-xs text-muted-foreground\">\n                        Workload: {staff.assigned}/{staff.workloadCapacity}\n                      </span>\n                      {staff.expertise.length > 0 && (\n                        <>\n                          <span className=\"text-xs text-muted-foreground\">•</span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {staff.expertise.slice(0, 2).map(toCountryName).join(', ')}\n                            {staff.expertise.length > 2 && ` +${staff.expertise.length - 2}`}\n                          </span>\n                        </>\n                      )}\n                      {staff.autoAssignEnabled === false && (\n                        <>\n                          <span className=\"text-xs text-muted-foreground\">•</span>\n                          <Badge variant=\"outline\" className=\"text-xs\">Auto-assign disabled</Badge>\n                        </>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"flex gap-1 items-center\">\n                  <div className=\"flex items-center gap-2 mr-1\">\n                    <Switch\n                      id={`auto-assign-${rowKey}`}\n                      checked={!!staff.autoAssignEnabled}\n                      onCheckedChange={(checked) => handleToggleStaffAutoAssign(staff, index, checked)}\n                    />\n                  </div>\n                  {isEditing && (\n                    <>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 w-8 p-0\"\n                        disabled={index === 0}\n                        onClick={() => moveStaff(index, 'up')}\n                        title=\"Move up\"\n                      >\n                        <ArrowUp className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 w-8 p-0\"\n                        disabled={index === sequenceStaff.length - 1}\n                        onClick={() => moveStaff(index, 'down')}\n                        title=\"Move down\"\n                      >\n                        <ArrowDown className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"h-8 w-8 p-0 text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950\"\n                        onClick={() => handleRemoveStaff(staff.id)}\n                        title=\"Remove from sequence\"\n                      >\n                        <Trash className=\"h-4 w-4\" />\n                      </Button>\n                    </>\n                  )}\n                </div>\n              </div>\n              );\n            })\n          ) : (\n            <div className=\"text-center py-8 text-muted-foreground\">\n              <div className=\"mb-2\">No staff in the auto-assignment sequence</div>\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setAddStaffDialogOpen(true)}>\n                <Plus className=\"h-4 w-4 mr-1\" />\n                Add Staff to Sequence\n              </Button>\n            </div>\n          )}\n        </div>\n      </CardContent>\n\n      {/* Add Staff Dialog */}\n      <Dialog open={addStaffDialogOpen} onOpenChange={setAddStaffDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Add Staff to Sequence</DialogTitle>\n            <DialogDescription>\n              Select a staff member to add to the auto-assignment sequence.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4\">\n            {availableStaff.length > 0 ? (\n              <div className=\"space-y-4\">\n                <p className=\"text-sm text-muted-foreground\">\n                  Select a staff member to add to the auto-assignment sequence:\n                </p>\n                <Select\n                  value={selectedStaffId}\n                  onValueChange={setSelectedStaffId}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Select a staff member\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {availableStaff.map((staff) => (\n                      <SelectItem\n                        key={(staff as any).uuid ? String((staff as any).uuid) : staff.id.toString()}\n                        value={(staff as any).uuid ? String((staff as any).uuid) : staff.id.toString()}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarFallback className=\"text-xs\">{staff.name.charAt(0)}</AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <span className=\"font-medium\">{staff.name}</span>\n                            <span className=\"ml-2 text-muted-foreground text-xs\">({staff.role})</span>\n                          </div>\n                        </div>\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                \n                {selectedStaffId && (\n                  <div className=\"p-3 border rounded-lg bg-muted/50\">\n                    {(() => {\n                      const selectedStaff = availableStaff.find(s => {\n                        const sUuid = (s as any).uuid ? String((s as any).uuid) : String(s.id);\n                        return sUuid === selectedStaffId;\n                      });\n                      return selectedStaff ? (\n                        <div className=\"flex items-center gap-3\">\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarFallback>{selectedStaff.name.charAt(0)}</AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1\">\n                            <div className=\"font-medium\">{selectedStaff.name}</div>\n                            <div className=\"text-sm text-muted-foreground\">{selectedStaff.role}</div>\n                            <div className=\"text-xs text-muted-foreground mt-1\">\n                              Current workload: {selectedStaff.assigned}/{selectedStaff.workloadCapacity}\n                            </div>\n                          </div>\n                        </div>\n                      ) : null;\n                    })()}\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center py-6\">\n                <p className=\"text-muted-foreground mb-2\">All active staff members are already in the sequence.</p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Add more staff members in the Staff Management section to expand the sequence.\n                </p>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => {\n              setAddStaffDialogOpen(false);\n              setSelectedStaffId('');\n            }}>\n              Cancel\n            </Button>\n            <Button \n              onClick={handleAddStaff}\n              disabled={availableStaff.length === 0 || !selectedStaffId}\n            >\n              Add to Sequence\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </Card>\n  );\n};\n\nexport default StaffSequence;\n","\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport PageLayout from '@/components/layout/PageLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Switch } from '@/components/ui/switch';\nimport { AlertCircle, ArrowRightLeft, CheckCircle, UserRound, User, MapPin, Clock, Star, TrendingUp, Award, ArrowLeft } from 'lucide-react';\nimport { useEnquiries, getEnquiryById } from '@/services/enquiriesService';\nimport { useToast } from '@/hooks/use-toast';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '@/components/ui/dialog';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Avatar, AvatarFallback } from '@/components/ui/avatar';\nimport { useQueryAssignment } from '@/hooks/useQueryAssignment';\nimport { useActiveStaffData } from '@/hooks/useActiveStaffData';\nimport QueryList from './components/QueryList';\nimport AssignmentRules from './components/AssignmentRules';\nimport AssignmentRulesEditor from './components/AssignmentRulesEditor';\nimport StaffSequence from './components/StaffSequence';\nimport { Label } from '@/components/ui/label';\nimport { Query } from '@/types/query';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { useRealTimeCountriesData } from '@/hooks/useRealTimeCountriesData';\nimport { Separator } from '@/components/ui/separator';\nimport { seedAssignmentTestData } from '@/services/testSeedService';\nimport { supabase } from '@/lib/supabaseClient';\n\nconst AssignQueries: React.FC = () => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [activeTab, setActiveTab] = useState('unassigned');\n  const [assignDialogOpen, setAssignDialogOpen] = useState(false);\n  const [editRulesDialogOpen, setEditRulesDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const [seeding, setSeeding] = useState(false);\n  const [seedLogs, setSeedLogs] = useState<string[]>([]);\n  const [debugAssignments, setDebugAssignments] = useState<{ id: string; assignedTo?: string | null; assignedName?: string | null }[]>([]);\n  const searchParams = new URLSearchParams(location.search);\n  const isDebug = searchParams.get('debug') === '1' || searchParams.get('seedTest') === '1';\n  const autoSeed = searchParams.get('autoSeed') === '1';\n  \n  // Use active staff data from management module\n  const { activeStaff } = useActiveStaffData();\n  \n  const {\n    assigningQuery,\n    isAssigning,\n    selectedStaffId,\n    autoAssignEnabled,\n    autoAssignHydrated,\n    setAssigningQuery,\n    setSelectedStaffId,\n    setAutoAssignEnabled,\n    assignQueryToStaff,\n    autoAssignQueries,\n    findBestStaffMatch\n  } = useQueryAssignment();\n\n  // Fetch queries from Supabase-backed service\n  const { data: queries = [], isLoading, error, refetch } = useEnquiries({\n    page: 1,\n    pageSize: 50,\n    sort: { field: 'created_at', direction: 'desc' }\n  });\n\n  // Process queries data\n  const unassignedQueries = (queries || []).filter(q => q.status === 'new');\n  const assignedQueries = (queries || []).filter(q => q.status === 'assigned' || q.status === 'in-progress');\n  const allQueries = queries || [];\n\n  // Handle back navigation\n  const handleBackClick = () => {\n    navigate('/queries');\n  };\n\n  // Handle query assignment initiation\n  const handleAssignQuery = (query: Query) => {\n    setAssigningQuery(query);\n    setSelectedStaffId(null);\n    setAssignDialogOpen(true);\n  };\n\n  // Complete the assignment\n  const completeAssignment = () => {\n    if (selectedStaffId && assigningQuery) {\n      assignQueryToStaff(assigningQuery, selectedStaffId);\n      setAssignDialogOpen(false);\n    }\n  };\n\n  // Auto assign queries based on rules\n  const handleAutoAssign = () => {\n    if (!autoAssignEnabled) {\n      toast({\n        title: \"Auto-assignment is disabled\",\n        description: \"Please enable auto-assignment feature first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const availableStaff = activeStaff.filter(s => s.active);\n    if (availableStaff.length === 0) {\n      toast({\n        title: \"Auto-assignment failed\",\n        description: \"No active staff members available\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    autoAssignQueries(unassignedQueries);\n  };\n\n  // Map potential country IDs to readable names for display\n  const { getCountryById } = useRealTimeCountriesData();\n  const toCountryName = (value: string) => getCountryById(value)?.name || value;\n\n  // Get recommended staff for current query\n  const getRecommendedStaff = (query: Query | null) => {\n    if (!query) return null;\n    return findBestStaffMatch(query);\n  };\n\n  // Get the currently selected staff for dialog\n  const selectedStaff = activeStaff.find(s => s.id === selectedStaffId);\n  \n  // Get recommended staff for the query being assigned\n  const recommendedStaff = getRecommendedStaff(assigningQuery);\n\n  // Get expertise match percentage\n  const getExpertiseMatch = (staff: any, query: Query | null) => {\n    if (!staff || !query) return 0;\n    const destinations = [query.destination.country, ...query.destination.cities];\n    const matches = staff.expertise.filter((exp: string) => \n      destinations.some(dest => exp.toLowerCase().includes(dest.toLowerCase()))\n    );\n    return Math.round((matches.length / destinations.length) * 100);\n  };\n\n  // Get workload status\n  const getWorkloadStatus = (staff: any) => {\n    const percentage = (staff.assigned / staff.workloadCapacity) * 100;\n    if (percentage >= 90) return { status: 'overloaded', color: 'text-red-600', bgColor: 'bg-red-50' };\n    if (percentage >= 70) return { status: 'busy', color: 'text-orange-600', bgColor: 'bg-orange-50' };\n    return { status: 'available', color: 'text-green-600', bgColor: 'bg-green-50' };\n  };\n\n  // Auto-run seeding when autoSeed param is set\n  useEffect(() => {\n    if (isDebug && autoSeed && !seeding) {\n      (async () => {\n        try {\n          setSeeding(true);\n          const { logs } = await seedAssignmentTestData();\n          setSeedLogs(logs);\n          toast({ title: 'Seed complete', description: 'Test data created and auto-assigned.' });\n          // Fetch seeded enquiry assignments and resolve names\n          const ids = ['ENQ_REL_UAE', 'ENQ_BALANCE_TH', 'ENQ_RR_TH_1', 'ENQ_RR_TH_2'];\n          const entries = await Promise.all(ids.map(async (id) => {\n            const { data } = await getEnquiryById(id);\n            return data;\n          }));\n          const assignedIds = entries\n            .map(e => (e?.assignedTo ? String(e.assignedTo) : null))\n            .filter(Boolean) as string[];\n          let nameMap = new Map<string, string>();\n          if (assignedIds.length > 0) {\n            const { data: staffRows } = await (supabase as any)\n              .from('staff')\n              .select('id,name')\n              .in('id', assignedIds);\n            (staffRows || []).forEach((r: any) => {\n              if (r?.id) nameMap.set(String(r.id), String(r.name || 'Staff'));\n            });\n            // Fallback to profiles\n            const missing = assignedIds.filter(id => !nameMap.has(id));\n            if (missing.length > 0) {\n              const { data: profRows } = await (supabase as any)\n                .from('profiles')\n                .select('id,name,username')\n                .in('id', missing);\n              (profRows || []).forEach((r: any) => {\n                if (r?.id) nameMap.set(String(r.id), String(r.name || r.username || 'User'));\n              });\n            }\n          }\n          const snapshots = ids.map((id, idx) => {\n            const e = entries[idx];\n            const assignedTo = e?.assignedTo ? String(e.assignedTo) : null;\n            const assignedName = assignedTo ? (nameMap.get(assignedTo) || null) : null;\n            return { id, assignedTo, assignedName };\n          });\n          setDebugAssignments(snapshots);\n          refetch();\n        } finally {\n          setSeeding(false);\n        }\n      })();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDebug, autoSeed]);\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-4 md:space-y-6 p-2 md:p-4 lg:p-6\">\n        {/* Header Section with Back Button - Mobile Optimized */}\n        <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={handleBackClick}\n              className=\"flex items-center gap-2 w-fit\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Back to Queries</span>\n              <span className=\"sm:hidden\">Back</span>\n            </Button>\n            <div>\n              <h1 className=\"text-xl md:text-2xl font-bold\">Assign Queries</h1>\n              <p className=\"text-sm md:text-base text-muted-foreground\">\n                Manage and assign queries to staff members\n              </p>\n            </div>\n          </div>\n          \n          {/* Controls Section - Mobile Stacked */}\n          <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Switch\n                id=\"auto-assign\"\n                checked={!!autoAssignEnabled}\n                disabled={!autoAssignHydrated}\n                onCheckedChange={setAutoAssignEnabled}\n              />\n              <Label htmlFor=\"auto-assign\" className=\"cursor-pointer text-sm\">\n                Auto Assignment <span className=\"hidden sm:inline\">{!autoAssignHydrated ? 'Loading…' : (autoAssignEnabled ? 'Enabled' : 'Disabled')}</span>\n              </Label>\n            </div>\n            <div className=\"flex flex-col gap-2 sm:flex-row\">\n              <Button variant=\"outline\" onClick={() => setActiveTab('unassigned')} size=\"sm\">\n                <UserRound className=\"mr-2 h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Manual Assign</span>\n                <span className=\"sm:hidden\">Manual</span>\n              </Button>\n              <Button \n                variant=\"default\" \n                size=\"sm\"\n                onClick={handleAutoAssign}\n                disabled={!autoAssignHydrated || autoAssignEnabled !== true || unassignedQueries.length === 0}\n              >\n                <ArrowRightLeft className=\"mr-2 h-4 w-4\" />\n                <span className=\"hidden sm:inline\">Auto Assign</span>\n                <span className=\"sm:hidden\">Auto</span>\n                {unassignedQueries.length > 0 && (\n                  <span className=\"ml-1\">({unassignedQueries.length})</span>\n                )}\n              </Button>\n              {isDebug && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  disabled={seeding}\n                  onClick={async () => {\n                    setSeeding(true);\n                    setSeedLogs([]);\n                    const { logs } = await seedAssignmentTestData();\n                    setSeedLogs(logs);\n                    setSeeding(false);\n                    toast({ title: 'Seed complete', description: 'Test data created and auto-assigned.' });\n                    // Fetch and show assignments\n                    const ids = ['ENQ_REL_UAE', 'ENQ_BALANCE_TH', 'ENQ_RR_TH_1', 'ENQ_RR_TH_2'];\n                    const entries = await Promise.all(ids.map(async (id) => {\n                      const { data } = await getEnquiryById(id);\n                      return data;\n                    }));\n                    const assignedIds = entries\n                      .map(e => (e?.assignedTo ? String(e.assignedTo) : null))\n                      .filter(Boolean) as string[];\n                    let nameMap = new Map<string, string>();\n                    if (assignedIds.length > 0) {\n                      const { data: staffRows } = await (supabase as any)\n                        .from('staff')\n                        .select('id,name')\n                        .in('id', assignedIds);\n                      (staffRows || []).forEach((r: any) => {\n                        if (r?.id) nameMap.set(String(r.id), String(r.name || 'Staff'));\n                      });\n                      const missing = assignedIds.filter(id => !nameMap.has(id));\n                      if (missing.length > 0) {\n                        const { data: profRows } = await (supabase as any)\n                          .from('profiles')\n                          .select('id,name,username')\n                          .in('id', missing);\n                        (profRows || []).forEach((r: any) => {\n                          if (r?.id) nameMap.set(String(r.id), String(r.name || r.username || 'User'));\n                        });\n                      }\n                    }\n                    const snapshots = ids.map((id, idx) => {\n                      const e = entries[idx];\n                      const assignedTo = e?.assignedTo ? String(e.assignedTo) : null;\n                      const assignedName = assignedTo ? (nameMap.get(assignedTo) || null) : null;\n                      return { id, assignedTo, assignedName };\n                    });\n                    setDebugAssignments(snapshots);\n                    refetch();\n                  }}\n                >\n                  {seeding ? 'Seeding…' : 'Seed Assignment Test'}\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n\n        {/* Statistics Cards - Mobile Responsive Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4\">\n          <Card>\n            <CardContent className=\"pt-4 md:pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs md:text-sm font-medium text-muted-foreground\">Total</p>\n                  <p className=\"text-lg md:text-2xl font-bold\">{allQueries.length}</p>\n                </div>\n                <MapPin className=\"h-6 w-6 md:h-8 md:w-8 text-blue-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4 md:pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs md:text-sm font-medium text-muted-foreground\">Unassigned</p>\n                  <p className=\"text-lg md:text-2xl font-bold text-orange-600\">{unassignedQueries.length}</p>\n                </div>\n                <AlertCircle className=\"h-6 w-6 md:h-8 md:w-8 text-orange-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4 md:pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs md:text-sm font-medium text-muted-foreground\">Assigned</p>\n                  <p className=\"text-lg md:text-2xl font-bold text-green-600\">{assignedQueries.length}</p>\n                </div>\n                <CheckCircle className=\"h-6 w-6 md:h-8 md:w-8 text-green-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-4 md:pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-xs md:text-sm font-medium text-muted-foreground\">Active Staff</p>\n                  <p className=\"text-lg md:text-2xl font-bold\">{activeStaff.filter(s => s.active).length}</p>\n                </div>\n                <User className=\"h-6 w-6 md:h-8 md:w-8 text-purple-600\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Main Content - Responsive */}\n        <div className=\"grid grid-cols-1 gap-4 md:gap-6\">\n          {/* Main Content - Queries */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5\" />\n                Query Management\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {isDebug && seedLogs.length > 0 && (\n                <div className=\"mb-4 p-3 rounded-md border text-sm bg-muted/30\">\n                  <div className=\"font-semibold mb-2\">Seed Logs</div>\n                  <ul className=\"list-disc list-inside space-y-1\">\n                    {seedLogs.map((l, idx) => (\n                      <li key={`seed-log-${idx}`}>{l}</li>\n                    ))}\n                  </ul>\n                  {debugAssignments.length > 0 && (\n                    <div className=\"mt-3\">\n                      <div className=\"font-semibold mb-1\">Assignments</div>\n                      <ul className=\"list-disc list-inside space-y-1\">\n                        {debugAssignments.map((a) => (\n                          <li key={`seed-assignment-${a.id}`}>\n                            {a.id}: {a.assignedName || a.assignedTo || 'unassigned'}\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n              )}\n              <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                <TabsList className=\"mb-4 grid w-full grid-cols-3\">\n                  <TabsTrigger value=\"unassigned\" className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm\">\n                    <AlertCircle className=\"h-3 w-3 md:h-4 md:w-4\" />\n                    <span className=\"hidden sm:inline\">Unassigned</span>\n                    <span className=\"sm:hidden\">New</span>\n                    {unassignedQueries.length > 0 && (\n                      <Badge variant=\"secondary\" className=\"ml-1 text-xs\">{unassignedQueries.length}</Badge>\n                    )}\n                  </TabsTrigger>\n                  <TabsTrigger value=\"assigned\" className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm\">\n                    <CheckCircle className=\"h-3 w-3 md:h-4 md:w-4\" />\n                    <span className=\"hidden sm:inline\">Assigned</span>\n                    <span className=\"sm:hidden\">Done</span>\n                    {assignedQueries.length > 0 && (\n                      <Badge variant=\"secondary\" className=\"ml-1 text-xs\">{assignedQueries.length}</Badge>\n                    )}\n                  </TabsTrigger>\n                  <TabsTrigger value=\"all\" className=\"flex items-center gap-1 md:gap-2 text-xs md:text-sm\">\n                    <MapPin className=\"h-3 w-3 md:h-4 md:w-4\" />\n                    <span>All</span>\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"unassigned\">\n                  <QueryList\n                    queries={unassignedQueries}\n                    mode=\"unassigned\"\n                    onAssignQuery={handleAssignQuery}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"assigned\">\n                  <QueryList\n                    queries={assignedQueries}\n                    mode=\"assigned\"\n                    onAssignQuery={handleAssignQuery}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"all\">\n                  <QueryList\n                    queries={allQueries}\n                    mode=\"all\"\n                    onAssignQuery={handleAssignQuery}\n                  />\n                </TabsContent>\n              </Tabs>\n            </CardContent>\n          </Card>\n\n          {/* Sidebar - Staff List removed as requested */}\n        </div>\n\n        {/* Assignment Rules and Staff Sequence - Mobile Stacked */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6\">\n          <AssignmentRules onEditRules={() => setEditRulesDialogOpen(true)} />\n          <StaffSequence staff={activeStaff} />\n        </div>\n      </div>\n\n      {/* Enhanced Assignment Dialog */}\n      <Dialog open={assignDialogOpen} onOpenChange={setAssignDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <User className=\"h-5 w-5\" />\n              {assigningQuery?.status === 'new' ? 'Assign Query' : 'Reassign Query'} {assigningQuery?.id}\n            </DialogTitle>\n            <DialogDescription>\n              Assign this query to the most suitable agent based on expertise and availability\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-6 py-4\">\n            {/* Query Information */}\n            {assigningQuery && (\n              <Card className=\"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    <MapPin className=\"h-4 w-4\" />\n                    Query Details\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">Destination</p>\n                      <p className=\"font-semibold\">{assigningQuery.destination.country}</p>\n                      <p className=\"text-sm text-muted-foreground\">{assigningQuery.destination.cities.join(', ')}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">PAX</p>\n                      <p className=\"font-semibold\">{assigningQuery.paxDetails.adults + assigningQuery.paxDetails.children}</p>\n                      <p className=\"text-sm text-muted-foreground\">{assigningQuery.paxDetails.adults}A, {assigningQuery.paxDetails.children}C</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">Duration</p>\n                      <p className=\"font-semibold\">{assigningQuery.tripDuration.days} Days</p>\n                      <p className=\"text-sm text-muted-foreground\">{assigningQuery.tripDuration.nights} Nights</p>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium text-muted-foreground\">Agent</p>\n                      <p className=\"font-semibold\">{assigningQuery.agentName}</p>\n                      <p className=\"text-sm text-muted-foreground\">ID: {assigningQuery.agentId}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Staff Selection */}\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-lg font-semibold\">Select Staff Member</h3>\n                {recommendedStaff && (\n                  <Badge variant=\"outline\" className=\"bg-green-50 text-green-700 border-green-200\">\n                    <Star className=\"h-3 w-3 mr-1\" />\n                    AI Recommendation Available\n                  </Badge>\n                )}\n              </div>\n              \n              <Select value={selectedStaffId?.toString()} onValueChange={(value) => setSelectedStaffId(parseInt(value))}>\n                <SelectTrigger className=\"w-full\">\n                  <SelectValue placeholder=\"Select a staff member\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {activeStaff.filter(s => s.active).map((member) => {\n                    const workloadStatus = getWorkloadStatus(member);\n                    const expertiseMatch = getExpertiseMatch(member, assigningQuery);\n                    const isSuperAdmin = (member.role || '').toLowerCase() === 'super_admin';\n                    const roleLabel = isSuperAdmin ? 'Super Admin' : (member.role || 'Staff').replace(/\\b\\w/g, (c) => c.toUpperCase());\n                    \n                    return (\n                      <SelectItem\n                        key={`staff-${member.id}`}\n                        value={member.id.toString()}\n                        disabled={isSuperAdmin}\n                        className={isSuperAdmin ? 'opacity-60 cursor-not-allowed' : ''}\n                      >\n                        <div className=\"flex items-center justify-between w-full\">\n                          <div className=\"flex items-center gap-2\">\n                            <Avatar className=\"h-6 w-6\">\n                              <AvatarFallback className=\"text-xs\">{member.name.charAt(0)}</AvatarFallback>\n                            </Avatar>\n                            <div>\n                              <span className=\"font-medium\">{member.name}</span>\n                              <Badge\n                                variant=\"outline\"\n                                className={`ml-2 text-xs ${\n                                  isSuperAdmin\n                                    ? 'bg-red-50 text-red-700 border-red-200'\n                                    : (member.role || '').toLowerCase() === 'manager'\n                                      ? 'bg-blue-50 text-blue-700 border-blue-200'\n                                      : 'bg-gray-50 text-gray-700 border-gray-200'\n                                }`}\n                              >\n                                {roleLabel}\n                              </Badge>\n                              <span className=\"text-xs text-muted-foreground ml-2\">\n                                {member.assigned}/{member.workloadCapacity} assigned\n                              </span>\n                            </div>\n                          </div>\n                          <div className=\"flex items-center gap-1\">\n                            {expertiseMatch > 0 && (\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                {expertiseMatch}% match\n                              </Badge>\n                            )}\n                            <div className={`w-2 h-2 rounded-full ${\n                              workloadStatus.status === 'available' ? 'bg-green-500' :\n                              workloadStatus.status === 'busy' ? 'bg-orange-500' : 'bg-red-500'\n                            }`} />\n                          </div>\n                        </div>\n                      </SelectItem>\n                    );\n                  })}\n                </SelectContent>\n              </Select>\n            </div>\n            \n            {/* AI Recommendation */}\n            {recommendedStaff && (\n              <Card className=\"border-green-200 bg-green-50 dark:bg-green-950/20 dark:border-green-800\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-base flex items-center gap-2 text-green-800 dark:text-green-200\">\n                    <Award className=\"h-4 w-4\" />\n                    AI Recommended Staff\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarFallback className=\"bg-green-500 text-white\">\n                          {recommendedStaff.name.charAt(0)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div>\n                        <p className=\"font-semibold text-green-800 dark:text-green-200\">{recommendedStaff.name}</p>\n                        <p className=\"text-sm text-green-600 dark:text-green-400\">{recommendedStaff.role}</p>\n                      </div>\n                    </div>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"border-green-300 text-green-700 hover:bg-green-100 dark:border-green-700 dark:text-green-300 dark:hover:bg-green-900/20\"\n                      onClick={() => setSelectedStaffId(recommendedStaff.id)}\n                      disabled={(recommendedStaff.role || '').toLowerCase() === 'super_admin'}\n                    >\n                      {(recommendedStaff.role || '').toLowerCase() === 'super_admin' ? 'Unavailable (Super Admin)' : 'Select Recommended'}\n                    </Button>\n                  </div>\n                  <div className=\"mt-3 flex flex-wrap gap-2\">\n                    <Badge variant=\"secondary\" className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\">\n                      {getExpertiseMatch(recommendedStaff, assigningQuery)}% Expertise Match\n                    </Badge>\n                    <Badge variant=\"secondary\" className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300\">\n                      {recommendedStaff.assigned}/{recommendedStaff.workloadCapacity} Workload\n                    </Badge>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n            \n            {/* Keep existing selected staff details section */}\n            {selectedStaff && (\n              <Card className=\"border-2 border-primary/20 bg-primary/5\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <User className=\"h-5 w-5\" />\n                    Selected Staff Details\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-start gap-4\">\n                    <Avatar className=\"h-16 w-16\">\n                      <AvatarFallback className=\"bg-primary text-primary-foreground text-xl\">\n                        {selectedStaff.name.charAt(0)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1\">\n                      <h4 className=\"text-xl font-semibold\">{selectedStaff.name}</h4>\n                      <p className=\"text-muted-foreground\">{selectedStaff.role}</p>\n                      <p className=\"text-sm text-muted-foreground mt-1\">{selectedStaff.email}</p>\n                    </div>\n                    <div className=\"text-right\">\n                      <Badge variant={selectedStaff.active ? \"default\" : \"secondary\"} className=\"mb-2\">\n                        {selectedStaff.active ? \"Active\" : \"Inactive\"}\n                      </Badge>\n                    </div>\n                  </div>\n\n                  <Separator />\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    {/* Workload Analysis */}\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm flex items-center gap-1\">\n                          <TrendingUp className=\"h-4 w-4\" />\n                          Workload Status\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span>Current Load</span>\n                            <span className=\"font-semibold\">{selectedStaff.assigned}/{selectedStaff.workloadCapacity}</span>\n                          </div>\n                          <Progress \n                            value={(selectedStaff.assigned / selectedStaff.workloadCapacity) * 100} \n                            className=\"h-2\"\n                          />\n                          <div className={`text-xs p-2 rounded-md ${getWorkloadStatus(selectedStaff).bgColor}`}>\n                            <span className={`font-medium ${getWorkloadStatus(selectedStaff).color}`}>\n                              {getWorkloadStatus(selectedStaff).status === 'available' ? 'Available for new assignments' :\n                               getWorkloadStatus(selectedStaff).status === 'busy' ? 'Approaching capacity' :\n                               'At maximum capacity'}\n                            </span>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    {/* Expertise Match */}\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm flex items-center gap-1\">\n                          <Star className=\"h-4 w-4\" />\n                          Expertise Match\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"space-y-2\">\n                          <div className=\"flex justify-between text-sm\">\n                            <span>Destination Match</span>\n                            <span className=\"font-semibold\">{getExpertiseMatch(selectedStaff, assigningQuery)}%</span>\n                          </div>\n                          <Progress \n                            value={getExpertiseMatch(selectedStaff, assigningQuery)} \n                            className=\"h-2\"\n                          />\n                          <div className=\"flex flex-wrap gap-1 mt-2\">\n                      {selectedStaff.expertise.slice(0, 3).map((exp, i) => (\n                        <Badge key={`expertise-${i}-${exp}`} variant=\"outline\" className=\"text-xs\">\n                          {toCountryName(exp)}\n                        </Badge>\n                      ))}\n                            {selectedStaff.expertise.length > 3 && (\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                +{selectedStaff.expertise.length - 3} more\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    {/* Assignment Info */}\n                    <Card>\n                      <CardHeader className=\"pb-2\">\n                        <CardTitle className=\"text-sm flex items-center gap-1\">\n                          <Clock className=\"h-4 w-4\" />\n                          Assignment Info\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"space-y-2 text-sm\">\n                          <div className=\"flex justify-between\">\n                            <span>Auto-assign</span>\n                            <span className={selectedStaff.autoAssignEnabled ? 'text-green-600' : 'text-red-600'}>\n                              {selectedStaff.autoAssignEnabled ? 'Enabled' : 'Disabled'}\n                            </span>\n                          </div>\n                          {selectedStaff.sequenceOrder && (\n                            <div className=\"flex justify-between\">\n                              <span>Priority Order</span>\n                              <Badge variant=\"secondary\" className=\"text-xs\">\n                                #{selectedStaff.sequenceOrder}\n                              </Badge>\n                            </div>\n                          )}\n                          <div className=\"flex justify-between\">\n                            <span>Department</span>\n                            <span className=\"text-muted-foreground\">{selectedStaff.department || 'General'}</span>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n\n                  {/* Assignment Impact */}\n                  <Card className=\"bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800\">\n                    <CardContent className=\"pt-4\">\n                      <div className=\"flex items-start gap-3\">\n                        <CheckCircle className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                        <div>\n                          <h5 className=\"font-medium text-blue-800 dark:text-blue-200\">Assignment Impact</h5>\n                          <ul className=\"text-sm text-blue-600 dark:text-blue-400 mt-1 space-y-1\">\n                            <li>• Workload will increase to {selectedStaff.assigned + 1}/{selectedStaff.workloadCapacity}</li>\n                            {getExpertiseMatch(selectedStaff, assigningQuery) > 50 && (\n                              <li>• High expertise match - likely faster processing</li>\n                            )}\n                            {selectedStaff.assigned < selectedStaff.workloadCapacity * 0.7 && (\n                              <li>• Staff member has good availability</li>\n                            )}\n                          </ul>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n\n                  {/* Warning for overloaded staff */}\n                  {getWorkloadStatus(selectedStaff).status === 'overloaded' && (\n                    <Card className=\"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800\">\n                      <CardContent className=\"pt-4\">\n                        <div className=\"flex items-start gap-3\">\n                          <AlertCircle className=\"h-5 w-5 text-red-600 mt-0.5\" />\n                          <div>\n                            <h5 className=\"font-medium text-red-800 dark:text-red-200\">Workload Warning</h5>\n                            <p className=\"text-sm text-red-600 dark:text-red-400 mt-1\">\n                              This staff member is at maximum capacity. Consider assigning to someone else or adjusting workload.\n                            </p>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            <DialogFooter className=\"gap-2\">\n              <Button variant=\"outline\" onClick={() => setAssignDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button \n                disabled={!selectedStaffId || isAssigning} \n                onClick={completeAssignment}\n                className=\"min-w-32\"\n              >\n                {isAssigning ? (\n                  <>\n                    <Clock className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Assigning...\n                  </>\n                ) : (\n                  <>\n                    <CheckCircle className=\"h-4 w-4 mr-2\" />\n                    {assigningQuery?.status === 'new' ? 'Assign Query' : 'Reassign Query'}\n                  </>\n                )}\n              </Button>\n            </DialogFooter>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Rules Dialog - Full CRUD editor connected to Supabase */}\n      <Dialog open={editRulesDialogOpen} onOpenChange={setEditRulesDialogOpen}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Edit Assignment Rules</DialogTitle>\n            <DialogDescription>\n              Configure rules for automatic query assignment based on various criteria\n            </DialogDescription>\n          </DialogHeader>\n          <AssignmentRulesEditor onClose={() => setEditRulesDialogOpen(false)} />\n        </DialogContent>\n      </Dialog>\n    </PageLayout>\n  );\n};\n\nexport default AssignQueries;\n","\nimport { useState, useEffect } from 'react';\nimport { Hotel } from '@/components/inventory/hotels/types/hotel';\nimport { sightseeingData } from '@/pages/inventory/sightseeing/data/initialData';\nimport { Sightseeing } from '@/types/sightseeing';\nimport { Restaurant } from '@/pages/inventory/restaurants/types/restaurantTypes';\nimport { initialRestaurants } from '@/pages/inventory/restaurants/data/restaurantData';\nimport { TransportRoute } from '@/pages/queries/types/proposalTypes';\nimport { transportRoutes } from '@/pages/inventory/transport/data/transportData';\nimport { CitiesService, CityRow } from '@/services/citiesService';\nimport { CountriesService, CountryRow } from '@/services/countriesService';\nimport { listTransportRoutes, mapRouteRowToProposalRoute } from '@/services/transportRoutesService';\n\n// Function to get sightseeing data from localStorage with real-time updates\nconst getSavedSightseeingData = (): Sightseeing[] => {\n  try {\n    const data = localStorage.getItem('sightseeingData');\n    return data ? JSON.parse(data) : sightseeingData;\n  } catch (error) {\n    console.error('Error getting sightseeing data from localStorage:', error);\n    return sightseeingData;\n  }\n};\n\n// Function to get hotel data from localStorage with real-time updates\nconst getSavedHotelData = (): Hotel[] => {\n  try {\n    const data = localStorage.getItem('savedHotels');\n    return data ? JSON.parse(data) : [];\n  } catch (error) {\n    console.error('Error getting hotel data from localStorage:', error);\n    return [];\n  }\n};\n\n// Function to get restaurant data from localStorage with real-time updates\nconst getSavedRestaurantData = (): Restaurant[] => {\n  try {\n    const data = localStorage.getItem('savedRestaurants');\n    if (data) {\n      return JSON.parse(data);\n    }\n    // Adapt initial restaurant data if no saved data\n    return initialRestaurants.map(restaurant => ({\n      ...restaurant,\n      id: restaurant.id,\n      vegOptions: restaurant.dietaryOptions?.vegetarian || false,\n      currencyCode: restaurant.currencySymbol ? (restaurant.currencySymbol === '$' ? 'USD' : 'THB') : 'USD'\n    })) as Restaurant[];\n  } catch (error) {\n    console.error('Error getting restaurant data from localStorage:', error);\n    return initialRestaurants.map(restaurant => ({\n      ...restaurant,\n      id: restaurant.id,\n      vegOptions: restaurant.dietaryOptions?.vegetarian || false,\n      currencyCode: restaurant.currencySymbol ? (restaurant.currencySymbol === '$' ? 'USD' : 'THB') : 'USD'\n    })) as Restaurant[];\n  }\n};\n\n// Function to get transport data from localStorage with real-time updates\nconst getSavedTransportData = (): TransportRoute[] => {\n  try {\n    const data = localStorage.getItem('savedTransportRoutes');\n    if (data) {\n      return JSON.parse(data);\n    }\n    // Use all transport routes, not just first 10\n    return transportRoutes.map(route => ({\n      id: String(route.id),\n      from: route.from || '',\n      to: route.to || '',\n      distance: route.distance || 0,\n      duration: route.duration || '1h',\n      transportType: route.transportType || 'Car',\n      price: route.price || 0,\n      name: route.name || `${route.from || ''} to ${route.to || ''}`,\n      country: route.country || 'Thailand'\n    })) as TransportRoute[];\n  } catch (error) {\n    console.error('Error getting transport data from localStorage:', error);\n    return transportRoutes.map(route => ({\n      id: String(route.id),\n      from: route.from || '',\n      to: route.to || '',\n      distance: route.distance || 0,\n      duration: route.duration || '1h',\n      transportType: route.transportType || 'Car',\n      price: route.price || 0,\n      name: route.name || `${route.from || ''} to ${route.to || ''}`,\n      country: route.country || 'Thailand'\n    })) as TransportRoute[];\n  }\n};\n\n// Define the return type for the hook\ninterface InventoryData {\n  hotels: Hotel[];\n  restaurants: Restaurant[];\n  sightseeing: Sightseeing[];\n  transportRoutes: TransportRoute[];\n  cities: CityRow[];\n  countries: CountryRow[];\n  currency: string;\n  currencySymbol: string;\n  refreshData: () => void;\n  loading: boolean;\n}\n\nexport const useInventoryData = (): InventoryData => {\n  const [data, setData] = useState<InventoryData>({\n    hotels: [],\n    restaurants: [],\n    sightseeing: [],\n    transportRoutes: [],\n    cities: [],\n    countries: [],\n    currency: 'USD',\n    currencySymbol: '$',\n    refreshData: () => {},\n    loading: true\n  });\n\n  const [loading, setLoading] = useState(true);\n\n  const loadData = async () => {\n    setLoading(true);\n    try {\n      // Load real-time data from localStorage and fallback to initial data\n      const hotelData = getSavedHotelData();\n      const sightseeingDataFromStorage = getSavedSightseeingData();\n      const restaurantData = getSavedRestaurantData();\n      // Try remote transport routes first, fallback to local if unavailable\n      let transportData: TransportRoute[] = [];\n      try {\n        const rows = await listTransportRoutes();\n        transportData = rows.map(mapRouteRowToProposalRoute);\n      } catch (err) {\n        console.warn('Falling back to local transport routes due to remote error:', err);\n        transportData = getSavedTransportData();\n      }\n\n      // Use only Supabase data - no fallback to mock data\n      let finalHotelData = hotelData;\n\n      // Process sightseeing data to ensure proper typing\n      const processedSightseeingData = sightseeingDataFromStorage.map(item => {\n        const typedItem: Sightseeing = {\n          ...item,\n          price: item.price === undefined ? { adult: 0, child: 0 } : \n                 typeof item.price === 'number' ? { adult: item.price, child: item.price / 2 } : \n                 item.price\n        };\n        return typedItem;\n      });\n\n      // Load cities and countries from new services\n      let citiesData: CityRow[] = [];\n      let countriesData: CountryRow[] = [];\n\n      try {\n        const citiesResponse = await CitiesService.getAllCities();\n        if (citiesResponse.success && citiesResponse.data && Array.isArray(citiesResponse.data)) {\n          citiesData = citiesResponse.data;\n        }\n      } catch (error) {\n        console.error(\"Error loading cities data:\", error);\n      }\n\n      try {\n        const countriesResponse = await CountriesService.getAllCountries();\n        if (countriesResponse.success && countriesResponse.data && Array.isArray(countriesResponse.data)) {\n          countriesData = countriesResponse.data;\n        }\n      } catch (error) {\n        console.error(\"Error loading countries data:\", error);\n      }\n\n      setData(prevData => ({\n        ...prevData,\n        hotels: finalHotelData,\n        restaurants: restaurantData,\n        sightseeing: processedSightseeingData,\n        transportRoutes: transportData,\n        cities: citiesData,\n        countries: countriesData,\n        loading: false\n      }));\n\n      console.log('Inventory data loaded:', {\n        hotels: finalHotelData.length,\n        restaurants: restaurantData.length,\n        sightseeing: processedSightseeingData.length,\n        transportRoutes: transportData.length,\n        cities: citiesData.length,\n        countries: countriesData.length\n      });\n\n    } catch (error) {\n      console.error(\"Error loading inventory data:\", error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const refreshData = () => {\n    loadData();\n  };\n\n  useEffect(() => {\n    loadData();\n\n    // Listen for localStorage changes to update data in real-time\n    const handleStorageChange = (e: StorageEvent) => {\n      if (e.key === 'savedHotels' || \n          e.key === 'sightseeingData' || \n          e.key === 'savedRestaurants' || \n          e.key === 'savedTransportRoutes') {\n        console.log('Storage changed, refreshing inventory data');\n        loadData();\n      }\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, []);\n\n  return {\n    ...data,\n    refreshData,\n    loading\n  };\n};\n","\nimport React, { useMemo, useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Check, ChevronDown, User, MapPin, TrendingUp } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useSupabaseAgentsList } from \"@/hooks/useSupabaseAgentsList\";\nimport { toNumericAgentId } from \"@/utils/supabaseAgentIds\";\n\ninterface AgentSelectorProps {\n  value: string;\n  onValueChange: (value: string) => void;\n  placeholder?: string;\n  countryFilter?: string;\n  cityFilter?: string;\n  queryId?: string;\n}\n\nexport const AgentSelector: React.FC<AgentSelectorProps> = ({\n  value,\n  onValueChange,\n  placeholder = \"Search and select agent...\",\n  countryFilter,\n  cityFilter,\n  queryId\n}) => {\n  const [open, setOpen] = useState(false);\n  const { agents, loading, error } = useSupabaseAgentsList();\n\n  // Filter agents based on location filters (Supabase-backed)\n  const filteredAgents = useMemo(() => {\n    let list = agents;\n    if (countryFilter) {\n      const cf = countryFilter.toLowerCase();\n      const byCountry = list.filter(a => (a.country || '').toLowerCase() === cf);\n      if (byCountry.length > 0) list = byCountry;\n    }\n    if (cityFilter) {\n      const ct = cityFilter.toLowerCase();\n      const byCity = list.filter(a => (a.city || '').toLowerCase() === ct);\n      if (byCity.length > 0) list = byCity;\n    }\n    return list;\n  }, [agents, countryFilter, cityFilter]);\n\n  // Supabase stats are not yet populated; provide simple top suggestions\n  const highPerformers = useMemo(() => filteredAgents.slice(0, 3), [filteredAgents]);\n\n  const selectedAgent = useMemo(() => {\n    const numeric = Number.parseInt(value || '');\n    return filteredAgents.find(a => toNumericAgentId(a.id) === numeric);\n  }, [filteredAgents, value]);\n\n  const renderAgentItem = (agent: { id: string; name: string; email?: string; city?: string; country?: string; agencyName?: string; stats?: any }) => (\n    <div className=\"flex flex-col gap-1\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"font-medium\">{agent.name}</span>\n        {agent.agencyName && (\n          <Badge variant=\"outline\" className=\"text-xs ml-2\">\n            {agent.agencyName}\n          </Badge>\n        )}\n        {agent?.stats?.conversionRate > 20 && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            <TrendingUp className=\"h-3 w-3 mr-1\" />\n            Top Performer\n          </Badge>\n        )}\n      </div>\n      <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n        {agent.email && <span>{agent.email}</span>}\n        {agent.email && <span>•</span>}\n        <div className=\"flex items-center gap-1\">\n          <MapPin className=\"h-3 w-3\" />\n          <span>{agent.city || 'Unknown'}, {agent.country || 'Unknown'}</span>\n        </div>\n      </div>\n      {agent?.stats && (\n        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n          <span>Conversion: {agent.stats.conversionRate}%</span>\n          <span>•</span>\n          <span>Bookings: {agent.stats.totalBookings}</span>\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          role=\"combobox\"\n          aria-expanded={open}\n          className={cn(\n            \"w-full justify-between\",\n            !value && \"text-muted-foreground\"\n          )}\n        >\n          <div className=\"flex items-center gap-2\">\n            <User className=\"h-4 w-4\" />\n            {selectedAgent ? (\n              <div className=\"flex items-center gap-2\">\n                <span>{selectedAgent.name}</span>\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {selectedAgent.city}\n                </Badge>\n              </div>\n            ) : (\n              placeholder\n            )}\n          </div>\n          <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-full p-0\" align=\"start\">\n        <Command>\n          <CommandInput placeholder=\"Search agents...\" />\n          <CommandList>\n            <CommandEmpty>\n              {loading ? \"Loading agents...\" : error ? \"Failed to load agents.\" : \"No agent found.\"}\n            </CommandEmpty>\n            \n            {highPerformers.length > 0 && (\n              <CommandGroup heading=\"Recommended\">\n                {highPerformers.map((agent) => (\n                  <CommandItem\n                    key={agent.id}\n                    value={agent.name}\n                    onSelect={() => {\n                      const numId = toNumericAgentId(agent.id);\n                      onValueChange(numId.toString());\n                      setOpen(false);\n                    }}\n                  >\n                    <Check\n                      className={cn(\n                        \"mr-2 h-4 w-4\",\n                        Number.parseInt(value || '') === toNumericAgentId(agent.id)\n                          ? \"opacity-100\"\n                          : \"opacity-0\"\n                      )}\n                    />\n                    {renderAgentItem(agent)}\n                  </CommandItem>\n                ))}\n              </CommandGroup>\n            )}\n\n            <CommandGroup heading=\"All Agents\">\n              {filteredAgents.map((agent) => (\n                <CommandItem\n                  key={agent.id}\n                  value={agent.name}\n                  onSelect={() => {\n                    const numId = toNumericAgentId(agent.id);\n                    onValueChange(numId.toString());\n                    setOpen(false);\n                  }}\n                >\n                  <Check\n                    className={cn(\n                      \"mr-2 h-4 w-4\",\n                      Number.parseInt(value || '') === toNumericAgentId(agent.id)\n                        ? \"opacity-100\"\n                        : \"opacity-0\"\n                    )}\n                  />\n                  {renderAgentItem(agent)}\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          </CommandList>\n        </Command>\n      </PopoverContent>\n    </Popover>\n  );\n};\n","\nimport React from 'react';\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useCitiesData } from '@/hooks/useCitiesData';\nimport { CityAllocation } from '@/hooks/useOptionalCities';\nimport { Switch } from \"@/components/ui/switch\";\n\ninterface CityCheckboxSelectorProps {\n  country: string;\n  selectedCities: string[];\n  onCitiesChange: (cities: string[]) => void;\n  cityAllocations?: CityAllocation[];\n  onCityAllocationsChange?: (allocations: CityAllocation[]) => void;\n  isOptionalEnabled?: boolean;\n  onOptionalToggle?: (enabled: boolean) => void;\n  cityOptionalFlags?: Record<string, boolean>;\n  onCityOptionalChange?: (cityName: string, optional: boolean) => void;\n}\n\nexport const CityCheckboxSelector: React.FC<CityCheckboxSelectorProps> = ({\n  country,\n  selectedCities,\n  onCitiesChange,\n  cityAllocations = [],\n  onCityAllocationsChange,\n  isOptionalEnabled = false,\n  onOptionalToggle,\n  cityOptionalFlags,\n  onCityOptionalChange\n}) => {\n  const { getCitiesByCountry } = useCitiesData();\n  const availableCities = country ? getCitiesByCountry(country) : [];\n  const [optionalCities, setOptionalCities] = React.useState<Set<string>>(new Set());\n\n  const handleCityToggle = (cityName: string, checked: boolean) => {\n    if (checked) {\n      onCitiesChange([...selectedCities, cityName]);\n    } else {\n      onCitiesChange(selectedCities.filter(city => city !== cityName));\n      // Remove allocation when city is deselected\n      if (onCityAllocationsChange) {\n        onCityAllocationsChange(cityAllocations.filter(alloc => alloc.cityId !== cityName));\n      }\n    }\n  };\n\n  const handleAllocationChange = (cityName: string, allocation: number) => {\n    if (onCityAllocationsChange) {\n      const existingIndex = cityAllocations.findIndex(alloc => alloc.cityId === cityName);\n      if (existingIndex >= 0) {\n        const updated = [...cityAllocations];\n        updated[existingIndex] = { cityId: cityName, allocation };\n        onCityAllocationsChange(updated);\n      } else {\n        onCityAllocationsChange([...cityAllocations, { cityId: cityName, allocation }]);\n      }\n    }\n  };\n\n  const getCityAllocation = (cityName: string): number => {\n    const allocation = cityAllocations.find(alloc => alloc.cityId === cityName);\n    return allocation?.allocation || 0;\n  };\n\n  const handleCityOptionalToggle = (cityName: string, optional: boolean) => {\n    if (onCityOptionalChange) {\n      onCityOptionalChange(cityName, optional);\n      return;\n    }\n    const newOptionalCities = new Set(optionalCities);\n    if (optional) {\n      newOptionalCities.add(cityName);\n    } else {\n      newOptionalCities.delete(cityName);\n    }\n    setOptionalCities(newOptionalCities);\n  };\n\n  const isCityOptional = (cityName: string): boolean => {\n    if (cityOptionalFlags && cityName in cityOptionalFlags) {\n      return !!cityOptionalFlags[cityName];\n    }\n    return optionalCities.has(cityName);\n  };\n\n  if (!country) {\n    return null;\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <Label className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n        Cities to Visit\n      </Label>\n      \n\n      \n      {availableCities.length > 0 ? (\n        <div className=\"grid grid-cols-2 gap-4 max-h-64 overflow-y-auto p-4 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900/50\">\n          {availableCities.map((city) => {\n            const isSelected = selectedCities.includes(city.name);\n            const isOptional = isCityOptional(city.name);\n            \n            return (\n              <div key={city.id} className=\"flex items-center justify-between space-x-3 p-2 rounded-md hover:bg-white dark:hover:bg-gray-800 transition-colors\">\n                <div className=\"flex items-center space-x-3\">\n                  <Checkbox\n                    id={`city-${city.id}`}\n                    checked={isSelected}\n                    onCheckedChange={(checked) => handleCityToggle(city.name, checked as boolean)}\n                    className=\"border-gray-400 dark:border-gray-500\"\n                  />\n                  <Label \n                    htmlFor={`city-${city.id}`} \n                    className={`text-sm font-medium cursor-pointer ${\n                      isSelected \n                        ? isOptional \n                          ? 'text-blue-600 dark:text-blue-400' \n                          : 'text-gray-700 dark:text-gray-300'\n                        : 'text-gray-500 dark:text-gray-400'\n                    }`}\n                  >\n                    {city.name}\n                  </Label>\n                </div>\n                {isSelected && (\n                  <div className=\"flex items-center space-x-1\">\n                    <Switch\n                      id={`optional-${city.id}`}\n                      checked={isOptional}\n                      onCheckedChange={(checked) => handleCityOptionalToggle(city.name, checked as boolean)}\n                      className=\"scale-75\"\n                    />\n                    <Label \n                      htmlFor={`optional-${city.id}`} \n                      className=\"text-xs text-gray-500 dark:text-gray-400 cursor-pointer\"\n                    >\n                      Optional\n                    </Label>\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      ) : (\n        <div className=\"p-4 text-center text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900/50\">\n          No cities available for {country}\n        </div>\n      )}\n      \n      {selectedCities.length > 0 && (\n        <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n          Selected: {selectedCities.length} {selectedCities.length === 1 ? 'city' : 'cities'}\n\n        </div>\n      )}\n    </div>\n  );\n};\n","\nimport React, { useState } from 'react';\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useCitiesData } from '@/hooks/useCitiesData';\nimport { CityCheckboxSelector } from './CityCheckboxSelector';\nimport { CityAllocation } from '@/hooks/useOptionalCities';\n\ninterface CountryCitySelectorProps {\n  destination: {\n    country: string;\n    cities: string[];\n  };\n  onDestinationChange: (destination: { country: string; cities: string[] }) => void;\n  cityAllocations?: CityAllocation[];\n  onCityAllocationsChange?: (allocations: CityAllocation[]) => void;\n  isOptionalEnabled?: boolean;\n  onOptionalToggle?: (enabled: boolean) => void;\n  cityOptionalFlags?: Record<string, boolean>;\n  onCityOptionalChange?: (cityName: string, optional: boolean) => void;\n}\n\nexport const CountryCitySelector: React.FC<CountryCitySelectorProps> = ({\n  destination,\n  onDestinationChange,\n  cityAllocations,\n  onCityAllocationsChange,\n  isOptionalEnabled,\n  onOptionalToggle,\n  cityOptionalFlags,\n  onCityOptionalChange\n}) => {\n  const { getActiveCountries } = useCitiesData();\n  const activeCountries = getActiveCountries();\n\n  const handleCountryChange = (country: string) => {\n    onDestinationChange({\n      country,\n      cities: []\n    });\n  };\n\n  const handleCitiesChange = (cities: string[]) => {\n    onDestinationChange({\n      ...destination,\n      cities\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"country\" className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">\n          Destination Country *\n        </Label>\n        <Select value={destination.country} onValueChange={handleCountryChange}>\n          <SelectTrigger className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\">\n            <SelectValue placeholder=\"Select destination country\" />\n          </SelectTrigger>\n          <SelectContent className=\"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\">\n            {activeCountries.map((country) => (\n              <SelectItem key={country.id} value={country.name}>\n                {country.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n      \n      {destination.country && (\n        <CityCheckboxSelector\n          country={destination.country}\n          selectedCities={destination.cities}\n          onCitiesChange={handleCitiesChange}\n          cityAllocations={cityAllocations}\n          onCityAllocationsChange={onCityAllocationsChange}\n          isOptionalEnabled={isOptionalEnabled}\n          onOptionalToggle={onOptionalToggle}\n          cityOptionalFlags={cityOptionalFlags}\n          onCityOptionalChange={onCityOptionalChange}\n        />\n      )}\n    </div>\n  );\n};\n","\nimport React from 'react';\nimport { useParams } from 'react-router-dom';\nimport PageLayout from '@/components/layout/PageLayout';\nimport BreadcrumbNav from '@/components/navigation/BreadcrumbNav';\nimport EnquiryForm from '@/components/queries/EnquiryForm';\n\nconst EditQuery: React.FC = () => {\n  const { id: encodedId } = useParams<{ id: string }>();\n  const id = encodedId ? decodeURIComponent(encodedId) : undefined;\n\n  return (\n    <PageLayout>\n      <BreadcrumbNav \n        customPaths={{\n          [id!]: `Edit Query ${id}`\n        }}\n      />\n      <EnquiryForm mode=\"edit\" enquiryId={id} />\n    </PageLayout>\n  );\n};\n\nexport default EditQuery;\n","\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\n\n// UUID validation regex - shared across the component\nconst UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { ArrowLeft, Save, Send, Eye, Plus, Clock, CheckCircle, AlertCircle, Calendar, MapPin, Users, Shield } from 'lucide-react';\nimport PageLayout from '@/components/layout/PageLayout';\nimport { Query } from '@/types/query';\nimport ProposalService from '@/services/proposalService';\nimport { useToast } from '@/hooks/use-toast';\nimport { EnhancedDayPlanningInterface } from '@/components/proposal/EnhancedDayPlanningInterface';\nimport { ProposalSummaryView } from '@/components/proposal/ProposalSummaryView';\nimport { useProposalBuilder } from '@/hooks/useProposalBuilder';\nimport { calculateTripDuration, getCurrencyByCountry, formatCurrency } from '@/utils/currencyUtils';\nimport { SmartSuggestion } from '@/hooks/useSmartSuggestions';\nimport { DayByDayItineraryBuilder } from '@/components/proposal/DayByDayItineraryBuilder';\nimport ProposalManagement from '@/components/enquiry/ProposalManagement';\nimport { ItineraryDay as CoreItineraryDay, ItineraryActivity as CoreItineraryActivity } from '@/types/itinerary';\nimport { ItineraryDay as BuilderItineraryDay } from '@/components/proposal/DayByDayItineraryBuilder';\nimport { cn } from '@/lib/utils';\nimport EnhancedValidationDialog from '@/components/proposal/validation/EnhancedValidationDialog';\nimport GenerationProgressDialog from '@/components/proposal/enhanced/GenerationProgressDialog';\nimport { useProposalValidation } from '@/hooks/useProposalValidation';\nimport { useProposalGeneration } from '@/hooks/useProposalGeneration';\nimport { TabErrorBoundary } from '@/components/common/TabErrorBoundary';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { createWorkflowEvent } from '@/services/workflowEventsService';\nimport { OptionalRecords } from '@/types/optionalRecords';\nimport { supabase } from '@/lib/supabaseClient';\n\n// Activity type mapping functions - fixed to handle the correct type mappings\nconst mapBuilderActivityTypeToCore = (builderType: 'sightseeing' | 'transport' | 'meal' | 'accommodation' | 'activity'): CoreItineraryActivity['type'] => {\n  switch (builderType) {\n    case 'sightseeing':\n      return 'sightseeing';\n    case 'transport':\n      return 'sightseeing'; // Map transport to sightseeing as fallback\n    case 'meal':\n      return 'dining';\n    case 'accommodation':\n      return 'relaxation'; // Map accommodation to relaxation as fallback\n    case 'activity':\n    default:\n      return 'adventure'; // Map generic activity to adventure\n  }\n};\n\nconst mapCoreActivityTypeToBuilder = (coreType: CoreItineraryActivity['type']): 'sightseeing' | 'transport' | 'meal' | 'accommodation' | 'activity' => {\n  switch (coreType) {\n    case 'sightseeing':\n      return 'sightseeing';\n    case 'dining':\n      return 'meal';\n    case 'adventure':\n    case 'cultural':\n    case 'relaxation':\n    default:\n      return 'activity'; // Map adventure, cultural, relaxation to generic activity\n  }\n};\n\n// Enhanced conversion functions with better type handling\nconst convertItineraryDayToProposalDay = (day: any) => ({\n  ...day,\n  activities: day.activities?.map((activity: any) => ({\n    id: activity.id,\n    name: activity.name,\n    price: activity.cost || activity.price || 0,\n    duration: activity.duration,\n    description: activity.description || '',\n    type: activity.type || 'activity',\n    category: activity.category || 'afternoon',\n    location: activity.location || '',\n    timeSlot: activity.timeSlot || '1:00 PM - 5:00 PM',\n    popularity: activity.popularity || 75,\n    seasonalScore: activity.seasonalScore || 50,\n    budgetFit: activity.budgetFit || 50,\n    travelerTypeScore: activity.travelerTypeScore || 50,\n    data: activity.data || activity\n  })) || []\n});\n\n// Convert between different ItineraryDay types with proper type mapping\nconst convertCoreToBuilder = (coreDays: CoreItineraryDay[]): BuilderItineraryDay[] => {\n  return coreDays.map(day => ({\n    id: day.id,\n    dayNumber: day.day || 1,\n    title: `Day ${day.day || 1}`,\n    city: day.location?.city || '',\n    description: day.notes || '',\n    date: day.date,\n    activities: day.activities?.map(activity => ({\n      id: activity.id,\n      name: activity.name,\n      description: activity.description || '',\n      duration: activity.duration,\n      cost: activity.price,\n      type: mapCoreActivityTypeToBuilder(activity.type)\n    })) || [],\n    transport: day.transport?.map(transport => ({\n      id: transport.id,\n      name: `${transport.from.name} to ${transport.to.name}`,\n      from: transport.from.name,\n      to: transport.to.name,\n      price: transport.price,\n      type: transport.type\n    })) || [],\n    accommodations: day.accommodation ? [{\n      id: day.accommodation.id,\n      name: day.accommodation.name,\n      type: day.accommodation.type,\n      price: day.accommodation.price,\n      hotel: day.accommodation.name,\n      roomType: day.accommodation.roomType\n    }] : [],\n    meals: {\n      breakfast: day.meals?.some(meal => meal.type === 'breakfast') || false,\n      lunch: day.meals?.some(meal => meal.type === 'lunch') || false,\n      dinner: day.meals?.some(meal => meal.type === 'dinner') || false\n    },\n    totalCost: day.totalCost\n  }));\n};\n\nconst convertBuilderToCore = (builderDays: BuilderItineraryDay[]): CoreItineraryDay[] => {\n  return builderDays.map(day => ({\n    id: day.id,\n    day: day.dayNumber,\n    date: day.date,\n    location: {\n      id: `loc_${day.city}`,\n      name: day.city,\n      country: '',\n      city: day.city\n    },\n    accommodation: day.accommodations?.[0] ? {\n      id: day.accommodations[0].id,\n      name: day.accommodations[0].name,\n      type: day.accommodations[0].type as 'hotel' | 'resort' | 'guesthouse' | 'apartment',\n      location: {\n        id: `loc_${day.city}`,\n        name: day.city,\n        country: '',\n        city: day.city\n      },\n      checkIn: day.date,\n      checkOut: day.date,\n      nights: 1,\n      roomType: day.accommodations[0].roomType || 'Standard Room',\n      price: day.accommodations[0].price,\n      starRating: 3,\n      amenities: []\n    } : undefined,\n    transport: day.transport?.map(transport => ({\n      id: transport.id,\n      type: transport.type as 'flight' | 'car' | 'bus' | 'train' | 'boat',\n      from: {\n        id: `loc_${transport.from}`,\n        name: transport.from,\n        country: '',\n        city: transport.from\n      },\n      to: {\n        id: `loc_${transport.to}`,\n        name: transport.to,\n        country: '',\n        city: transport.to\n      },\n      duration: '2 hours',\n      price: transport.price,\n      details: ''\n    })) || [],\n    activities: day.activities?.map(activity => ({\n      id: activity.id,\n      name: activity.name,\n      type: mapBuilderActivityTypeToCore(activity.type),\n      location: {\n        id: `loc_${day.city}`,\n        name: day.city,\n        country: '',\n        city: day.city\n      },\n      startTime: '09:00',\n      endTime: '17:00',\n      duration: activity.duration,\n      price: activity.cost,\n      description: activity.description,\n      inclusions: []\n    })) || [],\n    meals: [],\n    totalCost: day.totalCost,\n    notes: day.description\n  }));\n};\n\nconst AdvancedProposalCreation: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  \n  const [query, setQuery] = useState<Query | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [activeView, setActiveView] = useState<'planning' | 'summary'>('planning');\n  \n  // Initialize activeTab from URL parameters\n  const urlParams = new URLSearchParams(window.location.search);\n  const initialTab = urlParams.get('tab') || 'itinerary';\n  const [activeTab, setActiveTab] = useState<'itinerary' | 'proposal'>(initialTab as 'itinerary' | 'proposal');\n  \n  const [itineraryData, setItineraryData] = useState<BuilderItineraryDay[]>([]);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [optionalRecords, setOptionalRecords] = useState<OptionalRecords>({});\n  \n  const [hasShownDraftLoadedToast, setHasShownDraftLoadedToast] = useState(false);\n  const [actionLoading, setActionLoading] = useState<string | null>(null);\n  const [showValidationDialog, setShowValidationDialog] = useState(false);\n  const [showProgressDialog, setShowProgressDialog] = useState(false);\n  const [skippedRules, setSkippedRules] = useState<string[]>([]);\n  const recentLogsRef = useRef<Map<string, number>>(new Map());\n  const [isTabSwitching, setIsTabSwitching] = useState(false);\n\n  // Log tab engagement whenever active tab changes (including initial mount)\n  useEffect(() => {\n    if (!query?.id) return;\n    try {\n      const tabLabel = activeTab === 'itinerary' ? 'Day Wise Itinerary' : 'Proposal Management';\n      const key = `ui_engagement:tab_view:${query.id}:${activeTab}`;\n      const now = Date.now();\n      const last = recentLogsRef.current.get(key);\n      // Guard against duplicate logs (e.g., React StrictMode double-invokes effects in dev)\n      if (last && now - last < 1000) return;\n      recentLogsRef.current.set(key, now);\n      void createWorkflowEvent({\n        enquiryBusinessId: query.id,\n        eventType: 'ui_engagement',\n        userId: user?.id || null,\n        userName: user?.name || null,\n        userRole: user?.role || null,\n        details: `Tab viewed: ${tabLabel}`,\n        metadata: {\n          action: 'tab_view',\n          tab: activeTab,\n          source: 'AdvancedProposalCreation'\n        }\n      });\n    } catch (e) {\n      console.warn('Failed to log tab engagement:', e);\n    }\n  }, [activeTab, query?.id]);\n\n  // Sync optional records to proposal when they change\n  useEffect(() => {\n    const syncOptionalRecords = async () => {\n      if (!query?.id || Object.keys(optionalRecords).length === 0) return;\n\n      try {\n        // Determine if query.id is a UUID or enquiry ID\n        const isUuid = UUID_REGEX.test(query.id);\n        \n        let updateQuery = supabase\n          .from('proposals')\n          .update({\n            optional_records: optionalRecords,\n            last_saved: new Date().toISOString()\n          });\n\n        // Use appropriate field based on ID format\n        if (isUuid) {\n          updateQuery = updateQuery.eq('id', query.id);\n        } else {\n          updateQuery = updateQuery.eq('proposal_id', query.id);\n        }\n\n        const { error } = await updateQuery;\n\n        if (error) throw error;\n        console.log('Optional records synced to proposal successfully');\n      } catch (error) {\n        console.error('Error syncing optional records to proposal:', error);\n      }\n    };\n\n    // Debounce the sync to avoid too many API calls\n    const timeoutId = setTimeout(syncOptionalRecords, 1000);\n    return () => clearTimeout(timeoutId);\n  }, [optionalRecords, query?.id]);\n\n  // Enhanced useProposalBuilder with URL parameter support\n  const {\n    days,\n    totalCost,\n    addDay,\n    updateDay,\n    removeDay,\n    saveDraft,\n    generateProposal,\n    loading: proposalLoading\n  } = useProposalBuilder(query?.id, {\n    draftType: urlParams.get('draftType') as 'daywise' | 'enhanced' || 'daywise',\n    autoLoadDraft: urlParams.get('loadDraft') === 'true',\n    initialTab: initialTab\n  });\n\n  // Get proposal management data for validation\n  const [proposalManagementData, setProposalManagementData] = useState<any>(null);\n  \n  // Load proposal management data when needed for validation\n  const loadProposalManagementData = useCallback(() => {\n    if (!query?.id) return null;\n    \n    try {\n      // Load persistent proposal data from storage\n      const persistentDataKey = `proposal_persistence_${query.id}`;\n      const savedData = localStorage.getItem(persistentDataKey);\n      \n      if (savedData) {\n        const parsedData = JSON.parse(savedData);\n        return {\n          termsConditions: parsedData.termsConditions || {},\n          emailData: parsedData.emailData || {},\n          pricingConfig: parsedData.pricingConfig || {},\n          hasProposalManagementData: Object.keys(parsedData).some(key => \n            parsedData[key] && typeof parsedData[key] === 'object' && Object.keys(parsedData[key]).length > 0\n          )\n        };\n      }\n    } catch (error) {\n      console.error('Error loading proposal management data:', error);\n    }\n    \n    return null;\n  }, [query?.id]);\n\n  // Update proposal management data when tab changes or component mounts\n  useEffect(() => {\n    const managementData = loadProposalManagementData();\n    setProposalManagementData(managementData);\n  }, [loadProposalManagementData, activeTab]);\n\n  // Validation for proposal generation - includes both itinerary and proposal management data\n  const { validationRules, hasErrors, isValid } = useProposalValidation({\n    query: query,\n    days: itineraryData,\n    totalCost,\n    skippedRules,\n    proposalManagementData\n  });\n\n  // Enhanced proposal generation with progress\n  const {\n    isGenerating,\n    currentProgress,\n    generationSteps,\n    handleGenerateWithProgress,\n    resetGeneration\n  } = useProposalGeneration({ generateProposal });\n\n  // Calculate trip duration automatically\n  const tripDuration = query ? calculateTripDuration(query.travelDates.from, query.travelDates.to) : null;\n  const currencyInfo = query ? getCurrencyByCountry(query.destination.country) : null;\n\n  // Load saved itinerary data without auto-save\n  const loadSavedItineraryData = useCallback((): { data: BuilderItineraryDay[], hasSavedData: boolean } => {\n    if (!query?.id) return { data: [], hasSavedData: false };\n    \n    try {\n      const saveKey = `itinerary_builder_${query.id}`;\n      const saved = localStorage.getItem(saveKey);\n      \n      if (saved) {\n        const parsedData = JSON.parse(saved);\n        if (parsedData.queryId === query.id && parsedData.data && parsedData.data.length > 0) {\n          setLastSaved(new Date(parsedData.lastSaved));\n          console.log('Loaded saved itinerary data:', parsedData.data.length, 'days');\n          return { data: parsedData.data, hasSavedData: true };\n        }\n      }\n    } catch (error) {\n      console.error('Error loading saved itinerary data:', error);\n      const saveKey = `itinerary_builder_${query.id}`;\n      localStorage.removeItem(saveKey);\n    }\n    \n    return { data: [], hasSavedData: false };\n  }, [query?.id]);\n\n  // Manual save function - only triggered by user action\n  const saveItineraryData = useCallback((data: BuilderItineraryDay[], actionType: string) => {\n    if (!query?.id || data.length === 0) return false;\n    \n    try {\n      const saveKey = `itinerary_builder_${query.id}`;\n      const saveData = {\n        data,\n        lastSaved: new Date().toISOString(),\n        queryId: query.id,\n        version: Date.now(),\n        actionType\n      };\n      \n      localStorage.setItem(saveKey, JSON.stringify(saveData));\n      setLastSaved(new Date());\n      \n      console.log(`Itinerary saved after action: ${actionType}`, 'at', new Date().toLocaleTimeString());\n      return true;\n    } catch (error) {\n      console.error('Error saving itinerary data:', error);\n      return false;\n    }\n  }, [query?.id]);\n\n  // Enhanced tab change handler - persist URL/localStorage and show spinner\n  const handleTabChange = useCallback(async (newTab: string) => {\n    if (newTab === activeTab) return;\n\n    try {\n      setIsTabSwitching(true);\n      console.log('Switching tab from', activeTab, 'to', newTab);\n\n      // Save itinerary data when leaving itinerary tab (best-effort)\n      if (activeTab === 'itinerary' && itineraryData.length > 0) {\n        saveItineraryData(itineraryData, 'tab-switch');\n      }\n\n      // Update URL param without navigation\n      const params = new URLSearchParams(window.location.search);\n      params.set('tab', newTab);\n      const newUrl = `${window.location.pathname}?${params.toString()}`;\n      window.history.replaceState(null, '', newUrl);\n\n      // Persist tab choice per-query\n      if (query?.id) {\n        try {\n          localStorage.setItem(`active_tab_${query.id}`, newTab);\n        } catch {}\n      }\n\n      setActiveTab(newTab as 'itinerary' | 'proposal');\n      console.log(`✅ Switched to tab: ${newTab}`);\n    } catch (e) {\n      console.error('Error during tab switch:', e);\n      toast({\n        title: 'Tab switch error',\n        description: 'We could not persist the tab state reliably.',\n        variant: 'destructive'\n      });\n    } finally {\n      // Small delay to avoid flicker\n      setTimeout(() => setIsTabSwitching(false), 300);\n    }\n  }, [activeTab, itineraryData, query?.id, toast, saveItineraryData]);\n\n  // Enhanced day update handler with proper type conversion\n  const handleUpdateDay = (dayId: string, updates: any) => {\n    // Convert SmartSuggestion activities back to ItineraryActivity format\n    const convertedUpdates = updates.activities ? {\n      ...updates,\n      activities: updates.activities.map((activity: SmartSuggestion) => ({\n        id: activity.id,\n        name: activity.name,\n        description: activity.description || '',\n        duration: activity.duration,\n        cost: activity.price || 0,\n        type: activity.type || 'activity' as const,\n        startTime: activity.timeSlot?.split(' - ')[0],\n        endTime: activity.timeSlot?.split(' - ')[1]\n      }))\n    } : updates;\n    \n    updateDay(dayId, convertedUpdates);\n  };\n\n  // Handle itinerary data changes - no auto-save\n  const handleItineraryDataChange = useCallback((newData: BuilderItineraryDay[], actionType?: string) => {\n    setItineraryData(newData);\n    // Remove auto-save - data will only be saved on manual save\n  }, []);\n\n  // Auto-save optional records when they change\n  useEffect(() => {\n    const saveOptionalRecords = async () => {\n      if (!query?.id || !query?.proposalId) return;\n\n      try {\n        console.log('💾 Auto-saving optional records to proposals and enquiries tables...');\n        \n        // Save to proposals table\n        // Determine if proposalId is a UUID or enquiry ID (use shared constant)\n        const isUuid = UUID_REGEX.test(query.proposalId);\n        \n        let proposalUpdateQuery = supabase\n          .from('proposals')\n          .update({ \n            optional_records: optionalRecords,\n            last_saved: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n          });\n\n        if (isUuid) {\n          // If it's a UUID, update by the 'id' field\n          proposalUpdateQuery = proposalUpdateQuery.eq('id', query.proposalId);\n        } else {\n          // If it's an enquiry ID, update by the 'proposal_id' field\n          proposalUpdateQuery = proposalUpdateQuery.eq('proposal_id', query.proposalId);\n        }\n\n        const { error: proposalError } = await proposalUpdateQuery;\n\n        if (proposalError) {\n          console.error('❌ Error saving optional records to proposals:', proposalError);\n          throw proposalError;\n        }\n\n        console.log('✅ Optional records saved to proposals table');\n\n        // Save to enquiries table (update cityAllocations based on optional records)\n        const optionalCities = optionalRecords.cities?.filter(city => city.isOptional).map(city => city.city) || [];\n        \n        const { error: enquiryError } = await supabase\n          .from('enquiries')\n          .update({ \n            city_allocations: optionalCities,\n            updated_at: new Date().toISOString()\n          })\n          .eq('enquiry_id', query.id);\n\n        if (enquiryError) {\n          console.error('❌ Error saving optional records to enquiries:', enquiryError);\n          throw enquiryError;\n        }\n\n        console.log('✅ Optional records saved to enquiries table');\n\n      } catch (error) {\n        console.error('❌ Error auto-saving optional records:', error);\n        toast({\n          title: \"Error saving optional city settings\",\n          description: \"Failed to save optional city settings. Please try again.\",\n          variant: \"destructive\",\n          duration: 3000,\n        });\n      }\n    };\n\n    // Debounce the save to avoid too many rapid updates\n    const timeoutId = setTimeout(() => {\n      saveOptionalRecords();\n    }, 1000);\n\n    return () => clearTimeout(timeoutId);\n  }, [optionalRecords, query?.id, query?.proposalId, toast]);\n\n  // Manual save handler - only save when user explicitly clicks save\n  const handleItinerarySave = async (data: BuilderItineraryDay[]) => {\n    const saveSuccess = saveItineraryData(data, 'manual-save');\n    // No toast message - silent save\n    return saveSuccess;\n  };\n\n  // Handle optional city toggle\n  const handleToggleCityOptional = (cityId: string, isOptional: boolean) => {\n    setOptionalRecords(prev => {\n      const existingCities = prev.cities || [];\n      const existingIndex = existingCities.findIndex(record => \n        record.city === cityId || \n        record.cityName === cityId ||\n        record.cityId === cityId\n      );\n      \n      if (existingIndex >= 0) {\n        // Update existing record\n        const updated = [...existingCities];\n        updated[existingIndex] = { \n          ...updated[existingIndex], \n          isOptional,\n          city: cityId, // Ensure city field is updated\n          cityName: cityId, // Ensure cityName field is updated for new format\n          updatedAt: new Date().toISOString()\n        };\n        return { ...prev, cities: updated };\n      } else {\n        // Add new record with both old and new format for compatibility\n        const newRecord = {\n          city: cityId,\n          cityName: cityId,\n          cityId: cityId,\n          isOptional,\n          allocation: 0,\n          nights: 0,\n          updatedAt: new Date().toISOString()\n        };\n        return { ...prev, cities: [...existingCities, newRecord] };\n      }\n    });\n    \n    // Log the toggle action for debugging\n    console.log(`🏙️ City toggle: ${cityId} -> ${isOptional ? 'optional' : 'required'}`);\n  };\n\n  useEffect(() => {\n    const loadQuery = async () => {\n      try {\n        setLoading(true);\n        \n        if (!id) {\n          throw new Error('Query ID not provided');\n        }\n\n        // Load using async ProposalService with Supabase fallback\n        const queryData = await ProposalService.getQueryByIdAsync(id);\n\n        if (!queryData) {\n          throw new Error(`Query with ID ${id} not found`);\n        }\n\n        setQuery(queryData);\n        \n        // Load optional records from the proposal\n        if (queryData?.proposalId) {\n          try {\n            // Determine if proposalId is a UUID or enquiry ID (use shared constant)\n            const isUuid = UUID_REGEX.test(queryData.proposalId);\n            \n            let proposalQuery = supabase\n              .from('proposals')\n              .select('optional_records');\n\n            if (isUuid) {\n              // If it's a UUID, query by the 'id' field\n              proposalQuery = proposalQuery.eq('id', queryData.proposalId);\n            } else {\n              // If it's an enquiry ID, query by the 'proposal_id' field\n              proposalQuery = proposalQuery.eq('proposal_id', queryData.proposalId);\n            }\n\n            const { data: proposalData, error } = await proposalQuery.maybeSingle();\n            \n            if (!error && proposalData?.optional_records) {\n              console.log('📋 Loaded optional records from proposal:', proposalData.optional_records);\n              setOptionalRecords(proposalData.optional_records);\n            } else {\n              console.log('ℹ️ No optional records found in proposal, checking enquiry...');\n              \n              // Try to load from enquiry if not found in proposal\n              if (queryData?.city_allocations) {\n                const cityOptionalRecords = queryData.city_allocations.map((city: string) => ({\n                  city: city,\n                  cityName: city,\n                  cityId: city,\n                  isOptional: true,\n                  allocation: 0,\n                  nights: 0,\n                  updatedAt: new Date().toISOString()\n                }));\n                \n                console.log('📍 Loaded optional cities from enquiry:', cityOptionalRecords);\n                setOptionalRecords({ cities: cityOptionalRecords });\n              }\n            }\n          } catch (error) {\n            console.error('Error loading optional records:', error);\n          }\n        } else if (queryData?.cityAllocations) {\n          // If no proposalId but has cityAllocations, create optional records from enquiry\n          // Create optional records from enquiry cityAllocations with proper isOptional flag\n          const cityOptionalRecords = queryData.cityAllocations.map((allocation: any) => ({\n            city: typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || allocation.cityId,\n            cityName: typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || allocation.cityId,\n            cityId: typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || allocation.cityId,\n            isOptional: allocation.isOptional || false,\n            allocation: allocation.allocation || 0,\n            nights: allocation.nights || 0,\n            updatedAt: new Date().toISOString()\n          }));\n          \n          console.log('📍 Created optional records from enquiry cityAllocations:', cityOptionalRecords);\n          setOptionalRecords({ cities: cityOptionalRecords });\n        }\n        \n        // Load saved itinerary data after query is loaded - with URL parameter support\n        setTimeout(() => {\n          // Check if we should auto-load a draft from URL parameters\n          const shouldLoadDraft = urlParams.get('loadDraft') === 'true';\n          const draftType = urlParams.get('draftType') || 'daywise';\n          const draftId = urlParams.get('draftId') || id;\n          \n          if (shouldLoadDraft && draftId) {\n            console.log('Loading draft from URL parameters:', { draftId, draftType });\n            // Draft loading will be handled by useProposalBuilder with URL parameters\n          }\n          \n          const { data: savedData, hasSavedData } = loadSavedItineraryData();\n          if (hasSavedData) {\n            setItineraryData(savedData);\n            if (!hasShownDraftLoadedToast) {\n              toast({\n                title: \"Draft loaded\",\n                description: \"Your saved itinerary draft has been loaded successfully\",\n              });\n              setHasShownDraftLoadedToast(true);\n            }\n          }\n\n          // Restore previously selected tab from localStorage if available\n          if (query?.id) {\n            try {\n              const storedTab = localStorage.getItem(`active_tab_${query.id}`);\n              if (storedTab === 'itinerary' || storedTab === 'proposal') {\n                setActiveTab(storedTab as 'itinerary' | 'proposal');\n              }\n            } catch {}\n          }\n          \n          // If direct-linking to proposal tab, ensure data is ready\n          if (initialTab === 'proposal') {\n            setTimeout(() => {\n              const managementData = loadProposalManagementData();\n              setProposalManagementData(managementData);\n            }, 200);\n          }\n        }, 100);\n        \n      } catch (error) {\n        console.error('Error loading query:', error);\n        toast({\n          title: \"Error loading query\",\n          description: error instanceof Error ? error.message : \"Failed to load query details\",\n          variant: \"destructive\"\n        });\n        \n        setTimeout(() => navigate('/queries'), 2000);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (id && !hasShownDraftLoadedToast) {\n      loadQuery();\n    }\n  }, [id, navigate, toast, loadSavedItineraryData, hasShownDraftLoadedToast]);\n\n  const handleSaveDraft = async () => {\n    if (!query?.id) {\n      toast({\n        title: \"Error saving draft\",\n        description: \"No query ID found. Please refresh the page and try again.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    try {\n      setActionLoading('save');\n      \n      // Only save itinerary data if there's meaningful content\n      if (activeTab === 'itinerary' && itineraryData.length > 0) {\n        const hasContent = itineraryData.some(day => \n          day.activities.length > 0 || \n          day.accommodations.length > 0 || \n          day.transport.length > 0 ||\n          Object.values(day.meals).some(Boolean)\n        );\n        \n        if (hasContent) {\n          saveItineraryData(itineraryData, 'manual-draft-save');\n        }\n      }\n      \n      const savedDraftId = await saveDraft();\n      \n      // Update last saved timestamp\n      setLastSaved(new Date());\n      \n      toast({\n        title: \"Draft saved\",\n        description: `Your proposal draft has been saved successfully (ID: ${savedDraftId})`,\n      });\n      \n      console.log('Draft saved successfully:', savedDraftId);\n    } catch (error) {\n      console.error('Error saving draft:', error);\n      toast({\n        title: \"Error saving draft\",\n        description: error instanceof Error ? error.message : \"Failed to save proposal draft\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setActionLoading(null);\n    }\n  };\n\n  // Enhanced proposal generation with validation\n  const handleValidateAndGenerate = () => {\n    if (!query) return;\n    \n    // Refresh proposal management data before validation\n    const latestManagementData = loadProposalManagementData();\n    setProposalManagementData(latestManagementData);\n    \n    console.log('Validating proposal with data:', {\n      itinerarDays: itineraryData.length,\n      managementData: latestManagementData ? 'Available' : 'Not found',\n      totalCost\n    });\n    \n    // Show validation dialog\n    setShowValidationDialog(true);\n  };\n\n  const handleProceedWithGeneration = async () => {\n    setShowValidationDialog(false);\n    setShowProgressDialog(true);\n    \n    try {\n      await handleGenerateWithProgress();\n    } finally {\n      setShowProgressDialog(false);\n    }\n  };\n\n  const handleSkipRule = (ruleId: string) => {\n    setSkippedRules(prev => [...prev, ruleId]);\n    toast({\n      title: \"Rule Skipped\",\n      description: \"Validation rule has been skipped for this generation\",\n    });\n  };\n\n  const handleGenerateProposal = async () => {\n    try {\n      setActionLoading('generate');\n      \n      const proposalId = await generateProposal();\n      \n      toast({\n        title: \"Proposal created\",\n        description: \"Your proposal has been generated successfully\",\n      });\n      \n      navigate(`/proposals/${proposalId}`);\n    } catch (error) {\n      console.error('Error generating proposal:', error);\n      toast({\n        title: \"Error generating proposal\",\n        description: \"Failed to generate proposal\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setActionLoading(null);\n    }\n  };\n\n  // Auto-add days based on trip duration\n  const autoAddDaysForDuration = () => {\n    if (!tripDuration || days.length >= tripDuration.days) return;\n\n    const startDate = new Date(query!.travelDates.from);\n    for (let i = days.length; i < tripDuration.days; i++) {\n      const dayDate = new Date(startDate);\n      dayDate.setDate(startDate.getDate() + i);\n      addDay();\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50\">\n        <PageLayout>\n          <div className=\"flex items-center justify-center min-h-screen\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n              <h2 className=\"text-xl font-semibold\">Loading Enhanced Proposal Builder...</h2>\n            </div>\n          </div>\n        </PageLayout>\n      </div>\n    );\n  };\n\n  if (!query) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50\">\n        <PageLayout>\n          <div className=\"flex items-center justify-center min-h-screen\">\n            <Card className=\"w-full max-w-md\">\n              <CardHeader>\n                <CardTitle className=\"text-center text-red-600\">Query Not Found</CardTitle>\n              </CardHeader>\n              <CardContent className=\"text-center space-y-4\">\n                <p className=\"text-muted-foreground\">\n                  The query with ID \"{id}\" could not be found.\n                </p>\n                <Button onClick={() => navigate('/queries')} className=\"w-full\">\n                  <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                  Back to Queries\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </PageLayout>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50\">\n      <PageLayout>\n        <div className=\"space-y-6\">\n          {/* Enhanced Header */}\n          <div className=\"flex items-center justify-between bg-white/50 backdrop-blur-sm rounded-xl p-6 shadow-sm border border-gray-100\">\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-4\">\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\"\n                  onClick={() => navigate('/queries')}\n                  className=\"gap-2 hover:bg-white/80 transition-all duration-200\"\n                >\n                  <ArrowLeft className=\"h-4 w-4\" />\n                  Back\n                </Button>\n                \n                <div className=\"space-y-1\">\n                  <h1 className=\"text-3xl font-bold tracking-tight bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent\">\n                    Create Proposal\n                  </h1>\n                  <p className=\"text-sm text-gray-600 font-medium\">Query ID: {query.id}</p>\n                </div>\n              </div>\n            </div>\n\n            {/* Action Buttons */}\n            <div className=\"flex items-center gap-3\">\n              {/* HIDDEN: Auto-add days button removed from header\n              {tripDuration && days.length < tripDuration.days && (\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={autoAddDaysForDuration}\n                  className=\"gap-2 border-blue-200 text-blue-700 hover:bg-blue-50 hover:text-blue-800 transition-all duration-200 shadow-sm\"\n                  disabled={!!actionLoading}\n                >\n                  <Plus className=\"h-4 w-4\" />\n                  Auto-Add {tripDuration.days - days.length} Days\n                </Button>\n              )}\n              */}\n              {/* Preview Button Hidden - Commented out for future use */}\n              {/* <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setActiveView(activeView === 'planning' ? 'summary' : 'planning')}\n                className=\"gap-2\"\n                disabled={!!actionLoading}\n              >\n                <Eye className=\"h-4 w-4\" />\n                {activeView === 'planning' ? 'Preview' : 'Edit'}\n              </Button> */}\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={handleSaveDraft}\n                disabled={proposalLoading || actionLoading === 'save'}\n                className=\"gap-2 border-green-200 text-green-700 hover:bg-green-50 hover:text-green-800 transition-all duration-200 shadow-sm\"\n              >\n                {actionLoading === 'save' ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\" />\n                    Saving...\n                  </>\n                ) : (\n                  <>\n                    <Save className=\"h-4 w-4\" />\n                    Save Draft\n                  </>\n                )}\n              </Button>\n              <Button \n                size=\"sm\"\n                onClick={handleValidateAndGenerate}\n                disabled={!query || proposalLoading || itineraryData.length === 0 || isGenerating}\n                className=\"gap-2 shadow-lg hover:shadow-xl transition-all duration-200\"\n                variant={query && hasErrors ? \"destructive\" : \"default\"}\n              >\n                {isGenerating ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\" />\n                    Generating...\n                  </>\n                ) : (\n                  <>\n                    <Shield className=\"h-4 w-4\" />\n                    Generate Proposal\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n\n          {/* Enhanced Query Summary Card */}\n          <Card className=\"bg-gradient-to-r from-blue-50/80 to-indigo-50/80 backdrop-blur-sm border-blue-200 shadow-sm\">\n            <CardHeader>\n              <CardTitle className=\"text-blue-800 font-semibold\">Query Summary</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n                <div>\n                  <p className=\"text-sm font-medium text-blue-700\">Destination</p>\n                  <p className=\"text-sm text-blue-600\">{query.destination.country}</p>\n                  <div className=\"text-xs text-blue-500\">\n                    {query.cityAllocations && query.cityAllocations.length > 0 \n                      ? query.cityAllocations.map((allocation: any, index: number) => {\n                          const cityName = typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || 'City';\n                          return (\n                            <span key={index} className=\"inline-flex items-center gap-1\">\n                              <span className={allocation.isOptional ? 'opacity-60' : ''}>\n                                {cityName} {allocation.nights}N\n                              </span>\n                              {allocation.isOptional && (\n                                <Badge variant=\"outline\" className=\"text-xs px-1 py-0 border-orange-300 text-orange-600 bg-orange-50\">\n                                  Optional\n                                </Badge>\n                              )}\n                              {index < query.cityAllocations.length - 1 && <span className=\"mx-1\">+</span>}\n                            </span>\n                          );\n                        })\n                      : query.destination.cities.map((city: any, index: number) => {\n                          const cityName = typeof city === 'string' ? city : (city as any)?.name || (city as any)?.city || 'City';\n                          const nights = tripDuration ? Math.floor(tripDuration.nights / query.destination.cities.length) : 0;\n                          const isOptional = query.cityAllocations?.find((alloc: any) => alloc.cityId === cityName)?.isOptional || false;\n                          \n                          return (\n                            <span key={index} className=\"inline-flex items-center gap-1\">\n                              <span className={isOptional ? 'opacity-60' : ''}>\n                                {cityName} {nights}N\n                              </span>\n                              {isOptional && (\n                                <Badge variant=\"outline\" className=\"text-xs px-1 py-0 border-orange-300 text-orange-600 bg-orange-50\">\n                                  Optional\n                                </Badge>\n                              )}\n                              {index < query.destination.cities.length - 1 && <span className=\"mx-1\">+</span>}\n                            </span>\n                          );\n                        })\n                    }\n                  </div>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-blue-700\">Travel Dates</p>\n                  <p className=\"text-sm text-blue-600\">\n                    {new Date(query.travelDates.from).toLocaleDateString()} - {new Date(query.travelDates.to).toLocaleDateString()}\n                  </p>\n                  {tripDuration && (\n                    <p className=\"text-xs text-blue-500\">\n                      {tripDuration.days} days, {tripDuration.nights} nights\n                    </p>\n                  )}\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-blue-700\">Travelers</p>\n                  <p className=\"text-sm text-blue-600\">\n                    {query.paxDetails.adults} Adults\n                    {query.paxDetails.children > 0 && `, ${query.paxDetails.children} Children`}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-blue-700\">Currency</p>\n                  <p className=\"text-sm text-blue-600\">\n                    {currencyInfo ? `${currencyInfo.code} (${currencyInfo.symbol})` : 'USD ($)'}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-blue-700\">Total Cost</p>\n                  <p className=\"text-lg font-bold text-blue-600\">\n                    {formatCurrency(totalCost, query.destination.country)}\n                  </p>\n                  <p className=\"text-xs text-blue-500\">\n                    {formatCurrency(totalCost / (query.paxDetails.adults + query.paxDetails.children), query.destination.country)} per person\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Main Tabs with improved switching */}\n          <Tabs value={activeTab} onValueChange={handleTabChange}>\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"itinerary\" className=\"flex items-center gap-2\">\n                <span>Day Wise Itinerary</span>\n                {query?.cityAllocations?.some((alloc: any) => alloc.isOptional) && (\n                  <Badge variant=\"outline\" className=\"text-xs px-1 py-0 border-orange-300 text-orange-600 bg-orange-50\">\n                    {query.cityAllocations.filter((alloc: any) => alloc.isOptional).length} Optional\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"proposal\" className=\"flex items-center gap-2\">\n                <span>Proposal Management</span>\n              </TabsTrigger>\n            </TabsList>\n\n            {isTabSwitching && (\n              <div className=\"mt-3 flex items-center gap-2 text-muted-foreground\">\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600\" />\n                <span className=\"text-sm\">Switching tabs…</span>\n              </div>\n            )}\n\n            {/* Optional Cities Display - Integrated directly into query summary */}\n\n            <TabsContent value=\"itinerary\" className=\"mt-6\">\n              <TabErrorBoundary tabName=\"Day Wise Itinerary\">\n                {query && (\n                  <DayByDayItineraryBuilder\n                    queryId={query.id}\n                    query={query}\n                    initialDays={itineraryData}\n                    onDataChange={(newData) => handleItineraryDataChange(newData, 'tab-switch')}\n                    onSave={handleItinerarySave}\n                    optionalRecords={optionalRecords}\n                    onToggleCityOptional={handleToggleCityOptional}\n                  />\n                )}\n              </TabErrorBoundary>\n            </TabsContent>\n\n            <TabsContent value=\"proposal\" className=\"mt-6\">\n              <TabErrorBoundary tabName=\"Proposal Management\">\n                {query && (\n                  <ProposalManagement query={query} />\n                )}\n              </TabErrorBoundary>\n            </TabsContent>\n          </Tabs>\n\n          {/* Enhanced Main Content - Legacy view toggle */}\n          {activeView === 'planning' ? (\n            <div className=\"hidden\">\n              <EnhancedDayPlanningInterface\n                query={query}\n                days={days.map(convertItineraryDayToProposalDay)}\n                onAddDay={addDay}\n                onUpdateDay={handleUpdateDay}\n                onRemoveDay={removeDay}\n              />\n            </div>\n          ) : (\n            <div className=\"hidden\">\n              <ProposalSummaryView\n                query={query}\n                days={days.map(convertItineraryDayToProposalDay)}\n                totalCost={totalCost}\n              />\n            </div>\n          )}\n        </div>\n\n        {/* Enhanced Validation Dialog */}\n        <EnhancedValidationDialog\n          isOpen={showValidationDialog}\n          onClose={() => setShowValidationDialog(false)}\n          onProceed={handleProceedWithGeneration}\n          onSkipRule={handleSkipRule}\n          validationRules={validationRules}\n          queryId={query?.id}\n          title=\"Proposal Generation Validation\"\n        />\n\n        {/* Progress Dialog */}\n        <GenerationProgressDialog\n          isOpen={showProgressDialog}\n          steps={generationSteps}\n          currentProgress={currentProgress}\n          title=\"Generating Your Proposal\"\n        />\n      </PageLayout>\n    </div>\n  );\n};\n\nexport default AdvancedProposalCreation;\n","\nimport React from 'react';\nimport PageLayout from '@/components/layout/PageLayout';\nimport BreadcrumbNav from '@/components/navigation/BreadcrumbNav';\nimport EnhancedQueryManagement from '@/components/queries/EnhancedQueryManagement';\n\nconst QueryManagement: React.FC = () => {\n  return (\n    <PageLayout>\n      <BreadcrumbNav />\n      <EnhancedQueryManagement />\n    </PageLayout>\n  );\n};\n\nexport default QueryManagement;\n","import * as React from \"react\";\nimport { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport PageLayout from \"@/components/layout/PageLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { CalendarIcon, ArrowLeft, Users, MapPin, Calendar as CalendarDays, DollarSign, Car, Edit3 } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport { useToast } from \"@/hooks/use-toast\";\nimport { AgentSelector } from '@/components/queries/AgentSelector';\nimport { CountryCitySelector } from './components/CountryCitySelector';\nimport { CityNightAllocator } from '@/components/proposal/CityNightAllocator';\nimport { OptionalSightseeingOptions } from '@/components/queries/OptionalSightseeingOptions';\nimport { OptionalTransportOptions } from '@/components/queries/OptionalTransportOptions';\nimport { Query } from '@/types/query';\nimport { createEnquiry } from '@/services/enquiriesService';\nimport { EnqIdGenerator } from '@/utils/enqIdGenerator';\nimport { getCountryCodeByName } from '@/utils/countryUtils';\nimport { findSupabaseAgentByNumericId } from '@/utils/supabaseAgentIds';\nimport { useAgentData } from '@/hooks/useAgentData';\nimport { useSupabaseAgentsList } from '@/hooks/useSupabaseAgentsList';\nimport { toNumericAgentId } from '@/utils/supabaseAgentIds';\nimport { useOptionalCities } from '@/hooks/useOptionalCities';\n\nconst CreateQuery: React.FC = () => {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { getAgentById } = useAgentData();\n  const { agents } = useSupabaseAgentsList();\n\n  // Form state\n  const [selectedAgentId, setSelectedAgentId] = useState('');\n  const [selectedAgentName, setSelectedAgentName] = useState('');\n  const [destination, setDestination] = useState({ country: '', cities: [] as string[] });\n  const [paxDetails, setPaxDetails] = useState({ adults: 2, children: 0, infants: 0 });\n  const [travelDates, setTravelDates] = useState({ from: null as Date | null, to: null as Date | null, isEstimated: false });\n  const [packageType, setPackageType] = useState('full-package');\n  const [specialRequests, setSpecialRequests] = useState(['']);\n  const [budget, setBudget] = useState({ min: 0, max: 0, currency: 'USD' });\n  const [notes, setNotes] = useState('');\n  const [communicationPreference, setCommunicationPreference] = useState('email');\n  const [hotelDetails, setHotelDetails] = useState({ rooms: 1, category: 'standard' });\n  const [inclusions, setInclusions] = useState({\n    sightseeing: true,\n    transfers: '',\n    mealPlan: 'breakfast',\n    transportTypes: [] as string[]\n  });\n  \n  // Manual trip duration override\n  const [manualDuration, setManualDuration] = useState({ days: 0, nights: 0 });\n  const [isManualDuration, setIsManualDuration] = useState(false);\n  \n  // City night allocations\n  const [cityAllocations, setCityAllocations] = useState([]);\n\n  // Optional city allocation toggle and percentages (independent of night allocations)\n  const {\n    cityAllocations: optionalCityAllocations,\n    onCityAllocationsChange: setOptionalCityAllocations,\n    isOptionalEnabled,\n    setOptionalEnabled,\n  } = useOptionalCities();\n\n  const [cityOptionalFlags, setCityOptionalFlags] = useState<Record<string, boolean>>({});\n  const handleCityOptionalChange = (cityName: string, optional: boolean) => {\n    setCityOptionalFlags(prev => ({ ...prev, [cityName]: optional }));\n  };\n\n  // Clear transfer selections when package type changes to hotel-only\n  useEffect(() => {\n    if (packageType === 'hotel-only') {\n      setInclusions(prev => ({\n        ...prev,\n        transportTypes: [],\n        transfers: ''\n      }));\n    }\n  }, [packageType]);\n\n  // Optional sightseeing options\n  const [optionalSightseeingOptions, setOptionalSightseeingOptions] = useState([\n    { id: 'option1', title: 'Option 1: Cultural Heritage Tour', description: 'Museums, historical sites, and cultural experiences', activities: [], isOptional: false },\n    { id: 'option2', title: 'Option 2: Adventure & Nature Tour', description: 'Outdoor activities, nature walks, and adventure sports', activities: [], isOptional: false }\n  ]);\n\n  const updateSightseeingOption = (id: string, field: string, value: any) => {\n    setOptionalSightseeingOptions(prev => prev.map(option => \n      option.id === id ? { ...option, [field]: value } : option\n    ));\n  };\n\n  const addSightseeingActivity = (optionId: string) => {\n    setOptionalSightseeingOptions(prev => prev.map(option => \n      option.id === optionId ? {\n        ...option,\n        activities: [...option.activities, { name: '', duration: '', cost: 0, description: '' }]\n      } : option\n    ));\n  };\n\n  const updateSightseeingActivity = (optionId: string, activityIndex: number, field: string, value: any) => {\n    setOptionalSightseeingOptions(prev => prev.map(option => \n      option.id === optionId ? {\n        ...option,\n        activities: option.activities.map((activity, index) => \n          index === activityIndex ? { ...activity, [field]: value } : activity\n        )\n      } : option\n    ));\n  };\n\n  const removeSightseeingActivity = (optionId: string, activityIndex: number) => {\n    setOptionalSightseeingOptions(prev => prev.map(option => \n      option.id === optionId ? {\n        ...option,\n        activities: option.activities.filter((_, index) => index !== activityIndex)\n      } : option\n    ));\n  };\n\n  // Optional transport options\n  const [optionalTransportOptions, setOptionalTransportOptions] = useState([\n    { id: 'transport1', type: 'private' as const, description: 'Private car with driver', cost: 0, isOptional: false },\n    { id: 'transport2', type: 'shared' as const, description: 'Shared shuttle service', cost: 0, isOptional: false }\n  ]);\n\n  const updateTransportOption = (id: string, field: string, value: any) => {\n    setOptionalTransportOptions(prev => prev.map(option => \n      option.id === id ? { ...option, [field]: value } : option\n    ));\n  };\n\n  const calculateTripDuration = () => {\n    if (isManualDuration) {\n      return manualDuration;\n    }\n    \n    if (travelDates.from && travelDates.to) {\n      const timeDiff = travelDates.to.getTime() - travelDates.from.getTime();\n      const days = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;\n      const nights = days - 1;\n      return { days, nights };\n    }\n    return { days: 0, nights: 0 };\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!selectedAgentId || !destination.country || !travelDates.from || !travelDates.to) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all required fields.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const tripDuration = calculateTripDuration();\n    \n    // Prepare enquiry ID based on destination country\n    const selectedCountryCode = getCountryCodeByName(destination.country);\n    try {\n      await EnqIdGenerator.prepareConfig(selectedCountryCode || undefined);\n    } catch {}\n    const enquiryId = EnqIdGenerator.generateEnqId(selectedCountryCode || undefined);\n    \n    // Resolve Supabase agent UUID from numeric selection\n    const numericAgentId = Number.parseInt(selectedAgentId);\n    const supabaseAgent = findSupabaseAgentByNumericId(agents, numericAgentId);\n    const agentUuid = supabaseAgent?.id;\n    \n    const finalCityAllocations = (() => {\n      const existing = cityAllocations || [];\n      const byCity = new Map<string, any>();\n      existing.forEach((a: any) => {\n        const key = typeof a.city === 'string' ? a.city : String(a.city);\n        byCity.set(key, a);\n      });\n      const merged: any[] = [];\n      destination.cities.filter(c => c.trim() !== '').forEach((city) => {\n        const key = city;\n        const alloc = byCity.get(key) || { id: key, city: key, nights: 0, isOptional: false, estimatedCost: 0 };\n        const opt = !!cityOptionalFlags[key];\n        merged.push({ ...alloc, isOptional: opt });\n      });\n      return merged;\n    })();\n\n    const queryData: Omit<Query, 'createdAt' | 'updatedAt'> = {\n      id: enquiryId,\n      agentId: numericAgentId,\n      agentUuid: agentUuid,\n      agentName: selectedAgentName,\n      destination: {\n        country: destination.country,\n        cities: destination.cities.filter(city => city.trim() !== '')\n      },\n      paxDetails,\n      travelDates: {\n        from: travelDates.from!.toISOString(),\n        to: travelDates.to!.toISOString(),\n        isEstimated: !!travelDates.isEstimated\n      },\n      tripDuration,\n      packageType,\n      specialRequests: specialRequests.filter(req => req.trim() !== ''),\n      budget,\n      status: 'new',\n      assignedTo: null,\n      priority: 'normal',\n      notes,\n      communicationPreference,\n      hotelDetails,\n      inclusions,\n      cityAllocations: finalCityAllocations,\n      optionalSightseeingOptions: [],\n      optionalTransportOptions: []\n    };\n\n    try {\n      const { data: created, error } = await createEnquiry(queryData as Query);\n      if (error) throw error;\n      const newQuery = created || (queryData as Query);\n      toast({\n        title: \"Query Created\",\n        description: `Enquiry ${newQuery.id} has been created successfully.`,\n      });\n      navigate('/queries');\n    } catch (error) {\n      console.error('Error creating query:', error);\n      toast({\n        title: \"Error\",\n        description: \"There was an error creating the query.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleAgentChange = (agentId: string, agentName: string) => {\n    setSelectedAgentId(agentId);\n    // Prefer the provided name; if missing, resolve from Supabase; otherwise fall back to local data\n    if (agentName && agentName.trim().length > 0) {\n      setSelectedAgentName(agentName);\n      return;\n    }\n\n    const numeric = Number.parseInt(agentId || '');\n    const supabaseAgent = agents.find(a => toNumericAgentId(a.id) === numeric);\n    if (supabaseAgent) {\n      setSelectedAgentName(supabaseAgent.name);\n      return;\n    }\n\n    const localAgent = getAgentById(numeric);\n    if (localAgent) {\n      setSelectedAgentName(localAgent.name);\n    }\n  };\n\n  const addSpecialRequest = () => {\n    setSpecialRequests(prev => [...prev, '']);\n  };\n\n  const updateSpecialRequest = (index: number, value: string) => {\n    setSpecialRequests(prev => prev.map((req, i) => i === index ? value : req));\n  };\n\n  const removeSpecialRequest = (index: number) => {\n    setSpecialRequests(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const handleTransportTypeChange = (transportType: string, checked: boolean) => {\n    setInclusions(prev => {\n      const nextTransportTypes = checked\n        ? [...prev.transportTypes, transportType]\n        : prev.transportTypes.filter(type => type !== transportType);\n      const transfersText = nextTransportTypes.length === 0 ? '' : nextTransportTypes.join(',');\n      return {\n        ...prev,\n        transportTypes: nextTransportTypes,\n        transfers: transfersText,\n      };\n    });\n  };\n\n  const toggleManualDuration = () => {\n    if (!isManualDuration) {\n      // Switch to manual mode, initialize with calculated duration\n      const calculatedDuration = calculateTripDuration();\n      setManualDuration(calculatedDuration);\n    }\n    setIsManualDuration(!isManualDuration);\n  };\n\n  const handleManualDurationChange = (field: 'days' | 'nights', value: string) => {\n    const numValue = parseInt(value) || 0;\n    setManualDuration(prev => ({\n      ...prev,\n      [field]: numValue,\n      // Auto-adjust the other field\n      ...(field === 'days' ? { nights: Math.max(0, numValue - 1) } : { days: numValue + 1 })\n    }));\n  };\n\n  const duration = calculateTripDuration();\n  const totalPax = paxDetails.adults + paxDetails.children + paxDetails.infants;\n  const today = new Date();\n\n  return (\n    <PageLayout>\n      <div className=\"container mx-auto max-w-6xl px-4 py-6\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-4\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => navigate('/queries')}>\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back to Queries\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-gray-100\">Create New Query</h1>\n              <p className=\"text-gray-600 dark:text-gray-400 mt-1\">Fill in the details to create a new travel query</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            {totalPax > 0 && (\n              <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                <Users className=\"h-4 w-4\" />\n                <span>{totalPax} PAX</span>\n              </div>\n            )}\n            {duration.days > 0 && (\n              <div className=\"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                <CalendarDays className=\"h-4 w-4\" />\n                <span>{duration.days}D/{duration.nights}N</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"space-y-8\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            {/* Left Column */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Agent Selection */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center gap-2 text-gray-900 dark:text-gray-100\">\n                    <Users className=\"h-5 w-5 text-blue-600\" />\n                    Agent Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <AgentSelector\n                    selectedAgentId={selectedAgentId}\n                    onAgentChange={handleAgentChange}\n                  />\n                </CardContent>\n              </Card>\n\n              {/* Destination */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center gap-2 text-gray-900 dark:text-gray-100\">\n                    <MapPin className=\"h-5 w-5 text-green-600\" />\n                    Destination Details\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <CountryCitySelector\n                    destination={destination}\n                    onDestinationChange={setDestination}\n                    cityAllocations={optionalCityAllocations}\n                    onCityAllocationsChange={setOptionalCityAllocations}\n                    isOptionalEnabled={isOptionalEnabled}\n                    onOptionalToggle={setOptionalEnabled}\n                    cityOptionalFlags={cityOptionalFlags}\n                    onCityOptionalChange={handleCityOptionalChange}\n                  />\n                </CardContent>\n              </Card>\n\n              {/* Travel Information */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center gap-2 text-gray-900 dark:text-gray-100\">\n                    <CalendarDays className=\"h-5 w-5 text-purple-600\" />\n                    Travel Information\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Passenger Details */}\n                  <div>\n                    <Label className=\"text-sm font-medium mb-3 block text-gray-900 dark:text-gray-100\">Passenger Details</Label>\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"adults\" className=\"text-sm text-gray-700 dark:text-gray-300\">Adults *</Label>\n                        <Input\n                          id=\"adults\"\n                          type=\"number\"\n                          min=\"1\"\n                          value={paxDetails.adults}\n                          onChange={(e) => setPaxDetails(prev => ({ ...prev, adults: parseInt(e.target.value) || 0 }))}\n                          placeholder=\"0\"\n                          className=\"text-center bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                          inputMode=\"numeric\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"children\" className=\"text-sm text-gray-700 dark:text-gray-300\">Children</Label>\n                        <Input\n                          id=\"children\"\n                          type=\"number\"\n                          min=\"0\"\n                          value={paxDetails.children}\n                          onChange={(e) => setPaxDetails(prev => ({ ...prev, children: parseInt(e.target.value) || 0 }))}\n                          placeholder=\"0\"\n                          className=\"text-center bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                          inputMode=\"numeric\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"infants\" className=\"text-sm text-gray-700 dark:text-gray-300\">Infants</Label>\n                        <Input\n                          id=\"infants\"\n                          type=\"number\"\n                          min=\"0\"\n                          value={paxDetails.infants}\n                          onChange={(e) => setPaxDetails(prev => ({ ...prev, infants: parseInt(e.target.value) || 0 }))}\n                          placeholder=\"0\"\n                          className=\"text-center bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                          inputMode=\"numeric\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Travel Dates */}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-gray-700 dark:text-gray-300\">Departure Date *</Label>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            className={cn(\n                              \"w-full justify-start text-left font-normal bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\",\n                              !travelDates.from && \"text-muted-foreground\"\n                            )}\n                          >\n                            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                            {travelDates.from ? format(travelDates.from, \"PPP\") : \"Select departure date\"}\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={travelDates.from}\n                            onSelect={(date) => setTravelDates(prev => ({ ...prev, from: date }))}\n                            initialFocus\n                            modifiers={{\n                              today: today\n                            }}\n                            modifiersStyles={{\n                              today: {\n                                backgroundColor: '#3b82f6',\n                                color: 'white',\n                                fontWeight: 'bold'\n                              }\n                            }}\n                            className=\"p-3 pointer-events-auto\"\n                          />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label className=\"text-gray-700 dark:text-gray-300\">Return Date *</Label>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <Button\n                            variant=\"outline\"\n                            className={cn(\n                              \"w-full justify-start text-left font-normal bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\",\n                              !travelDates.to && \"text-muted-foreground\"\n                            )}\n                          >\n                            <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                            {travelDates.to ? format(travelDates.to, \"PPP\") : \"Select return date\"}\n                          </Button>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0 bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={travelDates.to}\n                            onSelect={(date) => setTravelDates(prev => ({ ...prev, to: date }))}\n                            initialFocus\n                            disabled={(date) => travelDates.from ? date < travelDates.from : false}\n                            modifiers={{\n                              departureDate: travelDates.from ? [travelDates.from] : []\n                            }}\n                            modifiersStyles={{\n                              departureDate: {\n                                backgroundColor: '#10b981',\n                                color: 'white',\n                                fontWeight: 'bold'\n                              }\n                            }}\n                            className=\"p-3 pointer-events-auto\"\n                          />\n                        </PopoverContent>\n                      </Popover>\n                    </div>\n                  </div>\n\n                  {/* Date Estimated Toggle */}\n                  <div className=\"flex items-center gap-3 mt-2\">\n                    <Switch\n                      checked={!!travelDates.isEstimated}\n                      onCheckedChange={(checked) => setTravelDates(prev => ({ ...prev, isEstimated: !!checked }))}\n                    />\n                    <Label className=\"text-sm text-gray-700 dark:text-gray-300\">Dates are estimated</Label>\n                  </div>\n\n                  {duration.days > 0 && (\n                    <div className=\"p-3 bg-gradient-to-br from-primary/5 to-accent/5 dark:from-primary/10 dark:to-accent/10 rounded-md border border-primary/20 dark:border-primary/30\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <CalendarDays className=\"h-4 w-4 text-primary\" />\n                          <p className=\"text-sm font-semibold text-foreground\">\n                            Trip Duration\n                          </p>\n                        </div>\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={toggleManualDuration}\n                          className=\"h-7 px-2 text-xs text-primary hover:text-primary/80 hover:bg-primary/10\"\n                        >\n                          <Edit3 className=\"h-3 w-3 mr-1\" />\n                          {isManualDuration ? 'Auto' : 'Edit'}\n                        </Button>\n                      </div>\n                      \n                      {isManualDuration ? (\n                        <div className=\"grid grid-cols-2 gap-3\">\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs font-medium text-muted-foreground\">Days</Label>\n                            <Input\n                              type=\"number\"\n                              min=\"1\"\n                              value={manualDuration.days}\n                              onChange={(e) => handleManualDurationChange('days', e.target.value)}\n                              placeholder=\"0\"\n                              className=\"h-7 text-sm min-h-[48px] sm:min-h-[32px] text-base sm:text-sm touch-manipulation\"\n                              inputMode=\"numeric\"\n                            />\n                          </div>\n                          <div className=\"space-y-1\">\n                            <Label className=\"text-xs font-medium text-muted-foreground\">Nights</Label>\n                            <Input\n                              type=\"number\"\n                              min=\"0\"\n                              value={manualDuration.nights}\n                              onChange={(e) => handleManualDurationChange('nights', e.target.value)}\n                              placeholder=\"0\"\n                              className=\"h-7 text-sm min-h-[48px] sm:min-h-[32px] text-base sm:text-sm touch-manipulation\"\n                              inputMode=\"numeric\"\n                            />\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center gap-2 p-2 bg-background/50 rounded border border-border/50\">\n                          <span className=\"text-sm font-medium text-foreground\">\n                            {duration.days} days, {duration.nights} nights\n                          </span>\n                        </div>\n                      )}\n                     </div>\n                   )}\n                 </CardContent>\n               </Card>\n\n               {/* City Night Allocator - Show when dates and cities are selected */}\n               {travelDates.from && travelDates.to && destination.cities.length > 0 && duration.nights > 0 && (\n                 <CityNightAllocator\n                   query={{\n                     destination,\n                     travelDates: {\n                       from: travelDates.from.toISOString(),\n                       to: travelDates.to.toISOString(),\n                       isEstimated: !!travelDates.isEstimated\n                     },\n                     tripDuration: duration\n                   } as Query}\n                   onAllocationsChange={setCityAllocations}\n                   onGenerateDays={(allocations) => {\n                     // This will be used for itinerary generation later\n                     console.log('City allocations ready for itinerary generation:', allocations);\n                   }}\n                 />\n               )}\n\n              {/* Package Type & Inclusions */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"text-gray-900 dark:text-gray-100\">Package Type & Inclusions</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  {/* Package Type */}\n                  <div className=\"space-y-4\">\n                    <Label className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">Package Type</Label>\n                    <RadioGroup value={packageType} onValueChange={setPackageType}>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"transport-only\" id=\"transport-only\" />\n                        <Label htmlFor=\"transport-only\" className=\"text-gray-700 dark:text-gray-300\">Transport Only</Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"hotel-only\" id=\"hotel-only\" />\n                        <Label htmlFor=\"hotel-only\" className=\"text-gray-700 dark:text-gray-300\">Hotel Only</Label>\n                      </div>\n                      <div className=\"flex items-center space-x-2\">\n                        <RadioGroupItem value=\"full-package\" id=\"full-package\" />\n                        <Label htmlFor=\"full-package\" className=\"text-gray-700 dark:text-gray-300\">Full Package (Includes Hotel + Transport + Sightseeing)</Label>\n                      </div>\n                    </RadioGroup>\n                  </div>\n\n                  {/* Inclusions */}\n                  <div className=\"space-y-4\">\n                    <Label className=\"text-sm font-medium text-gray-900 dark:text-gray-100\">Inclusions</Label>\n                    \n                    {/* Sightseeing Required */}\n                    <div>\n                      <Label className=\"text-sm font-medium mb-3 block text-gray-900 dark:text-gray-100\">Sightseeing Required</Label>\n                      <RadioGroup \n                        value={inclusions.sightseeing ? \"yes\" : \"no\"} \n                        onValueChange={(value) => setInclusions(prev => ({ ...prev, sightseeing: value === \"yes\" }))}\n                      >\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"yes\" id=\"sightseeing-yes\" />\n                          <Label htmlFor=\"sightseeing-yes\" className=\"text-gray-700 dark:text-gray-300\">Yes</Label>\n                        </div>\n                        <div className=\"flex items-center space-x-2\">\n                          <RadioGroupItem value=\"no\" id=\"sightseeing-no\" />\n                          <Label htmlFor=\"sightseeing-no\" className=\"text-gray-700 dark:text-gray-300\">No</Label>\n                        </div>\n                      </RadioGroup>\n                    </div>\n\n                    {/* Transfer Types */}\n                    <div className={packageType === 'hotel-only' ? 'opacity-50' : ''}>\n                      <Label className=\"text-sm font-medium mb-2 block text-gray-900 dark:text-gray-100\">Transfer Types (Optional)</Label>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                        You can select one or both transfer types, or leave unselected if not needed\n                      </p>\n                      <div className=\"grid grid-cols-2 gap-4\">\n                        <div className=\"flex items-center space-x-3\">\n                          <Checkbox\n                            id=\"private-transfer\"\n                            checked={inclusions.transportTypes.includes('private')}\n                            onCheckedChange={(checked) => handleTransportTypeChange('private', checked as boolean)}\n                          />\n                          <div className=\"flex items-center space-x-2\">\n                            <Car className=\"h-4 w-4 text-blue-600\" />\n                            <div>\n                              <Label htmlFor=\"private-transfer\" className=\"text-gray-700 dark:text-gray-300 font-medium\">Private</Label>\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Dedicated vehicle</p>\n                            </div>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center space-x-3\">\n                          <Checkbox\n                            id=\"sic-transfer\"\n                            checked={inclusions.transportTypes.includes('sic')}\n                            onCheckedChange={(checked) => handleTransportTypeChange('sic', checked as boolean)}\n                          />\n                          <div className=\"flex items-center space-x-2\">\n                            <Car className=\"h-4 w-4 text-green-600\" />\n                            <div>\n                              <Label htmlFor=\"sic-transfer\" className=\"text-gray-700 dark:text-gray-300 font-medium\">SIC</Label>\n                              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Shared in Coach</p>\n                            </div>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Meal Plan */}\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"mealPlan\" className=\"text-gray-700 dark:text-gray-300\">Meal Plan</Label>\n                      <Select value={inclusions.mealPlan} onValueChange={(value) => setInclusions(prev => ({ ...prev, mealPlan: value }))}>\n                        <SelectTrigger className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent className=\"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\">\n                          <SelectItem value=\"breakfast\">Breakfast</SelectItem>\n                          <SelectItem value=\"halfboard\">Half Board</SelectItem>\n                          <SelectItem value=\"fullboard\">Full Board</SelectItem>\n                          <SelectItem value=\"allinclusive\">All Inclusive</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n\n                  {/* Hotel Details */}\n                  <div>\n                    <Label className=\"text-sm font-medium mb-3 block text-gray-900 dark:text-gray-100\">Accommodation Preferences</Label>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"rooms\" className=\"text-gray-700 dark:text-gray-300\">Number of Rooms</Label>\n                        <Input\n                          id=\"rooms\"\n                          type=\"number\"\n                          min=\"1\"\n                          value={hotelDetails.rooms}\n                          onChange={(e) => setHotelDetails(prev => ({ ...prev, rooms: parseInt(e.target.value) || 1 }))}\n                          placeholder=\"0\"\n                          className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                          inputMode=\"numeric\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"category\" className=\"text-gray-700 dark:text-gray-300\">Hotel Category</Label>\n                        <Select value={hotelDetails.category} onValueChange={(value) => setHotelDetails(prev => ({ ...prev, category: value }))}>\n                          <SelectTrigger className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\">\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent className=\"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\">\n                            <SelectItem value=\"budget\">Budget</SelectItem>\n                            <SelectItem value=\"standard\">Standard</SelectItem>\n                            <SelectItem value=\"deluxe\">Deluxe</SelectItem>\n                            <SelectItem value=\"luxury\">Luxury</SelectItem>\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"communicationPreference\" className=\"text-gray-700 dark:text-gray-300\">Preferred Communication</Label>\n                    <Select value={communicationPreference} onValueChange={setCommunicationPreference}>\n                      <SelectTrigger className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent className=\"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\">\n                        <SelectItem value=\"email\">Email</SelectItem>\n                        <SelectItem value=\"phone\">Phone</SelectItem>\n                        <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Right Column - Budget & Additional Info */}\n            <div className=\"space-y-6\">\n              {/* Budget Information */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"flex items-center gap-2 text-gray-900 dark:text-gray-100\">\n                    <DollarSign className=\"h-5 w-5 text-green-600\" />\n                    Budget Range\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"minBudget\" className=\"text-gray-700 dark:text-gray-300\">Minimum Budget</Label>\n                      <Input\n                        id=\"minBudget\"\n                        type=\"number\"\n                        min=\"0\"\n                        value={budget.min}\n                        onChange={(e) => setBudget(prev => ({ ...prev, min: parseInt(e.target.value) || 0 }))}\n                        placeholder=\"0\"\n                        className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                        inputMode=\"numeric\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"maxBudget\" className=\"text-gray-700 dark:text-gray-300\">Maximum Budget</Label>\n                      <Input\n                        id=\"maxBudget\"\n                        type=\"number\"\n                        min=\"0\"\n                        value={budget.max}\n                        onChange={(e) => setBudget(prev => ({ ...prev, max: parseInt(e.target.value) || 0 }))}\n                        placeholder=\"0\"\n                        className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 min-h-[48px] text-base sm:text-lg md:text-base touch-manipulation\"\n                        inputMode=\"numeric\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"currency\" className=\"text-gray-700 dark:text-gray-300\">Currency</Label>\n                      <Select value={budget.currency} onValueChange={(value) => setBudget(prev => ({ ...prev, currency: value }))}>\n                        <SelectTrigger className=\"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent className=\"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600\">\n                          <SelectItem value=\"USD\">USD</SelectItem>\n                          <SelectItem value=\"EUR\">EUR</SelectItem>\n                          <SelectItem value=\"GBP\">GBP</SelectItem>\n                          <SelectItem value=\"INR\">INR</SelectItem>\n                          <SelectItem value=\"AED\">AED</SelectItem>\n                          <SelectItem value=\"THB\">THB</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Special Requests */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"text-gray-900 dark:text-gray-100\">Special Requests</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {specialRequests.map((request, index) => (\n                      <div key={index} className=\"flex gap-2\">\n                        <Input\n                          value={request}\n                          onChange={(e) => updateSpecialRequest(index, e.target.value)}\n                          placeholder=\"Enter special request\"\n                          className=\"flex-1 bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\"\n                        />\n                        {specialRequests.length > 1 && (\n                          <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => removeSpecialRequest(index)}>\n                            Remove\n                          </Button>\n                        )}\n                      </div>\n                    ))}\n                    <Button type=\"button\" variant=\"outline\" onClick={addSpecialRequest} className=\"w-full\">\n                      Add Request\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Additional Notes */}\n              <Card className=\"shadow-sm border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800\">\n                <CardHeader className=\"pb-4\">\n                  <CardTitle className=\"text-gray-900 dark:text-gray-100\">Additional Notes</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <Textarea\n                    id=\"notes\"\n                    value={notes}\n                    onChange={(e) => setNotes(e.target.value)}\n                    placeholder=\"Any additional notes or special requirements...\"\n                    rows={4}\n                    className=\"resize-none bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100\"\n                  />\n                </CardContent>\n              </Card>\n\n              {/* Query Summary Preview */}\n              <Card className=\"shadow-lg border-blue-200 dark:border-blue-600 bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/20\">\n                <CardHeader className=\"pb-3 border-b border-blue-200 dark:border-blue-700\">\n                  <CardTitle className=\"flex items-center gap-2 text-blue-900 dark:text-blue-100\">\n                    <Edit3 className=\"h-5 w-5 text-blue-600\" />\n                    Preview Summary\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-4\">\n                  <div className=\"grid grid-cols-1 gap-3 text-sm\">\n                    {/* Top Row - Key Info */}\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Agent</span>\n                        <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          {selectedAgentName || 'Not selected'}\n                        </span>\n                      </div>\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Passengers</span>\n                        <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          {totalPax} PAX\n                        </span>\n                      </div>\n                    </div>\n\n                    {/* Destination with Nights */}\n                    <div className=\"p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                      <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 block mb-1\">Destination</span>\n                      <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                        {destination.country ? (\n                          cityAllocations.length > 0 ? (\n                            cityAllocations.map((allocation: any, index: number) => (\n                              <span key={index}>\n                                {typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || 'City'} {allocation.nights}N\n                                {index < cityAllocations.length - 1 ? ' + ' : ''}\n                              </span>\n                            ))\n                          ) : (\n                            destination.cities.map((city: any, index: number) => (\n                              <span key={index}>\n                                {typeof city === 'string' ? city : (city as any)?.name || (city as any)?.city || 'City'} {duration.nights > 0 ? `${Math.floor(duration.nights / destination.cities.length)}N` : ''}\n                                {index < destination.cities.length - 1 ? ' + ' : ''}\n                              </span>\n                            ))\n                          )\n                        ) : 'Not selected'}\n                      </span>\n                    </div>\n\n                    {/* Travel Dates & Duration */}\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Travel Dates</span>\n                        <span className=\"text-xs text-gray-900 dark:text-gray-100\">\n                          {travelDates.from && travelDates.to \n                            ? `${format(travelDates.from, \"dd MMM\")} - ${format(travelDates.to, \"dd MMM yyyy\")}`\n                            : 'Not selected'}\n                        </span>\n                      </div>\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Duration</span>\n                        <span className=\"font-semibold text-gray-900 dark:text-gray-100\">\n                          {duration.days > 0 ? `${duration.days}D/${duration.nights}N` : 'Not calculated'}\n                        </span>\n                      </div>\n                    </div>\n\n                    {/* Package & Budget */}\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Package</span>\n                        <span className=\"text-xs text-gray-900 dark:text-gray-100 capitalize\">\n                          {packageType.replace('-', ' ')}\n                        </span>\n                      </div>\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Budget</span>\n                        <span className=\"text-xs text-gray-900 dark:text-gray-100\">\n                          {budget.min > 0 || budget.max > 0 \n                            ? `${budget.currency} ${budget.min.toLocaleString()}-${budget.max.toLocaleString()}`\n                            : 'Not specified'}\n                        </span>\n                      </div>\n                    </div>\n\n                    {/* Hotel & Communication */}\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Hotel</span>\n                        <span className=\"text-xs text-gray-900 dark:text-gray-100\">\n                          {hotelDetails.rooms}R, {hotelDetails.category}\n                        </span>\n                      </div>\n                      <div className=\"flex flex-col p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                        <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 mb-1\">Contact</span>\n                        <span className=\"text-xs text-gray-900 dark:text-gray-100 capitalize\">{communicationPreference}</span>\n                      </div>\n                    </div>\n\n                    {/* Inclusions Grid */}\n                    <div className=\"p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border border-blue-200 dark:border-blue-700\">\n                      <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300 block mb-2\">Inclusions</span>\n                      <div className=\"grid grid-cols-2 gap-x-4 gap-y-1 text-xs\">\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">Sightseeing:</span>\n                          <span className=\"text-gray-900 dark:text-gray-100\">{inclusions.sightseeing ? '✓' : '✗'}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">Transfers:</span>\n                          <span className=\"text-gray-900 dark:text-gray-100 capitalize\">{inclusions.transfers}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">Meals:</span>\n                          <span className=\"text-gray-900 dark:text-gray-100 capitalize\">{inclusions.mealPlan}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-gray-600 dark:text-gray-400\">Transport:</span>\n                          <span className=\"text-gray-900 dark:text-gray-100\">\n                            {inclusions.transportTypes.length > 0 ? '✓' : '✗'}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n\n                    {/* Special Requests */}\n                    {specialRequests.some(req => req.trim() !== '') && (\n                      <div className=\"p-2 bg-white dark:bg-gray-800 rounded border\">\n                        <span className=\"font-medium text-gray-700 dark:text-gray-300 block mb-2\">Special Requests:</span>\n                        <ul className=\"text-xs space-y-1\">\n                          {specialRequests.filter(req => req.trim() !== '').map((request, index) => (\n                            <li key={index} className=\"text-gray-900 dark:text-gray-100\">• {request}</li>\n                          ))}\n                        </ul>\n                      </div>\n                    )}\n\n                    {/* Additional Notes */}\n                    {notes.trim() !== '' && (\n                      <div className=\"p-2 bg-white dark:bg-gray-800 rounded border\">\n                        <span className=\"font-medium text-gray-700 dark:text-gray-300 block mb-2\">Additional Notes:</span>\n                        <p className=\"text-xs text-gray-900 dark:text-gray-100\">{notes}</p>\n                      </div>\n                    )}\n\n                    {/* Communication Preference */}\n                    <div className=\"flex justify-between items-center p-2 bg-white dark:bg-gray-800 rounded border\">\n                      <span className=\"font-medium text-gray-700 dark:text-gray-300\">Communication:</span>\n                      <span className=\"text-gray-900 dark:text-gray-100 capitalize\">{communicationPreference}</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Submit Actions */}\n          <div className=\"flex gap-4 justify-end pt-6 border-t border-gray-200 dark:border-gray-700\">\n            <Button type=\"button\" variant=\"outline\" onClick={() => navigate('/queries')}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" className=\"px-8\">\n              Create Query\n            </Button>\n          </div>\n        </form>\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default CreateQuery;\n","import React, { useState, useEffect, useMemo } from \"react\";\nimport { useParams, Link, useSearchParams, useNavigate } from \"react-router-dom\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport PageLayout from \"@/components/layout/PageLayout\";\nimport BreadcrumbNav from \"@/components/navigation/BreadcrumbNav\";\nimport ProposalActions from \"@/components/queries/ProposalActions\";\nimport { QueryAssignmentActions } from \"@/components/queries/QueryAssignmentActions\";\nimport { SupabaseAgentDetailsCard } from \"@/components/queries/SupabaseAgentDetailsCard\";\nimport { getEnquiryById, updateEnquiry } from \"@/services/enquiriesService\";\nimport { queryWorkflowService } from \"@/services/queryWorkflowService\";\nimport EnquiryTimeline from \"@/components/queries/workflow/EnquiryTimeline\";\nimport EnhancedStatusBadge from \"@/components/queries/status/EnhancedStatusBadge\";\nimport EnhancedProposalService from \"@/services/enhancedProposalService\";\nimport { \n  ArrowLeft, Calendar, Clock, Edit, FileText, Hotel, Map, Plane, \n  User2, Users, MapPin, Star,\n  DollarSign, Clock3, AlertTriangle, CheckCircle2, Eye, Send,\n  Plus, Copy, Car, Landmark, Utensils\n} from \"lucide-react\";\nimport { getProposalsByQueryId } from \"@/data/queryData\";\nimport { Query, Proposal } from \"@/types/query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport ProposalService from \"@/services/proposalService\";\nimport { formatCurrency, getCurrencyByCountry } from \"@/utils/currencyUtils\";\n\nconst QueryDetails: React.FC = () => {\n  const { id: encodedId } = useParams<{ id: string }>();\n  const id = encodedId ? decodeURIComponent(encodedId) : undefined;\n  const [searchParams] = useSearchParams();\n  const { toast } = useToast();\n  const navigate = useNavigate();\n  const [activeTab, setActiveTab] = useState(searchParams.get('tab') || \"details\");\n  const [query, setQuery] = useState<Query | undefined>(undefined);\n  const [proposals, setProposals] = useState<any[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [sendDialogOpen, setSendDialogOpen] = useState(false);\n  const [selectedProposal, setSelectedProposal] = useState<any>(null);\n  const [sendOptions, setSendOptions] = useState({\n    method: 'email',\n    recipient: '',\n    subject: '',\n    message: '',\n    urgency: 'normal'\n  });\n  const [selectedModules, setSelectedModules] = useState<any[]>([]);\n  const [proposalState, setProposalState] = useState<any>(null);\n  const [statusUpdating, setStatusUpdating] = useState(false);\n\n  // Fetch the query from Supabase (no localStorage fallback)\n  useEffect(() => {\n    if (!id) return;\n    setIsLoading(true);\n    (async () => {\n      const { data, error } = await getEnquiryById(id);\n      if (error) {\n        console.error('Error loading enquiry from Supabase:', error);\n        toast({ title: 'Failed to load enquiry', description: String(error), variant: 'destructive' });\n      }\n      setQuery(data || undefined);\n      if (data) {\n        const mockProposals = getProposalsByQueryId(data.id);\n        const savedProposals = ProposalService.getProposalsByQueryId(data.id);\n        const allProposals = [...mockProposals, ...savedProposals];\n        const uniqueProposals = allProposals.filter((proposal, index, self) => \n          index === self.findIndex(p => p.id === proposal.id)\n        );\n        setProposals(uniqueProposals);\n        setSelectedModules(uniqueProposals.length > 0 ? (uniqueProposals[0].modules || []) : []);\n      } else {\n        setSelectedModules([]);\n      }\n      setIsLoading(false);\n    })();\n  }, [id]);\n\n  // Debug: Monitor query status changes\n  useEffect(() => {\n    if (query) {\n      console.log(`QueryDetails: Query status updated to \"${query.status}\"`);\n    }\n  }, [query?.status]);\n\n  const calculatePriority = (query: Query): 'low' | 'normal' | 'high' | 'urgent' => {\n    const travelDate = new Date(query.travelDates.from);\n    const daysUntilTravel = Math.floor((travelDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n    const totalPax = query.paxDetails.adults + query.paxDetails.children + query.paxDetails.infants;\n\n    if (daysUntilTravel <= 7) return 'urgent';\n    if (query.packageType === 'luxury' || totalPax >= 8 || daysUntilTravel <= 30) return 'high';\n    if (totalPax >= 4 || daysUntilTravel <= 60) return 'normal';\n    return 'low';\n  };\n\n  const isNewAssignment = query?.status === 'assigned' && \n    new Date().getTime() - new Date(query.createdAt).getTime() < 24 * 60 * 60 * 1000;\n\n  // Calculate PAX excluding infants\n  const totalPax = query ? query.paxDetails.adults + query.paxDetails.children : 0;\n  const estimatedRevenue = query?.budget?.max ? query.budget.max * 0.15 : 0;\n\n  // Get proper currency based on destination country\n  const currencyInfo = query ? getCurrencyByCountry(query.destination.country) : { code: 'USD' };\n  const destinationCurrency = currencyInfo.code;\n\n  const formatDestinationCurrency = (amount: number) => {\n    if (!query) return amount.toFixed(2);\n    return formatCurrency(amount, query.destination.country);\n  };\n\n  const handleStatusChange = async (newStatus: string) => {\n    if (!query) return;\n    const oldStatus = query.status;\n    try {\n      setStatusUpdating(true);\n      \n      // Preserve existing required fields to avoid NOT NULL constraint violations\n      const updatePayload = {\n        status: newStatus,\n        updatedAt: new Date().toISOString(),\n        // Preserve existing travel dates to satisfy NOT NULL constraint\n        travelDates: {\n          from: query.travelDates.from,\n          to: query.travelDates.to,\n          isEstimated: query.travelDates.isEstimated\n        },\n        // Preserve other required fields that might have NOT NULL constraints\n        destination: query.destination,\n        paxDetails: query.paxDetails,\n        packageType: query.packageType,\n        tripDuration: query.tripDuration\n      };\n      \n      // Update the enquiry in Supabase\n      const { error } = await updateEnquiry(query.id, updatePayload as any);\n      \n      if (error) {\n        throw new Error(error.message || \"Failed to update status\");\n      }\n      \n      // Update local state\n      setQuery(prev => prev ? { ...prev, status: newStatus, updatedAt: new Date().toISOString() } : prev);\n      \n      // Record workflow event for audit trail\n      try {\n        queryWorkflowService.createStatusChangeEvent(\n          query.id,\n          'current-user',\n          'Current User',\n          'staff',\n          oldStatus,\n          newStatus\n        );\n      } catch (workflowError) {\n        console.warn('Failed to record workflow event:', workflowError);\n      }\n      \n      toast({ \n        title: \"Status Updated\", \n        description: `Enquiry status changed from ${oldStatus.replace('-', ' ')} to ${newStatus.replace('-', ' ')}` \n      });\n    } catch (e: any) {\n      console.error('Status update error:', e);\n      toast({ \n        title: \"Update failed\", \n        description: e?.message || \"Could not update status. Please try again.\", \n        variant: \"destructive\" \n      });\n    } finally {\n      setStatusUpdating(false);\n    }\n  };\n\n  const handleViewProposalDetails = (proposalId: string) => {\n    // Navigate to Advanced Proposal Creation section for viewing and updating\n    navigate(`/queries/advanced-proposal/${encodeURIComponent(query?.id)}?proposal=${proposalId}&mode=view`);\n  };\n\n  const handleSendToAgent = (proposal: any) => {\n    setSelectedProposal(proposal);\n    setSendOptions({\n      method: 'email',\n      recipient: query?.agentName || '',\n      subject: `Travel Proposal - Query ${query?.id}`,\n      message: `Dear ${query?.agentName || 'Agent'},\\n\\nPlease find attached the travel proposal for Query ${query?.id}.\\n\\nProposal Details:\\n- Total Amount: ${formatDestinationCurrency(proposal.totals?.total || proposal.finalPrice || 0)}\\n- Modules: ${proposal.modules?.length || proposal.totals?.moduleCount || 0}\\n\\nBest regards,\\nTravel Team`,\n      urgency: 'normal'\n    });\n    setSendDialogOpen(true);\n  };\n\n  const handleSendProposal = () => {\n    if (!sendOptions.recipient) {\n      toast({\n        title: \"Error\",\n        description: \"Please enter recipient details.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Simulate sending proposal\n    toast({\n      title: \"Proposal Sent\",\n      description: `Proposal has been sent to ${sendOptions.recipient} via ${sendOptions.method}.`,\n    });\n\n    setSendDialogOpen(false);\n    setSelectedProposal(null);\n  };\n\n  // Group modules by type for summary display\n  const groupedModules = useMemo(() => {\n    const groups: { [key: string]: any[] } = {\n      hotel: [],\n      transport: [],\n      sightseeing: [],\n      restaurant: [],\n      other: []\n    };\n\n    selectedModules.forEach(module => {\n      if (groups[module.type]) {\n        groups[module.type].push(module);\n      } else {\n        groups.other.push(module);\n      }\n    });\n\n    return groups;\n  }, [selectedModules]);\n\n  if (isLoading) {\n    return (\n      <PageLayout>\n        <BreadcrumbNav />\n        <div className=\"flex flex-col items-center justify-center h-[500px] bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-border\">\n          <div className=\"text-center p-8\">\n            <div className=\"animate-spin h-16 w-16 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <h2 className=\"text-2xl font-bold mb-4 text-foreground\">Loading Query Details...</h2>\n            <p className=\"text-muted-foreground\">Please wait while we fetch the enquiry information.</p>\n          </div>\n        </div>\n      </PageLayout>\n    );\n  }\n  \n  if (!query) {\n    return (\n      <PageLayout>\n        <BreadcrumbNav />\n        <div className=\"flex flex-col items-center justify-center h-[500px] bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-border\">\n          <div className=\"text-center p-8\">\n            <AlertTriangle className=\"h-16 w-16 text-orange-500 mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold mb-4 text-foreground\">Query not found</h2>\n            <p className=\"text-muted-foreground mb-6\">The query you're looking for doesn't exist or has been removed.</p>\n            <p className=\"text-sm text-muted-foreground mb-6\">Query ID: {id}</p>\n            <Button asChild className=\"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800\">\n              <Link to=\"/queries\">\n                <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                Back to Queries\n              </Link>\n            </Button>\n          </div>\n        </div>\n      </PageLayout>\n    );\n  }\n\n  return (\n    <PageLayout>\n      <BreadcrumbNav \n        customPaths={{\n          [id!]: `Query ${id}`\n        }}\n      />\n      \n      <div className=\"space-y-6\">\n        {/* Enhanced Header with proper dark mode */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-blue-700 dark:from-blue-700 dark:to-blue-800 rounded-lg p-6 text-white border border-border\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-4\">\n              <Link to=\"/queries\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"text-white hover:bg-white/20 dark:hover:bg-white/10\">\n                  <ArrowLeft className=\"h-4 w-4 mr-1\" />\n                  Back\n                </Button>\n              </Link>\n              <div>\n                <h1 className=\"text-2xl md:text-3xl font-bold\">\n                  Query {query.id}\n                </h1>\n                <p className=\"text-blue-100 dark:text-blue-200 mt-1\">\n                  Created on {new Date(query.createdAt).toLocaleDateString('en-US', { \n                    year: 'numeric', \n                    month: 'long', \n                    day: 'numeric' \n                  })}\n                </p>\n              </div>\n              <EnhancedStatusBadge \n                status={query.status}\n                isNewAssignment={isNewAssignment}\n                priority={calculatePriority(query)}\n                showProgress={true}\n                size=\"lg\"\n              />\n            </div>\n            <div className=\"flex items-center space-x-3\">\n              {estimatedRevenue > 0 && (\n                <div className=\"text-right\">\n                  <div className=\"text-sm text-blue-100 dark:text-blue-200\">Est. Revenue</div>\n                  <div className=\"text-xl font-bold flex items-center\">\n                    <DollarSign className=\"h-5 w-5 mr-1\" />\n                    {estimatedRevenue.toLocaleString()}\n                  </div>\n                </div>\n              )}\n              <div className=\"min-w-[180px]\">\n                <Select value={query.status} onValueChange={handleStatusChange} disabled={statusUpdating}>\n                  <SelectTrigger className=\"bg-white/10 hover:bg-white/20 text-white border-white/20\">\n                    <SelectValue placeholder=\"Change Status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"new\">New</SelectItem>\n                    <SelectItem value=\"assigned\">Assigned</SelectItem>\n                    <SelectItem value=\"in-progress\">In Progress</SelectItem>\n                    <SelectItem value=\"proposal-sent\">Proposal Sent</SelectItem>\n                    <SelectItem value=\"confirmed\">Confirmed</SelectItem>\n                    <SelectItem value=\"converted\">Converted</SelectItem>\n                    <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Button size=\"sm\" variant=\"secondary\" asChild className=\"bg-white/10 hover:bg-white/20 text-white border-white/20\">\n                <Link to={`/queries/edit/${encodeURIComponent(query.id)}`}>\n                  <Edit className=\"h-4 w-4 mr-1\" />\n                  Edit\n                </Link>\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Quick Stats with dark mode support */}\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <Card className=\"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-green-200 dark:border-green-800\">\n            <CardContent className=\"p-4 text-center\">\n              <Users className=\"h-8 w-8 text-green-600 dark:text-green-400 mx-auto mb-2\" />\n              <div className=\"text-2xl font-bold text-green-700 dark:text-green-300\">{totalPax}</div>\n              <div className=\"text-sm text-green-600 dark:text-green-400\">\n                Total PAX\n                {query.paxDetails.infants > 0 && (\n                  <div className=\"text-xs text-green-500 dark:text-green-400 mt-1\">\n                    +{query.paxDetails.infants} infant{query.paxDetails.infants > 1 ? 's' : ''}\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n          <Card className=\"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-blue-200 dark:border-blue-800\">\n            <CardContent className=\"p-4 text-center\">\n              <Clock3 className=\"h-8 w-8 text-blue-600 dark:text-blue-400 mx-auto mb-2\" />\n              <div className=\"text-2xl font-bold text-blue-700 dark:text-blue-300\">{query.tripDuration.nights}</div>\n              <div className=\"text-sm text-blue-600 dark:text-blue-400\">Nights</div>\n            </CardContent>\n          </Card>\n          <Card className=\"bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border-purple-200 dark:border-purple-800\">\n            <CardContent className=\"p-4 text-center\">\n              <MapPin className=\"h-8 w-8 text-purple-600 dark:text-purple-400 mx-auto mb-2\" />\n              <div className=\"text-2xl font-bold text-purple-700 dark:text-purple-300\">{query.destination.cities.length}</div>\n              <div className=\"text-sm text-purple-600 dark:text-purple-400\">Cities</div>\n            </CardContent>\n          </Card>\n          <Card className=\"bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 border-orange-200 dark:border-orange-800\">\n            <CardContent className=\"p-4 text-center\">\n              <Star className=\"h-8 w-8 text-orange-600 dark:text-orange-400 mx-auto mb-2\" />\n              <div className=\"text-2xl font-bold text-orange-700 dark:text-orange-300 capitalize\">{query.packageType}</div>\n              <div className=\"text-sm text-orange-600 dark:text-orange-400\">Package</div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-4 bg-muted\">\n            <TabsTrigger value=\"details\" className=\"flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Details\n            </TabsTrigger>\n            <TabsTrigger value=\"timeline\" className=\"flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              Timeline\n            </TabsTrigger>\n            <TabsTrigger value=\"proposals\" className=\"flex items-center gap-2\">\n              <FileText className=\"h-4 w-4\" />\n              Proposals ({proposals.length})\n            </TabsTrigger>\n            <TabsTrigger value=\"followups\" className=\"flex items-center gap-2\">\n              <Calendar className=\"h-4 w-4\" />\n              Follow-ups\n            </TabsTrigger>\n          </TabsList>\n          \n          <TabsContent value=\"details\" className=\"space-y-6 mt-6\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n              {/* Left Column - Query Details */}\n              <div className=\"lg:col-span-2 space-y-6\">\n                {/* Travel Information with dark mode */}\n                <Card className=\"shadow-sm hover:shadow-md transition-shadow bg-card border-border\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-lg flex items-center gap-2 text-card-foreground\">\n                        <Calendar className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                        Travel Information\n                      </CardTitle>\n                      {query?.travelDates?.isEstimated && (\n                        <Badge\n                          variant=\"outline\"\n                          className=\"bg-amber-50 dark:bg-amber-900/30 border-amber-200 dark:border-amber-800 text-amber-700 dark:text-amber-300 flex items-center gap-1\"\n                        >\n                          <Clock3 className=\"h-3 w-3\" />\n                          Dates are estimated\n                        </Badge>\n                      )}\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n                        <div className=\"flex items-center mb-2\">\n                          <Calendar className=\"h-4 w-4 mr-2 text-blue-600 dark:text-blue-400\" />\n                          <span className=\"font-medium text-blue-800 dark:text-blue-200\">Departure</span>\n                        </div>\n                        <p className=\"text-lg font-semibold text-blue-900 dark:text-blue-100\">\n                          {new Date(query.travelDates.from).toLocaleDateString('en-US', { \n                            weekday: 'long',\n                            year: 'numeric', \n                            month: 'long', \n                            day: 'numeric' \n                          })}\n                        </p>\n                      </div>\n                      <div className=\"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg border border-green-200 dark:border-green-800\">\n                        <div className=\"flex items-center mb-2\">\n                          <Calendar className=\"h-4 w-4 mr-2 text-green-600 dark:text-green-400\" />\n                          <span className=\"font-medium text-green-800 dark:text-green-200\">Return</span>\n                        </div>\n                        <p className=\"text-lg font-semibold text-green-900 dark:text-green-100\">\n                          {new Date(query.travelDates.to).toLocaleDateString('en-US', { \n                            weekday: 'long',\n                            year: 'numeric', \n                            month: 'long', \n                            day: 'numeric' \n                          })}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"bg-muted p-4 rounded-lg\">\n                      <div className=\"flex items-center justify-center\">\n                        <Clock className=\"h-5 w-5 mr-2 text-muted-foreground\" />\n                        <span className=\"font-medium text-muted-foreground\">\n                          {query.tripDuration.nights} Nights / {query.tripDuration.days} Days\n                        </span>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                {/* Destination Details with dark mode */}\n                <Card className=\"shadow-sm hover:shadow-md transition-shadow bg-card border-border\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-card-foreground\">\n                      <MapPin className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                      Destination Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/30 dark:to-blue-900/30 p-6 rounded-lg border border-border\">\n                      <div className=\"text-center\">\n                        <h3 className=\"text-2xl font-bold text-foreground mb-2\">{query.destination.country}</h3>\n                        <div className=\"flex flex-wrap justify-center gap-2\">\n                          {query.cityAllocations && query.cityAllocations.length > 0 ? (\n                            // Show cities with allocated nights if allocations exist\n                            query.cityAllocations.map((allocation: any, index: number) => (\n                              <Badge key={index} variant=\"outline\" className=\"bg-background border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300\">\n                                {typeof allocation.city === 'string' ? allocation.city : (allocation.city as any)?.name || (allocation.city as any)?.city || 'City'} ({allocation.nights}N){allocation.isOptional ? ' Optional' : ''}\n                              </Badge>\n                            ))\n                          ) : (\n                            // Fallback to showing just city names for older queries\n                            query.destination.cities.map((city: any, index: number) => (\n                              <Badge key={index} variant=\"outline\" className=\"bg-background border-blue-300 dark:border-blue-600 text-blue-700 dark:text-blue-300\">\n                                {typeof city === 'string' ? city : (city as any)?.name || (city as any)?.city || 'City'}\n                              </Badge>\n                            ))\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                {/* PAX Details with dark mode */}\n                <Card className=\"shadow-sm hover:shadow-md transition-shadow bg-card border-border\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-card-foreground\">\n                      <Users className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n                      Guest Details\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"text-center bg-blue-50 dark:bg-blue-900/30 p-4 rounded-lg\">\n                        <div className=\"text-2xl font-bold text-blue-700 dark:text-blue-300\">{query.paxDetails.adults}</div>\n                        <div className=\"text-sm text-blue-600 dark:text-blue-400\">Adults</div>\n                      </div>\n                      <div className=\"text-center bg-green-50 dark:bg-green-900/30 p-4 rounded-lg\">\n                        <div className=\"text-2xl font-bold text-green-700 dark:text-green-300\">{query.paxDetails.children}</div>\n                        <div className=\"text-sm text-green-600 dark:text-green-400\">Children</div>\n                      </div>\n                      <div className=\"text-center bg-orange-50 dark:bg-orange-900/30 p-4 rounded-lg\">\n                        <div className=\"text-2xl font-bold text-orange-700 dark:text-orange-300\">{query.paxDetails.infants}</div>\n                        <div className=\"text-sm text-orange-600 dark:text-orange-400\">Infants</div>\n                      </div>\n                    </div>\n                    <div className=\"bg-muted p-4 rounded-lg flex items-center justify-between\">\n                      <div className=\"flex items-center\">\n                        <Hotel className=\"h-5 w-5 mr-2 text-muted-foreground\" />\n                        <span className=\"font-medium text-foreground\">Accommodation</span>\n                      </div>\n                      <div className=\"text-right\">\n                        <div className=\"font-semibold text-foreground\">{query.hotelDetails.rooms} Rooms</div>\n                        <div className=\"text-sm text-muted-foreground\">{query.hotelDetails.category} Hotel</div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n                \n                {/* Package Information with dark mode */}\n                <Card className=\"shadow-sm hover:shadow-md transition-shadow bg-card border-border\">\n                  <CardHeader className=\"pb-3\">\n                    <CardTitle className=\"text-lg flex items-center gap-2 text-card-foreground\">\n                      <Plane className=\"h-5 w-5 text-indigo-600 dark:text-indigo-400\" />\n                      Package Information\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div className=\"bg-indigo-50 dark:bg-indigo-900/30 p-4 rounded-lg\">\n                        <div className=\"font-medium text-indigo-800 dark:text-indigo-200 mb-1\">Package Type</div>\n                        <Badge className=\"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-800 dark:text-indigo-200 capitalize\">\n                          {query.packageType.replace('-', ' ')}\n                        </Badge>\n                      </div>\n                      {query.budget && (\n                        <div className=\"bg-green-50 dark:bg-green-900/30 p-4 rounded-lg\">\n                          <div className=\"font-medium text-green-800 dark:text-green-200 mb-1\">Budget Range</div>\n                          <div className=\"text-lg font-semibold text-green-900 dark:text-green-100\">\n                            {formatDestinationCurrency(query.budget.min || 0)} - {formatDestinationCurrency(query.budget.max || 0)}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"bg-muted p-4 rounded-lg\">\n                      <h4 className=\"font-medium text-foreground mb-3\">Inclusions</h4>\n                      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n                        <div className=\"flex items-center\">\n                          <CheckCircle2 className={`h-4 w-4 mr-2 ${query.inclusions.sightseeing ? 'text-green-600 dark:text-green-400' : 'text-muted-foreground'}`} />\n                          <span className={query.inclusions.sightseeing ? 'text-green-700 dark:text-green-300' : 'text-muted-foreground'}>\n                            Sightseeing\n                          </span>\n                        </div>\n                        <div className=\"flex items-center\">\n                          <CheckCircle2 className=\"h-4 w-4 mr-2 text-green-600 dark:text-green-400\" />\n                          <span className=\"text-green-700 dark:text-green-300 capitalize\">\n                            {query.inclusions.transfers} Transfers\n                          </span>\n                        </div>\n                        <div className=\"flex items-center\">\n                          <CheckCircle2 className=\"h-4 w-4 mr-2 text-green-600 dark:text-green-400\" />\n                          <span className=\"text-green-700 dark:text-green-300 capitalize\">\n                            {query.inclusions.mealPlan.replace(\"-\", \" \")}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    \n                    {query.specialRequests && (\n                      <div className=\"bg-amber-50 dark:bg-amber-900/30 p-4 rounded-lg border border-amber-200 dark:border-amber-800\">\n                        <div className=\"font-medium text-amber-800 dark:text-amber-200 mb-2\">Special Requests</div>\n                        <p className=\"text-amber-700 dark:text-amber-300\">{query.specialRequests}</p>\n                      </div>\n                    )}\n                    \n                    {query.notes && (\n                      <div className=\"bg-indigo-50 dark:bg-indigo-900/30 p-4 rounded-lg border border-indigo-200 dark:border-indigo-800\">\n                        <div className=\"font-medium text-indigo-800 dark:text-indigo-200 mb-2\">Additional Notes</div>\n                        <p className=\"text-indigo-700 dark:text-indigo-300 whitespace-pre-wrap\">{query.notes}</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              </div>\n\n              {/* Right Column - Agent Details and Actions */}\n              <div className=\"lg:col-span-1 space-y-6\">\n                {/* Agent Details */}\n                <SupabaseAgentDetailsCard \n                  agentId={query?.agentUuid || \"\"}\n                  agentName={query?.agentName}\n                  agentCompany={query?.agentCompany}\n                />\n\n                {/* Assignment Actions */}\n                <QueryAssignmentActions query={query} />\n\n                {/* Proposal Actions */}\n                <ProposalActions \n                  query={query} \n                  onProposalStateChange={setProposalState}\n                  onQueryUpdate={(updatedQuery) => setQuery(updatedQuery)}\n                />\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"timeline\" className=\"space-y-6 mt-6\">\n            <EnquiryTimeline query={query} />\n          </TabsContent>\n          \n          <TabsContent value=\"proposals\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-6\">\n              {/* Created Proposals Section - Show First */}\n              {proposals.length > 0 && (\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <h3 className=\"text-xl font-semibold text-foreground\">Created Proposals ({proposals.length})</h3>\n                    <Badge variant=\"outline\" className=\"font-medium\">\n                      {proposals.length} proposal{proposals.length > 1 ? 's' : ''} ready\n                    </Badge>\n                  </div>\n                  \n                  {proposals.map((proposal) => (\n                    <Card key={proposal.id} className=\"shadow-lg hover:shadow-xl transition-all duration-300 bg-card border-border\">\n                      <CardHeader className=\"pb-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-t-lg\">\n                        <div className=\"flex justify-between items-start\">\n                          <div className=\"space-y-2\">\n                            <CardTitle className=\"text-xl font-bold text-card-foreground\">\n                              {proposal.title || `Proposal ${proposal.id}`}\n                            </CardTitle>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {proposal.description || 'Custom travel itinerary with selected services'}\n                            </p>\n                          </div>\n                          <div className=\"flex items-center gap-3\">\n                            <Badge variant=\"secondary\" className=\"capitalize font-medium\">\n                              {proposal.status || proposal.metadata?.status || 'Draft'}\n                            </Badge>\n                            <Badge variant=\"outline\">\n                              v{proposal.metadata?.version || '1'}\n                            </Badge>\n                          </div>\n                        </div>\n                      </CardHeader>\n                      \n                      <CardContent className=\"p-6 space-y-6\">\n                        {/* Enhanced Services Summary */}\n                        {proposal.modules && proposal.modules.length > 0 && (\n                          <div className=\"space-y-6\">\n                            <div className=\"flex items-center justify-between border-b pb-3\">\n                              <h4 className=\"text-xl font-bold text-foreground flex items-center gap-2\">\n                                <Star className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n                                Service Details ({proposal.modules.length} Services)\n                              </h4>\n                              <Badge variant=\"outline\" className=\"font-medium text-lg px-3 py-1\">\n                                Total: {formatDestinationCurrency(proposal.totals?.total || proposal.finalPrice || 0)}\n                              </Badge>\n                            </div>\n                            \n                            {/* Hotels Section */}\n                            {groupedModules.hotel.length > 0 && (\n                              <div className=\"space-y-4\">\n                                <div className=\"flex items-center gap-3 mb-4\">\n                                  <div className=\"bg-blue-100 dark:bg-blue-900/50 p-2 rounded-lg\">\n                                    <Hotel className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n                                  </div>\n                                  <div>\n                                    <h5 className=\"text-lg font-bold text-blue-800 dark:text-blue-200\">\n                                      Accommodation ({groupedModules.hotel.length})\n                                    </h5>\n                                    <p className=\"text-sm text-blue-600 dark:text-blue-400\">\n                                      {groupedModules.hotel.length} hotel{groupedModules.hotel.length > 1 ? 's' : ''} selected\n                                    </p>\n                                  </div>\n                                </div>\n                                \n                                <div className=\"grid gap-4\">\n                                  {groupedModules.hotel.map((module: any, index: number) => (\n                                    <Card key={module.id || index} className=\"border-blue-200 dark:border-blue-800 shadow-md\">\n                                      <CardHeader className=\"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 pb-3\">\n                                        <div className=\"flex justify-between items-start\">\n                                          <div className=\"flex-1\">\n                                            <CardTitle className=\"text-lg text-blue-900 dark:text-blue-100 flex items-center gap-2\">\n                                              <Hotel className=\"h-5 w-5\" />\n                                              {module.name}\n                                            </CardTitle>\n                                            {module.location && (\n                                              <p className=\"text-sm text-blue-600 dark:text-blue-400 flex items-center gap-1 mt-1\">\n                                                <MapPin className=\"h-3 w-3\" />\n                                                {module.location}\n                                              </p>\n                                            )}\n                                          </div>\n                                          <div className=\"text-right\">\n                                            <div className=\"text-xl font-bold text-blue-700 dark:text-blue-300\">\n                                              {formatDestinationCurrency(module.pricing?.finalPrice || module.pricing?.basePrice || 0)}\n                                            </div>\n                                            {module.pricing?.basePrice && module.pricing?.finalPrice && module.pricing.basePrice !== module.pricing.finalPrice && (\n                                              <div className=\"text-sm text-muted-foreground line-through\">\n                                                {formatDestinationCurrency(module.pricing.basePrice)}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      </CardHeader>\n                                      <CardContent className=\"p-4 space-y-3\">\n                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                                          {module.duration && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Calendar className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                                              <span className=\"font-medium\">Duration:</span>\n                                              <span>{module.duration}</span>\n                                            </div>\n                                          )}\n                                          {module.roomType && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Hotel className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                                              <span className=\"font-medium\">Room:</span>\n                                              <span>{module.roomType}</span>\n                                            </div>\n                                          )}\n                                          {module.roomCount && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Users className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                                              <span className=\"font-medium\">Rooms:</span>\n                                              <span>{module.roomCount}</span>\n                                            </div>\n                                          )}\n                                          {module.rating && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Star className=\"h-4 w-4 text-yellow-500\" />\n                                              <span className=\"font-medium\">Rating:</span>\n                                              <span>{module.rating}/5</span>\n                                            </div>\n                                          )}\n                                        </div>\n                                        \n                                        {(module.checkIn || module.checkOut || module.mealPlan) && (\n                                          <div className=\"bg-blue-50/50 dark:bg-blue-900/20 rounded-lg p-3 space-y-2\">\n                                            {module.checkIn && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-blue-700 dark:text-blue-300 font-medium\">Check-in:</span>\n                                                <span>{module.checkIn}</span>\n                                              </div>\n                                            )}\n                                            {module.checkOut && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-blue-700 dark:text-blue-300 font-medium\">Check-out:</span>\n                                                <span>{module.checkOut}</span>\n                                              </div>\n                                            )}\n                                            {module.mealPlan && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-blue-700 dark:text-blue-300 font-medium\">Meal Plan:</span>\n                                                <span className=\"capitalize\">{module.mealPlan}</span>\n                                              </div>\n                                            )}\n                                          </div>\n                                        )}\n                                        \n                                        {module.amenities && module.amenities.length > 0 && (\n                                          <div>\n                                            <div className=\"text-sm font-medium text-blue-700 dark:text-blue-300 mb-2\">Amenities:</div>\n                                            <div className=\"flex flex-wrap gap-1\">\n                                              {module.amenities.map((amenity: string, idx: number) => (\n                                                <Badge key={idx} variant=\"outline\" className=\"text-xs bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300\">\n                                                  {amenity}\n                                                </Badge>\n                                              ))}\n                                            </div>\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Transport Section */}\n                            {groupedModules.transport.length > 0 && (\n                              <div className=\"space-y-4\">\n                                <div className=\"flex items-center gap-3 mb-4\">\n                                  <div className=\"bg-green-100 dark:bg-green-900/50 p-2 rounded-lg\">\n                                    <Car className=\"h-6 w-6 text-green-600 dark:text-green-400\" />\n                                  </div>\n                                  <div>\n                                    <h5 className=\"text-lg font-bold text-green-800 dark:text-green-200\">\n                                      Transportation ({groupedModules.transport.length})\n                                    </h5>\n                                    <p className=\"text-sm text-green-600 dark:text-green-400\">\n                                      {groupedModules.transport.length} transport service{groupedModules.transport.length > 1 ? 's' : ''} arranged\n                                    </p>\n                                  </div>\n                                </div>\n                                \n                                <div className=\"grid gap-4\">\n                                  {groupedModules.transport.map((module: any, index: number) => (\n                                    <Card key={module.id || index} className=\"border-green-200 dark:border-green-800 shadow-md\">\n                                      <CardHeader className=\"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 pb-3\">\n                                        <div className=\"flex justify-between items-start\">\n                                          <div className=\"flex-1\">\n                                            <CardTitle className=\"text-lg text-green-900 dark:text-green-100 flex items-center gap-2\">\n                                              <Car className=\"h-5 w-5\" />\n                                              {module.name}\n                                            </CardTitle>\n                                            {(module.route || (module.from && module.to)) && (\n                                              <p className=\"text-sm text-green-600 dark:text-green-400 flex items-center gap-1 mt-1\">\n                                                <MapPin className=\"h-3 w-3\" />\n                                                {module.route || `${module.from} → ${module.to}`}\n                                              </p>\n                                            )}\n                                          </div>\n                                          <div className=\"text-right\">\n                                            <div className=\"text-xl font-bold text-green-700 dark:text-green-300\">\n                                              {formatDestinationCurrency(module.pricing?.finalPrice || module.pricing?.basePrice || 0)}\n                                            </div>\n                                            {module.pricing?.basePrice && module.pricing?.finalPrice && module.pricing.basePrice !== module.pricing.finalPrice && (\n                                              <div className=\"text-sm text-muted-foreground line-through\">\n                                                {formatDestinationCurrency(module.pricing.basePrice)}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      </CardHeader>\n                                      <CardContent className=\"p-4 space-y-3\">\n                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                                          {module.vehicleType && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Car className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                                              <span className=\"font-medium\">Vehicle:</span>\n                                              <span>{module.vehicleType}</span>\n                                            </div>\n                                          )}\n                                          {module.duration && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Clock className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                                              <span className=\"font-medium\">Duration:</span>\n                                              <span>{module.duration}</span>\n                                            </div>\n                                          )}\n                                          {module.distance && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Map className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                                              <span className=\"font-medium\">Distance:</span>\n                                              <span>{module.distance}</span>\n                                            </div>\n                                          )}\n                                          {module.capacity && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Users className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                                              <span className=\"font-medium\">Capacity:</span>\n                                              <span>{module.capacity}</span>\n                                            </div>\n                                          )}\n                                        </div>\n                                        \n                                        {(module.pickupTime || module.pickupLocation || module.dropoffLocation) && (\n                                          <div className=\"bg-green-50/50 dark:bg-green-900/20 rounded-lg p-3 space-y-2\">\n                                            {module.pickupTime && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-green-700 dark:text-green-300 font-medium\">Pickup Time:</span>\n                                                <span>{module.pickupTime}</span>\n                                              </div>\n                                            )}\n                                            {module.pickupLocation && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-green-700 dark:text-green-300 font-medium\">Pickup Location:</span>\n                                                <span>{module.pickupLocation}</span>\n                                              </div>\n                                            )}\n                                            {module.dropoffLocation && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-green-700 dark:text-green-300 font-medium\">Drop-off Location:</span>\n                                                <span>{module.dropoffLocation}</span>\n                                              </div>\n                                            )}\n                                          </div>\n                                        )}\n                                        \n                                        {module.driverDetails && (\n                                          <div className=\"bg-green-50/50 dark:bg-green-900/20 rounded-lg p-3\">\n                                            <div className=\"text-sm font-medium text-green-700 dark:text-green-300 mb-1\">Driver Details:</div>\n                                            <div className=\"text-sm\">{module.driverDetails}</div>\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Sightseeing Section */}\n                            {groupedModules.sightseeing.length > 0 && (\n                              <div className=\"space-y-4\">\n                                <div className=\"flex items-center gap-3 mb-4\">\n                                  <div className=\"bg-orange-100 dark:bg-orange-900/50 p-2 rounded-lg\">\n                                    <Landmark className=\"h-6 w-6 text-orange-600 dark:text-orange-400\" />\n                                  </div>\n                                  <div>\n                                    <h5 className=\"text-lg font-bold text-orange-800 dark:text-orange-200\">\n                                      Sightseeing & Activities ({groupedModules.sightseeing.length})\n                                    </h5>\n                                    <p className=\"text-sm text-orange-600 dark:text-orange-400\">\n                                      {groupedModules.sightseeing.length} attraction{groupedModules.sightseeing.length > 1 ? 's' : ''} & activities planned\n                                    </p>\n                                  </div>\n                                </div>\n                                \n                                <div className=\"grid gap-4\">\n                                  {groupedModules.sightseeing.map((module: any, index: number) => (\n                                    <Card key={module.id || index} className=\"border-orange-200 dark:border-orange-800 shadow-md\">\n                                      <CardHeader className=\"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/30 pb-3\">\n                                        <div className=\"flex justify-between items-start\">\n                                          <div className=\"flex-1\">\n                                            <CardTitle className=\"text-lg text-orange-900 dark:text-orange-100 flex items-center gap-2\">\n                                              <Landmark className=\"h-5 w-5\" />\n                                              {module.name}\n                                            </CardTitle>\n                                            {module.location && (\n                                              <p className=\"text-sm text-orange-600 dark:text-orange-400 flex items-center gap-1 mt-1\">\n                                                <MapPin className=\"h-3 w-3\" />\n                                                {module.location}\n                                              </p>\n                                            )}\n                                            {module.description && (\n                                              <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                                                {module.description}\n                                              </p>\n                                            )}\n                                          </div>\n                                          <div className=\"text-right\">\n                                            <div className=\"text-xl font-bold text-orange-700 dark:text-orange-300\">\n                                              {formatDestinationCurrency(module.pricing?.finalPrice || module.pricing?.basePrice || 0)}\n                                            </div>\n                                            {module.pricing?.basePrice && module.pricing?.finalPrice && module.pricing.basePrice !== module.pricing.finalPrice && (\n                                              <div className=\"text-sm text-muted-foreground line-through\">\n                                                {formatDestinationCurrency(module.pricing.basePrice)}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      </CardHeader>\n                                      <CardContent className=\"p-4 space-y-3\">\n                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                                          {module.duration && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Clock className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n                                              <span className=\"font-medium\">Duration:</span>\n                                              <span>{module.duration}</span>\n                                            </div>\n                                          )}\n                                          {module.category && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Star className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n                                              <span className=\"font-medium\">Category:</span>\n                                              <span>{module.category}</span>\n                                            </div>\n                                          )}\n                                          {module.difficulty && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <AlertTriangle className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n                                              <span className=\"font-medium\">Difficulty:</span>\n                                              <span>{module.difficulty}</span>\n                                            </div>\n                                          )}\n                                          {module.groupSize && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Users className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n                                              <span className=\"font-medium\">Group Size:</span>\n                                              <span>Max {module.groupSize}</span>\n                                            </div>\n                                          )}\n                                        </div>\n                                        \n                                        {(module.entryFees || module.guideCost || module.transportIncluded) && (\n                                          <div className=\"bg-orange-50/50 dark:bg-orange-900/20 rounded-lg p-3 space-y-2\">\n                                            {module.entryFees && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-orange-700 dark:text-orange-300 font-medium\">Entry Fees:</span>\n                                                <span>{formatDestinationCurrency(module.entryFees)}</span>\n                                              </div>\n                                            )}\n                                            {module.guideCost && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-orange-700 dark:text-orange-300 font-medium\">Guide Cost:</span>\n                                                <span>{formatDestinationCurrency(module.guideCost)}</span>\n                                              </div>\n                                            )}\n                                            {module.transportIncluded && (\n                                              <div className=\"flex items-center text-sm text-orange-700 dark:text-orange-300\">\n                                                <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                                Transport included\n                                              </div>\n                                            )}\n                                          </div>\n                                        )}\n                                        \n                                        {module.includes && module.includes.length > 0 && (\n                                          <div>\n                                            <div className=\"text-sm font-medium text-orange-700 dark:text-orange-300 mb-2\">Includes:</div>\n                                            <div className=\"flex flex-wrap gap-1\">\n                                              {module.includes.map((item: string, idx: number) => (\n                                                <Badge key={idx} variant=\"outline\" className=\"text-xs bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300\">\n                                                  {item}\n                                                </Badge>\n                                              ))}\n                                            </div>\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Dining Section */}\n                            {groupedModules.restaurant.length > 0 && (\n                              <div className=\"space-y-4\">\n                                <div className=\"flex items-center gap-3 mb-4\">\n                                  <div className=\"bg-purple-100 dark:bg-purple-900/50 p-2 rounded-lg\">\n                                    <Utensils className=\"h-6 w-6 text-purple-600 dark:text-purple-400\" />\n                                  </div>\n                                  <div>\n                                    <h5 className=\"text-lg font-bold text-purple-800 dark:text-purple-200\">\n                                      Dining ({groupedModules.restaurant.length})\n                                    </h5>\n                                    <p className=\"text-sm text-purple-600 dark:text-purple-400\">\n                                      {groupedModules.restaurant.length} dining experience{groupedModules.restaurant.length > 1 ? 's' : ''} included\n                                    </p>\n                                  </div>\n                                </div>\n                                \n                                <div className=\"grid gap-4\">\n                                  {groupedModules.restaurant.map((module: any, index: number) => (\n                                    <Card key={module.id || index} className=\"border-purple-200 dark:border-purple-800 shadow-md\">\n                                      <CardHeader className=\"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 pb-3\">\n                                        <div className=\"flex justify-between items-start\">\n                                          <div className=\"flex-1\">\n                                            <CardTitle className=\"text-lg text-purple-900 dark:text-purple-100 flex items-center gap-2\">\n                                              <Utensils className=\"h-5 w-5\" />\n                                              {module.name}\n                                            </CardTitle>\n                                            {module.location && (\n                                              <p className=\"text-sm text-purple-600 dark:text-purple-400 flex items-center gap-1 mt-1\">\n                                                <MapPin className=\"h-3 w-3\" />\n                                                {module.location}\n                                              </p>\n                                            )}\n                                            {module.cuisine && (\n                                              <p className=\"text-sm text-purple-600 dark:text-purple-400 mt-1\">\n                                                {module.cuisine} Cuisine\n                                              </p>\n                                            )}\n                                          </div>\n                                          <div className=\"text-right\">\n                                            <div className=\"text-xl font-bold text-purple-700 dark:text-purple-300\">\n                                              {formatDestinationCurrency(module.pricing?.finalPrice || module.pricing?.basePrice || 0)}\n                                            </div>\n                                            {module.pricing?.basePrice && module.pricing?.finalPrice && module.pricing.basePrice !== module.pricing.finalPrice && (\n                                              <div className=\"text-sm text-muted-foreground line-through\">\n                                                {formatDestinationCurrency(module.pricing.basePrice)}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      </CardHeader>\n                                      <CardContent className=\"p-4 space-y-3\">\n                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                                          {module.mealType && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Utensils className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                                              <span className=\"font-medium\">Meal:</span>\n                                              <span>{module.mealType}</span>\n                                            </div>\n                                          )}\n                                          {module.rating && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Star className=\"h-4 w-4 text-yellow-500\" />\n                                              <span className=\"font-medium\">Rating:</span>\n                                              <span>{module.rating}/5</span>\n                                            </div>\n                                          )}\n                                          {module.priceRange && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <DollarSign className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                                              <span className=\"font-medium\">Price Range:</span>\n                                              <span>{module.priceRange}</span>\n                                            </div>\n                                          )}\n                                          {module.seatingCapacity && (\n                                            <div className=\"flex items-center gap-2 text-sm\">\n                                              <Users className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                                              <span className=\"font-medium\">Capacity:</span>\n                                              <span>{module.seatingCapacity}</span>\n                                            </div>\n                                          )}\n                                        </div>\n                                        \n                                        {(module.dietaryOptions || module.reservationRequired || module.dresscode) && (\n                                          <div className=\"bg-purple-50/50 dark:bg-purple-900/20 rounded-lg p-3 space-y-2\">\n                                            {module.dietaryOptions && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-purple-700 dark:text-purple-300 font-medium\">Dietary Options:</span>\n                                                <span>{Array.isArray(module.dietaryOptions) ? module.dietaryOptions.join(', ') : module.dietaryOptions}</span>\n                                              </div>\n                                            )}\n                                            {module.reservationRequired && (\n                                              <div className=\"flex items-center text-sm text-purple-700 dark:text-purple-300\">\n                                                <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n                                                Reservation required\n                                              </div>\n                                            )}\n                                            {module.dresscode && (\n                                              <div className=\"flex justify-between text-sm\">\n                                                <span className=\"text-purple-700 dark:text-purple-300 font-medium\">Dress Code:</span>\n                                                <span>{module.dresscode}</span>\n                                              </div>\n                                            )}\n                                          </div>\n                                        )}\n                                        \n                                        {module.specialFeatures && module.specialFeatures.length > 0 && (\n                                          <div>\n                                            <div className=\"text-sm font-medium text-purple-700 dark:text-purple-300 mb-2\">Special Features:</div>\n                                            <div className=\"flex flex-wrap gap-1\">\n                                              {module.specialFeatures.map((feature: string, idx: number) => (\n                                                <Badge key={idx} variant=\"outline\" className=\"text-xs bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300\">\n                                                  {feature}\n                                                </Badge>\n                                              ))}\n                                            </div>\n                                          </div>\n                                        )}\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Other Services Section */}\n                            {groupedModules.other.length > 0 && (\n                              <div className=\"space-y-4\">\n                                <div className=\"flex items-center gap-3 mb-4\">\n                                  <div className=\"bg-gray-100 dark:bg-gray-800 p-2 rounded-lg\">\n                                    <Star className=\"h-6 w-6 text-gray-600 dark:text-gray-400\" />\n                                  </div>\n                                  <div>\n                                    <h5 className=\"text-lg font-bold text-gray-800 dark:text-gray-200\">\n                                      Additional Services ({groupedModules.other.length})\n                                    </h5>\n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                                      {groupedModules.other.length} additional service{groupedModules.other.length > 1 ? 's' : ''} included\n                                    </p>\n                                  </div>\n                                </div>\n                                \n                                <div className=\"grid gap-3\">\n                                  {groupedModules.other.map((module: any, index: number) => (\n                                    <Card key={module.id || index} className=\"border-gray-200 dark:border-gray-700\">\n                                      <CardContent className=\"p-4\">\n                                        <div className=\"flex justify-between items-start\">\n                                          <div className=\"flex-1\">\n                                            <h6 className=\"font-medium text-lg\">{module.name}</h6>\n                                            {module.description && (\n                                              <p className=\"text-sm text-muted-foreground mt-1\">{module.description}</p>\n                                            )}\n                                            {module.location && (\n                                              <p className=\"text-sm text-muted-foreground flex items-center gap-1 mt-1\">\n                                                <MapPin className=\"h-3 w-3\" />\n                                                {module.location}\n                                              </p>\n                                            )}\n                                          </div>\n                                          <div className=\"text-right\">\n                                            <div className=\"font-semibold text-lg\">\n                                              {formatDestinationCurrency(module.pricing?.finalPrice || module.pricing?.basePrice || 0)}\n                                            </div>\n                                            {module.pricing?.basePrice && module.pricing?.finalPrice && module.pricing.basePrice !== module.pricing.finalPrice && (\n                                              <div className=\"text-sm text-muted-foreground line-through\">\n                                                {formatDestinationCurrency(module.pricing.basePrice)}\n                                              </div>\n                                            )}\n                                          </div>\n                                        </div>\n                                      </CardContent>\n                                    </Card>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        )}\n                        \n                        {/* Enhanced Pricing Summary */}\n                        <div className=\"bg-gradient-to-r from-slate-50 to-slate-100 dark:from-slate-800 dark:to-slate-900 rounded-lg p-6 border-2 border-slate-200 dark:border-slate-700\">\n                          <h4 className=\"text-lg font-bold mb-4 text-slate-800 dark:text-slate-200 flex items-center gap-2\">\n                            <DollarSign className=\"h-5 w-5\" />\n                            Pricing Summary\n                          </h4>\n                          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                            <div className=\"text-center p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border\">\n                              <p className=\"text-sm text-muted-foreground mb-1\">Services</p>\n                              <p className=\"font-bold text-lg text-blue-600 dark:text-blue-400\">\n                                {proposal.modules?.length || proposal.totals?.moduleCount || 0}\n                              </p>\n                            </div>\n                            <div className=\"text-center p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border\">\n                              <p className=\"text-sm text-muted-foreground mb-1\">Subtotal</p>\n                              <p className=\"font-bold text-lg text-green-600 dark:text-green-400\">\n                                {formatDestinationCurrency(proposal.totals?.subtotal || proposal.totalCost || 0)}\n                              </p>\n                            </div>\n                            <div className=\"text-center p-3 bg-white/80 dark:bg-gray-800/80 rounded-lg border\">\n                              <p className=\"text-sm text-muted-foreground mb-1\">Discount</p>\n                              <p className=\"font-bold text-lg text-orange-600 dark:text-orange-400\">\n                                -{formatDestinationCurrency(proposal.totals?.discountAmount || 0)}\n                              </p>\n                            </div>\n                            <div className=\"text-center p-3 bg-gradient-to-br from-purple-100 to-purple-200 dark:from-purple-900/40 dark:to-purple-800/40 rounded-lg border-2 border-purple-300 dark:border-purple-600\">\n                              <p className=\"text-sm text-purple-700 dark:text-purple-300 mb-1 font-medium\">Final Total</p>\n                              <p className=\"font-bold text-xl text-purple-800 dark:text-purple-200\">\n                                {formatDestinationCurrency(proposal.totals?.total || proposal.finalPrice || 0)}\n                              </p>\n                            </div>\n                          </div>\n\n                          {/* Per Person Breakdown */}\n                          {(proposal.totals?.total || proposal.finalPrice) && totalPax > 0 && (\n                            <div className=\"mt-4 p-3 bg-blue-50/50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-700\">\n                              <div className=\"flex justify-between items-center\">\n                                <div className=\"flex items-center gap-2\">\n                                  <Users className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                                  <span className=\"text-sm font-medium text-blue-800 dark:text-blue-200\">Per Person:</span>\n                                </div>\n                                <div className=\"text-right\">\n                                  <p className=\"font-bold text-blue-800 dark:text-blue-200\">\n                                    {formatDestinationCurrency((proposal.totals?.total || proposal.finalPrice || 0) / totalPax)}\n                                  </p>\n                                  <p className=\"text-xs text-blue-600 dark:text-blue-400\">\n                                    for {totalPax} passenger{totalPax > 1 ? 's' : ''}\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Metadata */}\n                        <div className=\"flex justify-between items-center text-xs text-muted-foreground pt-4 border-t\">\n                          <div className=\"flex items-center gap-4\">\n                            <span className=\"flex items-center gap-1\">\n                              <Calendar className=\"h-3 w-3\" />\n                              Created: {new Date(proposal.metadata?.createdAt || proposal.createdAt || Date.now()).toLocaleDateString()}\n                            </span>\n                            {proposal.metadata?.updatedAt && (\n                              <span className=\"flex items-center gap-1\">\n                                <Clock className=\"h-3 w-3\" />\n                                Updated: {new Date(proposal.metadata.updatedAt).toLocaleDateString()}\n                              </span>\n                            )}\n                          </div>\n                        </div>\n                        \n                        {/* Action Buttons - Enhanced */}\n                        <div className=\"flex justify-between items-center pt-4 border-t bg-gradient-to-r from-gray-50/50 to-blue-50/50 dark:from-gray-800/50 dark:to-blue-900/50 rounded-lg p-4 -mx-2\">\n                          <div className=\"flex space-x-2\">\n                            <Button \n                              size=\"sm\" \n                              variant=\"outline\"\n                              onClick={() => {\n                                const newProposalId = EnhancedProposalService.duplicateProposal(proposal.id, query.id);\n                                if (newProposalId) {\n                                  toast({\n                                    title: \"New Proposal Created\",\n                                    description: `New proposal ${newProposalId} created successfully`\n                                  });\n                                  window.location.reload();\n                                }\n                              }}\n                              className=\"hover:bg-blue-50 dark:hover:bg-blue-900/20\"\n                            >\n                              <Plus className=\"h-4 w-4 mr-2\" />\n                              Create New\n                            </Button>\n                            <Button \n                              size=\"sm\" \n                              variant=\"outline\"\n                              onClick={() => {\n                                const duplicateId = EnhancedProposalService.duplicateProposal(proposal.id);\n                                if (duplicateId) {\n                                  toast({\n                                    title: \"Proposal Duplicated\",\n                                    description: `Proposal duplicated as ${duplicateId}`\n                                  });\n                                  window.location.reload();\n                                }\n                              }}\n                              className=\"hover:bg-green-50 dark:hover:bg-green-900/20\"\n                            >\n                              <Copy className=\"h-4 w-4 mr-2\" />\n                              Duplicate\n                            </Button>\n                          </div>\n                          \n                          <div className=\"flex space-x-2\">\n                            <Button \n                              size=\"sm\" \n                              variant=\"outline\"\n                              onClick={() => handleViewProposalDetails(proposal.id)}\n                              className=\"hover:bg-gray-50 dark:hover:bg-gray-900/20\"\n                            >\n                              <Eye className=\"h-4 w-4 mr-2\" />\n                              View Details\n                            </Button>\n                            <Button \n                              size=\"sm\"\n                              onClick={() => handleSendToAgent(proposal)}\n                              className=\"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800\"\n                            >\n                              <Send className=\"h-4 w-4 mr-2\" />\n                              Send to Agent\n                            </Button>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n\n              {/* Create New Proposal Section - Show After Existing Proposals */}\n              <div className=\"border-t pt-6\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"text-xl font-semibold text-foreground\">Create New Proposal</h3>\n                  <Badge variant=\"outline\" className=\"flex items-center gap-1\">\n                    <Plus className=\"h-3 w-3\" />\n                    New\n                  </Badge>\n                </div>\n                \n                <div className=\"bg-gradient-to-br from-blue-50/50 to-indigo-50/50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-lg border border-blue-200 dark:border-blue-800 p-6\">\n                  <ProposalActions \n                    query={query} \n                    onProposalStateChange={setProposalState}\n                    onQueryUpdate={(updatedQuery) => setQuery(updatedQuery)}\n                    enableAutoStatusUpdate={false}\n                  />\n                </div>\n              </div>\n            </div>\n          </TabsContent>\n          \n          <TabsContent value=\"followups\" className=\"space-y-6 mt-6\">\n            <div className=\"flex flex-col items-center justify-center p-12 text-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-lg border border-border\">\n              <Calendar className=\"h-16 w-16 text-muted-foreground mb-4\" />\n              <h3 className=\"text-xl font-semibold mb-2 text-foreground\">No Follow-ups Yet</h3>\n              <p className=\"text-muted-foreground mb-6 max-w-md\">\n                No follow-ups have been scheduled for this query. Stay organized by setting up follow-up reminders.\n              </p>\n              <Button className=\"bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800\">\n                <Calendar className=\"mr-2 h-4 w-4\" />\n                Schedule Follow-up\n              </Button>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        {/* Send to Agent Dialog */}\n        <Dialog open={sendDialogOpen} onOpenChange={setSendDialogOpen}>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Send Proposal to Agent</DialogTitle>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"method\">Send Method</Label>\n                <Select \n                  value={sendOptions.method} \n                  onValueChange={(value) => setSendOptions(prev => ({ ...prev, method: value }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"email\">Email</SelectItem>\n                    <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\n                    <SelectItem value=\"sms\">SMS</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"recipient\">Recipient</Label>\n                <Input\n                  id=\"recipient\"\n                  value={sendOptions.recipient}\n                  onChange={(e) => setSendOptions(prev => ({ ...prev, recipient: e.target.value }))}\n                  placeholder={sendOptions.method === 'email' ? 'agent@example.com' : 'Agent Name'}\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"urgency\">Priority</Label>\n                <Select \n                  value={sendOptions.urgency} \n                  onValueChange={(value) => setSendOptions(prev => ({ ...prev, urgency: value }))}\n                >\n                  <SelectTrigger>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"low\">Low Priority</SelectItem>\n                    <SelectItem value=\"normal\">Normal</SelectItem>\n                    <SelectItem value=\"high\">High Priority</SelectItem>\n                    <SelectItem value=\"urgent\">Urgent</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {sendOptions.method === 'email' && (\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"subject\">Subject</Label>\n                  <Input\n                    id=\"subject\"\n                    value={sendOptions.subject}\n                    onChange={(e) => setSendOptions(prev => ({ ...prev, subject: e.target.value }))}\n                    placeholder=\"Email subject\"\n                  />\n                </div>\n              )}\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"message\">Message</Label>\n                <Textarea\n                  id=\"message\"\n                  value={sendOptions.message}\n                  onChange={(e) => setSendOptions(prev => ({ ...prev, message: e.target.value }))}\n                  placeholder=\"Additional message or instructions...\"\n                  rows={4}\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button variant=\"outline\" onClick={() => setSendDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button onClick={handleSendProposal}>\n                  <Send className=\"h-4 w-4 mr-2\" />\n                  Send Proposal\n                </Button>\n              </div>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default QueryDetails;\n","import React, { useState } from 'react';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Calendar } from '@/components/ui/calendar';\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';\nimport { CalendarIcon, Users, MapPin, DollarSign } from 'lucide-react';\nimport { format } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport { Query } from '@/types/query';\nimport { createEnquiry } from '@/services/enquiriesService';\nimport { useAgentData } from '@/hooks/useAgentData';\nimport { useToast } from '@/hooks/use-toast';\nimport { EnqIdGenerator } from '@/utils/enqIdGenerator';\nimport { useRealTimeCountriesData } from '@/hooks/useRealTimeCountriesData';\nimport { getCountryCodeByName } from '@/utils/countryUtils';\n\ninterface QuickCreateQueryProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess?: (query: Query) => void;\n}\n\nconst QuickCreateQuery: React.FC<QuickCreateQueryProps> = ({ isOpen, onClose, onSuccess }) => {\n  const { activeAgents } = useAgentData();\n  const { activeCountries } = useRealTimeCountriesData();\n  const { toast } = useToast();\n  \n  // Form state\n  const [agentId, setAgentId] = useState('');\n  const [destination, setDestination] = useState({ country: '', cities: [''] });\n  const [paxDetails, setPaxDetails] = useState({ adults: 2, children: 0, infants: 0 });\n  const [travelDates, setTravelDates] = useState({ from: null as Date | null, to: null as Date | null });\n  const [packageType, setPackageType] = useState('full-package');\n  const [budget, setBudget] = useState({ min: 0, max: 0, currency: 'USD' });\n  const [notes, setNotes] = useState('');\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const generateQueryId = async () => {\n    const selectedCountryCode = getCountryCodeByName(destination.country);\n    console.log('QuickCreateQuery: Mapped country name to code:', { \n      countryName: destination.country, \n      countryCode: selectedCountryCode \n    });\n\n    // Prepare Supabase-backed config and active countries cache\n    await EnqIdGenerator.prepareConfig(selectedCountryCode);\n\n    const enquiryId = EnqIdGenerator.generateEnqId(selectedCountryCode);\n    console.log('QuickCreateQuery: Generated enquiry ID:', enquiryId);\n    return enquiryId;\n  };\n\n  const calculateTripDuration = () => {\n    if (travelDates.from && travelDates.to) {\n      const timeDiff = travelDates.to.getTime() - travelDates.from.getTime();\n      const days = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;\n      const nights = days - 1;\n      return { days, nights };\n    }\n    return { days: 0, nights: 0 };\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!agentId || !destination.country || !travelDates.from || !travelDates.to) {\n      toast({\n        title: \"Missing Information\",\n        description: \"Please fill in all required fields\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n\n    try {\n      const selectedAgent = activeAgents.find(agent => agent.id === parseInt(agentId));\n      const tripDuration = calculateTripDuration();\n      \n      const newQuery: Query = {\n        id: await generateQueryId(),\n        agentId: parseInt(agentId),\n        agentName: selectedAgent?.name || 'Unknown Agent',\n        destination: {\n          country: destination.country,\n          cities: destination.cities.filter(city => city.trim() !== '')\n        },\n        paxDetails,\n        travelDates: {\n          from: travelDates.from!.toISOString(),\n          to: travelDates.to!.toISOString(),\n          isEstimated: false\n        },\n        tripDuration,\n        packageType,\n        specialRequests: [],\n        budget,\n        status: 'new',\n        assignedTo: null,\n        createdAt: new Date().toISOString(),\n        updatedAt: new Date().toISOString(),\n        priority: 'medium',\n        notes,\n        communicationPreference: 'email',\n        hotelDetails: {\n          rooms: Math.ceil((paxDetails.adults + paxDetails.children) / 2),\n          category: 'standard'\n        },\n        inclusions: {\n          sightseeing: true,\n          transfers: 'airport',\n          mealPlan: 'breakfast'\n        }\n      };\n\n      // Persist to Supabase\n      const { data: created, error } = await createEnquiry(newQuery);\n      if (error) {\n        throw error;\n      }\n\n      // Call success callback\n      if (onSuccess) {\n        onSuccess(created || newQuery);\n      }\n\n      // Reset form\n      setAgentId('');\n      setDestination({ country: '', cities: [''] });\n      setPaxDetails({ adults: 2, children: 0, infants: 0 });\n      setTravelDates({ from: null, to: null });\n      setPackageType('full-package');\n      setBudget({ min: 0, max: 0, currency: 'USD' });\n      setNotes('');\n\n      toast({\n        title: \"Quick Query Created\",\n        description: `Enquiry ${(created || newQuery).id} has been created successfully`,\n      });\n\n    } catch (error) {\n      console.error('Error creating query:', error);\n      toast({\n        title: \"Error\",\n        description: \"Failed to create query. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const addCity = () => {\n    setDestination(prev => ({\n      ...prev,\n      cities: [...prev.cities, '']\n    }));\n  };\n\n  const updateCity = (index: number, value: string) => {\n    setDestination(prev => ({\n      ...prev,\n      cities: prev.cities.map((city, i) => i === index ? value : city)\n    }));\n  };\n\n  const removeCity = (index: number) => {\n    setDestination(prev => ({\n      ...prev,\n      cities: prev.cities.filter((_, i) => i !== index)\n    }));\n  };\n\n  const totalPax = paxDetails.adults + paxDetails.children + paxDetails.infants;\n  const duration = calculateTripDuration();\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5 text-blue-600\" />\n            Quick Create Enquiry\n          </DialogTitle>\n          <DialogDescription>\n            Quickly create a new travel enquiry for an agent\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          {/* Agent Selection */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"agent\">Select Agent *</Label>\n            <Select value={agentId} onValueChange={setAgentId}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"Choose an agent\" />\n              </SelectTrigger>\n              <SelectContent>\n                {activeAgents.map((agent) => (\n                  <SelectItem key={agent.id} value={agent.id.toString()}>\n                    {agent.name} - {agent.email}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Destination */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <MapPin className=\"h-4 w-4 text-green-600\" />\n              <Label className=\"text-base font-medium\">Destination *</Label>\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label htmlFor=\"country\">Country</Label>\n              <Select value={destination.country} onValueChange={(value) => setDestination(prev => ({ ...prev, country: value }))}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Select destination country\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {activeCountries.map((country) => (\n                    <SelectItem key={country.code} value={country.name}>\n                      {country.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Cities</Label>\n              {destination.cities.map((city, index) => (\n                <div key={index} className=\"flex gap-2\">\n                  <Input\n                    value={city}\n                    onChange={(e) => updateCity(index, e.target.value)}\n                    placeholder=\"Enter city name\"\n                    className=\"flex-1\"\n                  />\n                  {destination.cities.length > 1 && (\n                    <Button type=\"button\" variant=\"outline\" size=\"sm\" onClick={() => removeCity(index)}>\n                      Remove\n                    </Button>\n                  )}\n                </div>\n              ))}\n              <Button type=\"button\" variant=\"outline\" onClick={addCity} className=\"w-full\">\n                Add City\n              </Button>\n            </div>\n          </div>\n\n          {/* Travel Information */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-4\">\n              <Label className=\"text-base font-medium\">Passenger Details</Label>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"adults\">Adults *</Label>\n                <Input\n                  id=\"adults\"\n                  type=\"number\"\n                  min=\"1\"\n                  value={paxDetails.adults}\n                  onChange={(e) => setPaxDetails(prev => ({ ...prev, adults: parseInt(e.target.value) || 0 }))}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"children\">Children</Label>\n                <Input\n                  id=\"children\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={paxDetails.children}\n                  onChange={(e) => setPaxDetails(prev => ({ ...prev, children: parseInt(e.target.value) || 0 }))}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"infants\">Infants</Label>\n                <Input\n                  id=\"infants\"\n                  type=\"number\"\n                  min=\"0\"\n                  value={paxDetails.infants}\n                  onChange={(e) => setPaxDetails(prev => ({ ...prev, infants: parseInt(e.target.value) || 0 }))}\n                />\n              </div>\n              {totalPax > 0 && (\n                <div className=\"text-sm text-blue-600 font-medium\">\n                  Total PAX: {totalPax}\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-4\">\n              <Label className=\"text-base font-medium\">Travel Dates *</Label>\n              <div className=\"space-y-2\">\n                <Label>Departure Date</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className={cn(\n                        \"w-full justify-start text-left font-normal\",\n                        !travelDates.from && \"text-muted-foreground\"\n                      )}\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {travelDates.from ? format(travelDates.from, \"PPP\") : \"Select date\"}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={travelDates.from}\n                      onSelect={(date) => setTravelDates(prev => ({ ...prev, from: date }))}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>Return Date</Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className={cn(\n                        \"w-full justify-start text-left font-normal\",\n                        !travelDates.to && \"text-muted-foreground\"\n                      )}\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {travelDates.to ? format(travelDates.to, \"PPP\") : \"Select date\"}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={travelDates.to}\n                      onSelect={(date) => setTravelDates(prev => ({ ...prev, to: date }))}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              {duration.days > 0 && (\n                <div className=\"text-sm text-green-600 font-medium\">\n                  Duration: {duration.days}D/{duration.nights}N\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Package Type & Budget */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"packageType\">Package Type</Label>\n              <Select value={packageType} onValueChange={setPackageType}>\n                <SelectTrigger>\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"transport-only\">Transport Only</SelectItem>\n                  <SelectItem value=\"hotel-only\">Hotel Only</SelectItem>\n                  <SelectItem value=\"full-package\">Full Package</SelectItem>\n                  <SelectItem value=\"luxury\">Luxury Package</SelectItem>\n                  <SelectItem value=\"business\">Business Package</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-1\">\n                <DollarSign className=\"h-4 w-4\" />\n                Budget Range\n              </Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  type=\"number\"\n                  placeholder=\"Min\"\n                  value={budget.min || ''}\n                  onChange={(e) => setBudget(prev => ({ ...prev, min: parseInt(e.target.value) || 0 }))}\n                />\n                <Input\n                  type=\"number\"\n                  placeholder=\"Max\"\n                  value={budget.max || ''}\n                  onChange={(e) => setBudget(prev => ({ ...prev, max: parseInt(e.target.value) || 0 }))}\n                />\n                <Select value={budget.currency} onValueChange={(value) => setBudget(prev => ({ ...prev, currency: value }))}>\n                  <SelectTrigger className=\"w-20\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"USD\">USD</SelectItem>\n                    <SelectItem value=\"EUR\">EUR</SelectItem>\n                    <SelectItem value=\"GBP\">GBP</SelectItem>\n                    <SelectItem value=\"INR\">INR</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </div>\n\n          {/* Notes */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"notes\">Additional Notes</Label>\n            <Textarea\n              id=\"notes\"\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              placeholder=\"Any special requirements or notes...\"\n              rows={3}\n            />\n          </div>\n\n          {/* Submit Actions */}\n          <div className=\"flex gap-3 justify-end pt-4 border-t\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancel\n            </Button>\n            <Button type=\"submit\" disabled={isSubmitting} className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\">\n              {isSubmitting ? 'Creating...' : 'Create Quick Enquiry'}\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default QuickCreateQuery;\n","import React, { useState, useMemo, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport PageLayout from '@/components/layout/PageLayout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Checkbox } from '@/components/ui/checkbox';\nimport { \n  Plus, \n  Search, \n  Filter, \n  Download, \n  Upload, \n  ArrowRightLeft,\n  MapPin,\n  Clock,\n  User,\n  Zap,\n  CheckCircle,\n  AlertCircle,\n  ArrowUpDown,\n  ArrowDown,\n  ArrowUp,\n  CalendarDays,\n  Grid3X3,\n  List,\n  BarChart3,\n  RefreshCw,\n  Settings,\n  Activity,\n  Timer,\n  TrendingUp,\n  Edit\n} from 'lucide-react';\nimport { mockQueries } from '@/data/queryData';\nimport { useAutoAssignmentSettings } from '@/hooks/useAutoAssignmentSettings';\nimport { useActiveStaffData } from '@/hooks/useActiveStaffData';\nimport { Query } from '@/types/query';\nimport QuickCreateQuery from './components/QuickCreateQuery';\nimport { CountryBasedAssignmentDialog } from '@/components/queries/CountryBasedAssignmentDialog';\nimport QueryFiltersComponent from '@/components/queries/components/QueryFilters';\nimport EnhancedEnquiryCard from '@/components/queries/EnhancedEnquiryCard';\nimport EnquiryListTable from '@/components/queries/EnquiryListTable';\nimport ResponsiveTestPanel from '@/components/queries/ResponsiveTestPanel';\nimport BulkOperationsPanel from '@/components/queries/BulkOperationsPanel';\nimport AdvancedFilters from '@/components/queries/AdvancedFilters';\nimport { useQueryFilters } from '@/components/queries/hooks/useQueryFilters';\nimport { useQueryPagination } from '@/components/queries/hooks/useQueryPagination';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface SortConfig {\n  key: 'createdAt' | 'agentName' | 'destination' | 'status' | 'pax' | 'priority' | 'lastActivity' | 'budget' | 'departure';\n  direction: 'asc' | 'desc';\n}\n\nconst Queries: React.FC = () => {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { isAutoAssignmentEnabled } = useAutoAssignmentSettings();\n  const { activeStaff } = useActiveStaffData();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedStatus, setSelectedStatus] = useState<string>('all');\n  const [sortConfig, setSortConfig] = useState<SortConfig>({ key: 'createdAt', direction: 'desc' });\n  const [showQuickCreate, setShowQuickCreate] = useState(false);\n  const [showCountryAssignment, setShowCountryAssignment] = useState(false);\n  const [selectedQuery, setSelectedQuery] = useState<Query | null>(null);\n  const [viewMode, setViewMode] = useState<'card' | 'table'>('card');\n  const [selectedQueries, setSelectedQueries] = useState<Query[]>([]);\n  const [showAdvancedFilters, setShowAdvancedFilters] = useState(false);\n  const [isRealTimeEnabled, setIsRealTimeEnabled] = useState(true);\n  const [lastRefresh, setLastRefresh] = useState(new Date());\n  const [queries, setQueries] = useState<Query[]>([]);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  // Load queries from localStorage and merge with mock data, sorted by creation date (newest first)\n  useEffect(() => {\n    const loadQueries = () => {\n      try {\n        const savedQueries = localStorage.getItem('travel_queries');\n        let allQueries: Query[] = [];\n\n        if (savedQueries) {\n          const parsedQueries = JSON.parse(savedQueries);\n          // Use saved queries as primary source\n          allQueries = Array.isArray(parsedQueries) ? parsedQueries : [];\n        } else {\n          // Fall back to mock data if no saved queries\n          allQueries = [...mockQueries];\n          // Save mock data to localStorage for future use\n          localStorage.setItem('travel_queries', JSON.stringify(allQueries));\n        }\n\n        // Sort by creation date (newest first)\n        allQueries.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n        \n        setQueries(allQueries);\n        console.log('Loaded queries:', allQueries.length);\n      } catch (error) {\n        console.error('Error loading queries:', error);\n        // Fall back to mock data on error\n        const sortedMockQueries = [...mockQueries].sort((a, b) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n        setQueries(sortedMockQueries);\n        localStorage.setItem('travel_queries', JSON.stringify(sortedMockQueries));\n      }\n    };\n\n    loadQueries();\n  }, [refreshTrigger]);\n\n  // Listen for storage changes to refresh data when enquiries are created/updated\n  useEffect(() => {\n    const handleStorageChange = () => {\n      setRefreshTrigger(prev => prev + 1);\n    };\n\n    window.addEventListener('storage', handleStorageChange);\n    \n    // Also listen for custom events from the form\n    window.addEventListener('enquiry-saved', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n      window.removeEventListener('enquiry-saved', handleStorageChange);\n    };\n  }, []);\n\n  // Real-time refresh functionality\n  useEffect(() => {\n    if (!isRealTimeEnabled) return;\n\n    const interval = setInterval(() => {\n      setLastRefresh(new Date());\n      // Trigger refresh to reload queries from localStorage\n      setRefreshTrigger(prev => prev + 1);\n    }, 30000); // Refresh every 30 seconds\n\n    return () => clearInterval(interval);\n  }, [isRealTimeEnabled]);\n\n  // Use the query filters hook\n  const {\n    filters,\n    filteredQueries,\n    filterOptions,\n    updateFilter,\n    clearAllFilters,\n    activeFiltersCount\n  } = useQueryFilters(queries);\n\n  // Use pagination hook\n  const {\n    currentPage,\n    itemsPerPage,\n    totalPages,\n    startIndex,\n    endIndex,\n    paginatedQueries,\n    handlePageChange,\n    handleItemsPerPageChange,\n    totalItems\n  } = useQueryPagination({ queries: filteredQueries, itemsPerPage: 10 });\n\n  // Enhanced sorting function\n  const handleSort = (key: SortConfig['key']) => {\n    setSortConfig(prevConfig => ({\n      key,\n      direction: prevConfig.key === key && prevConfig.direction === 'desc' ? 'asc' : 'desc'\n    }));\n  };\n\n  // Helper function to format PAX information - Updated to exclude infants from total\n  const formatPaxInfo = (paxDetails: Query['paxDetails']) => {\n    // Total PAX excludes infants (they are for record only)\n    const total = paxDetails.adults + paxDetails.children;\n    let breakdown = '';\n    \n    if (paxDetails.adults > 0) {\n      breakdown += `${paxDetails.adults}A`;\n    }\n    if (paxDetails.children > 0) {\n      breakdown += breakdown ? ` ${paxDetails.children}C` : `${paxDetails.children}C`;\n    }\n    if (paxDetails.infants > 0) {\n      breakdown += breakdown ? ` ${paxDetails.infants}I` : `${paxDetails.infants}I`;\n    }\n    \n    return {\n      total, \n      breakdown: breakdown || '0'\n    };\n  };\n\n  // Enhanced filter and sort queries\n  const filteredAndSortedQueries = useMemo(() => {\n    let filtered = filteredQueries.filter(query => {\n      const matchesSearch = searchTerm === '' || \n        query.id.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        query.agentName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        query.destination.country.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        query.destination.cities.some(city => city.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      const matchesStatus = selectedStatus === 'all' || query.status === selectedStatus;\n      \n      return matchesSearch && matchesStatus;\n    });\n\n    // Enhanced sorting logic\n    filtered.sort((a, b) => {\n      let comparison = 0;\n      \n      switch (sortConfig.key) {\n        case 'createdAt':\n          comparison = new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();\n          break;\n        case 'agentName':\n          comparison = a.agentName.localeCompare(b.agentName);\n          break;\n        case 'destination':\n          comparison = a.destination.country.localeCompare(b.destination.country);\n          break;\n        case 'status':\n          comparison = a.status.localeCompare(b.status);\n          break;\n        case 'pax':\n          // Updated PAX sorting to exclude infants\n          const aPax = a.paxDetails.adults + a.paxDetails.children;\n          const bPax = b.paxDetails.adults + b.paxDetails.children;\n          comparison = aPax - bPax;\n          break;\n        case 'priority':\n          const aPriority = a.id === 'TQ-2024-001' ? 9 : a.id === 'TQ-2024-004' ? 8 : 5;\n          const bPriority = b.id === 'TQ-2024-001' ? 9 : b.id === 'TQ-2024-004' ? 8 : 5;\n          comparison = aPriority - bPriority;\n          break;\n        case 'budget':\n          const aBudget = a.budget?.max || 0;\n          const bBudget = b.budget?.max || 0;\n          comparison = aBudget - bBudget;\n          break;\n        case 'departure':\n          comparison = new Date(a.travelDates.from).getTime() - new Date(b.travelDates.from).getTime();\n          break;\n        case 'lastActivity':\n          comparison = new Date(a.updatedAt).getTime() - new Date(b.updatedAt).getTime();\n          break;\n        default:\n          comparison = 0;\n      }\n      \n      return sortConfig.direction === 'desc' ? -comparison : comparison;\n    });\n\n    return filtered;\n  }, [filteredQueries, searchTerm, selectedStatus, sortConfig]);\n\n  // Enhanced query statistics\n  const stats = useMemo(() => {\n    const total = queries.length;\n    const newQueries = queries.filter(q => q.status === 'new').length;\n    const assigned = queries.filter(q => q.status === 'assigned').length;\n    const inProgress = queries.filter(q => q.status === 'in-progress').length;\n    const completed = queries.filter(q => q.status === 'completed' || q.status === 'converted').length;\n    const proposalsSent = queries.filter(q => q.status === 'proposal-sent').length;\n    \n    const conversionRate = total > 0 ? Math.round((completed / total) * 100) : 0;\n    const avgResponseTime = '2.4 hours';\n    const slaBreaches = queries.filter(q => {\n      const hoursAgo = (new Date().getTime() - new Date(q.createdAt).getTime()) / (1000 * 60 * 60);\n      const slaHours = q.packageType === 'luxury' ? 1 : q.packageType === 'business' ? 2 : 4;\n      return hoursAgo > slaHours && q.status === 'new';\n    }).length;\n    \n    return { \n      total, \n      new: newQueries, \n      assigned, \n      inProgress, \n      completed, \n      proposalsSent,\n      conversionRate, \n      avgResponseTime,\n      slaBreaches\n    };\n  }, [queries, lastRefresh]);\n\n  // Selection handlers\n  const handleSelectQuery = (query: Query, checked: boolean) => {\n    if (checked) {\n      setSelectedQueries(prev => [...prev, query]);\n    } else {\n      setSelectedQueries(prev => prev.filter(q => q.id !== query.id));\n    }\n  };\n\n  const handleSelectAll = (checked: boolean) => {\n    if (checked) {\n      setSelectedQueries(filteredAndSortedQueries);\n    } else {\n      setSelectedQueries([]);\n    }\n  };\n\n  // Bulk operations handlers\n  const handleBulkAssign = (staffMember: string) => {\n    const updatedQueries = queries.map(query => {\n      if (selectedQueries.some(sq => sq.id === query.id)) {\n        return { ...query, assignedTo: staffMember, status: 'assigned', updatedAt: new Date().toISOString() };\n      }\n      return query;\n    });\n    setQueries(updatedQueries);\n    localStorage.setItem('travel_queries', JSON.stringify(updatedQueries));\n    \n    toast({\n      title: \"Bulk Assignment Complete\",\n      description: `${selectedQueries.length} enquiries assigned to ${staffMember}`,\n    });\n    setSelectedQueries([]);\n  };\n\n  const handleBulkStatusUpdate = (status: string) => {\n    const updatedQueries = queries.map(query => {\n      if (selectedQueries.some(sq => sq.id === query.id)) {\n        return { ...query, status, updatedAt: new Date().toISOString() };\n      }\n      return query;\n    });\n    setQueries(updatedQueries);\n    localStorage.setItem('travel_queries', JSON.stringify(updatedQueries));\n    \n    toast({\n      title: \"Status Updated\",\n      description: `${selectedQueries.length} enquiries status updated to ${status}`,\n    });\n    setSelectedQueries([]);\n  };\n\n  const handleBulkPriorityUpdate = (priority: string) => {\n    const updatedQueries = queries.map(query => {\n      if (selectedQueries.some(sq => sq.id === query.id)) {\n        return { ...query, priority, updatedAt: new Date().toISOString() };\n      }\n      return query;\n    });\n    setQueries(updatedQueries);\n    localStorage.setItem('travel_queries', JSON.stringify(updatedQueries));\n    \n    toast({\n      title: \"Priority Updated\",\n      description: `${selectedQueries.length} enquiries priority set to ${priority}`,\n    });\n    setSelectedQueries([]);\n  };\n\n  const handleBulkExport = () => {\n    const dataStr = JSON.stringify(selectedQueries, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `enquiries_export_${new Date().toISOString().split('T')[0]}.json`;\n    link.click();\n    \n    toast({\n      title: \"Export Complete\",\n      description: `${selectedQueries.length} enquiries exported successfully`,\n    });\n  };\n\n  const handleBulkDelete = () => {\n    const updatedQueries = queries.filter(query => !selectedQueries.some(sq => sq.id === query.id));\n    setQueries(updatedQueries);\n    localStorage.setItem('travel_queries', JSON.stringify(updatedQueries));\n    \n    toast({\n      title: \"Enquiries Deleted\",\n      description: `${selectedQueries.length} enquiries have been deleted`,\n      variant: \"destructive\",\n    });\n    setSelectedQueries([]);\n  };\n\n  const handleQuickAssign = (query: Query) => {\n    setSelectedQuery(query);\n    setShowCountryAssignment(true);\n  };\n\n  const handleQuickCreateSuccess = (newQuery: Query) => {\n    // Add new query to the beginning of the list and save to localStorage\n    const updatedQueries = [newQuery, ...queries];\n    setQueries(updatedQueries);\n    localStorage.setItem('travel_queries', JSON.stringify(updatedQueries));\n    \n    toast({\n      title: \"Enquiry Created\",\n      description: `New enquiry ${newQuery.id} has been created and appears first in the list`,\n    });\n    \n    setShowQuickCreate(false);\n  };\n\n  const getSortIcon = (key: SortConfig['key']) => {\n    if (sortConfig.key !== key) {\n      return <ArrowUpDown className=\"h-4 w-4 opacity-50\" />;\n    }\n    return sortConfig.direction === 'desc' ? \n      <ArrowDown className=\"h-4 w-4 text-blue-600\" /> : \n      <ArrowUp className=\"h-4 w-4 text-blue-600\" />;\n  };\n\n  const availableStaffCount = activeStaff.filter(s => \n    s.active && s.assigned < s.workloadCapacity\n  ).length;\n\n  // Enhanced query list rendering\n  const renderEnquiryRow = (query: Query) => {\n    const paxInfo = formatPaxInfo(query.paxDetails);\n    const isSelected = selectedQueries.some(q => q.id === query.id);\n    \n    return (\n      <div key={query.id} className=\"flex items-start gap-3\">\n        <Checkbox\n          checked={isSelected}\n          onCheckedChange={(checked) => handleSelectQuery(query, !!checked)}\n          className=\"mt-4 flex-shrink-0\"\n        />\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"border rounded-lg p-3 md:p-4 hover:shadow-md transition-shadow bg-white\">\n            <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-3\">\n              <div className=\"flex items-center gap-2 min-w-0\">\n                <h3 className=\"text-base md:text-lg font-semibold text-blue-700 truncate\">{query.id}</h3>\n                <Badge variant=\"outline\" className=\"text-xs flex-shrink-0\">\n                  {paxInfo.total} PAX ({paxInfo.breakdown})\n                </Badge>\n              </div>\n              <div className=\"flex items-center gap-2 flex-shrink-0\">\n                <Badge variant={query.status === 'new' ? 'secondary' : 'default'} className=\"text-xs md:text-sm\">\n                  {query.status.replace('-', ' ').toUpperCase()}\n                </Badge>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={() => navigate(`/queries/edit/${encodeURIComponent(query.id)}`)}\n                  className=\"text-xs md:text-sm\"\n                >\n                  <Edit className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                  Edit\n                </Button>\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 text-sm\">\n              <div className=\"min-w-0\">\n                <p className=\"text-muted-foreground text-xs md:text-sm\">Agent</p>\n                <p className=\"font-medium text-sm md:text-base truncate\">{query.agentName}</p>\n              </div>\n              <div className=\"min-w-0\">\n                <p className=\"text-muted-foreground text-xs md:text-sm\">Destination</p>\n                <p className=\"font-medium text-sm md:text-base truncate\">{query.destination.country}</p>\n                <p className=\"text-xs text-muted-foreground truncate\">{query.destination.cities.join(', ')}</p>\n              </div>\n              <div className=\"min-w-0\">\n                <p className=\"text-muted-foreground text-xs md:text-sm\">Travel Date</p>\n                <p className=\"font-medium text-sm md:text-base\">{new Date(query.travelDates.from).toLocaleDateString()}</p>\n              </div>\n              <div className=\"min-w-0\">\n                <p className=\"text-muted-foreground text-xs md:text-sm\">Duration</p>\n                <p className=\"font-medium text-sm md:text-base\">{query.tripDuration.nights}N/{query.tripDuration.days}D</p>\n              </div>\n            </div>\n            \n            <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mt-4 pt-3 border-t\">\n              <div className=\"flex flex-wrap items-center gap-2 md:gap-4 text-xs md:text-sm text-muted-foreground min-w-0\">\n                <span className=\"break-words\">Budget: ${query.budget.min.toLocaleString()} - ${query.budget.max.toLocaleString()}</span>\n                <span className=\"break-words\">Created: {new Date(query.createdAt).toLocaleDateString()}</span>\n                <span className=\"break-words\">Updated: {new Date(query.updatedAt).toLocaleDateString()}</span>\n              </div>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => handleQuickAssign(query)}\n                className=\"text-xs md:text-sm flex-shrink-0\"\n              >\n                <User className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                {query.status === 'new' ? 'Assign' : 'Reassign'}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 p-4 lg:p-6\">\n        {/* Enhanced Header */}\n        <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n          <div>\n            <h1 className=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n              Enhanced Query Management\n            </h1>\n            <p className=\"text-muted-foreground mt-1 text-sm md:text-base\">\n              Comprehensive enquiry tracking with detailed travel information and real-time updates\n            </p>\n            <div className=\"flex flex-wrap items-center gap-2 mt-2 text-xs md:text-sm text-muted-foreground\">\n              <Activity className=\"h-3 w-3 md:h-4 md:w-4 flex-shrink-0\" />\n              <span className=\"break-words\">Showing {filteredAndSortedQueries.length} of {queries.length} enquiries • Sorted by newest first</span>\n              <span className=\"text-green-600 whitespace-nowrap\">• Live</span>\n            </div>\n          </div>\n          \n          <div className=\"flex flex-col gap-3\">\n            <div className=\"flex flex-wrap items-center gap-2\">\n              <Badge \n                variant={isAutoAssignmentEnabled ? \"default\" : \"secondary\"}\n                className={`flex items-center gap-1 text-xs md:text-sm ${\n                  isAutoAssignmentEnabled ? \"bg-green-600\" : \"\"\n                }`}\n              >\n                {isAutoAssignmentEnabled ? (\n                  <Zap className=\"h-3 w-3\" />\n                ) : (\n                  <User className=\"h-3 w-3\" />\n                )}\n                Auto-Assignment {isAutoAssignmentEnabled ? \"ON\" : \"OFF\"}\n              </Badge>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setIsRealTimeEnabled(!isRealTimeEnabled)}\n                className={`${isRealTimeEnabled ? \"border-green-500 text-green-700\" : \"\"} text-xs md:text-sm`}\n              >\n                <RefreshCw className={`h-3 w-3 mr-1 ${isRealTimeEnabled ? 'animate-spin' : ''}`} />\n                Real-time {isRealTimeEnabled ? \"ON\" : \"OFF\"}\n              </Button>\n              <span className=\"text-xs md:text-sm text-muted-foreground whitespace-nowrap\">\n                ({availableStaffCount} staff available)\n              </span>\n            </div>\n            \n            <div className=\"flex flex-wrap gap-2\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setShowAdvancedFilters(!showAdvancedFilters)}\n                className=\"text-xs md:text-sm\"\n              >\n                <Settings className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                Settings\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" className=\"text-xs md:text-sm\">\n                <Upload className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                Import\n              </Button>\n              <Button variant=\"outline\" size=\"sm\" onClick={handleBulkExport} className=\"text-xs md:text-sm\">\n                <Download className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                Export All\n              </Button>\n              <Button onClick={() => navigate('/queries/create')} size=\"sm\" className=\"bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-xs md:text-sm\">\n                <Plus className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                Create Enquiry\n              </Button>\n              <Button onClick={() => setShowQuickCreate(true)} size=\"sm\" className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-xs md:text-sm\">\n                <Plus className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                Quick Create\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Status Alerts */}\n        {isAutoAssignmentEnabled && stats.new > 0 && (\n          <Alert className=\"border-green-200 bg-green-50\">\n            <Zap className=\"h-4 w-4 text-green-600\" />\n            <AlertDescription className=\"text-green-800\">\n              Auto-assignment is active. New enquiries will be automatically assigned based on destination country expertise.\n              <strong> {stats.new} unassigned enquiries</strong> are available for processing.\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {stats.slaBreaches > 0 && (\n          <Alert className=\"border-red-200 bg-red-50\">\n            <Timer className=\"h-4 w-4 text-red-600\" />\n            <AlertDescription className=\"text-red-800\">\n              <strong>{stats.slaBreaches} enquiries</strong> have breached SLA response times and require immediate attention.\n            </AlertDescription>\n          </Alert>\n        )}\n\n        {/* Enhanced Statistics Cards */}\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-3 md:gap-4\">\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Total</p>\n                  <p className=\"text-2xl font-bold\">{stats.total}</p>\n                </div>\n                <MapPin className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">New</p>\n                  <p className=\"text-2xl font-bold text-orange-600\">{stats.new}</p>\n                </div>\n                <AlertCircle className=\"h-8 w-8 text-orange-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Assigned</p>\n                  <p className=\"text-2xl font-bold text-blue-600\">{stats.assigned}</p>\n                </div>\n                <User className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">In Progress</p>\n                  <p className=\"text-2xl font-bold text-purple-600\">{stats.inProgress}</p>\n                </div>\n                <Clock className=\"h-8 w-8 text-purple-600\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Proposals</p>\n                  <p className=\"text-2xl font-bold text-indigo-600\">{stats.proposalsSent}</p>\n                </div>\n                <BarChart3 className=\"h-8 w-8 text-indigo-600\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">Conversion</p>\n                  <p className=\"text-2xl font-bold text-green-600\">{stats.conversionRate}%</p>\n                </div>\n                <TrendingUp className=\"h-8 w-8 text-green-600\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"hover:shadow-md transition-shadow\">\n            <CardContent className=\"pt-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">SLA Breach</p>\n                  <p className=\"text-2xl font-bold text-red-600\">{stats.slaBreaches}</p>\n                </div>\n                <Timer className=\"h-8 w-8 text-red-600\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Advanced Filters */}\n        {showAdvancedFilters && (\n          <AdvancedFilters\n            onFiltersChange={(filters) => console.log('Advanced filters:', filters)}\n            onClearFilters={() => console.log('Clear advanced filters')}\n            activeFiltersCount={0}\n          />\n        )}\n\n        {/* Bulk Operations Panel */}\n        <BulkOperationsPanel\n          selectedQueries={selectedQueries}\n          onClearSelection={() => setSelectedQueries([])}\n          onBulkAssign={handleBulkAssign}\n          onBulkStatusUpdate={handleBulkStatusUpdate}\n          onBulkPriorityUpdate={handleBulkPriorityUpdate}\n          onBulkExport={handleBulkExport}\n          onBulkDelete={handleBulkDelete}\n        />\n\n        {/* Enhanced Enquiry List */}\n        <Card className=\"shadow-lg\">\n          <CardHeader className=\"bg-gradient-to-r from-blue-50 to-purple-50 border-b\">\n            <CardTitle className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-xl font-bold\">Enhanced Enquiry List</span>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {filteredAndSortedQueries.length} items • Newest first\n                </Badge>\n              </div>\n              <div className=\"flex flex-wrap items-center gap-2\">\n                <Button onClick={() => navigate('/queries/create')} size=\"sm\" className=\"bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-xs md:text-sm\">\n                  <Plus className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                  Create New Enquiry\n                </Button>\n                <div className=\"flex items-center gap-1\">\n                  <Checkbox\n                    checked={selectedQueries.length === filteredAndSortedQueries.length && filteredAndSortedQueries.length > 0}\n                    onCheckedChange={handleSelectAll}\n                  />\n                  <span className=\"text-xs md:text-sm text-muted-foreground\">Select All</span>\n                </div>\n                <Button\n                  variant={viewMode === 'card' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setViewMode('card')}\n                  className=\"text-xs md:text-sm\"\n                >\n                  <Grid3X3 className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                  Card View\n                </Button>\n                <Button\n                  variant={viewMode === 'table' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => setViewMode('table')}\n                  className=\"text-xs md:text-sm\"\n                >\n                  <List className=\"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2\" />\n                  Table View\n                </Button>\n              </div>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            {/* Search and Filters */}\n            <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between mb-6\">\n              <div className=\"flex flex-1 items-center space-x-2\">\n                <Search className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                <Input\n                  placeholder=\"Search by ID, agent, destination, or city...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"max-w-full md:max-w-sm\"\n                />\n              </div>\n              \n              <div className=\"flex flex-wrap items-center gap-2\">\n                <Filter className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\n                <select \n                  value={selectedStatus}\n                  onChange={(e) => setSelectedStatus(e.target.value)}\n                  className=\"border border-input rounded-md px-3 py-2 text-sm min-w-[120px]\"\n                >\n                  <option value=\"all\">All Status</option>\n                  <option value=\"new\">New</option>\n                  <option value=\"assigned\">Assigned</option>\n                  <option value=\"in-progress\">In Progress</option>\n                  <option value=\"proposal-sent\">Proposal Sent</option>\n                  <option value=\"confirmed\">Confirmed</option>\n                  <option value=\"converted\">Converted</option>\n                </select>\n                \n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={() => navigate('/queries/assign')}\n                  className=\"whitespace-nowrap\"\n                >\n                  <ArrowRightLeft className=\"h-4 w-4 mr-2\" />\n                  Assign Queries\n                </Button>\n              </div>\n            </div>\n\n            {/* Sorting Controls */}\n            <div className=\"flex flex-wrap gap-2 mb-4 p-3 bg-gray-50 rounded-lg\">\n              <span className=\"text-sm font-medium text-gray-600 mr-2 whitespace-nowrap\">Sort by:</span>\n              <div className=\"flex flex-wrap gap-2\">\n                <Button\n                  variant={sortConfig.key === 'createdAt' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => handleSort('createdAt')}\n                  className=\"gap-2 text-xs md:text-sm\"\n                >\n                  <CalendarDays className=\"h-3 w-3 md:h-4 md:w-4\" />\n                  Created\n                  {getSortIcon('createdAt')}\n                </Button>\n                <Button\n                  variant={sortConfig.key === 'priority' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => handleSort('priority')}\n                  className=\"gap-2 text-xs md:text-sm\"\n                >\n                  <AlertCircle className=\"h-3 w-3 md:h-4 md:w-4\" />\n                  Priority\n                  {getSortIcon('priority')}\n                </Button>\n                <Button\n                  variant={sortConfig.key === 'departure' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => handleSort('departure')}\n                  className=\"gap-2 text-xs md:text-sm\"\n                >\n                  <CalendarDays className=\"h-3 w-3 md:h-4 md:w-4\" />\n                  Departure\n                  {getSortIcon('departure')}\n                </Button>\n                <Button\n                  variant={sortConfig.key === 'budget' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => handleSort('budget')}\n                  className=\"gap-2 text-xs md:text-sm\"\n                >\n                  <TrendingUp className=\"h-3 w-3 md:h-4 md:w-4\" />\n                  Budget\n                  {getSortIcon('budget')}\n                </Button>\n                <Button\n                  variant={sortConfig.key === 'pax' ? 'default' : 'outline'}\n                  size=\"sm\"\n                  onClick={() => handleSort('pax')}\n                  className=\"gap-2 text-xs md:text-sm\"\n                >\n                  <User className=\"h-3 w-3 md:h-4 md:w-4\" />\n                  PAX Count\n                  {getSortIcon('pax')}\n                </Button>\n              </div>\n            </div>\n\n            {/* Results Summary */}\n            <div className=\"flex items-center justify-between text-sm text-muted-foreground mb-4\">\n              <span>Showing {filteredAndSortedQueries.length} enquiries with enhanced details (newest first)</span>\n              <span>\n                Sorted by: {sortConfig.key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())} \n                ({sortConfig.direction === 'desc' ? 'Descending' : 'Ascending'})\n              </span>\n            </div>\n\n            {/* Enquiry List */}\n            <div className=\"space-y-4\">\n              {viewMode === 'card' ? (\n                // Card View with enhanced functionality\n                filteredAndSortedQueries.map(renderEnquiryRow)\n              ) : (\n                // Table View\n                <div className=\"space-y-2 overflow-x-auto\">\n                  {filteredAndSortedQueries.map((query) => (\n                    <div key={query.id} className=\"flex items-center gap-3 p-2 border rounded-lg hover:bg-gray-50 transition-colors min-w-max\">\n                      <Checkbox\n                        checked={selectedQueries.some(q => q.id === query.id)}\n                        onCheckedChange={(checked) => handleSelectQuery(query, !!checked)}\n                        className=\"flex-shrink-0\"\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <EnquiryListTable \n                          queries={[query]}\n                          onAssignQuery={handleQuickAssign}\n                        />\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n              \n              {filteredAndSortedQueries.length === 0 && (\n                <div className=\"text-center py-12\">\n                  <AlertCircle className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No enquiries found</h3>\n                  <p className=\"text-muted-foreground mb-4\">\n                    Try adjusting your search criteria or filters\n                  </p>\n                  <Button onClick={() => navigate('/queries/create')}>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Create First Enquiry\n                  </Button>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Dialogs */}\n        {showQuickCreate && (\n          <QuickCreateQuery \n            isOpen={showQuickCreate} \n            onClose={() => setShowQuickCreate(false)}\n            onSuccess={handleQuickCreateSuccess}\n          />\n        )}\n\n        {showCountryAssignment && selectedQuery && (\n          <CountryBasedAssignmentDialog\n            query={selectedQuery}\n            open={showCountryAssignment}\n            onOpenChange={setShowCountryAssignment}\n          />\n        )}\n\n        {/* Responsive Testing Panel - For development/testing only */}\n        <ResponsiveTestPanel />\n      </div>\n    </PageLayout>\n  );\n};\n\nexport default Queries;\n","\nimport React, { useEffect, useState } from 'react';\nimport { \n  Table, TableBody, TableCell, TableHead, TableHeader, TableRow \n} from '@/components/ui/table';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  Eye, Edit, Clock, Star, MapPin, Users, Calendar,\n  TrendingUp, AlertCircle, CheckCircle, FileText\n} from 'lucide-react';\nimport { Query } from '@/types/query';\nimport { useNavigate } from 'react-router-dom';\nimport { cn } from '@/lib/utils';\nimport EnhancedStatusBadge from '@/components/queries/status/EnhancedStatusBadge';\nimport { useApp } from '@/contexts/AppContext';\nimport { useAccessControl } from '@/hooks/use-access-control';\nimport { useSupabaseAgentsList } from '@/hooks/useSupabaseAgentsList';\nimport { findSupabaseAgentByNumericId } from '@/utils/supabaseAgentIds';\nimport { resolveProfileNameById } from '@/services/profilesHelper';\n\ninterface EnhancedQueryListProps {\n  queries: Query[];\n  showActions?: boolean;\n  calculatePriority: (query: Query) => number;\n  categorizeQuery: (query: Query) => string;\n}\n\n  const EnhancedQueryList: React.FC<EnhancedQueryListProps> = ({\n    queries,\n    showActions = true,\n    calculatePriority,\n    categorizeQuery\n  }) => {\n    const { agents: supabaseAgents } = useSupabaseAgentsList();\n  const navigate = useNavigate();\n  const { currentUser } = useApp();\n  const { hasAdminAccess, isStaff } = useAccessControl();\n\n  // Resolve assigned staff names for display\n  const [assignedNamesMap, setAssignedNamesMap] = useState<Record<string, string>>({});\n  useEffect(() => {\n    const ids = Array.from(new Set((queries || [])\n      .map(q => q.assignedTo)\n      .filter((id): id is string => Boolean(id))));\n    const missing = ids.filter(id => !(id in assignedNamesMap));\n    if (missing.length === 0) return;\n    let mounted = true;\n    (async () => {\n      try {\n        const entries = await Promise.all(missing.map(async (id) => {\n          const name = await resolveProfileNameById(id);\n          return [id, name] as const;\n        }));\n        if (!mounted) return;\n        const update: Record<string, string> = {};\n        for (const [id, name] of entries) {\n          if (name) update[id] = name;\n        }\n        if (Object.keys(update).length > 0) {\n          setAssignedNamesMap(prev => ({ ...prev, ...update }));\n        }\n      } catch {\n        // swallow errors; fallback will show raw ID\n      }\n    })();\n    return () => { mounted = false; };\n  }, [queries, assignedNamesMap]);\n\n  // Filter queries based on user access level\n  const getAccessibleQueries = (): Query[] => {\n    if (!currentUser) return [];\n    \n    // Super admin and manager have access to all queries\n    if (hasAdminAccess) {\n      return queries;\n    }\n    \n    // Staff users only see queries assigned to them\n    if (isStaff) {\n      return queries.filter(query => {\n        // Check if query is assigned to current staff user\n        return query.assignedTo === currentUser.name || \n               query.assignedTo === currentUser.id ||\n               query.agentName === currentUser.name; // Also show if they created it\n      });\n    }\n    \n    // Default: no access\n    return [];\n  };\n\n  const accessibleQueries = getAccessibleQueries();\n\n  const getQueryPriority = (query: Query): 'low' | 'normal' | 'high' | 'urgent' => {\n    const score = calculatePriority(query);\n    if (score >= 8) return 'urgent';\n    if (score >= 6) return 'high';\n    if (score >= 4) return 'normal';\n    return 'low';\n  };\n\n  const isNewAssignment = (query: Query): boolean => {\n    return query.status === 'assigned' && \n      new Date().getTime() - new Date(query.createdAt).getTime() < 24 * 60 * 60 * 1000;\n  };\n\n  const getStatusProgress = (status: string) => {\n    switch (status) {\n      case 'new': return 10;\n      case 'assigned': return 25;\n      case 'in-progress': return 50;\n      case 'proposal-sent': return 75;\n      case 'modify-proposal': return 65;\n      case 'confirmed': return 90;\n      case 'converted': return 100;\n      default: return 0;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric'\n    });\n  };\n\n  const calculateDaysUntilTravel = (travelDate: string) => {\n    const days = Math.floor((new Date(travelDate).getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n    return days;\n  };\n\n  const getLastUpdated = (query: Query): string => {\n    const now = new Date();\n    const created = new Date(query.createdAt);\n    const diffHours = Math.floor((now.getTime() - created.getTime()) / (1000 * 60 * 60));\n    \n    if (diffHours < 1) return 'now';\n    if (diffHours < 24) return `${diffHours}h ago`;\n    \n    const diffDays = Math.floor(diffHours / 24);\n    return `${diffDays}d ago`;\n  };\n\n  const getDurationText = (duration: Query['tripDuration']) => {\n    return `${duration.nights}N/${duration.days}D`;\n  };\n\n  const handleViewEnquiry = (queryId: string) => {\n    console.log('Navigating to query details:', queryId);\n    navigate(`/queries/${encodeURIComponent(queryId)}`);\n  };\n\n  const handleEditEnquiry = (queryId: string) => {\n    console.log('Navigating to edit query:', queryId);\n    navigate(`/queries/edit/${encodeURIComponent(queryId)}`);\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Access Level Info for Staff Users */}\n      {isStaff && !hasAdminAccess && (\n        <div className=\"bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg p-3\">\n          <div className=\"flex items-center gap-2\">\n            <AlertCircle className=\"h-4 w-4 text-blue-600\" />\n            <span className=\"text-sm text-blue-800 dark:text-blue-200\">\n              Showing only enquiries assigned to you ({accessibleQueries.length} of {queries.length} total)\n            </span>\n          </div>\n        </div>\n      )}\n\n      {accessibleQueries.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">\n          <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n          {isStaff && !hasAdminAccess ? (\n            <div>\n              <p>No enquiries assigned to you yet</p>\n              <p className=\"text-xs mt-1\">Contact your manager for enquiry assignments</p>\n            </div>\n          ) : (\n            <p>No enquiries found matching your criteria</p>\n          )}\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Enquiry Details</TableHead>\n                <TableHead>Destination & Category</TableHead>\n                <TableHead>Travel Info</TableHead>\n                <TableHead>Status & Progress</TableHead>\n                <TableHead>Priority</TableHead>\n                {showActions && <TableHead>Actions</TableHead>}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {accessibleQueries.map((query) => {\n                const priority = calculatePriority(query);\n                const category = categorizeQuery(query);\n                const daysUntilTravel = calculateDaysUntilTravel(query.travelDates.from);\n                const totalPax = query.paxDetails.adults + query.paxDetails.children + query.paxDetails.infants;\n                const lastUpdated = getLastUpdated(query);\n                const queryPriority = getQueryPriority(query);\n                const newAssignment = isNewAssignment(query);\n\n                return (\n                  <TableRow \n                    key={query.id} \n                    className={cn(\n                      \"hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors\",\n                      newAssignment && \"bg-blue-50 dark:bg-blue-950/20 border-l-4 border-l-blue-500\"\n                    )}\n                  >\n                    <TableCell>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-medium text-sm text-blue-600 hover:text-blue-800 cursor-pointer\"\n                                onClick={() => handleViewEnquiry(query.id)}>\n                            {query.id}\n                          </span>\n                          {newAssignment && (\n                            <Badge variant=\"destructive\" className=\"text-xs animate-pulse\">\n                              NEW\n                            </Badge>\n                          )}\n                          {daysUntilTravel <= 30 && (\n                            <AlertCircle className=\"h-4 w-4 text-orange-500\" />\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {(() => {\n                            const supAgent = findSupabaseAgentByNumericId(supabaseAgents, Number(query.agentId));\n                            const displayName = supAgent?.agencyName || supAgent?.name || query.agentName;\n                            const initial = (displayName || query.agentName || '?').charAt(0);\n                            return (\n                              <>\n                                <Avatar className=\"h-6 w-6\">\n                                  {supAgent?.profile_image && (\n                                    <AvatarImage src={supAgent.profile_image} alt={displayName || 'Agent'} />\n                                  )}\n                                  <AvatarFallback className=\"text-xs\">{initial}</AvatarFallback>\n                                </Avatar>\n                                <span className=\"text-sm text-gray-600\">{displayName}</span>\n                              </>\n                            );\n                          })()}\n                        </div>\n                        <p className=\"text-xs text-gray-500\">\n                          Created: {formatDate(query.createdAt)}\n                        </p>\n                        {query.assignedTo && (\n                          <p className=\"text-xs text-blue-600\">\n                            Assigned to: {assignedNamesMap[query.assignedTo] || query.assignedTo}\n                          </p>\n                        )}\n                      </div>\n                    </TableCell>\n\n                    <TableCell>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-1\">\n                          <MapPin className=\"h-4 w-4 text-gray-400\" />\n                          <span className=\"font-medium\">{query.destination.country}</span>\n                        </div>\n                        <p className=\"text-sm text-gray-600\">\n                          {query.destination.cities.join(', ')}\n                        </p>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {category}\n                        </Badge>\n                      </div>\n                    </TableCell>\n\n                    <TableCell>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-1\">\n                          <Calendar className=\"h-4 w-4 text-gray-400\" />\n                          <span className=\"text-sm\">{formatDate(query.travelDates.from)}</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Users className=\"h-4 w-4 text-gray-400\" />\n                          <span className=\"text-sm\">{totalPax} PAX</span>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Clock className=\"h-4 w-4 text-gray-400\" />\n                          <Badge variant=\"outline\" className=\"text-xs font-medium\">\n                            {getDurationText(query.tripDuration)}\n                          </Badge>\n                        </div>\n                        {daysUntilTravel <= 30 && (\n                          <Badge variant=\"destructive\" className=\"text-xs\">\n                            {daysUntilTravel} days left\n                          </Badge>\n                        )}\n                      </div>\n                    </TableCell>\n\n                    <TableCell>\n                      <div className=\"space-y-3\">\n                        <EnhancedStatusBadge \n                          status={query.status}\n                          isNewAssignment={newAssignment}\n                          priority={queryPriority}\n                          lastUpdated={lastUpdated}\n                          size=\"sm\"\n                        />\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"text-xs text-gray-500\">Progress</span>\n                            <span className=\"text-xs font-medium\">{getStatusProgress(query.status)}%</span>\n                          </div>\n                          <Progress value={getStatusProgress(query.status)} className=\"h-2\" />\n                        </div>\n                      </div>\n                    </TableCell>\n\n                    <TableCell>\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <Star className=\"h-4 w-4 text-yellow-500\" />\n                          <Badge className={cn(\n                            \"text-xs\",\n                            queryPriority === 'urgent' && 'bg-red-500 text-white',\n                            queryPriority === 'high' && 'bg-orange-500 text-white',\n                            queryPriority === 'normal' && 'bg-blue-500 text-white',\n                            queryPriority === 'low' && 'bg-gray-500 text-white'\n                          )}>\n                            {queryPriority.toUpperCase()} ({priority}/10)\n                          </Badge>\n                        </div>\n                        {query.status === 'converted' && (\n                          <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                        )}\n                      </div>\n                    </TableCell>\n\n                    {showActions && (\n                      <TableCell>\n                        <div className=\"flex items-center gap-1\">\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\"\n                            onClick={() => handleViewEnquiry(query.id)}\n                            title=\"View Enquiry\"\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          <Button \n                            variant=\"ghost\" \n                            size=\"sm\"\n                            onClick={() => handleEditEnquiry(query.id)}\n                            title=\"Edit Enquiry\"\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </TableCell>\n                    )}\n                  </TableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default EnhancedQueryList;\n","\nimport React, { useState, useMemo, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { \n  PlusCircle, Search, Filter, Download, Upload, Users,\n  MapPin, Clock, User, CheckCircle2, AlertCircle, TrendingUp,\n  BarChart3, Settings, Activity, Calendar, Globe, Building2\n} from 'lucide-react';\nimport { mockQueries } from '@/data/queryData';\nimport { Query } from '@/types/query';\nimport { useToast } from '@/hooks/use-toast';\nimport QuickCreateQuery from './components/QuickCreateQuery';\nimport EnhancedQueryList from './components/EnhancedQueryList';\n\nconst TravelEnquiryHub: React.FC = () => {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [selectedStatus, setSelectedStatus] = useState<string>('all');\n  const [showQuickCreate, setShowQuickCreate] = useState(false);\n  const [queries, setQueries] = useState<Query[]>([]);\n  const [refreshTrigger, setRefreshTrigger] = useState(0);\n\n  // Load queries from localStorage and merge with mock data, sorted by creation date (newest first)\n  useEffect(() => {\n    const loadQueries = () => {\n      try {\n        const savedQueries = localStorage.getItem('travel_queries');\n        let allQueries: Query[] = [];\n\n        if (savedQueries) {\n          const parsedQueries = JSON.parse(savedQueries);\n          // Use saved queries as primary source\n          allQueries = Array.isArray(parsedQueries) ? parsedQueries : [];\n        } else {\n          // Fall back to mock data if no saved queries\n          allQueries = [...mockQueries];\n        }\n\n        // Sort by creation date (newest first)\n        allQueries.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n        \n        setQueries(allQueries);\n      } catch (error) {\n        console.error('Error loading queries:', error);\n        // Fall back to mock data on error\n        const sortedMockQueries = [...mockQueries].sort((a, b) => \n          new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n        );\n        setQueries(sortedMockQueries);\n      }\n    };\n\n    loadQueries();\n  }, [refreshTrigger]);\n\n  // Filter queries based on search term and status\n  const filteredQueries = useMemo(() => {\n    return queries.filter(query => {\n      const matchesSearch = searchTerm === '' || \n        query.id.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        // Support searching by just the number part of new enquiry IDs (e.g. \"0001\" for \"ENQ2025-0001\")\n        query.id.replace(/[^0-9]/g, '').includes(searchTerm.replace(/[^0-9]/g, '')) ||\n        query.agentName.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        query.destination.country.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        query.destination.cities.some(city => city.toLowerCase().includes(searchTerm.toLowerCase()));\n      \n      const matchesStatus = selectedStatus === 'all' || query.status === selectedStatus;\n      \n      return matchesSearch && matchesStatus;\n    });\n  }, [queries, searchTerm, selectedStatus]);\n\n  // Calculate statistics\n  const stats = useMemo(() => {\n    const total = queries.length;\n    const newQueries = queries.filter(q => q.status === 'new').length;\n    const assigned = queries.filter(q => q.status === 'assigned').length;\n    const inProgress = queries.filter(q => q.status === 'in-progress').length;\n    const completed = queries.filter(q => q.status === 'completed' || q.status === 'converted').length;\n    const proposalsSent = queries.filter(q => q.status === 'proposal-sent').length;\n    \n    const conversionRate = total > 0 ? Math.round((completed / total) * 100) : 0;\n    \n    return { \n      total, \n      new: newQueries, \n      assigned, \n      inProgress, \n      completed, \n      proposalsSent,\n      conversionRate\n    };\n  }, [queries]);\n\n  // Handle successful query creation\n  const handleQuickCreateSuccess = (newQuery: Query) => {\n    // Trigger refresh to reload queries from localStorage\n    setRefreshTrigger(prev => prev + 1);\n    \n    toast({\n      title: \"Enquiry Created\",\n      description: `New enquiry ${newQuery.id} has been created and will appear at the top of the list`,\n    });\n    \n    setShowQuickCreate(false);\n  };\n\n  // Handle query updates (assignments, status changes, etc.)\n  const handleQueryUpdate = (updatedQueries: Query[]) => {\n    // Sort updated queries by creation date (newest first)\n    const sortedQueries = [...updatedQueries].sort((a, b) => \n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n    );\n    \n    setQueries(sortedQueries);\n    \n    // Save to localStorage\n    try {\n      localStorage.setItem('travel_queries', JSON.stringify(sortedQueries));\n    } catch (error) {\n      console.error('Error saving queries:', error);\n    }\n  };\n\n  // Calculate query priority (0-10 scale)\n  const calculatePriority = (query: Query): number => {\n    let score = 0;\n    \n    // Urgency based on travel date\n    const daysUntilTravel = Math.floor((new Date(query.travelDates.from).getTime() - Date.now()) / (1000 * 60 * 60 * 24));\n    if (daysUntilTravel <= 7) score += 4;\n    else if (daysUntilTravel <= 30) score += 2;\n    else if (daysUntilTravel <= 60) score += 1;\n    \n    // Budget value\n    if (query.budget.max > 5000) score += 3;\n    else if (query.budget.max > 2000) score += 2;\n    else if (query.budget.max > 1000) score += 1;\n    \n    // Group size\n    const totalPax = query.paxDetails.adults + query.paxDetails.children;\n    if (totalPax >= 10) score += 2;\n    else if (totalPax >= 5) score += 1;\n    \n    // Status urgency\n    if (query.status === 'new') score += 1;\n    \n    return Math.min(score, 10);\n  };\n\n  // Categorize query based on characteristics\n  const categorizeQuery = (query: Query): string => {\n    const totalPax = query.paxDetails.adults + query.paxDetails.children;\n    const budget = query.budget.max;\n    \n    if (budget > 5000 && totalPax <= 4) return 'Luxury';\n    if (totalPax >= 10) return 'Group';\n    if (query.packageType.toLowerCase().includes('adventure')) return 'Adventure';\n    if (query.packageType.toLowerCase().includes('family')) return 'Family';\n    if (query.packageType.toLowerCase().includes('honeymoon')) return 'Romance';\n    if (budget < 1000) return 'Budget';\n    \n    return 'Standard';\n  };\n\n  return (\n    <div className=\"space-y-6 p-4 lg:p-6\">\n      {/* Header */}\n      <div className=\"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n            Travel Enquiry Hub\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Comprehensive enquiry management with intelligent assignment and real-time tracking\n          </p>\n          <div className=\"flex items-center gap-2 mt-2 text-sm text-muted-foreground\">\n            <Activity className=\"h-4 w-4\" />\n            <span>Showing {filteredQueries.length} of {queries.length} enquiries • Sorted by newest first</span>\n          </div>\n        </div>\n        \n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center\">\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" size=\"sm\">\n              <Upload className=\"h-4 w-4 mr-2\" />\n              Import\n            </Button>\n            <Button variant=\"outline\" size=\"sm\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Export\n            </Button>\n            <Button onClick={() => setShowQuickCreate(true)} size=\"sm\" className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700\">\n              <PlusCircle className=\"h-4 w-4 mr-2\" />\n              Quick Create\n            </Button>\n            <Button onClick={() => navigate('/queries/create')} size=\"sm\" className=\"bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700\">\n              <PlusCircle className=\"h-4 w-4 mr-2\" />\n              Create Enquiry\n            </Button>\n          </div>\n        </div>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-2 md:grid-cols-6 gap-4\">\n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Total</p>\n                <p className=\"text-2xl font-bold\">{stats.total}</p>\n              </div>\n              <MapPin className=\"h-8 w-8 text-blue-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">New</p>\n                <p className=\"text-2xl font-bold text-orange-600\">{stats.new}</p>\n              </div>\n              <AlertCircle className=\"h-8 w-8 text-orange-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Assigned</p>\n                <p className=\"text-2xl font-bold text-blue-600\">{stats.assigned}</p>\n              </div>\n              <User className=\"h-8 w-8 text-blue-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">In Progress</p>\n                <p className=\"text-2xl font-bold text-purple-600\">{stats.inProgress}</p>\n              </div>\n              <Clock className=\"h-8 w-8 text-purple-600\" />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Proposals</p>\n                <p className=\"text-2xl font-bold text-indigo-600\">{stats.proposalsSent}</p>\n              </div>\n              <BarChart3 className=\"h-8 w-8 text-indigo-600\" />\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card className=\"hover:shadow-md transition-shadow\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">Conversion</p>\n                <p className=\"text-2xl font-bold text-green-600\">{stats.conversionRate}%</p>\n              </div>\n              <TrendingUp className=\"h-8 w-8 text-green-600\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Content Tabs */}\n      <Tabs defaultValue=\"enquiries\" className=\"space-y-4\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\" className=\"flex items-center gap-2\">\n            <BarChart3 className=\"h-4 w-4\" />\n            Overview\n          </TabsTrigger>\n          <TabsTrigger value=\"enquiries\" className=\"flex items-center gap-2\">\n            <Globe className=\"h-4 w-4\" />\n            Enquiries\n          </TabsTrigger>\n          <TabsTrigger value=\"assignment\" className=\"flex items-center gap-2\">\n            <Users className=\"h-4 w-4\" />\n            Assignment\n          </TabsTrigger>\n          <TabsTrigger value=\"analytics\" className=\"flex items-center gap-2\">\n            <Settings className=\"h-4 w-4\" />\n            Analytics\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Overview Dashboard\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Building2 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Overview dashboard coming soon...</p>\n                <p className=\"text-sm mt-2\">Track performance metrics, trends, and insights</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Enquiries Tab */}\n        <TabsContent value=\"enquiries\" className=\"space-y-4\">\n          {/* Search and Filter */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-between\">\n                <span>Enquiry Management</span>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {filteredQueries.length} results • Newest first\n                </Badge>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\n                <div className=\"flex flex-1 items-center space-x-2\">\n                  <Search className=\"h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Search by ID (e.g. ENQ2025-0001, 0001), agent, destination...\"\n                    value={searchTerm}\n                    onChange={(e) => setSearchTerm(e.target.value)}\n                    className=\"max-w-sm\"\n                  />\n                </div>\n                \n                <div className=\"flex items-center gap-2\">\n                  <Filter className=\"h-4 w-4 text-muted-foreground\" />\n                  <select \n                    value={selectedStatus}\n                    onChange={(e) => setSelectedStatus(e.target.value)}\n                    className=\"border border-input rounded-md px-3 py-2 text-sm\"\n                  >\n                    <option value=\"all\">All Status</option>\n                    <option value=\"new\">New</option>\n                    <option value=\"assigned\">Assigned</option>\n                    <option value=\"in-progress\">In Progress</option>\n                    <option value=\"proposal-sent\">Proposal Sent</option>\n                    <option value=\"confirmed\">Confirmed</option>\n                    <option value=\"converted\">Converted</option>\n                  </select>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Enhanced Query List */}\n          <EnhancedQueryList \n            queries={filteredQueries}\n            calculatePriority={calculatePriority}\n            categorizeQuery={categorizeQuery}\n          />\n        </TabsContent>\n\n        {/* Assignment Tab */}\n        <TabsContent value=\"assignment\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-5 w-5\" />\n                Assignment Interface\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Users className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Assignment interface coming soon...</p>\n                <p className=\"text-sm mt-2\">Bulk assign queries to staff members and manage workloads</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Analytics Tab */}\n        <TabsContent value=\"analytics\" className=\"space-y-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <BarChart3 className=\"h-5 w-5\" />\n                Analytics Dashboard\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <Building2 className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                <p>Analytics dashboard coming soon...</p>\n                <p className=\"text-sm mt-2\">Track conversion rates, response times, and performance metrics</p>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n\n      {/* Quick Create Query Dialog */}\n      {showQuickCreate && (\n        <QuickCreateQuery\n          isOpen={showQuickCreate}\n          onClose={() => setShowQuickCreate(false)}\n          onSuccess={handleQuickCreateSuccess}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default TravelEnquiryHub;\n"],"names":["QueryList","queries","mode","onAssignQuery","getApplicableRule","findBestStaffMatch","useQueryAssignment","activeStaff","useActiveStaffData","renderPriorityBadge","priority","p","toLowerCase","label","charAt","toUpperCase","slice","jsx","Badge","variant","children","getAssignedStaff","query","key","assignedTo","find","s","uuid","String","id","name","getBestMatchRule","bestStaff","getAssignmentReason","className","Table","TableHeader","TableRow","TableHead","TableBody","filter","q","status","length","map","jsxs","TableCell","destination","country","cities","join","paxDetails","adults","infants","travelDates","from","Button","size","onClick","colSpan","assignedStaff","Avatar","AvatarFallback","AssignmentRules","onEditRules","rules","setRules","useState","loading","setLoading","selectedRuleId","setSelectedRuleId","useEffect","mounted","data","listAssignmentRules","describeRuleType","type","Card","CardHeader","CardTitle","CardContent","rule","isEnabled","Boolean","enabled","isSelected","role","rule_type","Switch","checked","onCheckedChange","async","ruleId","prev","r","error","updateAssignmentRuleEnabled","handleToggleRule","Label","htmlFor","RULE_OPTIONS","value","AssignmentRulesEditor","onClose","toast","useToast","setError","newRule","setNewRule","conditions","loadRules","Input","onChange","e","target","Select","onValueChange","val","SelectTrigger","SelectValue","placeholder","SelectContent","opt","SelectItem","Number","patch","updateAssignmentRule","title","description","message","handleUpdate","deleteAssignmentRule","handleDelete","trim","createAssignmentRule","Separator","StaffSequence","staff","getCountryById","useRealTimeCountriesData","toCountryName","sequenceStaff","setSequenceStaff","isEditing","setIsEditing","addStaffDialogOpen","setAddStaffDialogOpen","selectedStaffId","setSelectedStaffId","ignore","StaffSequenceService","fetchSequence","mapped","row","found","staff_id","sequenceOrder","sequence_order","autoAssignEnabled","auto_assign_enabled","email","department","assigned","workloadCapacity","expertise","active","avatar","availability","sort","a","b","load","availableStaff","useMemo","some","sequenceMember","moveStaff","index","direction","newList","targetIndex","temp","forEach","idx","then","payload","upsertSequence","catch","Plus","rowKey","sequenceUuid","selectId","GripVertical","Fragment","item","i","updateAutoAssign","handleToggleStaffAutoAssign","disabled","ArrowUp","ArrowDown","staffId","staffToRemove","removeStaff","handleRemoveStaff","Trash","Dialog","open","onOpenChange","DialogContent","DialogHeader","DialogTitle","DialogDescription","toString","selectedStaff","DialogFooter","staffToAdd","addStaff","AssignQueries","navigate","useNavigate","location","useLocation","activeTab","setActiveTab","assignDialogOpen","setAssignDialogOpen","editRulesDialogOpen","setEditRulesDialogOpen","seeding","setSeeding","seedLogs","setSeedLogs","debugAssignments","setDebugAssignments","searchParams","URLSearchParams","search","isDebug","get","autoSeed","assigningQuery","isAssigning","autoAssignHydrated","setAssigningQuery","setAutoAssignEnabled","assignQueryToStaff","autoAssignQueries","isLoading","refetch","useEnquiries","page","pageSize","field","unassignedQueries","assignedQueries","allQueries","handleAssignQuery","recommendedStaff","getExpertiseMatch","destinations","matches","exp","dest","includes","Math","round","getWorkloadStatus","percentage","color","bgColor","logs","seedAssignmentTestData","ids","entries","Promise","all","getEnquiryById","assignedIds","nameMap","Map","staffRows","supabase","select","in","set","missing","has","profRows","username","snapshots","assignedName","PageLayout","ArrowLeft","UserRound","ArrowRightLeft","MapPin","AlertCircle","CheckCircle","User","l","Tabs","TabsList","TabsTrigger","TabsContent","tripDuration","days","nights","agentName","agentId","Star","parseInt","member","workloadStatus","expertiseMatch","isSuperAdmin","roleLabel","replace","c","Award","TrendingUp","Progress","Clock","useInventoryData","setData","hotels","restaurants","sightseeing","transportRoutes","countries","currency","currencySymbol","refreshData","loadData","hotelData","localStorage","getItem","JSON","parse","getSavedHotelData","sightseeingDataFromStorage","sightseeingData","getSavedSightseeingData","restaurantData","initialRestaurants","restaurant","vegOptions","dietaryOptions","vegetarian","currencyCode","getSavedRestaurantData","transportData","rows","listTransportRoutes","mapRouteRowToProposalRoute","err","route","to","distance","duration","transportType","price","getSavedTransportData","finalHotelData","processedSightseeingData","adult","child","citiesData","countriesData","citiesResponse","CitiesService","getAllCities","success","Array","isArray","countriesResponse","CountriesService","getAllCountries","prevData","handleStorageChange","window","addEventListener","removeEventListener","AgentSelector","countryFilter","cityFilter","queryId","setOpen","agents","useSupabaseAgentsList","filteredAgents","list","cf","byCountry","ct","byCity","city","highPerformers","selectedAgent","numeric","toNumericAgentId","renderAgentItem","agent","agencyName","stats","conversionRate","totalBookings","Popover","PopoverTrigger","asChild","cn","ChevronDown","PopoverContent","align","Command","CommandInput","CommandList","CommandEmpty","CommandGroup","heading","CommandItem","onSelect","numId","Check","CityCheckboxSelector","selectedCities","onCitiesChange","cityAllocations","onCityAllocationsChange","isOptionalEnabled","onOptionalToggle","cityOptionalFlags","onCityOptionalChange","getCitiesByCountry","useCitiesData","availableCities","optionalCities","setOptionalCities","React","Set","isOptional","cityName","Checkbox","alloc","cityId","handleCityToggle","optional","newOptionalCities","add","delete","handleCityOptionalToggle","CountryCitySelector","onDestinationChange","getActiveCountries","activeCountries","EditQuery","encodedId","useParams","decodeURIComponent","BreadcrumbNav","customPaths","EnquiryForm","enquiryId","UUID_REGEX","convertItineraryDayToProposalDay","day","activities","activity","cost","category","timeSlot","popularity","seasonalScore","budgetFit","travelerTypeScore","AdvancedProposalCreation","user","useAuth","setQuery","activeView","setActiveView","urlParams","initialTab","itineraryData","setItineraryData","lastSaved","setLastSaved","optionalRecords","setOptionalRecords","hasShownDraftLoadedToast","setHasShownDraftLoadedToast","actionLoading","setActionLoading","showValidationDialog","setShowValidationDialog","showProgressDialog","setShowProgressDialog","skippedRules","setSkippedRules","recentLogsRef","useRef","isTabSwitching","setIsTabSwitching","tabLabel","now","Date","last","current","createWorkflowEvent","enquiryBusinessId","eventType","userId","userName","userRole","details","metadata","action","tab","source","timeoutId","setTimeout","Object","keys","isUuid","test","updateQuery","update","optional_records","last_saved","toISOString","eq","clearTimeout","totalCost","addDay","updateDay","removeDay","saveDraft","generateProposal","proposalLoading","useProposalBuilder","draftType","autoLoadDraft","proposalManagementData","setProposalManagementData","loadProposalManagementData","useCallback","persistentDataKey","savedData","parsedData","termsConditions","emailData","pricingConfig","hasProposalManagementData","managementData","validationRules","hasErrors","useProposalValidation","isGenerating","currentProgress","generationSteps","handleGenerateWithProgress","useProposalGeneration","calculateTripDuration","currencyInfo","getCurrencyByCountry","loadSavedItineraryData","hasSavedData","saveKey","saved","removeItem","saveItineraryData","actionType","saveData","version","setItem","stringify","handleTabChange","newTab","params","newUrl","pathname","history","replaceState","handleItineraryDataChange","newData","proposalId","proposalUpdateQuery","updated_at","proposalError","enquiryError","city_allocations","saveOptionalRecords","Error","queryData","ProposalService","getQueryByIdAsync","proposalQuery","proposalData","maybeSingle","cityOptionalRecords","allocation","updatedAt","storedTab","loadQuery","accommodations","transport","values","meals","savedDraftId","Save","latestManagementData","Shield","floor","toLocaleDateString","code","symbol","formatCurrency","TabErrorBoundary","tabName","DayByDayItineraryBuilder","initialDays","onDataChange","onSave","onToggleCityOptional","existingCities","existingIndex","findIndex","record","updated","newRecord","ProposalManagement","EnhancedDayPlanningInterface","onAddDay","onUpdateDay","dayId","updates","convertedUpdates","startTime","split","endTime","onRemoveDay","ProposalSummaryView","EnhancedValidationDialog","isOpen","onProceed","onSkipRule","GenerationProgressDialog","steps","QueryManagement","EnhancedQueryManagement","CreateQuery","getAgentById","useAgentData","selectedAgentId","setSelectedAgentId","selectedAgentName","setSelectedAgentName","setDestination","setPaxDetails","setTravelDates","isEstimated","packageType","setPackageType","specialRequests","setSpecialRequests","budget","setBudget","min","max","notes","setNotes","communicationPreference","setCommunicationPreference","hotelDetails","setHotelDetails","rooms","inclusions","setInclusions","transfers","mealPlan","transportTypes","manualDuration","setManualDuration","isManualDuration","setIsManualDuration","setCityAllocations","optionalCityAllocations","setOptionalCityAllocations","setOptionalEnabled","useOptionalCities","setCityOptionalFlags","optionalSightseeingOptions","setOptionalSightseeingOptions","optionalTransportOptions","setOptionalTransportOptions","timeDiff","getTime","ceil","handleTransportTypeChange","nextTransportTypes","transfersText","handleManualDurationChange","numValue","totalPax","today","Users","CalendarDays","onSubmit","preventDefault","selectedCountryCode","getCountryCodeByName","EnqIdGenerator","prepareConfig","generateEnqId","numericAgentId","supabaseAgent","findSupabaseAgentByNumericId","agentUuid","finalCityAllocations","existing","merged","estimatedCost","push","req","created","createEnquiry","onAgentChange","localAgent","inputMode","CalendarIcon","format","Calendar","selected","date","initialFocus","modifiers","modifiersStyles","backgroundColor","fontWeight","departureDate","calculatedDuration","Edit3","CityNightAllocator","onAllocationsChange","onGenerateDays","allocations","RadioGroup","RadioGroupItem","Car","DollarSign","request","updateSpecialRequest","_","removeSpecialRequest","Textarea","toLocaleString","QueryDetails","useSearchParams","proposals","setProposals","setIsLoading","sendDialogOpen","setSendDialogOpen","selectedProposal","setSelectedProposal","sendOptions","setSendOptions","method","recipient","subject","urgency","selectedModules","setSelectedModules","proposalState","setProposalState","statusUpdating","setStatusUpdating","uniqueProposals","getProposalsByQueryId","proposal","self","modules","isNewAssignment","createdAt","estimatedRevenue","formatDestinationCurrency","amount","toFixed","groupedModules","groups","hotel","other","module","Link","year","month","EnhancedStatusBadge","travelDate","daysUntilTravel","calculatePriority","showProgress","newStatus","oldStatus","updatePayload","updateEnquiry","queryWorkflowService","createStatusChangeEvent","workflowError","encodeURIComponent","Edit","Clock3","FileText","weekday","Hotel","Plane","CheckCircle2","SupabaseAgentDetailsCard","agentCompany","QueryAssignmentActions","ProposalActions","onProposalStateChange","onQueryUpdate","updatedQuery","EnquiryTimeline","totals","total","finalPrice","pricing","basePrice","roomType","roomCount","rating","checkIn","checkOut","amenities","amenity","vehicleType","capacity","pickupTime","pickupLocation","dropoffLocation","driverDetails","Landmark","difficulty","AlertTriangle","groupSize","entryFees","guideCost","transportIncluded","Utensils","cuisine","mealType","priceRange","seatingCapacity","reservationRequired","dresscode","specialFeatures","feature","moduleCount","subtotal","discountAmount","newProposalId","EnhancedProposalService","duplicateProposal","reload","duplicateId","Copy","handleViewProposalDetails","Eye","handleSendToAgent","Send","enableAutoStatusUpdate","QuickCreateQuery","onSuccess","activeAgents","setAgentId","isSubmitting","setIsSubmitting","generateQueryId","newQuery","updateCity","removeCity","isAutoAssignmentEnabled","useAutoAssignmentSettings","searchTerm","setSearchTerm","selectedStatus","setSelectedStatus","sortConfig","setSortConfig","showQuickCreate","setShowQuickCreate","showCountryAssignment","setShowCountryAssignment","selectedQuery","setSelectedQuery","viewMode","setViewMode","selectedQueries","setSelectedQueries","showAdvancedFilters","setShowAdvancedFilters","isRealTimeEnabled","setIsRealTimeEnabled","lastRefresh","setLastRefresh","setQueries","refreshTrigger","setRefreshTrigger","savedQueries","parsedQueries","mockQueries","sortedMockQueries","loadQueries","interval","setInterval","clearInterval","filteredQueries","useQueryFilters","useQueryPagination","itemsPerPage","handleSort","prevConfig","filteredAndSortedQueries","filtered","matchesSearch","matchesStatus","comparison","localeCompare","newQueries","inProgress","completed","new","proposalsSent","avgResponseTime","slaBreaches","handleSelectQuery","handleBulkExport","dataStr","dataBlob","Blob","url","URL","createObjectURL","link","document","createElement","href","download","click","handleQuickAssign","getSortIcon","ArrowUpDown","availableStaffCount","Activity","Zap","RefreshCw","Settings","Upload","Download","Alert","AlertDescription","Timer","BarChart3","AdvancedFilters","onFiltersChange","filters","onClearFilters","activeFiltersCount","BulkOperationsPanel","onClearSelection","onBulkAssign","staffMember","updatedQueries","sq","onBulkStatusUpdate","onBulkPriorityUpdate","onBulkExport","onBulkDelete","Grid3X3","List","Search","Filter","str","paxInfo","breakdown","formatPaxInfo","EnquiryListTable","CountryBasedAssignmentDialog","ResponsiveTestPanel","EnhancedQueryList","showActions","categorizeQuery","supabaseAgents","currentUser","useApp","hasAdminAccess","isStaff","useAccessControl","assignedNamesMap","setAssignedNamesMap","resolveProfileNameById","accessibleQueries","getStatusProgress","formatDate","dateString","handleViewEnquiry","lastUpdated","diffHours","getLastUpdated","queryPriority","score","getQueryPriority","newAssignment","supAgent","displayName","initial","profile_image","AvatarImage","src","alt","handleEditEnquiry","PlusCircle","defaultValue","Globe","Building2"],"mappings":"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"}