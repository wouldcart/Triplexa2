{"version":3,"file":"flushed-size-tracker.js","sourceRoot":"","sources":["../../../../../src/extensions/replay/external/flushed-size-tracker.ts"],"names":[],"mappings":";;;AAGA,IAAM,8BAA8B,GAAG,sBAAsB,CAAA;AAE7D;IAII,4BAAY,OAAgB;QACxB,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,yFAAyF,CAAC,CAAA;QAC9G,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;QACtD,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;IAClF,CAAC;IAED,sCAAS,GAAT,UAAU,IAAY;QAClB,IAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,8BAA8B,CAAC,CAAC,IAAI,CAAC,CAAA;QACrF,IAAM,QAAQ,GAAG,cAAc,GAAG,IAAI,CAAA;QACtC,IAAI,CAAC,YAAY,CAAC,8BAA8B,EAAE,QAAQ,CAAC,CAAA;IAC/D,CAAC;IAED,kCAAK,GAAL;QACI,OAAO,IAAI,CAAC,YAAY,CAAC,8BAA8B,EAAE,CAAC,CAAC,CAAA;IAC/D,CAAC;IAED,sBAAI,kDAAkB;aAAtB;YACI,OAAO,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,8BAA8B,CAAC,CAAC,IAAI,CAAC,CAAA;QACzE,CAAC;;;OAAA;IACL,yBAAC;AAAD,CAAC,AA1BD,IA0BC;AA1BY,gDAAkB","sourcesContent":["import { PostHog } from '../../../posthog-core'\nimport { Property } from '../../../types'\n\nconst SESSION_RECORDING_FLUSHED_SIZE = '$sess_rec_flush_size'\n\nexport class FlushedSizeTracker {\n    private readonly _getProperty: (property_name: string) => Property | undefined\n    private readonly _setProperty: (prop: string, to: any) => void\n\n    constructor(posthog: PostHog) {\n        if (!posthog.persistence) {\n            throw new Error('it is not valid to not have persistence and be this far into setting up the application')\n        }\n\n        this._getProperty = posthog.get_property.bind(posthog)\n        this._setProperty = posthog.persistence.set_property.bind(posthog.persistence)\n    }\n\n    trackSize(size: number) {\n        const currentFlushed = Number(this._getProperty(SESSION_RECORDING_FLUSHED_SIZE)) || 0\n        const newValue = currentFlushed + size\n        this._setProperty(SESSION_RECORDING_FLUSHED_SIZE, newValue)\n    }\n\n    reset() {\n        return this._setProperty(SESSION_RECORDING_FLUSHED_SIZE, 0)\n    }\n\n    get currentTrackedSize(): number {\n        return Number(this._getProperty(SESSION_RECORDING_FLUSHED_SIZE)) || 0\n    }\n}\n"]}